(self.webpackChunkInvocationlab_ERD_Online=self.webpackChunkInvocationlab_ERD_Online||[]).push([[4966],{14945:function(P,w){var h={UNKNOWN:0,KEYWORD:1,NUMBER:2,STRING:3,FUNCTION:4,VARIABLE:5,PARAMS:6,OPERATOR:7,COMMAS:8,MEMORY:9,COMMENT:99},b=function(f){for(var s=[],E=h.UNKNOWN,u="",c="",d="",y="",g=0;g<f.length;g++){if(c=f.charAt(g),c=="/"&&f.charAt(g+1)=="*"){for(u="",g++;++g<f.length;){if(d=f.charAt(g),y=f.charAt(g+1),d=="*"&&y=="/"){u=u.substr(0,u.length-1),g++;break}u===""?u+=d+y:u+=y}s[s.length]={text:u.replace(/^[\*\s]+/,"").replace(/[\s\*]+$/,""),type:h.COMMENT}}else if(c=="'"||c=='"'||c=="`"){for(u="";g<f.length&&c!=(d=f.charAt(++g));)u+=d=="\\"?f.charAt(++g):d;s[s.length]={text:u,type:c=="`"?h.VARIABLE:h.STRING}}else if(c==":"){for(u=c;g<f.length&&(d=f.charAt(++g),!!/^\w+$/i.test(d));)u+=d;g--,s[s.length]={text:u,type:h.PARAMS}}else if(/^[a-z_]+$/i.test(c)){for(u=c;g<f.length&&(d=f.charAt(++g),!!/^[\w\.:]+$/i.test(d));)u+=d;g--,s[s.length]={text:u,type:d=="("?h.FUNCTION:h.KEYWORD}}else if(c=="-"&&h.VARIABLE!=E||/\d+/.test(c)){for(u=c;g<f.length&&(d=f.charAt(++g),!!/^[\d\.]+$/.test(d));)u+=d;g--,u=="-"?s[s.length]={text:"-",type:h.OPERATOR}:s[s.length]={text:u-0,type:h.NUMBER}}else if(/^[\,;\(\)]+$/.test(c))s[s.length]={text:c,type:h.COMMAS};else if(/^(\+|\-|\*|\/|>|<|=|!)$/.test(c)){for(u=c;g<f.length&&(d=f.charAt(++g),!!/^(\+|\*|\/|>|<|=|!)+$/.test(d));)u+=d;g--,s[s.length]={text:u,type:h.OPERATOR}}E=s.length===0?E:s[s.length-1].type}return s},v=function(f){this.tokens=f instanceof Array?f:b(f.toString()),this.blocks=[];for(var s=0,E={"(":1,")":-1},u=0;u<this.tokens.length;++u){var c=this.tokens[u];c.type==h.COMMAS&&E[c.text]!==void 0?s+=E[c.text]:s||(this.blocks[this.blocks.length]=u)}};v.prototype.getAll=function(){return this.tokens},v.prototype.indexOf=function(O,c){var s=0,E=null;try{var u=new RegExp(O.text,"i")}catch(y){var u=O.text.toLowerCase()}for(var c=c==null?0:c+1,d=0;d<this.blocks.length;++d)if(s=this.blocks[d],!(s<c)&&(E=this.tokens[s],O.type==E.type&&(u instanceof RegExp&&u.test(E.text)||u==E.text.toLowerCase())))return this.blocks[d];return-1},w.vars=function(O,f,s){var E;if(s){var u=new v(f);f=u.getAll()}if(!f[O])return null;switch(f[O].type){case h.OPERATOR:E=[f[O-1],f[O+1]];break;case h.FUNCTION:E=[];for(var c=[],d=0,y=O+1,g=f.length;y<g;y++){var e=f[y];if(e.type!=h.COMMAS){c.push(e);continue}switch(e.text){case"(":d>0&&c.push(e),d++;break;case")":if(--d==0){E.push(c),c=[],y=g;break}else c.push(e);break;case",":d==1?(E.push(c),c=[]):c.push(e);break;default:break}}break;default:E=null;break}return E},w.text=function(O,f){var s=[];for(var E in O){var u=O[E];if(!u||!u.type||u.text==null)s.push(null);else switch(u.type){case h.STRING:s.push("'"+u.text+"'");break;case h.VARIABLE:s.push(u.text);break;default:s.push(u.text);break}f&&s.push(f)}return f&&s.pop(),s},w.types=h,w.create=function(O){return new v(O)}},53406:function(P,w,h){var b=h(14945),v=h(22904),O=h(93363);function f(n){for(var t=[],a=0,o=0,r=0;r<n.length;r++){var l=n[r].text;if(l==="("){a++;continue}if(l===")"){a--;continue}a===0&&/^UNION$/i.test(l)&&n[r].type===b.types.KEYWORD&&(t.push(v.removeParenthese(n.slice(o,r))),o=r+1)}return t.push(v.removeParenthese(n.slice(o))),t}function s(n){for(var t=[],a={},o=0,r=0,l=0;l<n.length;l++){var i=n[l].text,R=n[l].type;if(i==="("){r++;continue}if(i===")"){r--;continue}if(!(r!==0||R!==b.types.KEYWORD)){if(/^SELECT$/i.test(i)){if(a.column!==void 0)continue;t.push({keyword:"column",pos:l}),a.column=!0}else if(/^FROM$/i.test(i)){if(a.source!==void 0)continue;t.push({keyword:"source",pos:l}),a.source=!0}else if(/^(JOIN|INNER|OUTER|LEFT|RIGHT)$/i.test(i)){if(a.joinmap!==void 0)continue;t.push({keyword:"joinmap",pos:l}),a.joinmap=!0}else if(/^WHERE$/i.test(i)){if(a.where!==void 0)continue;t.push({keyword:"where",pos:l}),a.where=!0}else if(/^GROUP$/i.test(i)){if(a.groupby!==void 0)continue;t.push({keyword:"groupby",pos:l}),a.groupby=!0}else if(/^ORDER$/i.test(i)){if(a.orderby!==void 0)continue;t.push({keyword:"orderby",pos:l}),a.orderby=!0}else if(/^LIMIT$/i.test(i)){if(a.limit!==void 0)continue;t.push({keyword:"limit",pos:l}),a.limit=!0}}}for(var L={},l=1;l<t.length;l++)L[t[l-1].keyword]=n.slice(t[l-1].pos,t[l].pos);return L[t[t.length-1].keyword]=n.slice(t[t.length-1].pos),L}function E(n){var t={},a=v.pickUp(n,",");a[0].shift();for(var o=0;o<a.length;o++){var r=a[o],l=null;/^(distinct|all|distinctrow)$/i.test(r[0].text)&&(r[0].text=r[0].text.toUpperCase(),l=r[0],r.shift());var i,R;r[r.length-1].type===b.types.KEYWORD||r[r.length-1].type===b.types.VARIABLE?(R=r[r.length-1].text.indexOf("."))===-1?(i=r[r.length-1].text,r.length===1?t[i]={dist:l,expr:r}:/^as$/i.test(r[r.length-2].text)?t[i]={dist:l,expr:r.slice(0,r.length-2)}:t[i]={dist:l,expr:r.slice(0,r.length-1)}):(i=r[r.length-1].text.substr(R+1),t[i]={dist:l,expr:r}):(i=v.merge(r,""),t[i]={dist:l,expr:r})}return t}w.parseColumn=E;function u(n){var t={},a=v.pickUp(n,",");a[0].shift();for(var o=0;o<a.length;o++){var r=v.parseOneSource(a[o]);t[r.name]={type:r.type,source:r.source}}return t}w.parseSource=u;function c(n){for(var t={},a=v.pickUp(n,"JOIN"),o=void 0,r=0;r<a.length;r++){var l=a[r];if(l.length===1){o=l[0].text.toUpperCase();continue}var i=o===void 0?"INNER JOIN":o+" JOIN",R,L,J;o=/^(LEFT|RIGHT|OUTER|INNER)$/i.test(l[l.length-1].text)?l.pop().text:void 0;for(var S=void 0,A=0;A<l.length;A++)if(/^on$/i.test(l[A].text)){S=A;var k=l.slice(0,A),U=v.parseOneSource(k);J=U.name,R=U.type,L=U.source;break}if(S===void 0)throw new Error("no keyword 'on' in join part");var W=[],D=S+1;l.push({text:"and",type:1});for(var A=D;A<l.length;A++)if(/^and$/i.test(l[A].text)){var F=l.slice(D,A);W.push(v.parseOneWhere(F)),D=A+1}t[J]={type:R,source:L,method:v.JOIN[i.toUpperCase()],where:W}}return t}w.parseJoinmap=c;function d(n){var t=[],a=v.pickUp(n,"and");return a[0].shift(),a.forEach(function(o){t.push(v.parseOneWhere(o))}),t}w.parseWhere=d;function y(n){var t=[],a=v.pickUp(n,",");return a[0].shift(),a[0].shift(),a.forEach(function(o){t.push(o)}),t}w.parseGroupby=y;function g(n){var t=[],a=v.pickUp(n,",");a[0].shift(),a[0].shift();for(var o=0;o<a.length;o++){var r=a[o],l,i=r[r.length-1].text.toUpperCase();/^(ASC|DESC)$/i.test(i)?(l=v.ORDER[i],r.pop()):l=v.ORDER.ASC,r.length!==0&&t.push({type:l,expr:r})}return t}w.parseOrderby=g;function e(n){var t=[],a=v.pickUp(n,",");a[0].shift();for(var o=0;o<a.length;o++){var r=a[o];if(r.length>=2)throw new Error("something wrong in 'limit' part");t.push(r[0])}return t.length===1&&t.unshift({text:0,type:2}),t}w.parseLimit=e,w.createObj=function(n){for(var t=[],a=b.create(n).getAll(),o=f(a),r=0;r<o.length;r++){var l={},i=s(o[r]),R=v.getHint(i.column,1);R&&(l.hint=R),i.column&&(l.column=E(i.column)),i.source&&(l.source=u(i.source)),i.joinmap&&(l.joinmap=c(i.joinmap)),i.where&&(l.where=d(i.where)),i.groupby&&(l.groupby=y(i.groupby)),i.orderby&&(l.orderby=g(i.orderby)),i.limit&&(l.limit=e(i.limit)),t.push(l)}return t}},22904:function(P,w,h){var b=h(14945),v={"=":1,">":2,">=":3,"<":4,"<=":5,"<>":6,"!=":6,in:7,"not in":8,like:9,"not like":10,between:11,"is null":20,"not null":21};w.RELATE=v;var O={ASC:1,DESC:2};w.ORDER=O;var f={"INNER JOIN":1,"OUTER JOIN":2,"LEFT JOIN":3,"RIGHT JOIN":4};w.JOIN=f;function s(e){if(e[0]===void 0||e[0].text!=="(")return e;for(var n=0,t=0;t<e.length;t++)e[t].text==="("&&n++,e[t].text===")"&&n--;if(n===0&&e[e.length-1].text===")")return e.pop(),e.shift(),s(e);throw new Error("lack parenthese")}w.removeParenthese=s;function E(e,n){n=n===void 0?" ":n;for(var t="",a=0;a<e.length;a++)t+=e[a].text+n;return t.substr(0,t.length-n.length)}w.merge=E;function u(e,n){e.push({text:n});for(var t=[],a=0,o=0,r=0;r<e.length;r++)if(e[r].text==="("&&o++,e[r].text===")"&&o--,new RegExp("^"+n+"$","i").test(e[r].text)&&o===0){var l=e.slice(a,r);if(l.length===0){a=r+1;continue}t.push(l),a=r+1}return t}w.pickUp=u;function c(e,n){var t=void 0;if(e&&e[n]&&e[n].type===b.types.COMMENT){t=e[n];for(var a=e.slice(0,n),o=0;o<=n;o++)e.shift();for(;a.length>0;)e.unshift(a.pop())}return t}w.getHint=c;function d(e){var n,t,a,o,r=e[0].text.indexOf(".");if(t=e[0].text.substr(0,r),r===-1)if(e[0].text==="("){for(var l=1,i=1;i<e.length;i++)if(e[i].text==="("&&l++,e[i].text===")"&&l--,l===0){a=E(e.slice(1,i)," "),e=e.slice(i+1,e.length);break}}else a=e[0].text,e.shift();else if(r===e[0].text.length-1){if(e[1].text!=="(")throw new Error("something wrong in 'source' part");var l=0,i;for(i=1;i<e.length;i++)if(e[i].text==="("&&l++,e[i].text===")"&&l--,l===0){a=E(e.slice(2,i)," "),e=e.slice(i+1,e.length);break}if(i===e.length)throw new Error("lack parentheses in 'source' part")}else a=e[0].text.substr(r+1),e.shift();if(e.length===0)o={name:a,type:t,source:a};else{if(e.length>=3||e.length===2&&!/^as$/i.test(e[0].text)||e[e.length-1].type!==b.types.KEYWORD&&e[e.length-1].type!==b.types.VARIABLE)throw new Error("something wrong in 'source' part");o={name:e[e.length-1].text,type:t,source:a}}return o}w.parseOneSource=d;function y(e){var n={},t=e[1];if(n.column=e[0],!t)return n;if(t.type===b.types.OPERATOR){if(v[t.text]===void 0)throw new Error("unrecognized operator");n.relate=v[t.text],n.values=g(e.slice(2),",")}else if(t.text.toLowerCase()==="between")n.relate=v[t.text.toLowerCase()],n.values=g(e.slice(3,e.length-1),"and");else if(t.text.toLowerCase()==="in")n.relate=v[t.text.toLowerCase()],n.values=g(e.slice(3,e.length-1),",");else if(t.text.toLowerCase()==="like")n.relate=v[t.text.toLowerCase()],n.values=[[e[2]]];else if(t.text.toLowerCase()==="is")if(e[2].text.toLowerCase()==="not")n.relate=v["not null"],n.values=null;else if(e[2].text.toLowerCase()==="null")n.relate=v["is null"],n.values=null;else throw new Error('wrong key word after "is"');else if(t.text.toLowerCase()==="not")if(e[2].text.toLowerCase()==="in")n.relate=v["not in"],n.values=g(e.slice(4,e.length-1),",");else if(e[2].text.toLowerCase()==="like")n.relate=v["not like"],n.values=[[e[3]]];else throw new Error('wrong key word after "not"');else throw new Error("unrecognized relate");return n}w.parseOneWhere=y;function g(e,n){n=new RegExp(n,"i");var t=[],a=0,o=[];for(var r in e)n.test(e[r].text)?(t.push(o),o=[]):o.push(e[r]);return o.length!==0&&t.push(o),t}},54507:function(P,w,h){var b=h(22904),v=h(14945),O={select:h(53406)};w.parse=function(f){f=f.trim();var s=f.substr(0,f.indexOf(" ")).toLowerCase();if(O[s]===void 0)throw new Error("Unsupport sentence");return O[s].createObj(f)},w.RELATE=b.RELATE,w.JOIN=b.JOIN,w.ORDER=b.ORDER,w.types=v.types},4966:function(P,w,h){"use strict";h.d(w,{Z:function(){return r}});var b=h(9116),v=h.n(b),O=h(5678),f=h.n(O),s=h(98404),E=h(44761),u=h(9797),c=h(56097),d=h(81101),y=h(91260),g=h(13642),e=h(54507),n=h(36422),t=new Map,a=new Map,o=function(i){var R=i.selectDB,L=i.mode,J=i.height,S=i.width,A=i.name,k=i.placeholder,U=i.value,W=i.theme,D=i.onChange,F=i.tables,$=(0,s.useRef)(null),V=function(){var N=F||[];a.set(R,{});var C=N.map(function(x){var T={name:x.title,value:x.title,meta:x.chnname};return a.get(R)[x.title]=x.fields.map(function(p){return{name:p.name,value:p.name,meta:"".concat(p.chnname,"(").concat(x.title,")"),remarks:p.chnname,dataType:p.dataType,notNull:p.notNull,autoIncrement:p.autoIncrement,defaultValue:p.defaultValue,pk:p.pk}}),T});t.set(R,C)},B=function(N){var C=[];try{var x=e.parse(N),T=Object.entries(x[0].source);x[0].joinmap&&T.push.apply(T,f()(Object.entries(x[0].joinmap))),T.forEach(function(p){var m=v()(p,2),I=m[0],H=m[1],j=H.source,G=a.get(R)[j];G&&C.push.apply(C,f()(G)),I!==j&&C.push({name:I,value:I,meta:j})})}catch(p){}return C};return(0,s.useImperativeHandle)(i.onRef,function(){return{selectLine:function(){return $.current.editor.selection.selectLine()},getEditor:function(){return $.current.editor},getSelectValue:function(){return $.current.editor.getSelectedText()},setSelectValue:function(N){return $.current.editor.insert(N)},getDbTableFieldsMap:function(N){var C={},x=a.get(R)[N];if(!x)return C;for(var T=0;T<x.length;T++){var p=x[T];C[p.name]=p}return C}}}),t.get(R)||V(),(0,s.useEffect)(function(){(0,d.addCompleter)({getCompletions:function(N,C,x,T,p){var m=C.getTextRange({start:{row:x.row,column:0},end:{row:x.row,column:2e3}}).toLowerCase(),I=[];if(m.includes("select")&&m.includes("from")){I=B(m),p(null,t.get(R).concat(I));return}m=C.getTextRange({start:{row:0,column:0},end:{row:100,column:2e3}}),m=m.replace(/[\r\n]/g," ").replace(/\s{2,}/g," "),I=B(m),p(null,t.get(R).concat(I))}})},[]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(E.ZP,{ref:$,width:S||"100%",height:J||"180px",mode:L||"sql",theme:W||"xcode",placeholder:k||"",onChange:D,name:A||"ace-editor",value:U,editorProps:{$blockScrolling:!0},fontSize:"14px",showGutter:!0,highlightActiveLine:!0,showPrintMargin:!1,setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,wrap:!1}})})},r=s.memo(o)}}]);
