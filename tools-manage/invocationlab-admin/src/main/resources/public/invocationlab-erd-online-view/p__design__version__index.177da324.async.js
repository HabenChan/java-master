(self.webpackChunkInvocationlab_ERD_Online=self.webpackChunkInvocationlab_ERD_Online||[]).push([[7133],{27856:function(De,I,r){"use strict";var P=r(27789),S=r(9169),x=r(66626),E=r(98404),F=r(25632),A=r(36933),O=r(36422),m=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],j=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],w=function(y,u){var i=y.fieldProps,D=y.children,$=y.params,oe=y.proFieldProps,re=y.mode,de=y.valueEnum,K=y.request,_=y.showSearch,fe=y.options,t=(0,S.Z)(y,m),ve=(0,E.useContext)(F.Z);return(0,O.jsx)(A.Z,(0,P.Z)((0,P.Z)({valueEnum:(0,x.h)(de),request:K,params:$,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,P.Z)({options:fe,mode:re,showSearch:_,getPopupContainer:ve.getPopupContainer},i),ref:u,proFieldProps:oe},t),{},{children:D}))},R=E.forwardRef(function(p,y){var u=p.fieldProps,i=p.children,D=p.params,$=p.proFieldProps,oe=p.mode,re=p.valueEnum,de=p.request,K=p.options,_=(0,S.Z)(p,j),fe=(0,P.Z)({options:K,mode:oe||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},u),t=(0,E.useContext)(F.Z);return(0,O.jsx)(A.Z,(0,P.Z)((0,P.Z)({valueEnum:(0,x.h)(re),request:de,params:D,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,P.Z)({getPopupContainer:t.getPopupContainer},fe),ref:y,proFieldProps:$},_),{},{children:i}))}),a=E.forwardRef(w),g=R,c=a;c.SearchSelect=g,c.displayName="ProFormComponent",I.Z=c},12125:function(De,I,r){"use strict";var P=r(27789),S=r(9169),x=r(98404),E=r(36933),F=r(36422),A=["fieldProps","proFieldProps"],O=function(j,w){var R=j.fieldProps,a=j.proFieldProps,g=(0,S.Z)(j,A);return(0,F.jsx)(E.Z,(0,P.Z)({ref:w,valueType:"textarea",fieldProps:R,proFieldProps:a},g))};I.Z=x.forwardRef(O)},89591:function(De,I,r){"use strict";r.d(I,{Z:function(){return F}});var P=r(98404),S=r(28068),x=r(74169),E=r(42279);function F(){const A=(0,S.Z)(x.Z);return A[E.Z]||A}},52107:function(De,I){var r={UNKNOWN:0,KEYWORD:1,NUMBER:2,STRING:3,FUNCTION:4,VARIABLE:5,PARAMS:6,OPERATOR:7,COMMAS:8,MEMORY:9,COMMENT:99},P=function(E){for(var F=[],A=r.UNKNOWN,O="",m="",j="",w="",R=0;R<E.length;R++){if(m=E.charAt(R),m=="/"&&E.charAt(R+1)=="*"){for(O="",R++;++R<E.length;){if(j=E.charAt(R),w=E.charAt(R+1),j=="*"&&w=="/"){O=O.substr(0,O.length-1),R++;break}O===""?O+=j+w:O+=w}F[F.length]={text:O.replace(/^[\*\s]+/,"").replace(/[\s\*]+$/,""),type:r.COMMENT}}else if(m=="'"||m=='"'||m=="`"){for(O="";R<E.length&&m!=(j=E.charAt(++R));)O+=j=="\\"?E.charAt(++R):j;F[F.length]={text:O,type:m=="`"?r.VARIABLE:r.STRING}}else if(m==":"){for(O=m;R<E.length&&(j=E.charAt(++R),!!/^\w+$/i.test(j));)O+=j;R--,F[F.length]={text:O,type:r.PARAMS}}else if(/^[a-z_]+$/i.test(m)){for(O=m;R<E.length&&(j=E.charAt(++R),!!/^[\w\.:]+$/i.test(j));)O+=j;R--,F[F.length]={text:O,type:j=="("?r.FUNCTION:r.KEYWORD}}else if(m=="-"&&r.VARIABLE!=A||/\d+/.test(m)){for(O=m;R<E.length&&(j=E.charAt(++R),!!/^[\d\.]+$/.test(j));)O+=j;R--,O=="-"?F[F.length]={text:"-",type:r.OPERATOR}:F[F.length]={text:O-0,type:r.NUMBER}}else if(/^[\,;\(\)]+$/.test(m))F[F.length]={text:m,type:r.COMMAS};else if(/^(\+|\-|\*|\/|>|<|=|!)$/.test(m)){for(O=m;R<E.length&&(j=E.charAt(++R),!!/^(\+|\*|\/|>|<|=|!)+$/.test(j));)O+=j;R--,F[F.length]={text:O,type:r.OPERATOR}}A=F.length===0?A:F[F.length-1].type}return F},S=function(E){this.tokens=E instanceof Array?E:P(E.toString()),this.blocks=[];for(var F=0,A={"(":1,")":-1},O=0;O<this.tokens.length;++O){var m=this.tokens[O];m.type==r.COMMAS&&A[m.text]!==void 0?F+=A[m.text]:F||(this.blocks[this.blocks.length]=O)}};S.prototype.getAll=function(){return this.tokens},S.prototype.indexOf=function(x,m){var F=0,A=null;try{var O=new RegExp(x.text,"i")}catch(w){var O=x.text.toLowerCase()}for(var m=m==null?0:m+1,j=0;j<this.blocks.length;++j)if(F=this.blocks[j],!(F<m)&&(A=this.tokens[F],x.type==A.type&&(O instanceof RegExp&&O.test(A.text)||O==A.text.toLowerCase())))return this.blocks[j];return-1},I.vars=function(x,E,F){var A;if(F){var O=new S(E);E=O.getAll()}if(!E[x])return null;switch(E[x].type){case r.OPERATOR:A=[E[x-1],E[x+1]];break;case r.FUNCTION:A=[];for(var m=[],j=0,w=x+1,R=E.length;w<R;w++){var a=E[w];if(a.type!=r.COMMAS){m.push(a);continue}switch(a.text){case"(":j>0&&m.push(a),j++;break;case")":if(--j==0){A.push(m),m=[],w=R;break}else m.push(a);break;case",":j==1?(A.push(m),m=[]):m.push(a);break;default:break}}break;default:A=null;break}return A},I.text=function(x,E){var F=[];for(var A in x){var O=x[A];if(!O||!O.type||O.text==null)F.push(null);else switch(O.type){case r.STRING:F.push("'"+O.text+"'");break;case r.VARIABLE:F.push(O.text);break;default:F.push(O.text);break}E&&F.push(E)}return E&&F.pop(),F},I.types=r,I.create=function(x){return new S(x)}},95430:function(De,I,r){var P=r(52107),S=r(91459),x=r(93363);function E(g){for(var c=[],p=0,y=0,u=0;u<g.length;u++){var i=g[u].text;if(i==="("){p++;continue}if(i===")"){p--;continue}p===0&&/^UNION$/i.test(i)&&g[u].type===P.types.KEYWORD&&(c.push(S.removeParenthese(g.slice(y,u))),y=u+1)}return c.push(S.removeParenthese(g.slice(y))),c}function F(g){for(var c=[],p={},y=0,u=0,i=0;i<g.length;i++){var D=g[i].text,$=g[i].type;if(D==="("){u++;continue}if(D===")"){u--;continue}if(!(u!==0||$!==P.types.KEYWORD)){if(/^SELECT$/i.test(D)){if(p.column!==void 0)continue;c.push({keyword:"column",pos:i}),p.column=!0}else if(/^FROM$/i.test(D)){if(p.source!==void 0)continue;c.push({keyword:"source",pos:i}),p.source=!0}else if(/^(JOIN|INNER|OUTER|LEFT|RIGHT)$/i.test(D)){if(p.joinmap!==void 0)continue;c.push({keyword:"joinmap",pos:i}),p.joinmap=!0}else if(/^WHERE$/i.test(D)){if(p.where!==void 0)continue;c.push({keyword:"where",pos:i}),p.where=!0}else if(/^GROUP$/i.test(D)){if(p.groupby!==void 0)continue;c.push({keyword:"groupby",pos:i}),p.groupby=!0}else if(/^ORDER$/i.test(D)){if(p.orderby!==void 0)continue;c.push({keyword:"orderby",pos:i}),p.orderby=!0}else if(/^LIMIT$/i.test(D)){if(p.limit!==void 0)continue;c.push({keyword:"limit",pos:i}),p.limit=!0}}}for(var oe={},i=1;i<c.length;i++)oe[c[i-1].keyword]=g.slice(c[i-1].pos,c[i].pos);return oe[c[c.length-1].keyword]=g.slice(c[c.length-1].pos),oe}function A(g){var c={},p=S.pickUp(g,",");p[0].shift();for(var y=0;y<p.length;y++){var u=p[y],i=null;/^(distinct|all|distinctrow)$/i.test(u[0].text)&&(u[0].text=u[0].text.toUpperCase(),i=u[0],u.shift());var D,$;u[u.length-1].type===P.types.KEYWORD||u[u.length-1].type===P.types.VARIABLE?($=u[u.length-1].text.indexOf("."))===-1?(D=u[u.length-1].text,u.length===1?c[D]={dist:i,expr:u}:/^as$/i.test(u[u.length-2].text)?c[D]={dist:i,expr:u.slice(0,u.length-2)}:c[D]={dist:i,expr:u.slice(0,u.length-1)}):(D=u[u.length-1].text.substr($+1),c[D]={dist:i,expr:u}):(D=S.merge(u,""),c[D]={dist:i,expr:u})}return c}I.parseColumn=A;function O(g){var c={},p=S.pickUp(g,",");p[0].shift();for(var y=0;y<p.length;y++){var u=S.parseOneSource(p[y]);c[u.name]={type:u.type,source:u.source}}return c}I.parseSource=O;function m(g){for(var c={},p=S.pickUp(g,"JOIN"),y=void 0,u=0;u<p.length;u++){var i=p[u];if(i.length===1){y=i[0].text.toUpperCase();continue}var D=y===void 0?"INNER JOIN":y+" JOIN",$,oe,re;y=/^(LEFT|RIGHT|OUTER|INNER)$/i.test(i[i.length-1].text)?i.pop().text:void 0;for(var de=void 0,K=0;K<i.length;K++)if(/^on$/i.test(i[K].text)){de=K;var _=i.slice(0,K),fe=S.parseOneSource(_);re=fe.name,$=fe.type,oe=fe.source;break}if(de===void 0)throw new Error("no keyword 'on' in join part");var t=[],ve=de+1;i.push({text:"and",type:1});for(var K=ve;K<i.length;K++)if(/^and$/i.test(i[K].text)){var ae=i.slice(ve,K);t.push(S.parseOneWhere(ae)),ve=K+1}c[re]={type:$,source:oe,method:S.JOIN[D.toUpperCase()],where:t}}return c}I.parseJoinmap=m;function j(g){var c=[],p=S.pickUp(g,"and");return p[0].shift(),p.forEach(function(y){c.push(S.parseOneWhere(y))}),c}I.parseWhere=j;function w(g){var c=[],p=S.pickUp(g,",");return p[0].shift(),p[0].shift(),p.forEach(function(y){c.push(y)}),c}I.parseGroupby=w;function R(g){var c=[],p=S.pickUp(g,",");p[0].shift(),p[0].shift();for(var y=0;y<p.length;y++){var u=p[y],i,D=u[u.length-1].text.toUpperCase();/^(ASC|DESC)$/i.test(D)?(i=S.ORDER[D],u.pop()):i=S.ORDER.ASC,u.length!==0&&c.push({type:i,expr:u})}return c}I.parseOrderby=R;function a(g){var c=[],p=S.pickUp(g,",");p[0].shift();for(var y=0;y<p.length;y++){var u=p[y];if(u.length>=2)throw new Error("something wrong in 'limit' part");c.push(u[0])}return c.length===1&&c.unshift({text:0,type:2}),c}I.parseLimit=a,I.createObj=function(g){for(var c=[],p=P.create(g).getAll(),y=E(p),u=0;u<y.length;u++){var i={},D=F(y[u]),$=S.getHint(D.column,1);$&&(i.hint=$),D.column&&(i.column=A(D.column)),D.source&&(i.source=O(D.source)),D.joinmap&&(i.joinmap=m(D.joinmap)),D.where&&(i.where=j(D.where)),D.groupby&&(i.groupby=w(D.groupby)),D.orderby&&(i.orderby=R(D.orderby)),D.limit&&(i.limit=a(D.limit)),c.push(i)}return c}},91459:function(De,I,r){var P=r(52107),S={"=":1,">":2,">=":3,"<":4,"<=":5,"<>":6,"!=":6,in:7,"not in":8,like:9,"not like":10,between:11,"is null":20,"not null":21};I.RELATE=S;var x={ASC:1,DESC:2};I.ORDER=x;var E={"INNER JOIN":1,"OUTER JOIN":2,"LEFT JOIN":3,"RIGHT JOIN":4};I.JOIN=E;function F(a){if(a[0]===void 0||a[0].text!=="(")return a;for(var g=0,c=0;c<a.length;c++)a[c].text==="("&&g++,a[c].text===")"&&g--;if(g===0&&a[a.length-1].text===")")return a.pop(),a.shift(),F(a);throw new Error("lack parenthese")}I.removeParenthese=F;function A(a,g){g=g===void 0?" ":g;for(var c="",p=0;p<a.length;p++)c+=a[p].text+g;return c.substr(0,c.length-g.length)}I.merge=A;function O(a,g){a.push({text:g});for(var c=[],p=0,y=0,u=0;u<a.length;u++)if(a[u].text==="("&&y++,a[u].text===")"&&y--,new RegExp("^"+g+"$","i").test(a[u].text)&&y===0){var i=a.slice(p,u);if(i.length===0){p=u+1;continue}c.push(i),p=u+1}return c}I.pickUp=O;function m(a,g){var c=void 0;if(a&&a[g]&&a[g].type===P.types.COMMENT){c=a[g];for(var p=a.slice(0,g),y=0;y<=g;y++)a.shift();for(;p.length>0;)a.unshift(p.pop())}return c}I.getHint=m;function j(a){var g,c,p,y,u=a[0].text.indexOf(".");if(c=a[0].text.substr(0,u),u===-1)if(a[0].text==="("){for(var i=1,D=1;D<a.length;D++)if(a[D].text==="("&&i++,a[D].text===")"&&i--,i===0){p=A(a.slice(1,D)," "),a=a.slice(D+1,a.length);break}}else p=a[0].text,a.shift();else if(u===a[0].text.length-1){if(a[1].text!=="(")throw new Error("something wrong in 'source' part");var i=0,D;for(D=1;D<a.length;D++)if(a[D].text==="("&&i++,a[D].text===")"&&i--,i===0){p=A(a.slice(2,D)," "),a=a.slice(D+1,a.length);break}if(D===a.length)throw new Error("lack parentheses in 'source' part")}else p=a[0].text.substr(u+1),a.shift();if(a.length===0)y={name:p,type:c,source:p};else{if(a.length>=3||a.length===2&&!/^as$/i.test(a[0].text)||a[a.length-1].type!==P.types.KEYWORD&&a[a.length-1].type!==P.types.VARIABLE)throw new Error("something wrong in 'source' part");y={name:a[a.length-1].text,type:c,source:p}}return y}I.parseOneSource=j;function w(a){var g={},c=a[1];if(g.column=a[0],!c)return g;if(c.type===P.types.OPERATOR){if(S[c.text]===void 0)throw new Error("unrecognized operator");g.relate=S[c.text],g.values=R(a.slice(2),",")}else if(c.text.toLowerCase()==="between")g.relate=S[c.text.toLowerCase()],g.values=R(a.slice(3,a.length-1),"and");else if(c.text.toLowerCase()==="in")g.relate=S[c.text.toLowerCase()],g.values=R(a.slice(3,a.length-1),",");else if(c.text.toLowerCase()==="like")g.relate=S[c.text.toLowerCase()],g.values=[[a[2]]];else if(c.text.toLowerCase()==="is")if(a[2].text.toLowerCase()==="not")g.relate=S["not null"],g.values=null;else if(a[2].text.toLowerCase()==="null")g.relate=S["is null"],g.values=null;else throw new Error('wrong key word after "is"');else if(c.text.toLowerCase()==="not")if(a[2].text.toLowerCase()==="in")g.relate=S["not in"],g.values=R(a.slice(4,a.length-1),",");else if(a[2].text.toLowerCase()==="like")g.relate=S["not like"],g.values=[[a[3]]];else throw new Error('wrong key word after "not"');else throw new Error("unrecognized relate");return g}I.parseOneWhere=w;function R(a,g){g=new RegExp(g,"i");var c=[],p=0,y=[];for(var u in a)g.test(a[u].text)?(c.push(y),y=[]):y.push(a[u]);return y.length!==0&&c.push(y),c}},33293:function(De,I,r){var P=r(91459),S=r(52107),x={select:r(95430)};I.parse=function(E){E=E.trim();var F=E.substr(0,E.indexOf(" ")).toLowerCase();if(x[F]===void 0)throw new Error("Unsupport sentence");return x[F].createObj(E)},I.RELATE=P.RELATE,I.JOIN=P.JOIN,I.ORDER=P.ORDER,I.types=S.types},70163:function(De,I,r){"use strict";r.d(I,{t:function(){return P}});var P=function(){var x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",F=function j(w,R,a,g){var c=-1,p=w[a]||0,y=R[a]||0;return p===y&&a+1<g?c=j(w,R,a+1,g):c=p-y,c},A=x.replace(/[a-zA-Z]/g,"").split(".").map(function(j){return parseInt(j,10)}),O=E.replace(/[a-zA-Z]/g,"").split(".").map(function(j){return parseInt(j,10)}),m=A.length>O.length?A:O;return F(A,O,0,m.length)}},46298:function(De,I,r){"use strict";r.d(I,{Z:function(){return re}});var P=r(9083),S=r.n(P),x=r(2927),E=r.n(x),F=r(98404),A=r(44761),O=r(86957),m=r(47470),j=r(44925),w=r(4185),R=r(12895),a=r(5891),g=r(42278),c=r(50205),p=r(8236),y=r(58168),u=r(33293),i=r(36422),D=new Map,$=new Map,oe=function(K){var _=K.selectDB,fe=K.mode,t=K.height,ve=K.width,ae=K.name,Se=K.placeholder,d=K.value,J=K.theme,k=K.onChange,N=K.tables,L=(0,F.useRef)(null),ue=function(){var W=N||[];$.set(_,{});var te=W.map(function(U){var ce={name:U.title,value:U.title,meta:U.chnname};return $.get(_)[U.title]=U.fields.map(function(Q){return{name:Q.name,value:Q.name,meta:"".concat(Q.chnname,"(").concat(U.title,")"),remarks:Q.chnname,dataType:Q.dataType,notNull:Q.notNull,autoIncrement:Q.autoIncrement,defaultValue:Q.defaultValue,pk:Q.pk}}),ce});D.set(_,te)},ne=function(W){var te=[];try{var U=u.parse(W),ce=Object.entries(U[0].source);U[0].joinmap&&ce.push.apply(ce,E()(Object.entries(U[0].joinmap))),ce.forEach(function(Q){var z=S()(Q,2),ge=z[0],je=z[1],pe=je.source,Oe=$.get(_)[pe];Oe&&te.push.apply(te,E()(Oe)),ge!==pe&&te.push({name:ge,value:ge,meta:pe})})}catch(Q){}return te};return(0,F.useImperativeHandle)(K.onRef,function(){return{selectLine:function(){return L.current.editor.selection.selectLine()},getEditor:function(){return L.current.editor},getSelectValue:function(){return L.current.editor.getSelectedText()},setSelectValue:function(W){return L.current.editor.insert(W)},getDbTableFieldsMap:function(W){var te={},U=$.get(_)[W];if(!U)return te;for(var ce=0;ce<U.length;ce++){var Q=U[ce];te[Q.name]=Q}return te}}}),D.get(_)||ue(),(0,F.useEffect)(function(){(0,c.addCompleter)({getCompletions:function(W,te,U,ce,Q){var z=te.getTextRange({start:{row:U.row,column:0},end:{row:U.row,column:2e3}}).toLowerCase(),ge=[];if(z.includes("select")&&z.includes("from")){ge=ne(z),Q(null,D.get(_).concat(ge));return}z=te.getTextRange({start:{row:0,column:0},end:{row:100,column:2e3}}),z=z.replace(/[\r\n]/g," ").replace(/\s{2,}/g," "),ge=ne(z),Q(null,D.get(_).concat(ge))}})},[]),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(A.ZP,{ref:L,width:ve||"100%",height:t||"250px",mode:fe||"sql",theme:J||"xcode",placeholder:Se||"",onChange:k,name:ae||"ace-editor",value:d,editorProps:{$blockScrolling:!0},fontSize:"14px",showGutter:!0,highlightActiveLine:!0,showPrintMargin:!1,setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,wrap:!1}})})},re=F.memo(oe)},15250:function(De,I,r){"use strict";r.r(I),r.d(I,{default:function(){return On}});var P=r(9083),S=r.n(P),x=r(98404),E=r(77662),F=r(60183),A=r.n(F),O=r(39346),m=r.n(O),j=r(2927),w=r.n(j),R=r(43953),a=r.n(R),g=r(91184),c=r.n(g),p=r(31777),y=r(44766),u=r.n(y),i=r(23759),D=r(29167),$=r(70163),oe=r(1993),re=r(49967),de=r(20497),K=r(61671),_=r.n(K),fe=r(7599),t=r(36422),ve={DEFAULT:"lastVersion",CURRENT:"currentVersion",MULTI:"multiVersionCompare"},ae=oe.ZP.getState(),Se=(0,p.Z)(function(M,s){return{init:!0,currentVersion:{},currentVersionIndex:void 0,hasDB:!0,versions:[],messages:[],data:void 0,dbVersion:"0.0.0",changes:[],dbs:[],incrementVersionData:{},synchronous:{},fetch:function(){var v=c()(a()().mark(function o(e){var f,l;return a()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(ae=oe.ZP.getState(),!u().isEmpty((f=ae)===null||f===void 0?void 0:f.project)){b.next=6;break}return b.next=4,ae.fetch().then(function(C){var T=C==null?void 0:C.data;if(!e&&T){var H;s().dispatch.initDbs((H=T.project.projectJSON)===null||H===void 0||(H=H.profile)===null||H===void 0?void 0:H.dbs)}re.hisProjectLoad(e||s().dispatch.getCurrentDBData()).then(function(V){if(V){var Z=V.data;Z?(s().dispatch.getDBVersion(),s().dispatch.checkBaseVersion(Z),s().dispatch.getVersionMessage(Z),M({changes:s().dispatch.calcChanges(Z)})):i.ZP.error("\u83B7\u53D6\u7248\u672C\u4FE1\u606F\u5931\u8D25")}})});case 4:b.next=8;break;case 6:e||s().dispatch.initDbs((l=ae.project.projectJSON)===null||l===void 0||(l=l.profile)===null||l===void 0?void 0:l.dbs),re.hisProjectLoad(e||s().dispatch.getCurrentDBData()).then(function(C){if(C){var T=C.data;T?(s().dispatch.getDBVersion(),s().dispatch.checkBaseVersion(T),s().dispatch.getVersionMessage(T),M({changes:s().dispatch.calcChanges(T)})):i.ZP.error("\u83B7\u53D6\u7248\u672C\u4FE1\u606F\u5931\u8D25")}});case 8:case"end":return b.stop()}},o)}));function n(o){return v.apply(this,arguments)}return n}(),dispatch:{compareStringArray:function(n,o,e,f){var l=[];return n.forEach(function(h){o.includes(h)||l.push({type:"index",name:"".concat(e,".").concat(f,".fields.").concat(h),opt:"update",changeData:"addField=>".concat(h)})}),o.forEach(function(h){n.includes(h)||l.push({type:"index",name:"".concat(e,".").concat(f,".fields.").concat(h),opt:"update",changeData:"deleteField=>".concat(h)})}),l},compareIndex:function(n,o,e){var f=[];return Object.keys(n).forEach(function(l){o[l]!==n[l]&&f.push({type:"index",name:"".concat(e.title,".").concat(n.name,".").concat(l),opt:"update",changeData:"".concat(o[l],"=>").concat(n[l])})}),f},compareIndexs:function(n,o){var e=[],f=n.indexs||[],l=o.indexs||[],h=l.map(function(C){return C.name}),b=f.map(function(C){return C.name});return f.forEach(function(C){if(!h.includes(C.name))e.push({type:"index",name:"".concat(n.title,".").concat(C.name),opt:"add"});else{var T=l.filter(function(Z){return Z.name===C.name})[0]||{};e.push.apply(e,w()(s().dispatch.compareIndex(u().omit(C,["fields"]),u().omit(T,["fields"]),n)));var H=T.fields||[],V=C.fields||[];e.push.apply(e,w()(s().dispatch.compareStringArray(V,H,n.title,C.name)))}}),l.forEach(function(C){b.includes(C.name)||e.push({type:"index",name:"".concat(n.title,".").concat(C.name),opt:"delete"})}),e},compareEntity:function(n,o){var e=[];return Object.keys(n).forEach(function(f){o[f]!==n[f]&&e.push({type:"entity",name:"".concat(n.title,".").concat(f),opt:"update",changeData:"".concat(o[f],"=>").concat(n[f])})}),e},compareField:function(n,o,e){var f=[];return Object.keys(n).forEach(function(l){l!=="typeName"&&l!=="dataType"&&o[l]!==n[l]&&f.push({type:"field",name:"".concat(e.title,".").concat(n.name,".").concat(l),opt:"update",changeData:"".concat(o[l],"=>").concat(n[l])})}),f},getAllTable:function(n){return(n.modules||[]).reduce(function(o,e){return o.concat(e.entities||[])},[])},calcChanges:function(n){var o=ae.project.projectJSON,e=[],f=w()(n),l=f.sort(function(Z,X){return(0,$.t)(X.version,Z.version)})[0];if(l){var h=m()({},o),b={modules:u().get(l,"projectJSON.modules",[])},C=s().dispatch.getAllTable(h),T=s().dispatch.getAllTable(b),H=T.map(function(Z){return Z.title}),V=C.map(function(Z){return Z.title});return C.forEach(function(Z){if(H.includes(Z.title)){var X=T.filter(function(ee){return ee.title===Z.title})[0]||{},le=(X.fields||[]).filter(function(ee){return ee.name}),he=(Z.fields||[]).filter(function(ee){return ee.name}),B=le.map(function(ee){return ee.name}),G=he.map(function(ee){return ee.name});he.forEach(function(ee){if(!B.includes(ee.name))e.push({type:"field",name:"".concat(Z.title,".").concat(ee.name),opt:"add"});else{var Fe=le.filter(function(Ve){return Ve.name===ee.name})[0]||{},Y=s().dispatch.compareField(ee,Fe,Z);e.push.apply(e,w()(Y))}}),le.forEach(function(ee){G.includes(ee.name)||e.push({type:"field",name:"".concat(Z.title,".").concat(ee.name),opt:"delete"})});var ie=s().dispatch.compareEntity(u().omit(Z,["fields","indexs","headers"]),u().omit(X,["fields","indexs"]));e.push.apply(e,w()(ie));var xe=s().dispatch.compareIndexs(Z,X);e.push.apply(e,w()(xe))}else e.push({type:"entity",name:Z.title,opt:"add"})}),T.forEach(function(Z){V.includes(Z.title)||e.push({type:"entity",name:Z.title,opt:"delete"})}),e}return[]},getDBVersion:function(){return M((0,fe.ZP)(function(n){n.hasDB=!0;var o=s().dispatch.getCurrentDBData();o?re.dbversion(m()(m()({},o.properties),{},{dbKey:o.key})).then(function(e){e&&e.code===200?i.ZP.success("\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u83B7\u53D6\u6210\u529F"):i.ZP.error("\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u83B7\u53D6\u5931\u8D25"),M({dbVersion:e.code!==200?"":e.data})}).catch(function(){i.ZP.error("\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u83B7\u53D6\u5931\u8D25")}):(M({dbVersion:""}),i.ZP.warning((0,t.jsxs)(t.Fragment,{children:["\u83B7\u53D6\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u5931\u8D25,\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F,\u8BF7",(0,t.jsx)("a",{href:"/design/table/setting/db",children:"\u914D\u7F6E"}),"\u6216\u5207\u6362\u6570\u636E\u6E90\uFF01"]}),2),n.hasDB=!1)}))},checkBaseVersion:function(n){return M((0,fe.ZP)(function(o){n.some(function(e){return e.baseVersion})?o.init=!1:(i.ZP.warning("\u5F53\u524D\u6570\u636E\u6E90\u4E0D\u5B58\u5728\u57FA\u7EBF\u7248\u672C\uFF0C\u8BF7\u5148\u521D\u59CB\u5316\u57FA\u7EBF",2),o.init=!0)}))},getVersionMessage:function(n,o){var e=s(),f=e.versions,l=f===void 0?[]:f,h=[];Array.isArray(n)?h=n:n&&(h=o?[].concat(n):l.concat(n)),M({versions:h.map(function(b){return u().pick(b,["id","version","versionDesc","changes","versionDate","projectJSON","baseVersion"])}).sort(function(b,C){return(0,$.t)(C.version,b.version)})})},setState:function(n){u().assign(s(),n)},getCurrentDB:function(){var n=s().dispatch.getCurrentDBData();return n?n.name:""},getCurrentDBData:function(){var n;return(n=s().dbs)===null||n===void 0?void 0:n.filter(function(o){return o.defaultDB})[0]},dropVersionTable:function(){var n=s().dispatch.getCurrentDBData();n?re.rebaseline(m()(m()({},n),{},{dbKey:n.key,version:"0.0.0",versionDesc:"\u57FA\u7EBF\u7248\u672C\uFF0C\u65B0\u5EFA\u7248\u672C\u65F6\u8BF7\u52FF\u4F4E\u4E8E\u8BE5\u7248\u672C"})).then(function(o){o&&o.code===200?(i.ZP.success("\u521D\u59CB\u5316\u6570\u636E\u8868\u6210\u529F"),s().dispatch.getDBVersion()):i.ZP.error("\u521D\u59CB\u5316\u6570\u636E\u8868\u5931\u8D25")}).catch(function(o){i.ZP.error("\u521D\u59CB\u5316\u6570\u636E\u8868\u5931\u8D25\uFF1A".concat(o.message))}):(M({dbVersion:""}),i.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F\uFF0C\u8BF7\u5207\u6362\u5C1D\u8BD5\u6570\u636E\u6E90"))},setCurrentVersion:function(n,o){M({currentVersion:n,currentVersionIndex:o})},getOptName:function(n){var o="";switch(n){case"update":o="\u66F4\u65B0";break;case"add":o="\u65B0\u589E";break;case"delete":o="\u5220\u9664";break;default:o="\u672A\u77E5\u64CD\u4F5C";break}return o},getTypeName:function(n){var o="";switch(n){case"entity":o="\u8868";break;case"index":o="\u7D22\u5F15";break;case"field":o="\u5C5E\u6027";break;default:o="\u672A\u77E5\u7C7B\u578B";break}return o},constructorMessage:function(n){return n&&u().remove(n,function(o){var e=o.type==="field"&&o.opt==="update"&&o.changeData&&o.changeData.search("undefined=>")>-1;return e}),n.map(function(o){var e="".concat(s().dispatch.getOptName(o.opt),`
      `).concat(s().dispatch.getTypeName(o.type),"\u300C").concat(o.name,"\u300D");return o.changeData&&(e="".concat(e,"\u300C").concat(o.changeData,"\u300D")),m()(m()({},o),{},{message:e})})},showChanges:function(n,o,e,f){var l=u().get(ae.project,"projectJSON"),h=s(),b=h.changes,C=h.init,T=h.currentVersionIndex,H=h.versions;(!e||!f)&&(e=s().currentVersion,f=T&&H[T+1]||e);var V;if(n===ve.CURRENT){var Z;V=w()(((Z=e)===null||Z===void 0?void 0:Z.changes)||[])}else n===ve.MULTI?V=w()(o):V=w()(b);V&&u().remove(V,function(Y){var Ve,q=(Y==null?void 0:Y.type)==="field"&&(Y==null?void 0:Y.opt)==="update"&&(Y==null?void 0:Y.changeData)&&(Y==null||(Ve=Y.changeData)===null||Ve===void 0?void 0:Ve.search("undefined=>"))>-1;return q});var X=u().get(ae.project,"configJSON"),le=m()({},(X==null?void 0:X.synchronous)||{upgradeType:"increment"});if(le.upgradeType==="rebuild"){var he=[],B=[];V.forEach(function(Y){Y.type==="entity"?B.push(Y):he.push(Y.name.split(".")[0])}),V=w()(new Set(he)).map(function(Y){return{type:"entity",name:Y,opt:"update"}}).concat(B)}else V=V.filter(function(Y){return!(Y.type==="entity"&&Y.opt==="update")});var G;if(n===ve.CURRENT){var ie;G=s().dispatch.constructorMessage(((ie=e)===null||ie===void 0?void 0:ie.changes)||[])}else n===ve.MULTI?G=s().dispatch.constructorMessage(o||[]):G=s().dispatch.constructorMessage(b||[]);M({messages:G});var xe=s().dispatch.getCurrentDBData(),ee=u().get(xe,"select","MYSQL"),Fe="";C?Fe=(0,de.U)(m()(m()({},l),{},{modules:(l==null?void 0:l.modules)||[]}),ee):Fe=e.baseVersion?(0,de.U)(m()(m()({},l),{},{modules:e.projectJSON?e.projectJSON.modules:e.modules}),ee):(0,de.I2)(m()(m()({},l),{},{modules:e.projectJSON?e.projectJSON.modules:e.modules}),V,ee,{modules:f.projectJSON?f.projectJSON.modules:f.modules}),M({data:Fe})},setChanges:function(n){M({changes:n})},checkVersionCount:function(n){var o=s(),e=o.dbVersion,f=o.versions,l=[];return e?l=f.filter(function(h){return(0,$.t)(h.version,e)>0}):l=f,l.filter(function(h){return h.version!==n.version}).some(function(h){return(0,$.t)(h.version,n.version)<=0})},execSQL:function(n,o,e,f,l){var h=s().dispatch.getCurrentDBData();h?D.Z.confirm({title:"\u540C\u6B65\u786E\u8BA4",content:"\u5143\u6570\u636E\u5373\u5C06\u540C\u6B65\u5230\u6570\u636E\u6E90\uFF0C\u540C\u6B65\u540E\u4E0D\u53EF\u64A4\u9500\uFF0C\u786E\u5B9A\u540C\u6B65\u5417\uFF1F",onOk:function(C){var T=function(){s().fetch(null),C&&C()};s().dispatch.generateSQL(h,o,n,e,T,l),f&&f()}}):(M({dbVersion:""}),i.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F\uFF0C\u8BF7\u5207\u6362\u5C1D\u8BD5\u6570\u636E\u6E90"),f&&f())},generateSQL:function(n,o,e,f,l,h){var b=s().dispatch.getCMD(f,h),C=u().get(ae.project,"projectJSON");if(n){var T={version:void 0,versionDesc:void 0,sql:void 0,separator:void 0};if(f&&(T.versionDesc=o.versionDesc,T.version=o.version),!h){var H=u().get(C,"profile.sqlConfig","/*SQL@Run*/");T.sql=e,T.separator=H}s().dispatch.connectJDBC(m()(m()(m()({},n.properties),T),{},{dbKey:n.key,showModal:!0}),b,function(V){l&&l(),M({synchronous:A()({},o.version,!1)})},b)}},getCMD:function(n,o){var e="dbsync";return o?e="updateVersion":n?e="dbsync":e="sqlexec",e},connectJDBC:function(n,o,e){re[o](n).then(function(f){f.code===200?(e&&e(),D.Z.success({title:"\u540C\u6B65\u6210\u529F",content:f.data})):D.Z.warn({title:"\u540C\u6B65\u5931\u8D25",content:f.msg})}).catch(function(f){i.ZP.error("\u540C\u6B65\u5931\u8D25:".concat(f.message))})},updateVersionData:function(n,o,e){if(e==="update"){var f=s().dispatch.getCurrentDBData();re.hisProjectSave(m()(m()({},n),{},{dbKey:f.key})).then(function(l){l.code===200?i.ZP.success("\u7248\u672C\u4FE1\u606F\u66F4\u65B0\u6210\u529F"):i.ZP.error("\u7248\u672C\u4FE1\u606F\u66F4\u65B0\u5931\u8D25")}).catch(function(l){i.ZP.error("\u7248\u672C\u4FE1\u606F\u66F4\u65B0\u5931\u8D25".concat(l.message))}).finally(function(){M({versions:s().versions.map(function(l,h){return h===s().currentVersionIndex?n:l})})})}else re.hisProjectDelete(n.id).then(function(l){if(l.code===200){i.ZP.success("\u7248\u672C\u4FE1\u606F\u5220\u9664\u6210\u529F");var h=s().versions.filter(function(b){return b.id!==n.id});M({changes:s().dispatch.calcChanges(h),versions:h}),s().dispatch.checkBaseVersion(h)}}).catch(function(l){i.ZP.error("\u7248\u672C\u4FE1\u606F\u5220\u9664\u5931\u8D25".concat(l.message))});s().fetch(null)},readDb:function(n,o,e){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],l=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;if(!n){var b=s().dispatch.getCurrentDBData();if(!b)i.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F\uFF0C\u8BF7\u5C1D\u8BD5\u5207\u6362\u6570\u636E\u6E90\uFF0C\u5E76\u68C0\u67E5\u662F\u5426\u5DF2\u7ECF\u914D\u7F6E\u6570\u636E\u6E90\u4FE1\u606F\uFF01");else{var C=!1;l||(C=s().dispatch.checkVersionCount(o)),C?i.ZP.error("\u5F53\u524D\u64CD\u4F5C\u7684\u7248\u672C\u4E4B\u524D\u8FD8\u6709\u7248\u672C\u5C1A\u672A\u540C\u6B65\uFF0C\u8BF7\u4E0D\u8981\u8DE8\u7248\u672C\u64CD\u4F5C!"):D.Z.confirm({title:"\u540C\u6B65\u786E\u8BA4",content:"\u5143\u6570\u636E\u5373\u5C06\u540C\u6B65\u5230\u6570\u636E\u6E90\uFF0C\u540C\u6B65\u540E\u4E0D\u53EF\u64A4\u9500\uFF0C\u786E\u5B9A\u540C\u6B65\u5417\uFF1F",onOk:function(H){u().set(s().synchronous,"".concat(o.version),!0),H&&H();var V=u().get(ae.project,"configJSON"),Z=m()({},(V==null?void 0:V.synchronous)||{upgradeType:"increment"}),X="";if(l)X=(0,de.U)(m()(m()({},u().get(ae.project,"projectJSON")),{},{modules:o.projectJSON.modules}),u().get(b,"select","MYSQL"));else{var le=w()(f);if(Z.upgradeType==="rebuild"){var he=[],B=[];le.forEach(function(G){G.type==="entity"?B.push(G):he.push(G.name.split(".")[0])}),le=w()(new Set(he)).map(function(G){return{type:"entity",name:G,opt:"update"}}).concat(B)}else le=le.filter(function(G){return!(G.type==="entity"&&G.opt==="update")});X=(0,de.I2)(m()(m()({},u().get(ae.project,"projectJSON")),{},{modules:o.projectJSON.modules}),le,u().get(b,"select","MYSQL"),e.projectJSON)}s().dispatch.generateSQL(b,o,X,h,function(){return s().fetch(null)})}})}}},saveNewVersion:function(n){var o=s().dispatch.calcChanges(s().versions);if(!n.version||!n.versionDesc)i.ZP.error("\u7248\u672C\u53F7\u548C\u7248\u672C\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");else if(s().versions.map(function(h){return h.version}).includes(n.version))i.ZP.error("\u8BE5\u7248\u672C\u53F7\u5DF2\u7ECF\u5B58\u5728\u4E86");else if(s().versions[0]&&(0,$.t)(n.version,s().versions[0].version)<=0)i.ZP.error("\u65B0\u7248\u672C\u4E0D\u80FD\u5C0F\u4E8E\u6216\u7B49\u4E8E\u5DF2\u7ECF\u5B58\u5728\u7684\u7248\u672C");else{var e,f=s().dispatch.getCurrentDBData(),l={projectJSON:{modules:((e=ae.project)===null||e===void 0||(e=e.projectJSON)===null||e===void 0?void 0:e.modules)||[]},dbKey:f.key,baseVersion:!1,version:n.version,versionDesc:n.versionDesc,changes:o,versionDate:_()().format("YYYY/M/D H:m:s")};re.hisProjectSave(l).then(function(h){h&&h.code===200?(s().dispatch.getVersionMessage(h.data),M({changes:[]}),i.ZP.success("\u5F53\u524D\u7248\u672C\u4FDD\u5B58\u6210\u529F")):i.ZP.error("\u5F53\u524D\u7248\u672C\u4FDD\u5B58\u5931\u8D25")}).catch(function(h){i.ZP.error("\u5F53\u524D\u7248\u672C\u4FDD\u5B58\u5931\u8D25:".concat(h.message))})}},rebuild:function(n){D.Z.confirm({title:"\u91CD\u5EFA\u57FA\u7EBF",content:"\u91CD\u5EFA\u57FA\u7EBF\u5C06\u4F1A\u6E05\u9664\u5F53\u524D\u9879\u76EE\u7684\u6240\u6709\u7248\u672C\u4FE1\u606F\uFF0C\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",onOk:function(){s().dispatch.initBase(n,"\u91CD\u5EFA\u57FA\u7EBF\u6210\u529F")}})},initBase:function(n,o){if(!n.version||!n.versionDesc)i.ZP.error("\u7248\u672C\u53F7\u548C\u7248\u672C\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");else{var e,f=s().dispatch.getCurrentDBData(),l=(e=ae)===null||e===void 0||(e=e.project)===null||e===void 0||(e=e.projectJSON)===null||e===void 0?void 0:e.modules,h={projectJSON:{modules:l||[]},dbKey:f.key,baseVersion:!0,version:n.version,versionDesc:n.versionDesc,changes:s().dispatch.calcChanges(s().versions),versionDate:_()().format("YYYY/M/D H:m:s")};o?re.hisProjectDeleteAll(f.key).then(function(b){b.code===200?s().dispatch.initSave(h,o):i.ZP.error("\u91CD\u5EFA\u57FA\u7EBF\u5931\u8D25")}).catch(function(b){i.ZP.error("\u91CD\u5EFA\u57FA\u7EBF\u5931\u8D25:".concat(b.message))}):s().dispatch.initSave(h,o)}},initSave:function(n,o){re.hisProjectSave(n).then(function(e){e?(i.ZP.success(o||"\u521D\u59CB\u5316\u57FA\u7EBF\u6210\u529F"),s().dispatch.getVersionMessage(e.data,!0),M({changes:s().dispatch.calcChanges(s().versions),init:!1,versions:e.data}),s().dispatch.dropVersionTable()):i.ZP.error("\u64CD\u4F5C\u5931\u8D25\uFF01")}).catch(function(e){i.ZP.error("\u64CD\u4F5C\u5931\u8D25\uFF01 ".concat(e.message))})},initDbs:function(n){return M((0,fe.ZP)(function(o){o.dbs=n||[]}))},dbChange:function(n){M({dbs:s().dbs.map(function(o){return o.name===n.name?m()(m()({},o),{},{defaultDB:!0}):m()(m()({},o),{},{defaultDB:!1})})}),s().fetch(n)},resolveDb:function(){return M((0,fe.ZP)(function(n){n.hasDB=n.dbs&&n.dbs.length>0}))},compare:function(n){if(s().versions.length>1&&(!n.initVersion||!n.incrementVersion)&&i.ZP.warning("\u8BF7\u9009\u62E9\u4F60\u8981\u6BD4\u8F83\u7684\u4E24\u4E2A\u7248\u672C"),(0,$.t)(n.incrementVersion,n.initVersion)<=0)i.ZP.warning("\u589E\u91CF\u811A\u672C\u7684\u7248\u672C\u53F7\u4E0D\u80FD\u5C0F\u4E8E\u6216\u7B49\u4E8E\u521D\u59CB\u7248\u672C\u7684\u7248\u672C\u53F7");else{var o={},e={};s().versions.forEach(function(l){l.version===n.initVersion&&(e={modules:l.projectJSON.modules}),l.version===n.incrementVersion&&(o={modules:l.projectJSON.modules})});var f=s().dispatch.checkVersionData(o,e);s().dispatch.showChanges(ve.MULTI,f,o,e),M({incrementVersionData:o})}},checkVersionData:function(n,o){var e=[],f=s().dispatch.getAllTable(n),l=s().dispatch.getAllTable(o),h=l.map(function(C){return C.title}),b=f.map(function(C){return C.title});return f.forEach(function(C){if(h.includes(C.title)){var T=l.filter(function(B){return B.title===C.title})[0]||{},H=(T.fields||[]).filter(function(B){return B.name}),V=(C.fields||[]).filter(function(B){return B.name}),Z=H.map(function(B){return B.name}),X=V.map(function(B){return B.name});V.forEach(function(B){if(!Z.includes(B.name))e.push({type:"field",name:"".concat(C.title,".").concat(B.name),opt:"add"});else{var G=H.filter(function(xe){return xe.name===B.name})[0]||{},ie=s().dispatch.compareField(B,G,C);e.push.apply(e,w()(ie))}}),H.forEach(function(B){X.includes(B.name)||e.push({type:"field",name:"".concat(C.title,".").concat(B.name),opt:"delete"})});var le=s().dispatch.compareEntity(u().omit(C,["fields","indexs","headers"]),u().omit(T,["fields","indexs"]));e.push.apply(e,w()(le));var he=s().dispatch.compareIndexs(C,T);e.push.apply(e,w()(he))}else e.push({type:"entity",name:C.title,opt:"add"})}),l.forEach(function(C){b.includes(C.title)||e.push({type:"entity",name:C.title,opt:"delete"})}),e}}}});oe.ZP.subscribe(function(M){var s;return(s=M.project)===null||s===void 0||(s=s.projectJSON)===null||s===void 0||(s=s.profile)===null||s===void 0?void 0:s.dbs},function(M,s){Se.getState().dispatch.initDbs(M),Se.getState().dispatch.resolveDb()});var d=Se,J=r(15122),k=r(64210),N=r(24765),L=r(15241),ue=r(63356),ne=r(4341),se=r(12125),W=r(27789),te=r(34843),U=r(20576),ce=function(s,v){return x.createElement(U.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:te.Z}))};ce.displayName="InfoCircleOutlined";var Q=x.forwardRef(ce),z=r(62656),ge=function(s){var v=d(function(e){return{init:e.init,versionDispatch:e.dispatch}},E.Z),n=v.init,o=v.versionDispatch;return(0,x.useEffect)(function(){return function(){}}),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(ue.Y,{title:"\u65B0\u589E\u7248\u672C",onFinish:function(){var e=c()(a()().mark(function f(l){var h;return a()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return h={version:l.version,versionDesc:l.versionDesc},o.saveNewVersion(h),C.abrupt("return",!0);case 3:case"end":return C.stop()}},f)}));return function(f){return e.apply(this,arguments)}}(),trigger:s.trigger==="bp"?(0,t.jsx)(z.ZP,{type:"primary",disabled:n,children:"\u65B0\u589E\u7248\u672C"},"artifact"):(0,t.jsx)(z.ZP,{type:"primary",disabled:n,title:n?"\u672A\u914D\u7F6E\u6570\u636E\u6E90\u4E0D\u80FD\u65B0\u589E\u7248\u672C":"",icon:n?(0,t.jsx)(Q,{}):"",children:"\u65B0\u589E\u7248\u672C"}),children:[(0,t.jsx)(ne.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u53F7",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}}),(0,t.jsx)(se.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u63CF\u8FF0",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},je=x.memo(ge),pe=r(2360),Oe=r(65581),Ae=function(s){var v=(0,oe.ZP)(function(e){var f;return{upgradeType:(f=e.project)===null||f===void 0||(f=f.configJSON)===null||f===void 0||(f=f.synchronous)===null||f===void 0?void 0:f.upgradeType,projectDispatch:e.dispatch}},E.Z),n=v.upgradeType,o=v.projectDispatch;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(ue.Y,{title:(0,t.jsxs)("span",{children:["\u540C\u6B65\u914D\u7F6E",(0,t.jsx)("span",{style:{color:"red"},children:"\uFF08\u914D\u7F6E\u6210\u529F\u540E\uFF0C\u540E\u7EED\u7684\u540C\u6B65\u7684\u64CD\u4F5C\u90FD\u4F7F\u7528\u8BE5\u914D\u7F6E\uFF0C\u4EC5\u5EFA\u8BAE\u9879\u76EE\u521D\u59CB\u5316\u4E4B\u540E\u8BBE\u7F6E\u4E00\u6B21\uFF0C\u4EE5\u540E\u4E0D\u8981\u53D8\u52A8\uFF0C\u514D\u5F97\u51FA\u73B0\u7248\u672C\u6DF7\u4E71\uFF09"})]}),trigger:(0,t.jsx)(z.ZP,{type:"primary",children:"\u540C\u6B65\u914D\u7F6E"},"refresh"),onFinish:function(){var e=c()(a()().mark(function f(l){return a()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,o.setUpgradeType(l);case 2:return b.abrupt("return",!0);case 3:case"end":return b.stop()}},f)}));return function(f){return e.apply(this,arguments)}}(),children:(0,t.jsx)(pe.A.Group,{children:(0,t.jsx)(Oe.Z.Group,{name:"upgradeType",label:"\u6570\u636E\u8868\u5347\u7EA7\u65B9\u5F0F",initialValue:n,options:[{label:"\u5B57\u6BB5\u589E\u91CF",value:"increment"},{label:"\u91CD\u5EFA\u6570\u636E\u8868",value:"rebuild"}]})})})})},Te=x.memo(Ae),Re=function(s){var v=d(function(h){return{hasDB:h.hasDB,init:h.init,versionDispatch:h.dispatch}},E.Z),n=v.hasDB,o=v.init,e=v.versionDispatch,f=(0,oe.ZP)(function(h){var b;return{projectJSON:(b=h.project)===null||b===void 0?void 0:b.projectJSON}},E.Z),l=f.projectJSON;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(ue.Y,{title:"\u521D\u59CB\u5316\u57FA\u7EBF",trigger:(0,t.jsx)(z.ZP,{type:"primary",disabled:!n||!o,children:"\u521D\u59CB\u5316\u57FA\u7EBF"},"selection"),onFinish:function(){var h=c()(a()().mark(function b(C){var T,H;return a()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(T=e.getCurrentDBData(),T){Z.next=4;break}return i.ZP.warning("\u672A\u914D\u7F6E\u6570\u636E\u5E93\u6E90\uFF0C\u8BF7\u5148\u914D\u7F6E\u6570\u636E\u6E90\uFF01"),Z.abrupt("return",!1);case 4:return H={projectJSON:{modules:l.modules||[]},dbKey:T.key||"",baseVersion:!0,version:C.version,versionDesc:C.versionDesc,changes:[],versionDate:_()().format("YYYY/M/D H:m:s")},re.hisProjectSave(H).then(function(X){X.code===200?(i.ZP.success("\u521D\u59CB\u5316\u57FA\u7EBF\u6210\u529F"),e.getVersionMessage(X.data,!0),e.setState({changes:[],init:!1,versions:X.data}),e.dropVersionTable()):i.ZP.error("\u64CD\u4F5C\u5931\u8D25\uFF01")}).catch(function(X){i.ZP.error("\u64CD\u4F5C\u5931\u8D25:".concat(X.message))}),Z.abrupt("return",!0);case 7:case"end":return Z.stop()}},b)}));return function(b){return h.apply(this,arguments)}}(),children:[(0,t.jsx)(ne.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u4F8B\u5982\uFF1A1.0.0\u300C\u8BF7\u52FF\u4F4E\u4E8E\u7CFB\u7EDF\u9ED8\u8BA4\u7684\u6570\u636E\u6E90\u7248\u672C0.0.0\u300D",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 200 \u4E2A\u5B57\u7B26"}]}}),(0,t.jsx)(se.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"'\u4F8B\u5982\uFF1A\u521D\u59CB\u5316\u5F53\u524D\u9879\u76EE\u7248\u672C",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},Ze=x.memo(Re),$e=function(s){var v=d(function(e){return{init:e.init,versionDispatch:e.dispatch}},E.Z),n=v.init,o=v.versionDispatch;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(ue.Y,{title:(0,t.jsxs)("span",{children:["\u91CD\u5EFA\u57FA\u7EBF",(0,t.jsx)("span",{style:{color:"red"},children:"\uFF08\u91CD\u5EFA\u57FA\u7EBF\u5C06\u4F1A\u6E05\u9664\u5F53\u524D\u9879\u76EE\u7684\u6240\u6709\u7248\u672C\u4FE1\u606F\uFF0C\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF09"})]}),onFinish:function(){var e=c()(a()().mark(function f(l){var h;return a()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return h={version:l.version,versionDesc:l.versionDesc},o.rebuild(h),C.abrupt("return",!0);case 3:case"end":return C.stop()}},f)}));return function(f){return e.apply(this,arguments)}}(),trigger:(0,t.jsx)(z.ZP,{type:"primary",disabled:n,children:"\u91CD\u5EFA\u57FA\u7EBF"},"undo"),children:[(0,t.jsx)(ne.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u4F8B\u5982\uFF1A1.0.0\u300C\u8BF7\u52FF\u4F4E\u4E8E\u7CFB\u7EDF\u9ED8\u8BA4\u7684\u6570\u636E\u6E90\u7248\u672C0.0.0\u300D",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 200 \u4E2A\u5B57\u7B26"}]}}),(0,t.jsx)(se.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"'\u4F8B\u5982\uFF1A\u521D\u59CB\u5316\u5F53\u524D\u9879\u76EE\u7248\u672C",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},Ce=x.memo($e),Ie=r(27856),Ue=r(31398),Pe=r(66205),Je=r(46298),Ne=r(11958),We={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M448 224a64 64 0 10128 0 64 64 0 10-128 0zm96 168h-64c-4.4 0-8 3.6-8 8v464c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V400c0-4.4-3.6-8-8-8z"}}]},name:"info",theme:"outlined"},ze=We,Be=function(s,v){return x.createElement(U.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:ze}))};Be.displayName="InfoOutlined";var He=x.forwardRef(Be),Me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M476 399.1c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1V484h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H420v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V540h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H476v-84.9zM560.5 704h-225c-4.1 0-7.5 3.2-7.5 7v42c0 3.8 3.4 7 7.5 7h225c4.1 0 7.5-3.2 7.5-7v-42c0-3.8-3.4-7-7.5-7zm-7.1-502.6c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v704c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32V397.3c0-8.5-3.4-16.6-9.4-22.6L553.4 201.4zM664 888H232V264h282.2L664 413.8V888zm190.2-581.4L611.3 72.9c-6-5.7-13.9-8.9-22.2-8.9H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h277l219 210.6V824c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V329.6c0-8.7-3.5-17-9.8-23z"}}]},name:"diff",theme:"outlined"},be=Me,Ke=function(s,v){return x.createElement(U.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:be}))};Ke.displayName="DiffOutlined";var _e=x.forwardRef(Ke),Ee=r(53631),we={DETAIL:"detail",COMPARE:"compare"},en=function(s){var v=d(function(q){return{messages:q.messages,data:q.data,versions:q.versions,currentVersion:q.currentVersion,dbVersion:q.dbVersion,versionDispatch:q.dispatch}},E.Z),n=v.currentVersion,o=v.dbVersion,e=v.messages,f=v.data,l=v.versions,h=v.versionDispatch,b=document.body.clientHeight,C=b-25,T=(0,x.useState)({initVersion:l[1]&&l[1].version||"",incrementVersion:l[0]&&l[0].version||"",incrementVersionData:{},again:!1,synchronous:!1,preSynchronous:!1,flagSynchronous:!1}),H=S()(T,2),V=H[0],Z=H[1],X=(0,Ee.md)(),le=(0,x.useState)(1),he=S()(le,2),B=he[0],G=he[1];(0,x.useEffect)(function(){h.compare(V)},[V.initVersion,V.incrementVersion,B]);var ie=l.map(function(q){return{label:q.version,value:q.version}}),xe=function(ye,me){Z(m()(m()({},V),{},A()({},me,ye)))},ee=function(){Ne.a1(f,"".concat(_()().format("YYYY-MM-D-h-mm-ss"),".sql"))},Fe=function(ye,me){var Le=h.checkVersionCount(n);if(Le)i.ZP.error("\u5F53\u524D\u64CD\u4F5C\u7684\u7248\u672C\u4E4B\u524D\u8FD8\u6709\u7248\u672C\u5C1A\u672A\u540C\u6B65\uFF0C\u8BF7\u4E0D\u8981\u8DE8\u7248\u672C\u64CD\u4F5C!");else{var qe=me;Z(m()(m()({},V),{},A()({},qe,!0)));try{h.execSQL(f,n,ye,null,me==="flagSynchronous"),G(B+1)}finally{Z(m()(m()({},V),{},A()({},qe,!1)))}}},Y=s.type===we.DETAIL,Ve=s.type===we.COMPARE;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(ue.Y,{title:Y?"\u7248\u672C\u53D8\u66F4\u8BE6\u60C5":"\u4EFB\u610F\u7248\u672C\u6BD4\u8F83",layout:"horizontal",trigger:(0,t.jsx)(z.ZP,{size:"small",type:"link",icon:Y?(0,t.jsx)(He,{}):(0,t.jsx)(_e,{}),onClick:function(){return Y?h.showChanges(ve.CURRENT,null,null,null):h.compare(V)},children:Y?"\u7248\u672C\u53D8\u66F4\u8BE6\u60C5":"\u4EFB\u610F\u7248\u672C\u6BD4\u8F83"},"compare"),submitter:{render:function(ye,me){return[(0,t.jsx)(z.ZP,{onClick:ee,children:"\u5BFC\u51FA\u5230\u6587\u4EF6"},"save"),(0,t.jsx)(Ee.Nv,{accessible:X.canErdConnectorDbsync,fallback:(0,t.jsx)(t.Fragment,{}),children:(0,t.jsx)(z.ZP,{loading:V.synchronous,title:"\u4F1A\u66F4\u65B0\u6570\u636E\u6E90\u4E2D\u7684\u7248\u672C\u53F7",style:{display:Y&&n.version&&(0,$.t)(n.version,o)>0?"":"none"},onClick:function(){return Fe(!0,"synchronous")},children:V.synchronous?"\u6B63\u5728\u540C\u6B65":"\u540C\u6B65\u5230\u6570\u636E\u6E90"})}),(0,t.jsx)(Ee.Nv,{accessible:X.canErdConnectorDbsync,fallback:(0,t.jsx)(t.Fragment,{}),children:(0,t.jsx)(z.ZP,{loading:V.flagSynchronous,title:"\u66F4\u65B0\u6570\u636E\u6E90\u7684\u7248\u672C\u53F7\uFF0C\u4E0D\u4F1A\u6267\u884C\u5DEE\u5F02\u5316\u7684SQL",style:{display:Y&&n.version&&(0,$.t)(n.version,o)>0?"":"none"},onClick:function(){return Fe(!0,"flagSynchronous")},children:V.flagSynchronous?"\u6B63\u5728\u6807\u8BB0\u4E3A\u540C\u6B65":"\u6807\u8BB0\u4E3A\u540C\u6B65"})}),(0,t.jsx)(Ee.Nv,{accessible:X.canErdConnectorDbsync,fallback:(0,t.jsx)(t.Fragment,{}),children:(0,t.jsx)(z.ZP,{loading:V.again,title:"\u4E0D\u4F1A\u66F4\u65B0\u6570\u636E\u6E90\u4E2D\u7684\u7248\u672C\u53F7",style:{display:Y&&n.version&&(0,$.t)(n.version,o)<=0?"":"none",marginLeft:10},onClick:function(){return Fe(!1,"again")},children:V.again?"\u6B63\u5728\u6267\u884C":"\u518D\u6B21\u6267\u884C"})})]}},children:[(0,t.jsxs)(pe.A.Group,{style:{display:Ve?"":"none"},children:[(0,t.jsx)(Ie.Z,{fieldProps:{onChange:function(ye){xe(ye,"initVersion")}},request:c()(a()().mark(function q(){return a()().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return me.abrupt("return",ie||[]);case 1:case"end":return me.stop()}},q)})),name:"initVersion",initialValue:V.initVersion,label:"\u521D\u59CB\u7248\u672C"}),(0,t.jsx)(Ie.Z,{fieldProps:{onChange:function(ye){xe(ye,"incrementVersion")}},request:c()(a()().mark(function q(){return a()().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return me.abrupt("return",ie||[]);case 1:case"end":return me.stop()}},q)})),name:"incrementVersion",initialValue:V.incrementVersion,label:"\u589E\u91CF\u7248\u672C"})]}),(0,t.jsx)(Ue.Z,{}),(0,t.jsxs)(Pe.ZP,{container:!0,spacing:2,children:[(0,t.jsx)(Pe.ZP,{item:!0,xs:4,children:"\u53D8\u5316\u4FE1\u606F"}),(0,t.jsx)(Pe.ZP,{item:!0,xs:8,children:n?"\u53D8\u5316\u811A\u672C(".concat((0,$.t)(n.version,o)<=0?"\u5DF2\u540C\u6B65":"\u672A\u540C\u6B65",")"):"\u53D8\u5316\u811A\u672C"}),(0,t.jsx)(Pe.ZP,{item:!0,xs:4,style:{height:"450px",overflowY:"auto"},children:e.length>0?u().sortBy(e,["opt","type"]).map(function(q,ye){return(0,t.jsx)("div",{children:"".concat(ye+1,": ").concat(q.message)},q.message)}):"".concat(f?"\u5F53\u524D\u811A\u672C\u4E3A\u5168\u91CF\u811A\u672C":"\u5F53\u524D\u7248\u672C\u65E0\u53D8\u5316")}),(0,t.jsx)(Pe.ZP,{item:!0,xs:8,children:(0,t.jsx)(Je.Z,{mode:"mysql",height:"".concat(C*.5,"px"),value:f})})]})]})})},Ye=x.memo(en),nn=r(88254),rn=function(s){var v=d(function(l){return{currentVersionIndex:l.currentVersionIndex,currentVersion:l.currentVersion,versions:l.versions,versionDispatch:l.dispatch}},E.Z),n=v.currentVersionIndex,o=v.currentVersion,e=v.versions,f=v.versionDispatch;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(ue.Y,{title:"\u7F16\u8F91\u7248\u672C",onFinish:function(){var l=c()(a()().mark(function h(b){var C,T;return a()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return C=m()(m()({},o),{},{version:b.version,versionDesc:b.versionDesc}),T=e.slice(1),n!==0?f.updateVersionData(C,o,"update"):T.map(function(Z){return Z.version}).includes(C.version)?i.ZP.error("\u8BE5\u7248\u672C\u53F7\u5DF2\u7ECF\u5B58\u5728\u4E86"):T[0]&&(0,$.t)(C.version,T[0].version)<=0?i.ZP.error("\u65B0\u7248\u672C\u4E0D\u80FD\u5C0F\u4E8E\u6216\u7B49\u4E8E\u5DF2\u7ECF\u5B58\u5728\u7684\u7248\u672C"):f.updateVersionData(C,o,"update"),V.abrupt("return",!0);case 4:case"end":return V.stop()}},h)}));return function(h){return l.apply(this,arguments)}}(),trigger:(0,t.jsx)(z.ZP,{size:"small",type:"link",icon:(0,t.jsx)(nn.Z,{}),children:"\u7F16\u8F91\u7248\u672C"},"editor"),request:function(){var l=c()(a()().mark(function h(b){return a()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.abrupt("return",o);case 1:case"end":return T.stop()}},h)}));return function(h){return l.apply(this,arguments)}}(),children:[(0,t.jsx)(ne.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u53F7",readonly:n!==0,formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}}),(0,t.jsx)(se.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u63CF\u8FF0",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},tn=x.memo(rn),on=r(31117),an=r(70198),sn=function(s){var v=d(function(e){return{currentVersionIndex:e.currentVersionIndex,currentVersion:e.currentVersion,versions:e.versions,versionDispatch:e.dispatch}},E.Z),n=v.currentVersion,o=v.versionDispatch;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(on.Z,{placement:"right",title:"\u5220\u9664\u7248\u672C[".concat(n.version,"]"),onConfirm:function(){return o.updateVersionData(n,n,"delete")},okText:"\u662F",cancelText:"\u5426",children:(0,t.jsx)(z.ZP,{size:"small",type:"link",icon:(0,t.jsx)(an.Z,{}),children:"\u5220\u9664\u7248\u672C"},"delete")})})},un=x.memo(sn),cn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M704 446H320c-4.4 0-8 3.6-8 8v402c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8V454c0-4.4-3.6-8-8-8zm-328 64h272v117H376V510zm272 290H376V683h272v117z"}},{tag:"path",attrs:{d:"M424 748a32 32 0 1064 0 32 32 0 10-64 0zm0-178a32 32 0 1064 0 32 32 0 10-64 0z"}},{tag:"path",attrs:{d:"M811.4 368.9C765.6 248 648.9 162 512.2 162S258.8 247.9 213 368.8C126.9 391.5 63.5 470.2 64 563.6 64.6 668 145.6 752.9 247.6 762c4.7.4 8.7-3.3 8.7-8v-60.4c0-4-3-7.4-7-7.9-27-3.4-52.5-15.2-72.1-34.5-24-23.5-37.2-55.1-37.2-88.6 0-28 9.1-54.4 26.2-76.4 16.7-21.4 40.2-36.9 66.1-43.7l37.9-10 13.9-36.7c8.6-22.8 20.6-44.2 35.7-63.5 14.9-19.2 32.6-36 52.4-50 41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.3c19.9 14 37.5 30.8 52.4 50 15.1 19.3 27.1 40.7 35.7 63.5l13.8 36.6 37.8 10c54.2 14.4 92.1 63.7 92.1 120 0 33.6-13.2 65.1-37.2 88.6-19.5 19.2-44.9 31.1-71.9 34.5-4 .5-6.9 3.9-6.9 7.9V754c0 4.7 4.1 8.4 8.8 8 101.7-9.2 182.5-94 183.2-198.2.6-93.4-62.7-172.1-148.6-194.9z"}}]},name:"cloud-server",theme:"outlined"},ln=cn,Ge=function(s,v){return x.createElement(U.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:ln}))};Ge.displayName="CloudServerOutlined";var dn=x.forwardRef(Ge),fn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},vn=fn,ke=function(s,v){return x.createElement(U.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:vn}))};ke.displayName="CloudUploadOutlined";var hn=x.forwardRef(ke),pn=function(s){var v=d(function(h){return{currentVersionIndex:h.currentVersionIndex,currentVersion:h.currentVersion,synchronous:h.synchronous,versions:h.versions,dbVersion:h.dbVersion,versionDispatch:h.dispatch}},E.Z),n=v.currentVersionIndex,o=v.currentVersion,e=v.versions,f=v.dbVersion,l=v.versionDispatch;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(z.ZP,{icon:s.synced?(0,t.jsx)(dn,{}):(0,t.jsx)(hn,{}),type:"link",size:"small",disabled:s.synced,onClick:function(){l.readDb(s.synced,o,n&&e[n+1]||o,o.changes,n===e.length-1,!0)},children:"\u540C\u6B65\u5230\u6570\u636E\u6E90"},"sync")})},mn=x.memo(pn),gn=r(59833),Qe=function(s,v){return x.createElement(U.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:gn.Z}))};Qe.displayName="WarningFilled";var Cn=x.forwardRef(Qe),En=r(16762),Xe=function(s,v){return x.createElement(U.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:En.Z}))};Xe.displayName="CheckCircleFilled";var yn=x.forwardRef(Xe),Dn=J.Z.Option,xn=J.Z.OptGroup,Fn=function(s){var v=d(function(B){return{dbs:B.dbs,synchronous:B.synchronous,dbVersion:B.dbVersion||"0.0.0",changes:B.changes,versions:B.versions,fetch:B.fetch,versionDispatch:B.dispatch}},E.Z),n=v.dbs,o=v.synchronous,e=v.dbVersion,f=v.changes,l=v.versions,h=v.fetch,b=v.versionDispatch,C=(0,Ee.md)();(0,x.useEffect)(function(){h(null)},[e]);var T=x.useCallback(function(B){},[]),H=b.getCurrentDB(),V=(0,x.useState)("tab1"),Z=S()(V,2),X=Z[0],le=Z[1],he=u().groupBy(n,function(B){return B.select});return(0,t.jsx)("div",{children:(0,t.jsx)(L.Rs,{rowKey:"id",dataSource:l,metas:{title:{dataIndex:"version"},description:{dataIndex:"versionDesc",render:function(G,ie){return(0,t.jsxs)(k.Z,{children:[(0,t.jsx)("span",{children:ie.versionDate}),(0,t.jsx)("span",{children:ie.versionDesc})]})}},subTitle:{dataIndex:"labels",render:function(G,ie){return(0,t.jsx)(k.Z,{children:(0,$.t)(ie.version,e)<=0?(0,t.jsx)(N.Z,{title:"\u5DF2\u540C\u6B65\u5230\u6570\u636E\u6E90",color:"blue",children:"\u5DF2\u540C\u6B65"}):o[ie.version]?(0,t.jsx)(N.Z,{title:"\u6B63\u5728\u540C\u6B65\u5230\u6570\u636E\u6E90",color:"lime",children:"\u6B63\u5728\u540C\u6B65"}):(0,t.jsx)(N.Z,{title:"\u672A\u540C\u6B65\u5230\u6570\u636E\u6E90",color:"red",children:"\u672A\u540C\u6B65"})})},search:!1},actions:{render:function(G,ie){return[(0,t.jsx)(Ye,{type:we.DETAIL}),(0,t.jsx)(Ye,{type:we.COMPARE}),(0,t.jsx)(Ee.Nv,{accessible:C.canErdHisprojectEdit,fallback:(0,t.jsx)(t.Fragment,{}),children:(0,t.jsx)(tn,{})}),(0,t.jsx)(Ee.Nv,{accessible:C.canErdHisprojectDel,fallback:(0,t.jsx)(t.Fragment,{}),children:(0,t.jsx)(un,{})}),(0,t.jsx)(Ee.Nv,{accessible:C.canErdConnectorDbsync,fallback:(0,t.jsx)(t.Fragment,{}),children:(0,t.jsx)(mn,{synced:(0,$.t)(ie.version,e)<=0})})]}}},onRow:function(G,ie){return{onMouseEnter:function(ee){b.setCurrentVersion(G,ie)}}},toolbar:{menu:{activeKey:X,items:[{key:"tab1",label:f.length>0?(0,t.jsx)("span",{title:"\u5F53\u524D\u5185\u5BB9\u4E0E\u4E0A\u4E00\u7248\u672C\u7684\u5185\u5BB9\u6709\u53D8\u5316\uFF0C\u4F46\u672A\u4FDD\u5B58\u540C\u6B65\u7248\u672C\uFF01",children:(0,t.jsx)(N.Z,{color:"red",children:(0,t.jsx)(Cn,{size:30})})}):(0,t.jsx)("span",{title:"\u5F53\u524D\u5185\u5BB9\u4E0E\u4E0A\u4E00\u7248\u672C\u5185\u5BB9\u65E0\u53D8\u5316",children:(0,t.jsx)(N.Z,{color:"blue",children:(0,t.jsx)(yn,{size:30})})})},{key:"tab2",label:(0,t.jsxs)(k.Z,{children:["\u6570\u636E\u6E90",(0,t.jsx)(J.Z,{labelInValue:!0,value:H||"\u8BF7\u9009\u62E9\u6570\u636E\u6E90",style:{width:200},onChange:T,children:Object.keys(he).map(function(B){return(0,t.jsx)(xn,{label:B,children:he[B].map(function(G){return(0,t.jsx)(Dn,{value:G.name,children:G.name},B.name)})},B)})})]})}],onChange:function(G){le(G)}},actions:[(0,t.jsx)(Ee.Nv,{accessible:C.canErdHisprojectAdd,fallback:(0,t.jsx)(t.Fragment,{}),children:(0,t.jsx)(je,{trigger:"bp"})}),(0,t.jsx)(Ee.Nv,{accessible:C.canErdHisprojectConfig,fallback:(0,t.jsx)(t.Fragment,{}),children:(0,t.jsx)(Te,{})}),(0,t.jsx)(Ee.Nv,{accessible:C.canErdHisprojectInit,fallback:(0,t.jsx)(t.Fragment,{}),children:(0,t.jsx)(Ze,{})}),(0,t.jsx)(Ee.Nv,{accessible:C.canErdHisprojectRebuild,fallback:(0,t.jsx)(t.Fragment,{}),children:(0,t.jsx)(Ce,{})})]}})})},On=x.memo(Fn)},24765:function(De,I,r){"use strict";r.d(I,{Z:function(){return Se}});var P=r(98404),S=r(18784),x=r(26869),E=r.n(x),F=r(57399),A=r(82557),O=r(99004),m=r(95704),j=r(43920),w=r(51084),R=r(19397),a=r(20120),g=r(67146);const c=d=>{const{paddingXXS:J,lineWidth:k,tagPaddingHorizontal:N,componentCls:L,calc:ue}=d,ne=ue(N).sub(k).equal(),se=ue(J).sub(k).equal();return{[L]:Object.assign(Object.assign({},(0,R.Wf)(d)),{display:"inline-block",height:"auto",marginInlineEnd:d.marginXS,paddingInline:ne,fontSize:d.tagFontSize,lineHeight:d.tagLineHeight,whiteSpace:"nowrap",background:d.defaultBg,border:`${(0,j.bf)(d.lineWidth)} ${d.lineType} ${d.colorBorder}`,borderRadius:d.borderRadiusSM,opacity:1,transition:`all ${d.motionDurationMid}`,textAlign:"start",position:"relative",[`&${L}-rtl`]:{direction:"rtl"},"&, a, a:hover":{color:d.defaultColor},[`${L}-close-icon`]:{marginInlineStart:se,fontSize:d.tagIconSize,color:d.colorTextDescription,cursor:"pointer",transition:`all ${d.motionDurationMid}`,"&:hover":{color:d.colorTextHeading}},[`&${L}-has-color`]:{borderColor:"transparent",[`&, a, a:hover, ${d.iconCls}-close, ${d.iconCls}-close:hover`]:{color:d.colorTextLightSolid}},["&-checkable"]:{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",[`&:not(${L}-checkable-checked):hover`]:{color:d.colorPrimary,backgroundColor:d.colorFillSecondary},"&:active, &-checked":{color:d.colorTextLightSolid},"&-checked":{backgroundColor:d.colorPrimary,"&:hover":{backgroundColor:d.colorPrimaryHover}},"&:active":{backgroundColor:d.colorPrimaryActive}},["&-hidden"]:{display:"none"},[`> ${d.iconCls} + span, > span + ${d.iconCls}`]:{marginInlineStart:ne}}),[`${L}-borderless`]:{borderColor:"transparent",background:d.tagBorderlessBg}}},p=d=>{const{lineWidth:J,fontSizeIcon:k,calc:N}=d,L=d.fontSizeSM;return(0,a.TS)(d,{tagFontSize:L,tagLineHeight:(0,j.bf)(N(d.lineHeightSM).mul(L).equal()),tagIconSize:N(k).sub(N(J).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:d.colorFillTertiary})},y=d=>({defaultBg:new w.C(d.colorFillQuaternary).onBackground(d.colorBgContainer).toHexString(),defaultColor:d.colorText});var u=(0,g.I$)("Tag",d=>{const J=p(d);return c(J)},y),i=function(d,J){var k={};for(var N in d)Object.prototype.hasOwnProperty.call(d,N)&&J.indexOf(N)<0&&(k[N]=d[N]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,N=Object.getOwnPropertySymbols(d);L<N.length;L++)J.indexOf(N[L])<0&&Object.prototype.propertyIsEnumerable.call(d,N[L])&&(k[N[L]]=d[N[L]]);return k},$=P.forwardRef((d,J)=>{const{prefixCls:k,style:N,className:L,checked:ue,onChange:ne,onClick:se}=d,W=i(d,["prefixCls","style","className","checked","onChange","onClick"]),{getPrefixCls:te,tag:U}=P.useContext(m.E_),ce=Oe=>{ne==null||ne(!ue),se==null||se(Oe)},Q=te("tag",k),[z,ge,je]=u(Q),pe=E()(Q,`${Q}-checkable`,{[`${Q}-checkable-checked`]:ue},U==null?void 0:U.className,L,ge,je);return z(P.createElement("span",Object.assign({},W,{ref:J,style:Object.assign(Object.assign({},N),U==null?void 0:U.style),className:pe,onClick:ce})))}),oe=r(10143);const re=d=>(0,oe.Z)(d,(J,k)=>{let{textColor:N,lightBorderColor:L,lightColor:ue,darkColor:ne}=k;return{[`${d.componentCls}${d.componentCls}-${J}`]:{color:N,background:ue,borderColor:L,"&-inverse":{color:d.colorTextLightSolid,background:ne,borderColor:ne},[`&${d.componentCls}-borderless`]:{borderColor:"transparent"}}}});var de=(0,g.bk)(["Tag","preset"],d=>{const J=p(d);return re(J)},y);function K(d){return typeof d!="string"?d:d.charAt(0).toUpperCase()+d.slice(1)}const _=(d,J,k)=>{const N=K(k);return{[`${d.componentCls}${d.componentCls}-${J}`]:{color:d[`color${k}`],background:d[`color${N}Bg`],borderColor:d[`color${N}Border`],[`&${d.componentCls}-borderless`]:{borderColor:"transparent"}}}};var fe=(0,g.bk)(["Tag","status"],d=>{const J=p(d);return[_(J,"success","Success"),_(J,"processing","Info"),_(J,"error","Error"),_(J,"warning","Warning")]},y),t=function(d,J){var k={};for(var N in d)Object.prototype.hasOwnProperty.call(d,N)&&J.indexOf(N)<0&&(k[N]=d[N]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,N=Object.getOwnPropertySymbols(d);L<N.length;L++)J.indexOf(N[L])<0&&Object.prototype.propertyIsEnumerable.call(d,N[L])&&(k[N[L]]=d[N[L]]);return k};const ve=(d,J)=>{const{prefixCls:k,className:N,rootClassName:L,style:ue,children:ne,icon:se,color:W,onClose:te,closeIcon:U,closable:ce,bordered:Q=!0}=d,z=t(d,["prefixCls","className","rootClassName","style","children","icon","color","onClose","closeIcon","closable","bordered"]),{getPrefixCls:ge,direction:je,tag:pe}=P.useContext(m.E_),[Oe,Ae]=P.useState(!0);P.useEffect(()=>{"visible"in z&&Ae(z.visible)},[z.visible]);const Te=(0,F.o2)(W),Re=(0,F.yT)(W),Ze=Te||Re,$e=Object.assign(Object.assign({backgroundColor:W&&!Ze?W:void 0},pe==null?void 0:pe.style),ue),Ce=ge("tag",k),[Ie,Ue,Pe]=u(Ce),Je=E()(Ce,pe==null?void 0:pe.className,{[`${Ce}-${W}`]:Ze,[`${Ce}-has-color`]:W&&!Ze,[`${Ce}-hidden`]:!Oe,[`${Ce}-rtl`]:je==="rtl",[`${Ce}-borderless`]:!Q},N,L,Ue,Pe),Ne=be=>{be.stopPropagation(),te==null||te(be),!be.defaultPrevented&&Ae(!1)},[,We]=(0,A.Z)(ce,U,be=>be===null?P.createElement(S.Z,{className:`${Ce}-close-icon`,onClick:Ne}):P.createElement("span",{className:`${Ce}-close-icon`,onClick:Ne},be),null,!1),ze=typeof z.onClick=="function"||ne&&ne.type==="a",Be=se||null,He=Be?P.createElement(P.Fragment,null,Be,ne&&P.createElement("span",null,ne)):ne,Me=P.createElement("span",Object.assign({},z,{ref:J,className:Je,style:$e}),He,We,Te&&P.createElement(de,{key:"preset",prefixCls:Ce}),Re&&P.createElement(fe,{key:"status",prefixCls:Ce}));return Ie(ze?P.createElement(O.Z,{component:"Tag"},Me):Me)},ae=P.forwardRef(ve);ae.CheckableTag=$;var Se=ae}}]);
