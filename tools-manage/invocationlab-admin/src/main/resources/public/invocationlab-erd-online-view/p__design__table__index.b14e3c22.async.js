"use strict";(self.webpackChunkInvocationlab_ERD_Online=self.webpackChunkInvocationlab_ERD_Online||[]).push([[5880],{6487:function(Ge,Fe,o){o.d(Fe,{t:function(){return Ne}});var Ne=function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",Ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",pe=function ne(ce,M,_,t){var k=-1,W=ce[_]||0,U=M[_]||0;return W===U&&_+1<t?k=ne(ce,M,_+1,t):k=W-U,k},re=b.replace(/[a-zA-Z]/g,"").split(".").map(function(ne){return parseInt(ne,10)}),De=Ce.replace(/[a-zA-Z]/g,"").split(".").map(function(ne){return parseInt(ne,10)}),ge=re.length>De.length?re:De;return pe(re,De,0,ge.length)}},22685:function(Ge,Fe,o){o.d(Fe,{I:function(){return b}});var Ne=o(98404),s=o(36422),b=function(pe){var re=pe.prefixCount,De=re===void 0?10:re,ge=pe.suffixCount,ne=ge===void 0?4:ge,ce=pe.children,M=pe.title,_=pe.style,t=ce.length;if(t<=De)return(0,s.jsx)("span",{title:M,style:_,children:ce});var k=t-De;if(k<=3)return(0,s.jsx)("span",{title:M,style:_,children:ce});k<ne&&(ne=k);var W=ce.slice(0,De).trim(),U=ce.slice(-ne).trim();return(0,s.jsxs)("span",{title:M,style:_,children:[W,"...",U]})}},68999:function(Ge,Fe,o){o.d(Fe,{Z:function(){return U}});var Ne=o(98404),s=o(4444),b=o.n(s),Ce=o(44766),pe=o.n(Ce),re=o(23744),De=o(41929),ge=o(85455),ne=o(75687),ce=o(77662),M=o(5049),_=o(28307),t=o(43878),k=o(36422),W=function($e){var Ke=(0,ne.ZP)(function(Ee){var N,Te,Ze,oe,Ae,Ie;return{syncing:Ee.syncing,setSyncing:Ee.dispatch.setSyncing,datatype:(N=Ee.project)===null||N===void 0||(Te=N.projectJSON)===null||Te===void 0||(Ze=Te.dataTypeDomains)===null||Ze===void 0?void 0:Ze.datatype,database:(oe=Ee.project)===null||oe===void 0||(Ae=oe.projectJSON)===null||Ae===void 0||(Ie=Ae.dataTypeDomains)===null||Ie===void 0?void 0:Ie.database}},ce.Z),Be=Ke.syncing,Me=Ke.setSyncing,de=Ke.datatype,fe=Ke.database,je=$e.data,Oe=$e.columns,Y=$e.saveData,_e=$e.notEmptyColumn,He=function(N){Be||!N||N.length===0||(_e&&(N=pe().reject(N,function(Te){var Ze=pe().findIndex(_e,function(oe){return!Te[oe]||Te[oe]==""});return Ze>-1})),Y(N))},O=(0,Ne.useRef)(null),Xe=[{title:"\u590D\u5236",description:"Windows\uFF1ACtrl + C              |             Mac\uFF1Acommand + C"},{title:"\u7C98\u8D34",description:"Windows\uFF1ACtrl + V              |             Mac\uFF1Acommand + V"},{title:"\u526A\u5207",description:"Windows\uFF1ACtrl + X              |             Mac\uFF1Acommand + X"},{title:"\u64A4\u9500",description:"Windows\uFF1ACtrl + Z              |            Mac\uFF1Acommand + Z"},{title:"\u91CD\u505A",description:"Windows\uFF1ACtrl + Shit + Z              |            Mac\uFF1Acommand + Shit + Z"}],rt={data:je,columns:Oe,allowExport:!1,minDimensions:[1,1],csvHeaders:!0,columnResize:!0,search:!0,toolbar:[{type:"i",content:"undo",tooltip:"\u64A4\u9500",onclick:function(){var N;O==null||(N=O.current)===null||N===void 0||N.jexcel.undo()}},{type:"i",content:"redo",tooltip:"\u91CD\u505A",onclick:function(){var N;O==null||(N=O.current)===null||N===void 0||N.jexcel.redo()}},{type:"i",content:"add",tooltip:"\u672B\u5C3E\u589E\u52A0\u4E00\u884C",onclick:function(){var N;O==null||(N=O.current)===null||N===void 0||N.jexcel.insertRow()}},{type:"i",content:"remove",tooltip:"\u5220\u9664\u9009\u4E2D\u884C",onclick:function(){var N;O==null||(N=O.current)===null||N===void 0||N.jexcel.deleteRow()}},{type:"i",content:"publish",tooltip:"\u5728\u6B64\u524D\u63D2\u5165\u884C",onclick:function(){var N,Te,Ze,oe=O==null||(N=O.current)===null||N===void 0?void 0:N.jexcel.getSelectedRows();if(!oe||!((Te=oe[0])!==null&&Te!==void 0&&Te.dataset)){M.ZP.warning("\u672A\u9009\u4E2D\u884C");return}O==null||(Ze=O.current)===null||Ze===void 0||Ze.jexcel.insertRow(1,parseInt(oe[0].dataset.y),1)}},{type:"i",content:"get_app",tooltip:"\u5728\u6B64\u540E\u63D2\u5165\u884C",onclick:function(){var N,Te,Ze,oe=O==null||(N=O.current)===null||N===void 0?void 0:N.jexcel.getSelectedRows();if(!oe||!((Te=oe[oe.length-1])!==null&&Te!==void 0&&Te.dataset)){M.ZP.warning("\u672A\u9009\u4E2D\u884C");return}O==null||(Ze=O.current)===null||Ze===void 0||Ze.jexcel.insertRow(1,parseInt(oe[oe.length-1].dataset.y))}},{type:"i",content:"help_outline",tooltip:"\u5FEB\u6377\u64CD\u4F5C",onclick:function(){_.Z.info({title:"\u5FEB\u6377\u64CD\u4F5C",width:500,content:(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(t.ZP,{itemLayout:"horizontal",dataSource:Xe,renderItem:function(Te){return(0,k.jsx)(t.ZP.Item,{children:(0,k.jsx)(t.ZP.Item.Meta,{title:(0,k.jsx)("a",{href:"https://ant.design",children:Te.title}),description:Te.description})})}})})})}}],text:{noRecordsFound:"\u672A\u627E\u5230",showingPage:"\u663E\u793A {1} \u6761\u4E2D\u7684\u7B2C {0} \u6761",show:"\u663E\u793A ",search:"\u641C\u7D22",entries:" \u6761\u76EE",columnName:"\u5217\u6807\u9898",insertANewColumnBefore:"\u5728\u6B64\u524D\u63D2\u5165\u5217",insertANewColumnAfter:"\u5728\u6B64\u540E\u63D2\u5165\u5217",deleteSelectedColumns:"\u5220\u9664\u9009\u5B9A\u5217",renameThisColumn:"\u91CD\u547D\u540D\u5217",orderAscending:"\u5347\u5E8F",orderDescending:"\u964D\u5E8F",insertANewRowBefore:"\u5728\u6B64\u524D\u63D2\u5165\u884C",insertANewRowAfter:"\u5728\u6B64\u540E\u63D2\u5165\u884C",deleteSelectedRows:"\u5220\u9664\u9009\u5B9A\u884C",editComments:"\u7F16\u8F91\u6279\u6CE8",addComments:"\u63D2\u5165\u6279\u6CE8",comments:"\u6279\u6CE8",clearComments:"\u5220\u9664\u6279\u6CE8",copy:"\u590D\u5236...",paste:"\u7C98\u8D34...",saveAs:"\u4FDD\u5B58\u4E3A...",about:"\u5173\u4E8E",areYouSureToDeleteTheSelectedRows:"\u786E\u5B9A\u5220\u9664\u9009\u5B9A\u884C?",areYouSureToDeleteTheSelectedColumns:"\u786E\u5B9A\u5220\u9664\u9009\u5B9A\u5217?",thisActionWillDestroyAnyExistingMergedCellsAreYouSure:"\u8FD9\u4E00\u64CD\u4F5C\u4F1A\u7834\u574F\u6240\u6709\u73B0\u5B58\u7684\u5408\u5E76\u5355\u5143\u683C\uFF0C\u786E\u8BA4\u64CD\u4F5C\uFF1F",thisActionWillClearYourSearchResultsAreYouSure:"\u8FD9\u4E00\u64CD\u4F5C\u4F1A\u6E05\u7A7A\u641C\u7D22\u7ED3\u679C\uFF0C\u786E\u8BA4\u64CD\u4F5C\uFF1F",thereIsAConflictWithAnotherMergedCell:"\u4E0E\u5176\u4ED6\u5408\u5E76\u5355\u5143\u683C\u6709\u51B2\u7A81",invalidMergeProperties:"\u65E0\u6548\u7684\u5408\u5E76\u5C5E\u6027",cellAlreadyMerged:"\u5355\u5143\u683C\u5DF2\u5408\u5E76",noCellsSelected:"\u672A\u9009\u5B9A\u5355\u5143\u683C"},about:!1,updateTable:function(N,Te,Ze,oe,Ae,Ie,et){Te.title=Ae},onchange:function(N,Te,Ze,oe,Ae){var Ie,et,kt=O==null||(Ie=O.current)===null||Ie===void 0?void 0:Ie.jexcel.getRowData(oe),it=pe().find(de,{name:Ae}),yt=pe().find(fe,{defaultDatabase:!0}).code||fe[0].code,gt=pe().get(it,"code"),Nt="apply.".concat(yt,".type"),xt=pe().get(it,Nt);if(it&&yt&&gt&&xt){var qe,lt,ut,Ue;O==null||(qe=O.current)===null||qe===void 0||(lt=qe.jexcel)===null||lt===void 0||lt.setValueFromCoords(Number(Ze)+1,oe,gt,!0),O==null||(ut=O.current)===null||ut===void 0||(Ue=ut.jexcel)===null||Ue===void 0||Ue.setValueFromCoords(Number(Ze)+2,oe,xt,!0)}He(O==null||(et=O.current)===null||et===void 0?void 0:et.jexcel.getJson())},oninsertrow:function(){},ondeleterow:function(){var N;He(O==null||(N=O.current)===null||N===void 0?void 0:N.jexcel.getJson())},onmoverow:function(){var N;He(O==null||(N=O.current)===null||N===void 0?void 0:N.jexcel.getJson())},onpaste:function(){var N;He(O==null||(N=O.current)===null||N===void 0?void 0:N.jexcel.getJson())},onundo:function(){var N;He(O==null||(N=O.current)===null||N===void 0?void 0:N.jexcel.getJson())},onredo:function(){var N;He(O==null||(N=O.current)===null||N===void 0?void 0:N.jexcel.getJson())}};(0,Ne.useEffect)(function(){O.current.jspreadsheet||b()(O.current,rt)},[rt]),(0,Ne.useEffect)(function(){},[$e.data]);var ot=function(){var N;O==null||(N=O.current)===null||N===void 0||N.jexcel.insertRow()};return(0,k.jsx)("div",{ref:O})},U=W},78167:function(Ge,Fe,o){o.r(Fe),o.d(Fe,{column1:function(){return ge},column2:function(){return ne},emptyValidator:function(){return De}});var Ne=o(98404),s=o(75687),b=o(77662),Ce=o(5049),pe=o(68999),re=o(36422),De=function(_,t){!_||_.length===0?(Ce.ZP.error("\u5F53\u524D\u7F16\u8F91\u9879\u4E0D\u5141\u8BB8\u4E3A\u7A7A"),t(!1)):t(!0)},ge=[{title:"\u4E2D\u6587\u540D*",name:"chnname",type:"text",width:"100"},{title:"\u82F1\u6587\u540D*",name:"name",type:"text",width:"100"}],ne=[{title:"\u7C7B\u578B(code)",name:"type",type:"text",width:"100",readOnly:!0},{title:"\u6570\u636E\u6E90\u7C7B\u578B",name:"dataType",type:"text",width:"130",readOnly:!0},{title:"\u8BF4\u660E",name:"remark",type:"text",width:"100"},{title:"\u4E3B\u952E",name:"pk",type:"checkbox",width:"50"},{title:"\u975E\u7A7A",name:"notNull",type:"checkbox",width:"50"},{title:"\u81EA\u589E",name:"autoIncrement",type:"checkbox",width:"50"},{title:"\u5728\u5173\u7CFB\u56FE\u4E2D\u9690\u85CF",name:"relationNoShow",type:"checkbox",width:"120"},{title:"\u9ED8\u8BA4\u503C",name:"defaultValue",type:"text",width:"100"},{title:"UI\u5EFA\u8BAE",name:"uiHint",type:"dropdown",width:"100",source:["Text","Number","Money","Select","Radio","CheckBox","Email","URL","DatePicker","TextArea","AddressPicker"]}],ce=function(_){var t=(0,s.ZP)(function(Me){var de,fe,je,Oe,Y,_e;return{datatype:(de=Me.project)===null||de===void 0||(fe=de.projectJSON)===null||fe===void 0||(je=fe.dataTypeDomains)===null||je===void 0?void 0:je.datatype,database:(Oe=Me.project)===null||Oe===void 0||(Y=Oe.projectJSON)===null||Y===void 0||(_e=Y.dataTypeDomains)===null||_e===void 0?void 0:_e.database,projectDispatch:Me.dispatch}},b.Z),k=t.datatype,W=t.projectDispatch,U=k==null?void 0:k.map(function(Me){return Me.name}),$=JSON.stringify(W.getDefaultFields().filter(function(Me){return Me!=null})||[]),$e=JSON.parse($),Ke=function(de){W.updateDefaultFields(de)},Be=[].concat(ge,[{title:"\u7C7B\u578B*",name:"typeName",type:"dropdown",source:U,width:"150"}],ne);return(0,re.jsx)(pe.Z,{data:$e,columns:Be,saveData:Ke,notEmptyColumn:["chnname","name","typeName"]})};Fe.default=Ne.memo(ce)},27934:function(Ge,Fe,o){o.r(Fe),o.d(Fe,{default:function(){return aa}});var Ne=o(91484),s=o.n(Ne),b=o(98404),Ce=o(50749),pe=o(5678),re=o.n(pe),De=o(98360),ge=o(35274),ne=o(75687),ce=o(77662),M=o(68999),_=o(78167),t=o(36422),k=function(v){var j=(0,ne.ZP)(function(u){var f,S,Z,L,T,Q,m,i,y;return{entity:(f=u.project)===null||f===void 0||(S=f.projectJSON)===null||S===void 0||(Z=S.modules[u.currentModuleIndex||0])===null||Z===void 0?void 0:Z.entities[u.currentEntityIndex||0],datatype:(L=u.project)===null||L===void 0||(T=L.projectJSON)===null||T===void 0||(Q=T.dataTypeDomains)===null||Q===void 0?void 0:Q.datatype,database:(m=u.project)===null||m===void 0||(i=m.projectJSON)===null||i===void 0||(y=i.dataTypeDomains)===null||y===void 0?void 0:y.database,projectDispatch:u.dispatch}},ce.Z),c=j.datatype,e=j.entity,n=j.projectDispatch,a=c==null?void 0:c.map(function(u){return u.name}),l=JSON.stringify((e==null?void 0:e.fields)||[{}]),r=function(f){n.updateEntityFields(f)},p=JSON.parse(l),d=[].concat(re()(_.column1),[{title:"\u7C7B\u578B*",name:"typeName",type:"dropdown",source:a,width:"150"}],re()(_.column2));return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(M.Z,{data:p,columns:d,saveData:r,notEmptyColumn:["name","typeName"]})})},W=b.memo(k),U=o(9116),$=o.n(U),$e=o(4966),Ke=o(44766),Be=o.n(Ke),Me=o(6487),de=function(v){return(v.modules||[]).reduce(function(j,c){return j.concat(c.entities||[])},[])},fe=function(v,j,c){var e=[];return Object.keys(v).forEach(function(n){n!=="typeName"&&n!=="dataType"&&j[n]!==v[n]&&e.push({type:"field",name:"".concat(c.title,".").concat(v.name,".").concat(n),opt:"update",changeData:"".concat(j[n],"=>").concat(v[n])})}),e},je=function(v,j,c){var e=[];return Object.keys(v).forEach(function(n){j[n]!==v[n]&&e.push({type:"index",name:"".concat(c.title,".").concat(v.name,".").concat(n),opt:"update",changeData:"".concat(j[n],"=>").concat(v[n])})}),e},Oe=function(v,j,c,e){var n=[];return v.forEach(function(a){j.includes(a)||n.push({type:"index",name:"".concat(c,".").concat(e,".fields.").concat(a),opt:"update",changeData:"addField=>".concat(a)})}),j.forEach(function(a){v.includes(a)||n.push({type:"index",name:"".concat(c,".").concat(e,".fields.").concat(a),opt:"update",changeData:"deleteField=>".concat(a)})}),n},Y=function(v,j){var c=[],e=v.indexs||[],n=j.indexs||[],a=n.map(function(r){return r.name}),l=e.map(function(r){return r.name});return e.forEach(function(r){if(!a.includes(r.name))c.push({type:"index",name:"".concat(v.title,".").concat(r.name),opt:"add"});else{var p=n.filter(function(f){return f.name===r.name})[0]||{};c.push.apply(c,re()(je(Be().omit(r,["fields"]),Be().omit(p,["fields"]),v)));var d=p.fields||[],u=r.fields||[];c.push.apply(c,re()(Oe(u,d,v.title,r.name)))}}),n.forEach(function(r){l.includes(r.name)||c.push({type:"index",name:"".concat(v.title,".").concat(r.name),opt:"delete"})}),c},_e=function(v,j){var c=[];return Object.keys(v).forEach(function(e){j[e]!==v[e]&&c.push({type:"entity",name:"".concat(v.title,".").concat(e),opt:"update",changeData:"".concat(j[e],"=>").concat(v[e])})}),c},He=function(v,j){var c=[],e=de(v),n=de(j),a=n.map(function(r){return r.title}),l=e.map(function(r){return r.title});return e.forEach(function(r){if(a.includes(r.title)){var p=n.filter(function(T){return T.title===r.title})[0]||{},d=(p.fields||[]).filter(function(T){return T.name}),u=(r.fields||[]).filter(function(T){return T.name}),f=d.map(function(T){return T.name}),S=u.map(function(T){return T.name});u.forEach(function(T){if(!f.includes(T.name))c.push({type:"field",name:"".concat(r.title,".").concat(T.name),opt:"add"});else{var Q=d.filter(function(i){return i.name===T.name})[0]||{},m=fe(T,Q,r);c.push.apply(c,re()(m))}}),d.forEach(function(T){S.includes(T.name)||c.push({type:"field",name:"".concat(r.title,".").concat(T.name),opt:"delete"})});var Z=_e(Be().omit(r,["fields","indexs","headers"]),Be().omit(p,["fields","indexs"]));c.push.apply(c,re()(Z));var L=Y(r,p);c.push.apply(c,re()(L))}else c.push({type:"entity",name:r.title,opt:"add"})}),n.forEach(function(r){l.includes(r.title)||c.push({type:"entity",name:r.title,opt:"delete"})}),c},O=function(v,j,c){var e=j.sort(function(l,r){return(0,Me.t)(r.version,l.version)})[0],n=s()({},v),a=He(n,(e==null?void 0:e.projectJSON)||n);c&&c(a,e)},Xe=o(40570),rt=o(82411),ot=o(81824),Ee=o(45836),N=o(67355),Te=ot.Z.Paragraph,Ze=function(v){var j=v.dbCode,c=v.templateCode,e=(0,ne.ZP)(function(C){var h,I,g,P,A,X,J;return{dataTable:(h=C.project)===null||h===void 0||(I=h.projectJSON)===null||I===void 0||(g=I.modules[C.currentModuleIndex||0])===null||g===void 0?void 0:g.entities[C.currentEntityIndex||0],dataSource:(P=C.project)===null||P===void 0?void 0:P.projectJSON,dbs:(A=C.project)===null||A===void 0||(X=A.projectJSON)===null||X===void 0||(J=X.profile)===null||J===void 0?void 0:J.dbs,projectDispatch:C.dispatch}},ce.Z),n=e.dataSource,a=e.dataTable,l=e.dbs,r=document.body.clientHeight,p=r,d=(0,b.useState)(""),u=$()(d,2),f=u[0],S=u[1],Z=(0,b.useState)([]),L=$()(Z,2),T=L[0],Q=L[1],m=(0,b.useState)({}),i=$()(m,2),y=i[0],x=i[1],D=function(){var h=l==null?void 0:l.filter(function(I){return I.defaultDB})[0];rt.hisProjectLoad(h).then(function(I){I&&I.code===200&&O(n,I.data,function(g,P){Q(g),x(P),S(E(g))})})},E=function(h){if(!a||a.fields.length<=0)return"";var I=h.filter(function(P){var A=P.name.split(".")[0];return c==="createFieldTemplate"&&P.type==="field"&&P.opt==="add"&&A===a.title||c==="updateFieldTemplate"&&P.type==="field"&&P.opt==="update"&&A===a.title||c==="deleteFieldTemplate"&&P.type==="field"&&P.opt==="delete"&&A===a.title||c==="deleteIndexTemplate"&&P.type==="index"&&P.opt==="delete"&&A===a.title||c==="rebuildTableTemplate"&&P.type==="field"&&A===a.title}),g;return c==="originalCreateTableTemplate"?g=a.originalCreateTableSql:g=(0,Xe.A8)(n,v.moduleEntity.module,a,j,c,I,y),g};return(0,b.useEffect)(function(){D()},[c]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(Te,{copyable:{text:f},children:["    ",c==="createTableTemplate"||c==="originalCreateTableTemplate"||c==="deleteTableTemplate"||c==="createIndexTemplate"?"\u8BE5\u811A\u672C\u4E3A\u5168\u91CF\u811A\u672C":(0,t.jsxs)(Ee.Z,{placement:"top",title:"\u5DEE\u5F02\u5316\u811A\u672C: 1\u3001\u6839\u636E\u6700\u540E\u4E00\u4E2A\u7248\u672C\u7684\u5143\u6570\u636E\uFF0C\u8BA1\u7B97\u548C\u5F53\u524D\u6A21\u578B\u7684\u5DEE\u5F02\uFF0C\u7136\u540E\u6309\u6A21\u677F\u6E32\u67D3\uFF1B 2\u3001\u672A\u540C\u6B65\u7248\u672C\u65F6\u8FD9\u91CC\u4E3A\u7A7A; 3\u3001\u5F53\u524D\u9879\u672A\u4EA7\u751F\u53D8\u5316\uFF0C\u8FD9\u91CC\u4E3A\u7A7A; ",children:[(0,t.jsx)(N.Z,{})," \u8BE5\u811A\u672C\u4E3A\u5DEE\u5F02\u5316\u811A\u672C"]})]}),(0,t.jsx)($e.Z,{mode:"mysql",height:"".concat(p*.55,"px"),value:f})]})},oe=b.memo(Ze),Ae=o(24882),Ie=Ae.Z.TabPane,et=function(v){var j=v.dbCode,c=v.moduleEntity;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(Ae.Z,{children:[(0,t.jsx)(Ie,{tab:"\u539F\u59CB\u5EFA\u8868\u8BED\u53E5",children:(0,t.jsx)(oe,{dbCode:j,templateCode:"originalCreateTableTemplate",moduleEntity:c})},"originalCreateTableTemplate"),(0,t.jsx)(Ie,{tab:"\u521B\u5EFA\u8868",children:(0,t.jsx)(oe,{dbCode:j,templateCode:"createTableTemplate",moduleEntity:c})},"createTableTemplate"),(0,t.jsx)(Ie,{tab:"\u5220\u9664\u8868",children:(0,t.jsx)(oe,{dbCode:j,templateCode:"deleteTableTemplate",moduleEntity:c})},"deleteTableTemplate"),(0,t.jsx)(Ie,{tab:"\u521B\u5EFA\u7D22\u5F15",closable:!0,children:(0,t.jsx)(oe,{dbCode:j,templateCode:"createIndexTemplate",moduleEntity:c})},"createIndexTemplate"),(0,t.jsx)(Ie,{tab:"\u91CD\u5EFA\u8868",children:(0,t.jsx)(oe,{dbCode:j,templateCode:"rebuildTableTemplate",moduleEntity:c})},"rebuildTableTemplate"),(0,t.jsx)(Ie,{tab:"\u6DFB\u52A0\u5B57\u6BB5",children:(0,t.jsx)(oe,{dbCode:j,templateCode:"createFieldTemplate",moduleEntity:c})},"createFieldTemplate"),(0,t.jsx)(Ie,{tab:"\u4FEE\u6539\u5B57\u6BB5",children:(0,t.jsx)(oe,{dbCode:j,templateCode:"deleteFieldTemplate",moduleEntity:c})},"deleteFieldTemplate"),(0,t.jsx)(Ie,{tab:"\u5220\u9664\u5B57\u6BB5",children:(0,t.jsx)(oe,{dbCode:j,templateCode:"updateFieldTemplate",moduleEntity:c})},"updateFieldTemplate"),(0,t.jsx)(Ie,{tab:"\u5220\u9664\u7D22\u5F15",children:(0,t.jsx)(oe,{dbCode:j,templateCode:"deleteIndexTemplate",moduleEntity:c})},"deleteIndexTemplate"),(0,t.jsx)(Ie,{tab:"\u521B\u5EFA\u4E3B\u952E",children:(0,t.jsx)(oe,{dbCode:j,templateCode:"createPkTemplate",moduleEntity:c})},"createPkTemplate"),(0,t.jsx)(Ie,{tab:"\u5220\u9664\u4E3B\u952E",children:(0,t.jsx)(oe,{dbCode:j,templateCode:"deletePkTemplate",moduleEntity:c})},"deletePkTemplate")]},"dbNav")})},kt=b.memo(et),it=Ae.Z.TabPane,yt=function(v){var j=(0,ne.ZP)(function(e){var n,a,l;return{database:(n=e.project)===null||n===void 0||(a=n.projectJSON)===null||a===void 0||(l=a.dataTypeDomains)===null||l===void 0?void 0:l.database,projectDispatch:e.dispatch}},ce.Z),c=j.database;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(Ae.Z,{id:"codeNav",children:c==null?void 0:c.map(function(e){return(0,t.jsx)(it,{id:e.code,tab:e.code,children:(0,t.jsx)(kt,{dbCode:e.code,moduleEntity:v.moduleEntity})},e.code)})})})},gt=b.memo(yt),Nt=function(v){var j=(0,ne.ZP)(function(d){var u,f;return{entity:(u=d.project)===null||u===void 0||(f=u.projectJSON)===null||f===void 0?void 0:f.modules[d.currentModuleIndex||0].entities[d.currentEntityIndex||0],projectDispatch:d.dispatch}}),c=j.entity,e=j.projectDispatch,n=c==null?void 0:c.fields.map(function(d,u){return d.name}),a=JSON.stringify((c==null?void 0:c.indexs)||[{}]),l=function(u){u=u.map(function(f){return s()(s()({},f),{},{fields:f.fields.constructor===String?Be().split(Be().trimStart(f==null?void 0:f.fields,";"),";"):f.fields})}),e.updateEntityIndex(u)},r=JSON.parse(a),p=[{title:"\u7D22\u5F15\u540D*",name:"name",type:"text",width:document.body.clientWidth*.2},{title:"\u5B57\u6BB5*",name:"fields",type:"dropdown",width:document.body.clientWidth*.35,multiple:!0,source:n},{title:"\u662F\u5426\u552F\u4E00",name:"isUnique",type:"checkbox",width:document.body.clientWidth*.1}];return(0,t.jsx)(M.Z,{data:r,columns:p,saveData:l,notEmptyColumn:["name","fields"]})},xt=b.memo(Nt),qe=Ae.Z.TabPane,lt=function(v){return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(Ae.Z,{id:"tableNav",defaultActiveKey:"field",size:"small",children:[(0,t.jsx)(qe,{tab:"\u5B57\u6BB5",children:(0,t.jsx)(W,{moduleEntity:v.moduleEntity})},"field"),(0,t.jsx)(qe,{tab:"\u7D22\u5F15",children:(0,t.jsx)(xt,{moduleEntity:v.moduleEntity})},"index"),(0,t.jsx)(qe,{tab:"\u5143\u6570\u636E\u5E94\u7528",children:(0,t.jsx)(gt,{moduleEntity:v.moduleEntity})},"code")]})})},ut=b.memo(lt),Ue=o(14515),Ht=o(29046),St=o.n(Ht),Jt=o(73348),Ct=o.n(Jt),Yt=o(38898),K=o.n(Yt),Qt=o(23301),jt=o.n(Qt),Gt=o(48201),Et=o.n(Gt),Xt=o(99439),z=o.n(Xt),bt=o(99880),qt=o(10651),Pe=o.n(qt),ke=o(25087),en=function(me){jt()(j,me);var v=Et()(j);function j(c){var e;return St()(this,j),e=v.call(this,c),z()(K()(e),"_valueChange",function(n,a){e.setState(z()({},a,n))}),z()(K()(e),"save",function(n){var a=e.state,l=a.from,r=a.to;!l||!r?Modal.error({title:"\u7F16\u8F91\u5931\u8D25",message:"\u5BF9\u5E94\u5173\u7CFB\u4E0D\u80FD\u4E3A\u7A7A",width:300}):n&&n(null,"".concat(l,":").concat(r))}),e.state={from:c.from,to:c.to},e}return Ct()(j,[{key:"render",value:function(){var e=this,n=this.state,a=n.from,l=n.to,r=this.props.prefix,p=r===void 0?"erd":r;return(0,t.jsxs)("div",{className:"".concat(p,"-relation-edit"),children:[(0,t.jsx)("span",{children:"from"}),(0,t.jsxs)(ke.Z,{style:{width:100},value:a,onChange:function(u){return e._valueChange(u,"from")},children:[(0,t.jsx)("option",{value:"1",children:"1"},"1"),(0,t.jsx)("option",{value:"0,1",children:"0,1"},"0,1"),(0,t.jsx)("option",{value:"0,n",children:"0,n"},"0,n"),(0,t.jsx)("option",{value:"1,n",children:"1,n"},"1,n"),(0,t.jsx)("option",{value:"",children:"\u8BF7\u9009\u62E9"},"__empty")]}),(0,t.jsx)("span",{children:":"}),(0,t.jsx)("span",{children:"to"}),(0,t.jsxs)(ke.Z,{style:{width:100},value:l,onChange:function(u){return e._valueChange(u,"to")},children:[(0,t.jsx)("option",{value:"0",children:"0"},"0"),(0,t.jsx)("option",{value:"1",children:"1"},"1"),(0,t.jsx)("option",{value:"0,1",children:"0,1"},"0,1"),(0,t.jsx)("option",{value:"0,n",children:"0,n"},"0,n"),(0,t.jsx)("option",{value:"1,n",children:"1,n"},"1,n"),(0,t.jsx)("option",{value:"",children:"\u8BF7\u9009\u62E9"},"__empty")]})]})}}]),j}(b.Component),tn=o(22677),nn=o(76129),Rt=function(me){jt()(j,me);var v=Et()(j);function j(c){var e;return St()(this,j),e=v.call(this,c),z()(K()(e),"_checkHeight",function(){var n=e.props.top,a=bt.findDOMNode(e.instance),l=a.getBoundingClientRect(),r=document.body.clientHeight;l.height+n>=r&&(n-l.height>=0?a.style.top=n-l.height+"px":a.style.top="0px")}),z()(K()(e),"_mouseOver",function(n,a){n.stopPropagation(),e.setState({menus:s()(s()({},e.state.menus),{},z()({},a,{backgroundColor:e.state.selectBackgroundColor,textColor:e.state.selectTextColor}))})}),z()(K()(e),"_mouseOut",function(n,a){n.stopPropagation(),e.setState({menus:s()(s()({},e.state.menus),{},z()({},a,{backgroundColor:e.state.defaultBackgroundColor,textColor:e.state.defaultTextColor}))})}),z()(K()(e),"_onClick",function(n,a,l){var r=e.props,p=r.onClick,d=r.closeContextMenu;p&&p(n,a,l),d&&d()}),z()(K()(e),"_onBlur",function(){var n=e.props.closeContextMenu;n&&n()}),e.state={defaultBackgroundColor:"#ffffff",defaultTextColor:"#000000",selectBackgroundColor:"#ffffff",selectTextColor:"#1690ff",border:"1px solid #CDCDCD",menus:{}},e}return Ct()(j,[{key:"componentDidUpdate",value:function(){document.getElementById("contextmenu").focus(),this._checkHeight()}},{key:"componentDidMount",value:function(){this._checkHeight()}},{key:"render",value:function(){var e=this,n=this.props,a=n.menus,l=n.left,r=n.top,p=n.display;return(0,t.jsx)("div",{tabIndex:"0",onBlur:this._onBlur,id:"contextmenu",ref:function(u){return e.instance=u},style:{outline:"none",position:"absolute",display:p,backgroundColor:this.state.defaultBackgroundColor,border:this.state.border,minWidth:160,zIndex:999,left:l,top:r},children:(0,t.jsx)("ul",{style:{width:"100%",height:"100%",listStyle:"none",paddingInlineStart:"20px",marginBottom:"0px"},children:a.map(function(d){return(0,t.jsx)("li",{onMouseOver:function(f){return e._mouseOver(f,d.key)},onMouseOut:function(f){return e._mouseOut(f,d.key)},style:{userSelect:"none",width:"100%",cursor:"pointer",padding:5,backgroundColor:Be().get(e.state.menus,[d.key]+".backgroundColor",e.state.defaultBackgroundColor),color:Be().get(e.state.menus,[d.key]+".textColor",e.state.defaultTextColor)},onClick:function(f){return e._onClick(f,d.key,d)},children:d.name},d.key)})})})}}]),j}(b.Component);z()(Rt,"defaultProps",{menus:[]});var an=Rt,Je=o(38297),we=o(5049),rn=o(28307),on=function(v){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=document.createElement("div");document.body.appendChild(c);var e=null,n=function(p){var d=bt.unmountComponentAtNode(c);if(d){c.parentNode.removeChild(c);var u=j.onCancel;u&&u(p)}},a=function(p){var d=j.onOk;d&&d({close:n},e,p)},l=function(r){jt()(d,r);var p=Et()(d);function d(){return St()(this,d),p.apply(this,arguments)}return Ct()(d,[{key:"render",value:function(){return(0,t.jsx)(rn.Z,s()(s()({},j),{},{visible:!0,onCancel:n,onOk:a,children:b.cloneElement(v,{ref:function(S){return e=S},onCancel:n})}))}}]),d}(b.Component);return bt.render(b.createElement(l),c),{close:n,com:e}},ln=on,un=o(42059),sn=o(2947),dn=o(85839),cn=o(90075),vn=o(59893);G6.track(!1);var fn=function(me){jt()(j,me);var v=Et()(j);function j(c){var e;return St()(this,j),e=v.call(this,c),z()(K()(e),"onZoom",function(n){var a=e.net.getScale();n==="add"&&a>=0&&a<=9.8&&(a=Math.round(parseFloat(a+.2)*100)/100),n==="sub"&&a<=10&&a>=0&&(a=Math.round(parseFloat(a-.2)*100)/100),n==="normal"&&(a=1),e._zoomTree(a)}),z()(K()(e),"_addCountTableName",function(n,a){var l=a.split(":")[1];return n.includes(":")?n:l?"".concat(n,":").concat(l):n}),z()(K()(e),"_getTableNameByNameTemplate",function(n,a){var l=a;if(n){var r=n.nameTemplate||"{code}[{name}]";r?l=r.replace(/\{(\w+)\}/g,function(p,d){var u=d;return u==="code"?u="title":u==="name"&&(u="chnname"),n[u]})||n.title:l=n.chnname||n.title}return e._addCountTableName(l,a)}),z()(K()(e),"_updateTableName",function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return n.map(function(l){var r=l.title.split(":");return a.oldName===r[0]?s()(s()({},l),{},{title:"".concat(a.newName).concat(r[1]?":".concat(r[1]):"")}):l})}),z()(K()(e),"_getAssociations",function(n,a){var l=re()(n.edges||[]),r=re()(n.nodes||[]),p=a.entities||[],d=l.map(function(f){var S=r.filter(function(x){return x.id===f.source})[0],Z=r.filter(function(x){return x.id===f.target})[0],L=S.title.split(":")[0],T=Z.title.split(":")[0],Q=p.filter(function(x){return x.title===L})[0]||S,m=p.filter(function(x){return x.title===T})[0]||Z,i=(Q.fields||[]).filter(function(x){return!x.relationNoShow})[parseInt(f.sourceAnchor/2,10)],y=(m.fields||[]).filter(function(x){return!x.relationNoShow})[parseInt(f.targetAnchor/2,10)];return!i||!y?null:{relation:f.relation||"0,n:1",from:{entity:L,field:i.name},to:{entity:T,field:y.name}}}).filter(function(f){return!!f}),u=[];return d.filter(function(f){var S="".concat(f.from.entity,"/").concat(f.to.field,`
      /`).concat(f.to.entity,"/").concat(f.from.field);return u.includes(S)?!1:(u.push(S),!0)})}),z()(K()(e),"_filterFieldsAndCopy",function(n){return s()(s()({},n),{},{edges:e._updateEdges(n.nodes,n.nodes,n.edges),nodes:(n.nodes||[]).map(function(a){return s()({},Pe().omit(a,["fields","headers","datatype","associations","realName","edges"]))})})}),z()(K()(e),"searchNodes",function(n){var a=e.net.getNodes();a.forEach(function(l){var r=Pe().get(l,"_attrs.model.realName","").toLocaleLowerCase();if(n&&r.includes(n.toLocaleLowerCase()))e.net.update(l,{color:"yellow"});else{var p="#431E90";r.includes(":")&&(p="#5D616A"),e.net.update(l,{color:p})}})}),z()(K()(e),"promiseSave",function(){return new Promise(function(n){e.saveData(function(){n()})})}),z()(K()(e),"getNodes",function(){return e.net.getNodes().map(function(n){return Pe().get(n,"_attrs.model")})}),z()(K()(e),"setNodes",function(n){e.newNodes=n}),z()(K()(e),"exportImg",function(n){var a=e.props.value,l=e.net,r=document.getElementById("paint-".concat(a)),p=getComputedStyle(r),d=null,u="",f="",S=void 0;n==="all"?(S="autoSize",u=2e3,f=2e3):(u=p.width&&p.width.split("px")[0],f=p.width&&p.height.split("px")[0]);var Z=(0,tn.V)();d=document.createElement("div"),d.setAttribute("id",Z),d.style.width="".concat(u,"px"),d.style.height="".concat(f,"px"),document.body.appendChild(d);var L=e.net.save().source;e._renderRelation(u,f,L,null,Z,S,!0,!0),setTimeout(function(){var T=e.net.get("graphContainer");e._keyDown({key:"m"},!0),html2canvas(T).then(function(Q){var m=Q.toDataURL("png"),i=e.props.value.split("map&")[1].split("/")[0];nn.pd(m,"".concat(i,"-relation.png")),e.net=l,d&&d.parentNode.removeChild(d)})})}),z()(K()(e),"saveData",function(n){e.graphCanvas=e.net.save().source;var a=e.props,l=a.saveProjectSome,r=a.dataSource,p=a.value,d=a.projectDispatch,u=e._filterFieldsAndCopy(e.graphCanvas);u=e._clearInvalidData(u,r);var f=p.split("map&")[1].split("/")[0],S=(r.modules||[]).filter(function(Z){return Z.name===f})[0];d.updateRelation({associations:e._getAssociations(e.graphCanvas,S),graphCanvas:s()({},u)})}),z()(K()(e),"undo",function(){e.net.undo()}),z()(K()(e),"redo",function(){e.net.redo()}),z()(K()(e),"del",function(n){e.net.remove(n)}),z()(K()(e),"paste",function(){e.net.paste()}),z()(K()(e),"copy",function(){e.net.copy()}),z()(K()(e),"changeMode",function(n){e.net.changeMode(n)}),z()(K()(e),"_checkEmpty",function(n){Pe().get(n,"nodes",[]).length===0&&Pe().get(n,"edges",[]).length===0?e.setState({empty:!0}):e.setState({empty:!1})}),z()(K()(e),"_updateEdges",function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return l.map(function(r){var p=r.source,d=r.target,u=n.filter(function(x){return x.id===p})[0],f=n.filter(function(x){return x.id===d})[0],S=parseInt(r.sourceAnchor/2,10),Z=u&&u.fields&&u.fields[S],L=parseInt(r.targetAnchor/2,10),T=f&&f.fields&&f.fields[L],Q=a.filter(function(x){return x.id===p})[0],m=a.filter(function(x){return x.id===d})[0],i=(Q&&Q.fields||[]).findIndex(function(x){return x.name===(Z&&Z.name)}),y=(m&&m.fields||[]).findIndex(function(x){return x.name===(T&&T.name)});return!Z||!T||i<0||y<0?null:s()(s()({},r),{},{sourceAnchor:S===i?r.sourceAnchor:i*2,targetAnchor:L===y?r.targetAnchor:y*2})}).filter(function(r){return!!r})}),z()(K()(e),"_updateNodes",function(n,a){var l=e.props.value,r=l.split("map&")[1].split("/")[0],p=Pe().get(n,"modules",[]).filter(function(S){return S.name===r})[0],d=Pe().get(n,"dataTypeDomains.datatype",[]),u=e._getAllTableData(n),f=Pe().get(p,"associations",[]);return a.map(function(S){var Z=u.filter(function(T){return T.title===(S.copy||S.title.split(":")[0])})[0],L=Pe().get(Z,"fields",[]);return s()(s()({},S),{},{datatype:d,realName:e._getTableNameByNameTemplate(Z,S.title),associations:f,headers:e._initColumnOrder(Z),fields:L.filter(function(T){return!T.relationNoShow})})})}),z()(K()(e),"_getData",function(n){var a=e.props.value,l=a.split("map&")[1].split("/")[0],r=Pe().get(n,"modules",[]).filter(function(S){return S.name===l})[0],p=e._clearInvalidData(Pe().get(r,"graphCanvas",{}),n),d=Pe().get(r,"associations",[]),u=Pe().get(n,"dataTypeDomains.datatype",[]),f=s()(s()({},p),{},{nodes:re()(p.nodes||[]).map(function(S){var Z=e._getAllTableData(n).filter(function(L){return L.title===(S.copy||S.title.split(":")[0])})[0];return s()(s()({},S),{},{realName:e._getTableNameByNameTemplate(Z,S.title),datatype:u,associations:d,headers:e._initColumnOrder(Z),fields:Pe().get(Z,"fields",[]).filter(function(L){return!L.relationNoShow}),edges:re()(p.edges||[])})})});return f}),z()(K()(e),"_initColumnOrder",function(n){var a=e.props.columnOrder,l=n&&n.headers||[],r=l.map(function(p){return p.fieldName});return a.forEach(function(p){r.includes(p.code)||l.push({fieldName:p.code,relationNoShow:p.relationNoShow})}),l.filter(function(p){return!p.relationNoShow&&p.fieldName!=="relationNoShow"})}),z()(K()(e),"_clearInvalidData",function(n,a){var l=e._getAllTable(a,[]),r=(n.nodes||[]).filter(function(u){return l.includes(u.title.split(":")[0])}),p=r.map(function(u){return u.id}),d=(n.edges||[]).filter(function(u){return p.includes(u.source)&&p.includes(u.target)});return{nodes:r,edges:d}}),z()(K()(e),"_checkTableName",function(n,a){return a.includes(n)?e._checkTableName("".concat(n,"1"),a):n}),z()(K()(e),"_getDefaultDataType",function(n){var a=e.props.dataSource,l=Pe().get(a,"dataTypeDomains.database",[]),r=Pe().get(a,"dataTypeDomains.datatype",[]),p=l.filter(function(S){return S.defaultDatabase})[0],d=p.code||l[0].code||"";if(d){var u=r.filter(function(S){return S.code===n})[0]||{},f=u.apply||{};return f[d]&&f[d].type||""}return""}),z()(K()(e),"_getActivePointerPosition",function(n,a){var l=null,r=-1,p=(e.net.getEdges()||[]).filter(function(u){return u._attrs.actived})[0];if(p){var d=(p._attrs.model.controlPoints||[]).map(function(u,f){return{index:f,distance:(u.x-n)*(u.x-n)+(u.y-a)*(u.y-a)}});r=p._attrs.model.controlPoints.findIndex(function(u,f){return d[f].distance<15}),r>0&&r!==(p._attrs.model.controlPoints||[]).length-1&&(l=(p._attrs.model.controlPoints||[])[r])}return l}),z()(K()(e),"_renderRelation",function(n,a,l,r,p,d,u,f){var S=K()(e),Z=G6.Util,L=e._getDefaultDataType,T=new G6.Plugins["tool.minimap"]({width:180,height:180,marginRight:"20%"});G6.registEdge("erdRelation",{stroke:"#666",getShorterPath:function(i,y,x,D){var E=10,C,h,I=0,g=[];if(D){C=x.minY-E-y.y,h=x.maxY+E-y.y;var P=Math.abs(C)<Math.abs(h);P?I=x.minY-E-i.y:I=x.maxY+E-i.y}return I},getPath:function(i,y,x,D){var E=24,C=x.getBBox(),h=D.getBBox(),I=i.points,g=I[0],P=I[I.length-1],A=C.minX==g.x?-1:1,X=h.minX==P.x?-1:1,J={x:g.x+A*E,y:g.y},V={x:P.x+X*E,y:P.y},R=V.x-J.x,B=V.y-J.y,q=A*R<0,he=-X*R<0,ee=[["M",g.x,g.y]];ee.push(["L",J.x,J.y]);var be=i.origin.controlPoints;if(be&&be.length>2)for(var le=1;le<be.length-1;le++)ee.push(["L",be[le].x,be[le].y]);else{var G=this.getShorterPath(J,V,C,q),w=this.getShorterPath(V,J,h,he);G!=0&&w!=0,R>0?(G!=0&&ee.push(["L",J.x,J.y+G]),ee.push(["L",J.x+R/2,J.y+G]),ee.push(["L",V.x-R/2,V.y+w]),w!=0&&ee.push(["L",V.x,V.y+w])):(ee.push(["L",J.x,J.y+B/2]),ee.push(["L",V.x,V.y-B/2]))}return ee.push(["L",V.x,V.y]),ee.push(["L",P.x,P.y]),ee},afterDraw:function(i,y,x){i.origin.relation=i.origin.relation||"0,n:1";var D=i.points,E=D[0],C=D[D.length-1],h=x.getPoint(.01),I=x.getPoint(.99),g=4,P=-15,A=0,X={"0,1":{attrs:{x:0,y:0,path:"M"+P+","+(A-g)+"a "+g+","+g+",0,1,1,0,"+2*g+"a "+g+","+g+",0,1,1,0,"+-2*g+"M "+(P+g+1)+","+(g+1)+"L "+(P+g+1)+","+(-g-1)+"M "+(P+g+1)+",0L 0,0z",stroke:this.stroke,fill:"#fff"},class:"arrow",zIndex:10},"0,n":{attrs:{x:0,y:0,path:"M"+P+","+(A-g)+"a "+g+","+g+",0,1,1,0,"+2*g+"a "+g+","+g+",0,1,1,0,"+-2*g+"M "+(P+g+1)+","+(g+1)+"L "+(P+g+1)+","+(-g-1)+"M "+(P+g+1)+","+A+"L "+A+",-"+g+"M "+(P+g+1)+","+A+"L "+A+","+g+"M "+(P+g+1)+",0L 0,0z",stroke:this.stroke,fill:"#fff"},class:"arrow",zIndex:10},1:{attrs:{x:0,y:0,path:"M "+(P+g+1)+","+(g+1)+"L "+(P+g+1)+","+(-g-1)+"M "+(P+g+1)+",0L 0,0z",stroke:this.stroke,fill:"#fff"},class:"arrow",zIndex:10},"1,n":{attrs:{x:0,y:0,path:"M "+(P+g+1)+","+(g+1)+"L "+(P+g+1)+","+(-g-1)+"M "+(P+g+1)+","+A+"L "+A+",-"+g+"M "+(P+g+1)+","+A+"L "+A+","+g+"M "+(P+g+1)+",0L 0,0z",stroke:this.stroke,fill:"#fff"},class:"arrow",zIndex:10},0:{attrs:{x:0,y:0,path:"M"+P+","+(A-g)+"a "+g+","+g+",0,1,1,0,"+2*g+"a "+g+","+g+",0,1,1,0,"+-2*g,stroke:this.stroke,fill:"#fff"},class:"arrow",zIndex:10}};if(i.origin.relation){var J=i.origin.relation.split(":");if(J.length==2&&h){var V=y.addShape("path",X[J[0]]);G6.Util.arrowTo(V,E.x,E.y,h.x,h.y,E.x,E.y);var R=y.addShape("path",X[J[1]]);G6.Util.arrowTo(R,C.x,C.y,I.x,I.y,C.x,C.y)}}}}),G6.registerNode("table",{draw:function(i,y){var x=i.x,D=i.y,E=i.model,C=E.fields||[],h=C.length,I=E.headers||[],g=i.size&&i.size[0]||E.width,P=i.size&&i.size[1]||E.height,A=6,X=E.datatype||[],J=E.associations||[],V=J.filter(function(xe){return xe.to&&xe.from.entity===E.title.split(":")[0]}),R={},B={},q=y.addShape("rect",{attrs:{stroke:"blue",fill:E.moduleName?"#5D616A":i.color}});I.forEach(function(xe){y&&(R[xe.fieldName]=y.addGroup())});var he,ee=[],be,le,G,w,ye;be=y.addShape("text",{attrs:{x:0,y:0,text:E.moduleName?"<<".concat(E.moduleName,">> ").concat(E.realName):E.realName,fill:"#E3C266",textBaseline:"top",textAlign:"center"}}),ye=y.addShape("line",{attrs:{stroke:"#4D5157"}});var te=function(F,Se){if(Se==="pk"){var Ve=[];return F[Se]&&Ve.push("PK"),V.some(function(ht){return ht.from.field===F.name})&&Ve.push("FK"),Ve.length>0?"<".concat(Ve.join(","),">"):""}else if(Se==="type"&&F[Se]){var mt=X.filter(function(ht){return ht.code===F[Se]})[0];return mt&&mt.name||F[Se]}else if(Se==="dataType")return L(F.type);var Qe=F[Se]||"";return Se==="chnname"&&Qe.length>12&&(Qe=Qe.substring(0,12)+"..."),Qe},ze=function(F){return F.pk?"#C2A412":V.some(function(Se){return Se.from.field===F.name})?"#8F9C6D":"#E9E9ED"};le=be.getBBox();var dt=P&&(P-le.height)/h||20,Zt=dt<13?13:dt;Z.each(C,function(xe,F){Object.keys(R).forEach(function(Se){if(R[Se].addShape("text",{attrs:{x,y:D+Zt*F,text:te(xe,Se),fill:ze(xe),textBaseline:"top"}}),xe.pk){var Ve=R[Se].getBBox();R[Se]&&R[Se].addShape("line",{attrs:{x1:Ve.minX,y1:Ve.maxY+3,x2:Ve.maxX,y2:Ve.maxY+3,stroke:"#C2A412"}})}})}),I.forEach(function(xe){B[xe.fieldName]=R[xe.fieldName].getBBox()});var at=Object.keys(B).reduce(function(xe,F){return xe+B[F].width},0),wt=((g||at)-at)/I.length,Ye=wt<0?10:wt+10;G=at+Object.keys(B).length*Ye+2*A,Object.keys(B).length===0&&(G=le.width),G=Math.max(le.width,G),w=Math.max.apply(Math,re()(Object.keys(B).map(function(xe){return B[xe].height})))+4*A+le.height;var ct=R[Object.keys(R)[0]];he=ct&&ct.get("children")[0]&&ct.get("children")[0].getBBox().height||13,be.translate(0,-w/2+A);var vt=0;Object.keys(R).forEach(function(xe){R[xe].translate(-G/2+vt+A,-w/2+le.height+3*A),vt+=B[xe].width+Ye}),ye.attr({x1:i.x-G/2,y1:i.y-w/2+2*A+le.height,x2:i.x+G/2,y2:i.y-w/2+2*A+le.height}),q.attr({x:x-(isFinite(G)?G/2:le.width),y:D-(isFinite(w)?w/2:le.height/2),width:isFinite(G)?G:le.width*2,height:isFinite(w)?w:le.height*2});var ft=B[Object.keys(B)[0]];return Z.each(C,function(xe,F){var Se=(le.height+F*(ft.height+Zt-he)/h+he/2+3*A)/w;ee.push([0,Se]),ee.push([1,Se])}),y.set("anchorPoints",ee),q},getAnchorPoints:function(i,y){return y.get("anchorPoints")}}),e.net=new G6.Net({id:p||"paint-".concat(e.props.value),height:n-20,width:a,mode:"edit",fitView:d,plugins:[T],grid:{forceAlign:!0,cell:10,line:{stroke:"#535c69",opacity:.05}}}),e.net.on("click",function(m){if(e.pointerDom.style.display="none",e.setState({contextDisplay:"none"}),m.itemType==="edge"){var i=e._getActivePointerPosition(m.x,m.y);if(i){var y=e.net.converPoint(i);e.pointerDom.style.display="block",e.pointerDom.style.top="".concat(y.y-3,"px"),e.pointerDom.style.left="".concat(y.x-3,"px")}e.clickEdgeX=m.x,e.clickEdgeY=m.y,e.clickEdge=m.item}else e.clickEdge=null,e.domX=m.domX,e.domY=m.domY}),e.net.on("mousewheel",function(){e.pointerDom.style.display="none",e.setState({count:e.net.getScale().toFixed(1)})}),e.net.on("afterrender",function(){var m=e.props,i=m.value,y=m.dataSource,x=e.net.save().source,D=i.split("map&")[1].split("/")[0],E=(y.modules||[]).filter(function(C){return C.name===D})[0];e.net.changeData(s()(s()({},x),{},{nodes:(x.nodes||[]).map(function(C){return s()(s()({},C),{},{associations:e._getAssociations(x,E)})})}))}),e.net.on("dblclick",function(m){if(e.net._attrs.mode==="edit"){var i=e.props.openTab;if(m.itemType==="node"){var y=m.item._attrs.model.title.split(":")[0],x=m.item._attrs.model.moduleName,D=e.props.value.split("map&")[1].split("/")[0];i&&i("entity&".concat(x||D,"&").concat(y))}}});var Q=!1;e.net.on("dragstart",function(m){Q=!0}),e.net.on("dragmove",function(m){e.pointerDom.style.display!=="none"&&(e.pointerDom.style.top="".concat(m.domY-3,"px"),e.pointerDom.style.left="".concat(m.domX-3,"px"))}),e.net.on("dragend",function(m){Q=!1,e.pointerDom.style.display="none",setTimeout(function(){var i=e.props,y=i.value,x=i.dataSource,D=e.net.save().source,E=y.split("map&")[1].split("/")[0],C=(x.modules||[]).filter(function(h){return h.name===E})[0];e.net.changeData(s()(s()({},D),{},{nodes:(D.nodes||[]).map(function(h){return s()(s()({},h),{},{associations:e._getAssociations(D,C)})})})),S.autoSave()},1)}),e.net.on("mouseenter",function(m){var i=m.shape;i&&i.hasClass("anchor-point")&&!Q&&e.net.beginAdd("edge",{shape:"erdRelation",relation:"0,n:1"})}),e.net.on("mouseleave",function(m){var i=m.shape;i&&i.hasClass("anchor-point")&&!Q&&e.net.changeMode("edit")}),e.net.on("keydown",function(m){if(m.keyCode>36&&m.keyCode<41){var i=e.state.count,y=(e.net.getNodes()||[]).filter(function(h){return h._attrs.actived});y.forEach(function(h){e.net.hideAnchor(h);var I=h.getModel(),g=I.x,P=I.y;m.keyCode===37?e.net.update(h,s()(s()({},h._attrs.model),{},{x:g-10/i,y:P})):m.keyCode===38?e.net.update(h,s()(s()({},h._attrs.model),{},{x:g,y:P-10/i})):m.keyCode===39?e.net.update(h,s()(s()({},h._attrs.model),{},{x:g+10/i,y:P})):m.keyCode===40&&e.net.update(h,s()(s()({},h._attrs.model),{},{x:g,y:P+10/i})),e.net.showAnchor(h)});var x=(e.net.getEdges()||[]).filter(function(h){return h._attrs.actived})[0]||e.clickEdge;if(x){var D=-1,E=x._attrs.model.controlPoints.map(function(h,I){return{index:I,distance:(h.x-e.clickEdgeX)*(h.x-e.clickEdgeX)+(h.y-e.clickEdgeY)*(h.y-e.clickEdgeY)}});if(D=x._attrs.model.controlPoints.findIndex(function(h,I){return E[I].distance<15}),D>0&&(x._attrs.model.controlPoints||[]).length-1!==D){m.keyCode===37?e.net.update(x,s()(s()({},x._attrs.model),{},{controlPoints:(x._attrs.model.controlPoints||[]).map(function(h,I){return I===D?(e.clickEdgeX=h.x-10/i,e.clickEdgeY=h.y,{x:h.x-10/i,y:h.y}):h})})):m.keyCode===38?e.net.update(x,s()(s()({},x._attrs.model),{},{controlPoints:(x._attrs.model.controlPoints||[]).map(function(h,I){return I===D?(e.clickEdgeX=h.x,e.clickEdgeY=h.y-10/i,{x:h.x,y:h.y-10/i}):h})})):m.keyCode===39?e.net.update(x,s()(s()({},x._attrs.model),{},{controlPoints:(x._attrs.model.controlPoints||[]).map(function(h,I){return I===D?(e.clickEdgeX=h.x+10/i,e.clickEdgeY=h.y,{x:h.x+10/i,y:h.y}):h})})):m.keyCode===40&&e.net.update(x,s()(s()({},x._attrs.model),{},{controlPoints:(x._attrs.model.controlPoints||[]).map(function(h,I){return I===D?(e.clickEdgeX=h.x,e.clickEdgeY=h.y+10/i,{x:h.x,y:h.y+10/i}):h})}));var C=e.net.converPoint({x:e.clickEdgeX,y:e.clickEdgeY});e.pointerDom.style.display="block",e.pointerDom.style.top="".concat(C.y-3,"px"),e.pointerDom.style.left="".concat(C.x-3,"px")}}}m.shiftKey&&e.net._attrs.mode==="edit"&&(e.net.events.mouseup.forEach(function(h){return h()}),e.net.changeMode("drag"))}),e.net.on("keyup",function(m){m.keyCode===16&&e.net._attrs.mode==="drag"&&e.net.changeMode("edit")}),e.net.on("itemadd",function(m){var i=m.item;if(i.get("type")==="node"){var y=e.net.getNodes(),x=i._attrs.model.title,D=y.map(function(P){return P._attrs.model.title}),E=e._getAllTable(e.props.dataSource).map(function(P){return P.title}),C=e._checkTableName(x,D);if(x!==C)if(i._attrs.model.copy)setTimeout(function(){e.net.remove(i),e.net.refresh()},1),Modal.error({title:"\u590D\u5236\u5931\u8D25",message:"\u65E0\u6CD5\u4ECE\u4E00\u4E2A\u514B\u9686\u8868\u4E2D\u590D\u5236\u4E00\u4E2A\u65B0\u7684\u6570\u636E\u8868\uFF0C\u8BF7\u5148\u4FDD\u5B58\u8BE5\u514B\u9686\u8868\uFF01",width:450});else{var h=e._getAllTable(e.props.dataSource).filter(function(P){return x===P.title})[0],I=e._checkTableName(C.split(":")[0],E.concat(D)),g=e.net.invertPoint({x:e.domX,y:e.domY});e.net.update(i,s()(s()({},i._attrs.model),{},{title:I,realName:e._getTableNameByNameTemplate(s()(s()({},h||{}),{},{title:I}),I),copy:x.split(":")[0],x:g.x,y:g.y})),e.table.push(s()(s()({},i._attrs.model),{},{title:I})),e.net.refresh()}}}),e.net.on("itemremove",function(m){var i=m.item;i.get("type")==="node"?setTimeout(function(){var y=e.net.save().source;e.net.changeData(s()(s()({},y),{},{nodes:y.nodes||[]})),S.autoSave()},1):i.get("type")==="edge"&&setTimeout(function(){var y=e.props,x=y.value,D=y.dataSource,E=e.net.save().source,C=x.split("map&")[1].split("/")[0],h=(D.modules||[]).filter(function(I){return I.name===C})[0];e.net.changeData(s()(s()({},E),{},{nodes:(E.nodes||[]).map(function(I){return s()(s()({},I),{},{associations:e._getAssociations(E,h)})})})),S.autoSave()},1)}),e.net.on("contextmenu",function(m){if(m.domEvent.preventDefault(),e.net._attrs.mode==="edit"){var i=-1,y=m.item,x=[];if(y&&y.get("type")==="node"&&y._attrs.actived)x=[{name:(0,t.jsxs)(Je.Z,{children:[(0,t.jsx)(un.Z,{theme:"filled",size:"12",fill:"#DE2910",strokeWidth:2,strokeLinejoin:"miter"}),(0,t.jsx)("span",{children:"\u5220\u9664\u6570\u636E\u8868"})]}),key:"deleteTable"}];else if(y&&y.get("type")==="edge"&&y._attrs.actived){x=[{name:(0,t.jsxs)(Je.Z,{children:[(0,t.jsx)(sn.Z,{theme:"filled",size:"12",fill:"#DE2910",strokeWidth:2,strokeLinejoin:"miter"}),(0,t.jsx)("span",{children:"\u5BF9\u5E94\u5173\u7CFB"})]}),key:"relation"},{name:(0,t.jsxs)(Je.Z,{children:[(0,t.jsx)(dn.Z,{theme:"filled",size:"12",fill:"#DE2910",strokeWidth:2,strokeLinejoin:"miter"}),(0,t.jsx)("span",{children:"\u5220\u9664\u8FDE\u63A5\u7EBF"})]}),key:"deleteEdge"}];var D=y._attrs.model,E=D.controlPoints.map(function(C,h){var I=e.net.invertPoint({x:m.domX,y:m.domY});return{index:h,distance:(C.x-I.x)*(C.x-I.x)+(C.y-I.y)*(C.y-I.y)}});i=D.controlPoints.findIndex(function(C,h){return E[h].distance<10}),i>-1?x.push({name:(0,t.jsxs)(Je.Z,{children:[(0,t.jsx)(cn.Z,{theme:"filled",size:"12",fill:"#DE2910",strokeWidth:2,strokeLinejoin:"miter"}),(0,t.jsx)("span",{children:"\u5220\u9664\u951A\u70B9"})]}),key:"deleteAnchor"}):x.push({name:(0,t.jsxs)(Je.Z,{children:[(0,t.jsx)(vn.Z,{theme:"filled",size:"12",fill:"#DE2910",strokeWidth:2,strokeLinejoin:"miter"}),(0,t.jsx)("span",{children:"\u6DFB\u52A0\u951A\u70B9"})]}),key:"addAnchor"})}e.setState({item:y,top:m.domY,left:m.domX,contextDisplay:x.length>0?"":"none",contextMenus:x,clickPoint:i})}}),e.net.source(l.nodes,l.edges),e.net.node().color("title",function(m){return m&&m.includes(":")?"#5D616A":"#431E90"}),e.net.render()}),z()(K()(e),"_tableHasExistAndUpdateName",function(n,a){if((n.nodes||[]).some(function(r){return r.title===a})){var l=a.split(":");return l[1]?e._tableHasExistAndUpdateName(n,"".concat(l[0],":").concat(parseInt(l[1],10)+1)):e._tableHasExistAndUpdateName(n,"".concat(a,":1"))}return a}),z()(K()(e),"_onDrop",function(n){n.preventDefault();var a=e.props,l=a.value,r=a.width,p=l.split("map&")[1].split("/")[0],d=n.dataTransfer.getData("Text");if(d.startsWith("map&"))we.ZP.error("\u79FB\u52A8\u65E0\u6548,\u8BE5\u5185\u5BB9\u4E0D\u662F\u6570\u636E\u8868\uFF0C\u65E0\u6CD5\u653E\u7F6E\u5728\u5173\u7CFB\u56FE\u4E2D\uFF01");else if(d.split("&")[1]!==p)we.ZP.error("\u79FB\u52A8\u65E0\u6548,\u76EE\u524D\u6682\u4E0D\u652F\u6301\u8DE8\u6A21\u5757\u4E4B\u95F4\u7684\u6570\u636E\u8868\u5173\u7CFB\u914D\u7F6E\uFF01");else if(d.startsWith("entity&")){var u=n.target.getBoundingClientRect();e.graphCanvas=e.net.save().source;var f=n.clientX-u.left,S=n.clientY-u.top,Z=e.net.invertPoint({x:f,y:S}),L=d.split("&")[2];(e.graphCanvas.nodes||[]).some(function(T){return T.title===L})?we.ZP.error("\u79FB\u52A8\u65E0\u6548,\u5173\u7CFB\u56FE\u4E2D\u5DF2\u7ECF\u5B58\u5728\u8868".concat(L)):e._addDataTable(L,Z.x,Z.y,"drag",d.split("&")[1]!==p&&d.split("&")[1])}}),z()(K()(e),"_onDragOver",function(n){n.preventDefault()}),z()(K()(e),"_saveTable",function(n,a){var l=e.props,r=l.saveProject,p=l.dataSource,d=l.value,u=d.split("map&")[1].split("/")[0];r(s()(s()({},p),{},{modules:(p.modules||[]).map(function(f){return f.name===u?s()(s()({},f),{},{entities:a==="new"?(f.entities||[]).concat(n):(f.entities||[]).map(function(S){return S.title===n.title?n:S})}):f})}))}),z()(K()(e),"_getAllTableData",function(n){var a=e.table.map(function(l){return l.title});return(n.modules||[]).reduce(function(l,r){return l.concat(r.entities||[])},[]).concat(a)}),z()(K()(e),"_addDataTable",function(n,a,l,r,p){var d=e.props,u=d.dataSource,f=d.value,S=null,Z=s()({},e.net.save().source),L=Pe().get(Z,"nodes",[]),T=Pe().get(Z,"edges",[]),Q=f.split("map&")[1].split("/")[0],m=Pe().get(u,"modules",[]).filter(function(D){return D.name===Q})[0],i=Pe().get(m,"associations",[]);if(r==="new")e.table.push({title:n,fields:[],headers:[],associations:i,realName:n});else{var y=e._getAllTableData(u);S=y.filter(function(D){return D.title===n.split(":")[0]})[0]}var x=e._getTableNameByNameTemplate(S,n.split(":")[0]);L.push({shape:"table",title:n,realName:n.includes(":")?"".concat(x,":").concat(n.split(":")[1]):x,headers:e._initColumnOrder(S),fields:(S&&S.fields||[]).filter(function(D){return!D.relationNoShow}),associations:i,moduleName:p,x:a,y:l}),e.net.changeData(L,T),e._checkEmpty({nodes:L,edges:T}),e.autoSave()}),z()(K()(e),"autoSave",function(){e.saveData()}),z()(K()(e),"_checkUntitledName",function(n){return n.split("untitled")[1]?"untitled".concat(parseInt(n.split("untitled")[1]||0,10)+1):"".concat(n,"1")}),z()(K()(e),"_getAllTable",function(n,a,l){var r=(a||e.table).map(function(d){return d.title}),p=n.modules||[];return l&&(p=p.filter(function(d){return d.name===l})),p.reduce(function(d,u){return d.concat((u.entities||[]).map(function(f){return f.title}))},[]).concat(r)}),z()(K()(e),"_getTableName",function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0;return n.some(function(l){return l===a})?e._getTableName(n,e._checkUntitledName(a)):a}),z()(K()(e),"_contextClick",function(n,a){var l=e.props,r=l.dataSource,p=l.width,d=e.state,u=d.item,f=d.left,S=d.top,Z=d.clickPoint;if(a==="deleteTable"||a==="deleteEdge")e.table=e.table.filter(function(y){return y.title!==u._attrs.model.title}),e.graphCanvas=s()(s()({},e.graphCanvas),{},{nodes:e.graphCanvas.nodes.filter(function(y){return y.title!==u._attrs.model.title})}),e.del(u);else if(a==="addTable"){var L=e.net.invertPoint({x:f,y:S});e._addDataTable(e._getTableName(e._getAllTable(r),"untitled"),L.x,L.y,"new")}else if(a==="addAnchor"){var T=re()(u._attrs.model.controlPoints||[]);T.splice(1,0,{x:f,y:S}),e.net.update(u,s()(s()({},u._attrs.model),{},{controlPoints:T})),e.net.refresh()}else if(a==="deleteAnchor")e.net.update(u,s()(s()({},u._attrs.model),{},{controlPoints:u._attrs.model.controlPoints.filter(function(y,x){return x!==Z})})),e.net.refresh();else if(a==="relation"){var Q=u._attrs.model.relation||"",m=Q.split(":")[0]||"",i=Q.split(":")[1]||"";ln((0,t.jsx)(en,{from:m,to:i}),{title:"\u7F16\u8F91\u5BF9\u5E94\u5173\u7CFB",modality:!0,autoFocus:!0,onOk:function(x,D){D.save(function(E,C){E?Modal.error({title:"\u7F16\u8F91\u5931\u8D25",message:"\u7F16\u8F91\u5931\u8D25",width:100}):(x.close(),e.net.update(u,s()(s()({},u._attrs.model),{},{relation:C})),e.net.refresh(),e.autoSave())})}})}}),z()(K()(e),"_closeContextMenu",function(){e.setState({contextDisplay:"none"})}),z()(K()(e),"_zoomTree",function(n){var a=e.props,l=a.width,r=a.height,p=e.net.invertPoint({x:l/2,y:r/2}),d=p,u=p,f=new G6.Matrix.Matrix3,S=d.x+(u.x-d.x)*1,Z=d.y+(u.y-d.y)*1;f.translate(-S,-Z),f.scale(n,n),f.translate(l/2,r/2),e.net.updateMatrix(f),e.net.refresh(),e.setState({count:e.net.getScale()})}),z()(K()(e),"_keyDown",function(n,a){if(n.key==="m"){var l=e.props.value,r=document.getElementById("paint-".concat(l)),p=r&&r.querySelector(".g6-plugins-navigation");getComputedStyle(p).display==="none"&&!a?(p.style.display="block",p.style.marginRight="20%"):p.style.display="none"}}),e.state={empty:!1,contextDisplay:"none",contextMenus:[],count:1,save:c.save},e.table=[],e.graphCanvas=e._getData(c.dataSource),e}return Ct()(j,[{key:"componentDidMount",value:function(){var e=this.props,n=e.height,a=e.dataSource,l=e.width,r=this.graphCanvas;this._checkEmpty(r),this._renderRelation(n,l,r,a),this.pointerDom=bt.findDOMNode(this.pointer)}},{key:"componentDidUpdate",value:function(e){if(e.height!==this.props.height||e.width!==this.props.width||e.dataSource!==this.props.dataSource)if(this.net.changeSize(e.width,e.height),e.dataSource!==this.props.dataSource){if(e.changeDataType==="reset"){var n=this._getData(e.dataSource);this.graphCanvas={edges:n.edges,nodes:this._updateTableName(n.nodes,e.dataHistory)},this.table=[]}else{var a=this.net.save().source,l=this._updateNodes(e.dataSource,this._updateTableName(this.newNodes||a.nodes,e.dataHistory));this.graphCanvas=this._clearInvalidData({edges:this._updateEdges(a.nodes,l,a.edges),nodes:l},e.dataSource),this.table=this._updateTableName(this.table,e.dataHistory),this.newNodes=null}this.net.changeData(s()({},this.graphCanvas))}else this.net.changeSize(e.width,e.height)}},{key:"componentWillUnmount",value:function(){this.net.destroy()}},{key:"render",value:function(){var e=this,n=this.state,a=n.empty,l=a===void 0?!1:a,r=n.count,p=r===void 0?1:r,d=this.props,u=d.prefix,f=u===void 0?"erd":u,S=d.value,Z=d.width;return(0,t.jsxs)("div",{onKeyDown:this._keyDown,className:"".concat(f,"-relation"),onDrop:this._onDrop,onDragOver:this._onDragOver,children:[(0,t.jsx)("div",{className:"".concat(f,"-relation-pointer"),ref:function(T){return e.pointer=T}}),(0,t.jsx)(an,{menus:this.state.contextMenus,left:this.state.left,top:this.state.top,display:this.state.contextDisplay,closeContextMenu:this._closeContextMenu,onClick:this._contextClick}),(0,t.jsx)("div",{className:"".concat(f,"-relation-empty"),children:l?"\u7A7A\u5173\u7CFB\u56FE\uFF0C\u8BF7\u62D6\u52A8\u5DE6\u4FA7\u7684\u6570\u636E\u8868\u4E8E\u7A7A\u767D\u5904":""}),(0,t.jsx)("div",{tabIndex:"0",className:"".concat(f,"-relation-paint"),id:"paint-".concat(S)}),(0,t.jsx)("div",{style:{position:"fixed",bottom:"0%",right:"33%",color:"#f50808"},children:"\u6309\u4F4F shift \u62D6\u52A8\u5173\u7CFB\u56FE\uFF0C\u6ED1\u52A8\u9F20\u6807\u653E\u5927\u7F29\u5C0F\u5173\u7CFB\u56FE\uFF0C\u6309 N \u6253\u5F00\u6216\u5173\u95ED\u5168\u5C4F\uFF0C\u6309 M \u6253\u5F00\u6216\u5173\u95ED\u7F29\u7565\u56FE"}),(0,t.jsxs)("div",{style:{position:"fixed",top:"20%",right:"20%",color:"green"},children:["\u653E\u5927\u500D\u6570\uFF1A",p,"X"]})]})}}]),j}(b.Component),mn=function(v){var j=(0,ne.ZP)(function(C){var h;return{projectJSON:(h=C.project)===null||h===void 0?void 0:h.projectJSON,projectDispatch:C.dispatch}},ce.Z),c=j.projectJSON,e=j.projectDispatch,n=[{code:"chnname",value:"\u5B57\u6BB5\u540D",com:"Input",relationNoShow:!1},{code:"name",value:"\u903B\u8F91\u540D(\u82F1\u6587\u540D)",com:"Input",relationNoShow:!1},{code:"type",value:"\u7C7B\u578B",com:"Select",relationNoShow:!1},{code:"dataType",value:"\u6570\u636E\u5E93\u7C7B\u578B",com:"Text",relationNoShow:!0},{code:"remark",value:"\u8BF4\u660E",com:"Input",relationNoShow:!0},{code:"pk",value:"\u4E3B\u952E",com:"Checkbox",relationNoShow:!1},{code:"notNull",value:"\u975E\u7A7A",com:"Checkbox",relationNoShow:!0},{code:"autoIncrement",value:"\u81EA\u589E",com:"Checkbox",relationNoShow:!0},{code:"defaultValue",value:"\u9ED8\u8BA4\u503C",com:"Input",relationNoShow:!0},{code:"relationNoShow",value:"\u5173\u7CFB\u56FE",com:"Icon",relationNoShow:!0},{code:"uiHint",value:"UI\u5EFA\u8BAE",com:"Select",relationNoShow:!0}],a=function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},l=function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},r=a()-340,p=l()-105,d=(0,b.useState)(r),u=$()(d,2),f=u[0],S=u[1],Z=(0,b.useState)(p),L=$()(Z,2),T=L[0],Q=L[1],m=!1,i=function(){try{if(m)document.exitFullscreen();else{var h;D==null||(h=D.current)===null||h===void 0||h.requestFullscreen()}}catch(I){}};(0,b.useEffect)(function(){var C;E==null||(C=E.current)===null||C===void 0||C.autoSave()},[]);var y=function(h){h.code==="KeyN"&&document.activeElement.id&&document.activeElement.id.includes("canvas")&&(i(),h.stopPropagation(),h.preventDefault())},x=function(){var h;document.fullscreenElement?(S(a()),Q(l()-10)):(S(r-0),Q(p-10)),m=!m,E==null||(h=E.current)===null||h===void 0||h.autoSave()};(0,b.useEffect)(function(){return window.addEventListener("keydown",y),document.addEventListener("fullscreenchange",x),function(){window.removeEventListener("keydown",y),window.removeEventListener("fullscreenchange",x)}},[]);var D=(0,b.useRef)(null),E=(0,b.useRef)(null);return(0,t.jsx)("div",{className:"fullscreen fullscreen-enabled",ref:D,children:(0,t.jsx)(fn,{ref:E,dataSource:JSON.parse(JSON.stringify(c)),columnOrder:n,value:"map&".concat(v.moduleEntity.module),height:T,width:f,projectDispatch:e})})},hn=b.memo(mn),Lt=o(6176),tt=o(3534),pn=o(61339),We=o(26774),At=o(66656),yn=o(27925),$t=o(1768),gn=o(97833),Dt=o.n(gn),xn=o(42196),zt=o.n(xn),Sn=o(30863),Cn=o(71841),Bt=o(34062),st=o(52041),jn=o(3571),nt=o.n(jn),En=function(v){var j=(0,b.useState)(!1),c=$()(j,2),e=c[0],n=c[1],a=(0,b.useState)(0),l=$()(a,2),r=l[0],p=l[1],d=(0,b.useState)(0),u=$()(d,2),f=u[0],S=u[1],Z=(0,b.useRef)(null),L=function(){return n(!1)};(0,b.useImperativeHandle)(v.onRef,function(){return{showContext:function(y){S(y.clientX+12),p(y.clientY-100),n(!0)}}}),(0,b.useEffect)(function(){return window.addEventListener("click",L),function(){window.removeEventListener("click",L)}},[]);function T(i,y,x,D,E){return{key:y,icon:x,children:D,label:i,type:E}}var Q=[T("\u8BBE\u4E3ANULL","1",(0,t.jsx)(st.Z,{})),T("\u8BBE\u4E3A\u7A7A\u5B57\u7B26\u4E32","2",(0,t.jsx)(st.Z,{})),T("\u8BBE\u4E3A\u5F53\u524D\u65F6\u95F4(YYYY-MM-DD HH:mm:ss)","3",(0,t.jsx)(st.Z,{})),T("\u8BBE\u4E3A\u5F53\u524D\u65F6\u95F4(YYYY-MM-DD)","4",(0,t.jsx)(st.Z,{})),T("\u8BBE\u4E3A\u5F53\u524D\u65F6\u95F4(HH:mm:ss)","5",(0,t.jsx)(st.Z,{}))],m=function(y){n(!1),y.key==="1"?v.onMenuItemClick("<null>"):y.key==="2"?v.onMenuItemClick(""):y.key==="3"?v.onMenuItemClick(nt()(new Date).format("YYYY-MM-DD HH:mm:ss")):y.key==="4"?v.onMenuItemClick(nt()(new Date).format("YYYY-MM-DD")):y.key==="5"&&v.onMenuItemClick(nt()(new Date).format("HH:mm:ss"))};return e&&(0,t.jsx)("div",{ref:Z,style:{width:"320px",position:"fixed",zIndex:1e4,top:r+"px",left:f+"px"},children:(0,t.jsx)(tt.Z,{mode:"inline",theme:"dark",items:Q,onClick:m})})},bn=b.memo(En),Dn=function(v){var j=v.value,c=v.onChange,e=(0,b.useState)(),n=$()(e,2),a=n[0],l=n[1],r=(0,b.useRef)(null),p=function(S){l(S.target.value),c==null||c(S.target.value)};(0,b.useEffect)(function(){l(j===null?"<null>":j===void 0?"":j)},[]);var d=function(S){var Z;r==null||(Z=r.current)===null||Z===void 0||Z.showContext(S),S.preventDefault()},u=function(S){l(S),c==null||c(S)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(bn,{onRef:r,onMenuItemClick:u}),(0,t.jsx)(Bt.Z,{type:"text",size:"small",value:a,onChange:p,onContextMenu:d})]})},Tn=b.memo(Dn),In=function(v){var j=(0,b.useState)(v.tableResult.columns),c=$()(j,2),e=c[0],n=c[1],a=(0,b.useState)(v.tableResult.dataSource),l=$()(a,2),r=l[0],p=l[1],d=(0,b.useState)({}),u=$()(d,2),f=u[0],S=u[1],Z=(0,b.useState)({}),L=$()(Z,2),T=L[0],Q=L[1],m=(0,b.useRef)(null);(0,b.useEffect)(function(){p(v.tableResult.dataSource),n(v.tableResult.columns),S({}),Q({})},[v.tableResult.queryKey]);var i=function(E){var C=document.createElement("textarea");C.style.position="absolute",C.style.left="-9999px",C.style.top="-9999px",document.body.appendChild(C),C.value=E,C.select(),document.execCommand("copy"),document.body.removeChild(C),we.ZP.success("\u590D\u5236\u5355\u5143\u683C\u5185\u5BB9\u6210\u529F")},y=function(){var E={};if(v.tableResult.tableName){var C,h;E=((C=v.onRef)===null||C===void 0||(h=C.current)===null||h===void 0?void 0:h.getDbTableFieldsMap(v.tableResult.tableName))||{}}var I=v.tableResult.columns.map(function(g,P){var A,X=v.tableResult.tableColumns[g];X?A={name:X.name,value:X.name,remarks:X.remarks,dataType:X.typeName,notNull:X.isNullable==="NO",autoIncrement:X.isAutoincrement==="YES",defaultValue:X.def,pk:X.primaryKey}:A=E[g];var J="",V="";if(g!=="index"){var R,B;(R=A)!==null&&R!==void 0&&R.pk?J="*"+g+"(\u4E3B\u952E)":(B=A)!==null&&B!==void 0&&B.notNull?J="*"+g:J=g}else J=g+"(\u865A\u62DF\u5217)";return A&&(A.pk?V="".concat(A.remarks," --- ")+(A.autoIncrement?"(\u81EA\u589E)":"(\u975E\u81EA\u589E)")+"("+A.dataType+")":V="".concat(A.remarks)+" --- ("+A.dataType+")"+(A.defaultValue?"(\u9ED8\u8BA4\u503C:".concat(A.defaultValue,")"):"")),{title:J,tooltip:V,key:g,dataIndex:g,ellipsis:!0,width:153,render:function(he,ee,be,le){return ee[g]===null?(0,t.jsx)("span",{style:{fontWeight:"100"},children:"<null>"}):typeof ee[g]=="boolean"?(0,t.jsx)("span",{children:ee[g]+""}):(0,t.jsx)("span",{onDoubleClick:function(){i(ee[g])},children:ee[g]})},renderFormItem:function(){return(0,t.jsx)(Tn,{})}}});return v.tableResult.primaryKeys.length>0&&I.push({title:"\u64CD\u4F5C",valueType:"option",key:"option",width:180,fixed:"right",render:function(P,A,X,J){return[(0,t.jsx)("a",{style:T[X],onClick:function(R){var B;A.rowOperationType||(A.rowOperationType="preEdit"),J==null||(B=J.startEditable)===null||B===void 0||B.call(J,A.index)},children:"\u7F16\u8F91"},"editable"),(0,t.jsx)("a",{style:f[X],onClick:function(R){we.ZP.info("\u884C\u5DF2\u6253\u4E0A\u5220\u9664\u6807\u8BC6"),S(function(B){var q=Object.assign({},B);return q[X]={color:"red"},q}),A.rowOperationType="delete"},children:"\u5220\u9664"},"delete"),(0,t.jsx)("a",{onClick:function(R){var B,q=JSON.parse(JSON.stringify(A));Object.entries(A).forEach(function(he){var ee=$()(he,2),be=ee[0],le=ee[1];le===null&&(q[be]="<null>")}),q.rowOperationType="preAdd",q.index=r.length,m==null||(B=m.current)===null||B===void 0||B.addEditRecord(q)},children:"\u590D\u5236\u8BE5\u884C"},"add")]}}),I},x=function(E,C){v.executeSqlWhenPaginationChange(E,C)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Sn.Z,{actionRef:m,size:"small",scroll:{x:1300,y:"calc(100vh - 500px)"},rowKey:"index",headerTitle:"\u53EF\u7F16\u8F91\u8868\u683C(\u53CC\u51FB\u5355\u5143\u683C\u590D\u5236\u5176\u5185\u5BB9)",columns:y(),value:r,bordered:!0,onChange:p,editable:{type:"multiple",editableKeys:e,saveText:"\u786E\u5B9A",onSave:function(){var D=zt()(Dt()().mark(function C(h,I,g){var P;return Dt()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:I.rowOperationType==="preAdd"||I.rowOperationType==="add"?(we.ZP.info("\u884C\u5DF2\u6253\u4E0A\u65B0\u589E\u6807\u8BC6"),I.rowOperationType="add",P={color:"gold"}):(we.ZP.info("\u884C\u5DF2\u6253\u4E0A\u7F16\u8F91\u6807\u8BC6"),I.rowOperationType="edit",P={color:"green"}),Q(function(J){var V=Object.assign({},J);return V[I.index]=P,V});case 2:case"end":return X.stop()}},C)}));function E(C,h,I){return D.apply(this,arguments)}return E}(),onChange:n,actionRender:function(E,C,h){return[h.save,h.cancel]}},recordCreatorProps:{position:"bottom",record:function(){return{index:r.length,rowOperationType:"preAdd"}},onClick:function(){}},form:{syncToUrl:function(E,C){return C==="get"?s()(s()({},E),{},{created_at:[E.startTime,E.endTime]}):E}},search:!1,options:!1,dateFormatter:"string",toolBarRender:function(){return[(0,t.jsx)(We.ZP,{size:"small",onClick:function(){if(r.length===0){we.ZP.warning("\u6CA1\u6709\u6570\u636E!");return}v.exportSql("json")},children:"\u5BFC\u51FA\u4E3Ajson"},"button"),(0,t.jsx)(We.ZP,{size:"small",onClick:function(){if(r.length===0){we.ZP.warning("\u6CA1\u6709\u6570\u636E!");return}v.exportSql("csv")},children:"\u5BFC\u51FA\u4E3Acsv"},"button"),(0,t.jsx)(We.ZP,{size:"small",onClick:function(){if(r.length===0){we.ZP.warning("\u6CA1\u6709\u6570\u636E!");return}v.exportSql("xls")},children:"\u5BFC\u51FA\u4E3AExcel"},"button"),(0,t.jsx)(We.ZP,{size:"small",onClick:function(){if(r.length===0){we.ZP.warning("\u6CA1\u6709\u6570\u636E!");return}v.exportSql("sqlInsert")},children:"\u5BFC\u51FA\u4E3Asql(insert)"},"button"),(0,t.jsx)(We.ZP,{size:"small",onClick:function(){if(r.length===0){we.ZP.warning("\u6CA1\u6709\u6570\u636E!");return}v.exportSql("sqlUpdate")},children:"\u5BFC\u51FA\u4E3Asql(update)"},"button"),(0,t.jsx)(We.ZP,{type:"primary",size:"small",onClick:function(){if(r.length===0){we.ZP.warning("\u6CA1\u6709\u6570\u636E!");return}var C=r.filter(function(h){return h.rowOperationType&&!h.rowOperationType.includes("pre")});if(C.length===0){we.ZP.warning("\u8868\u683C\u6570\u636E\u6CA1\u6709\u53D1\u751F\u53D8\u52A8!");return}v.submitQueryTableChange(C)},children:"\u63D0\u4EA4\u8868\u683C\u53D8\u52A8\u56DEdb"},"button")]}}),v.tableResult.showPagination&&(0,t.jsx)(Cn.Z,{size:"small",style:{textAlign:"right"},onChange:x,current:v.tableResult.page,pageSize:v.tableResult.pageSize,showTotal:function(E){return"\u603B\u5171 ".concat(E," \u6761")},total:v.tableResult.total,pageSizeOptions:[5,20,50],showSizeChanger:!0})]})},Pn=b.memo(In),_t=o(40517),Wt=o(28657),Fn=o(78191),On=o(59864),Zn=o(74562),wn=o(57956),Kt=o(19688),Tt=o(71793),It=o(51927),Nn=o(78496),Pt=o(88263),Vt=o(25467),An=function(v){var j=function(){return v.tableResult.columns.map(function(e){return{title:e,key:e,dataIndex:e,ellipsis:!0,width:150,render:function(a,l){return l[e]===null?(0,t.jsx)("span",{style:{fontWeight:"100"},children:"<null>"}):l[e]}}})};return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(Vt.Z,{size:"small",scroll:{x:1300,y:"calc(100vh - 500px)"},dataSource:v.tableResult.dataSource,rowKey:"id",pagination:{showQuickJumper:!0,total:v.tableResult.total},columns:j(),search:!1,options:!1,dateFormatter:"string"})})},Bn=b.memo(An),Mn=o(81663),kn=function(v){(0,b.useEffect)(function(){},[v.key]);var j=[{title:"SQL",dataIndex:"sqlInfo",copyable:!0,ellipsis:!0},{title:"\u6240\u6709\u53C2\u6570",dataIndex:"params"},{title:"\u6267\u884C\u6570\u636E\u5E93",dataIndex:"dbName"},{title:"\u8017\u65F6",dataIndex:"duration"},{title:"\u6267\u884C\u65F6\u95F4",dataIndex:"createTime"},{title:"\u6267\u884C\u4EBA",dataIndex:"creator"}],c=(0,Kt.useSearchParams)(),e=$()(c,1),n=e[0],a=n.get("erd:projectId")||"";return(!a||a==="")&&(a=Tt.rV(It.s.PROJECT_ID)||""),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(Vt.Z,{size:"small",scroll:{x:1300,y:"calc(100vh - 436px)"},rowKey:"id",request:function(){var l=zt()(Dt()().mark(function r(p){var d,u,f;return Dt()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,(0,Mn.HT)("/ncnb/queryHistory",s()(s()({},p),{},{size:p.pageSize,queryId:v.queryId}));case 2:return f=Z.sent,Z.abrupt("return",{data:f==null||(d=f.data)===null||d===void 0?void 0:d.records,total:f==null||(u=f.data)===null||u===void 0?void 0:u.total,success:f.code===200});case 4:case"end":return Z.stop()}},r)}));return function(r){return l.apply(this,arguments)}}(),pagination:{pageSize:100},columns:j,search:!1,options:!1,dateFormatter:"string"})})},Rn=b.memo(kn),Ln=o(36242),$n=o.n(Ln),Re=o(25409),zn=o(81152),_n=o(58018),Wn=o(49066),Kn=o(92945),Vn=o(51270),Un=["key","name"],Ft=ke.Z.Option,Hn=ke.Z.OptGroup,Jn=Bt.Z.TextArea,Yn={labelCol:{span:8},wrapperCol:{span:16}},Qn=function(v){var j=(0,b.useState)(!1),c=$()(j,2),e=c[0],n=c[1],a=(0,b.useState)([]),l=$()(a,2),r=l[0],p=l[1],d=(0,b.useState)(""),u=$()(d,2),f=u[0],S=u[1],Z=(0,b.useState)([]),L=$()(Z,2),T=L[0],Q=L[1],m=Re.Z.useForm(),i=$()(m,1),y=i[0];(0,b.useEffect)(function(){n(!0),Pt.ZP.post("/ncnb/getTables",{data:{projectId:Tt.rV(It.s.PROJECT_ID),selectDB:v.selectDB}}).then(function(V){n(!1),y.setFieldValue("conditionsChoose",[]),y.setFieldValue("tableColumnNamesChoose",[]),y.setFieldValue("tableNameChoose",""),Q([]),S(""),V.data&&p(V.data)})},[v.selectDB]);var x=function(R){n(!0),Pt.ZP.post("/ncnb/getTableColumns",{data:{projectId:Tt.rV(It.s.PROJECT_ID),selectDB:v.selectDB,tableName:R}}).then(function(B){y.setFieldValue("conditionsChoose",[]),n(!1),B.data&&(Q(B.data),y.setFieldValue("tableColumnNamesChoose",B.data.map(function(q){return q.name})),E())})},D=function(R,B,q){if(!q||!B)return"";var he;B.length===0||B.length===T.length?he="*":he=B.join(",");var ee="select ".concat(he," from ").concat(q);if(!R||R.length===0)return ee;var be=R.filter(function(w){return w}).map(function(w,ye){var te="";if(!w.querySymbol)return te;if(w.querySymbol==="="||w.querySymbol==="!="||w.querySymbol===">"||w.querySymbol===">="||w.querySymbol==="<"||w.querySymbol==="<=")te="".concat(w.columnName," ").concat(w.querySymbol," ").concat(w.columnValue);else if(w.querySymbol.includes("like"))te="".concat(w.columnName," ").concat(w.querySymbol).replace("${value}",w.columnValue);else if(w.querySymbol.startsWith("is"))te="".concat(w.columnName," ").concat(w.querySymbol);else if(w.querySymbol.includes("in"))te="".concat(w.columnName," ").concat(w.querySymbol).replace("${values}",w.columnValue);else if(w.querySymbol.includes("between")){var ze=w.columnValue.split(",");te="".concat(w.columnName," ").concat(w.querySymbol).replace("${start}",ze[0]||"").replace("${end}",ze[1]||"")}else throw new Error("wrong "+w.querySymbol);return ye!==R.length-1&&(te+=" ".concat(w.conditionJoin)),te}).join(" "),le="",G=R.filter(function(w){return w&&w.columnSort}).map(function(w,ye){return"".concat(w.columnName," ").concat(w.columnSort)});return G.length>0&&(le="order by "+G.join(",")),ee+=" where ".concat(be," ").concat(le),ee},E=function(){var R=y.getFieldValue("conditionsChoose"),B=y.getFieldValue("tableNameChoose"),q=D(R,[],B);S(q)},C=function(){var R=y.getFieldValue("conditionsChoose"),B=y.getFieldValue("tableColumnNamesChoose"),q=y.getFieldValue("tableNameChoose"),he=D(R,B,q);S(he)},h=function(R){var B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"=";return B.includes("like")?"":R.includes("char")?"''":R.includes("int")?"0":R.includes("datetime")||R.includes("timestamp")?"'"+nt()(new Date).format("YYYY-MM-DD HH:mm:ss")+"'":R.includes("date")?"'"+nt()(new Date).format("YYYY-MM-DD")+"'":R.includes("time")?"'"+nt()(new Date).format("HH:mm:ss")+"'":""},I=function(R){var B=T.filter(function(he){return he.name===R})[0],q=y.getFieldValue("conditionsChoose");q.filter(function(he){return he.columnName===R}).forEach(function(he){var ee=h(B.typeName,he.querySymbol);he.columnValue=ee})},g=function(R,B){var q=y.getFieldValue("conditionsChoose"),he=q[B];R.includes("in")?he.columnValue="a,b,c":R.includes("between")&&(he.columnValue="a,b")},P=function(R){v.closeDrawer(f)},A=[{id:"equals",label:"\u7B49\u4E8E",value:"="},{id:"notEquals",label:"\u4E0D\u7B49\u4E8E",value:"!="},{id:"moreThen",label:"\u5927\u4E8E",value:">"},{id:"moreThenOrEquals",label:"\u5927\u4E8E\u6216\u7B49\u4E8E",value:">="},{id:"lessThen",label:"\u5C0F\u4E8E",value:"<"},{id:"lessThenOrEquals",label:"\u5C0F\u4E8E\u6216\u7B49\u4E8E",value:"<="},{id:"contains",label:"\u5305\u542B",value:"like '%${value}%'"},{id:"notContains",label:"\u4E0D\u5305\u542B",value:"not like '%${value}%'"},{id:"startsWith",label:"\u4EE5...\u5F00\u59CB",value:"like '${value}%'"},{id:"endsWith",label:"\u4EE5...\u7ED3\u675F",value:"like '%${value}'"},{id:"isNull",label:"\u4E3Anull",value:"is null"},{id:"isNotNull",label:"\u4E0D\u4E3Anull",value:"is not null"},{id:"inList",label:"\u5728\u5217\u8868\u4E2D",value:"in (${values})"},{id:"notInList",label:"\u4E0D\u5728\u5217\u8868\u4E2D",value:"not in (${values})"},{id:"between",label:"\u5728\u4E24\u8005\u4E4B\u95F4",value:"between ${start} and ${end}"},{id:"notBetween",label:"\u4E0D\u5728\u4E24\u8005\u4E4B\u95F4",value:"not between ${start} and ${end}"}],X=[{id:"or",label:"\u6216\u8005",value:"or"},{id:"and",label:"\u5E76\u4E14",value:"and"},{id:"orNot",label:"or not",value:"or not"},{id:"andNot",label:"and not",value:"and not"}],J=[{id:"asc",label:"\u5347\u5E8F",value:"asc"},{id:"desc",label:"\u964D\u5E8F",value:"desc"}];return(0,t.jsxs)(At.Z,{spinning:e,children:[(0,t.jsxs)(Re.Z,s()(s()({},Yn),{},{form:y,style:{maxWidth:800},name:"control-hooks",labelCol:{span:4},onFinish:P,onFieldsChange:function(){C()},children:[(0,t.jsx)(Re.Z.Item,{name:"tableNameChoose",label:"\u9009\u62E9\u8981\u67E5\u8BE2\u7684\u8868",rules:[{required:!0}],children:(0,t.jsx)(ke.Z,{style:{width:630},showSearch:!0,size:"middle",placeholder:"\u8BF7\u9009\u62E9",onChange:x,children:(0,t.jsx)(Hn,{children:r.map(function(V){return(0,t.jsx)(Ft,{value:V.name,children:V.name+"("+V.remarks+")"},V.name)})})})}),(0,t.jsx)(Re.Z.Item,{name:"tableColumnNamesChoose",label:"\u9009\u62E9\u8981\u67E5\u8BE2\u7684\u5217",rules:[{required:!0}],children:(0,t.jsx)(ke.Z,{showSearch:!0,style:{width:630},size:"middle",mode:"multiple",placeholder:"\u8BF7\u9009\u62E9",allowClear:!0,options:T.map(function(V){return{label:V.name,value:V.name}})})}),(0,t.jsx)(Re.Z.List,{name:"conditionsChoose",children:function(R,B){var q=B.add,he=B.remove,ee=B.move;return(0,t.jsxs)(t.Fragment,{children:[R.map(function(be){var le=be.key,G=be.name,w=$n()(be,Un);return(0,t.jsxs)(Je.Z,{align:"baseline",style:{height:30},children:[(0,t.jsx)(Re.Z.Item,s()(s()({noStyle:!0},w),{},{name:[G,"columnName"],rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5217"}],children:(0,t.jsx)(ke.Z,{showSearch:!0,size:"small",style:{width:200},placeholder:"\u8BF7\u9009\u62E9\u5217",onChange:I,options:T.map(function(ye){return{label:"".concat(ye.name,"  ").concat(ye.remarks," ").concat(ye.typeName),value:ye.name}})})})),(0,t.jsx)(Re.Z.Item,{noStyle:!0,shouldUpdate:function(te,ze){return te.conditions!==ze.conditions},children:function(){return(0,t.jsx)(Re.Z.Item,s()(s()({},w),{},{name:[G,"querySymbol"],rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u7B26\u53F7"}],children:(0,t.jsx)(ke.Z,{onChange:function(ze){g(ze,G)},style:{width:120},placeholder:"\u8BF7\u9009\u62E9\u7B26\u53F7",size:"small",children:A.map(function(te){return(0,t.jsx)(Ft,{value:te.value,children:te.label},te.id)})})}))}}),(0,t.jsx)(Re.Z.Item,s()(s()({noStyle:!0,hidden:!1},w),{},{style:{width:190},name:[G,"columnValue"],rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u503C"}],children:(0,t.jsx)(Bt.Z,{size:"small",style:{width:190}})})),(0,t.jsx)(Re.Z.Item,{noStyle:!0,shouldUpdate:function(te,ze){return te.conditions!==ze.conditions},children:function(){return(0,t.jsx)(Re.Z.Item,s()(s()({noStyle:!0},w),{},{name:[G,"conditionJoin"],rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],children:(0,t.jsx)(ke.Z,{style:{width:80},placeholder:"\u8BF7\u9009\u62E9",size:"small",children:X.map(function(te){return(0,t.jsx)(Ft,{value:te.value,children:te.label},te.id)})})}))}}),(0,t.jsx)(Re.Z.Item,{noStyle:!0,shouldUpdate:function(te,ze){return te.conditions!==ze.conditions},children:function(){return(0,t.jsx)(Re.Z.Item,s()(s()({noStyle:!0},w),{},{name:[G,"columnSort"],children:(0,t.jsx)(ke.Z,{allowClear:!0,style:{width:70},placeholder:"\u6392\u5E8F",size:"small",children:J.map(function(te){return(0,t.jsx)(Ft,{value:te.value,children:te.label},te.id)})})}))}}),(0,t.jsx)(_n.Z,{onClick:function(){he(G),C()}}),(0,t.jsx)(Wn.Z,{onClick:function(){return ee(G,G-1)}}),(0,t.jsx)(Kn.Z,{onClick:function(){return ee(G,G+1)}})]},le)}),(0,t.jsx)(Re.Z.Item,{children:(0,t.jsx)(We.ZP,{size:"small",type:"dashed",onClick:function(){q();var le=y.getFieldValue("conditionsChoose");if(T.length==0){le.forEach(function(w,ye,te){w===void 0&&(te[ye]={querySymbol:A[0].value,conditionJoin:X[0].value})});return}var G=le.length-1;G>=T.length&&(G=0),le.forEach(function(w,ye,te){w===void 0&&(te[ye]={columnName:T[G].name,querySymbol:A[0].value,columnValue:h(T[G].typeName),conditionJoin:X[0].value})}),C()},block:!0,icon:(0,t.jsx)(Vn.Z,{}),children:"\u6DFB\u52A0\u67E5\u8BE2\u6761\u4EF6"})})]})}}),(0,t.jsx)(Re.Z.Item,{children:(0,t.jsx)(We.ZP,{icon:(0,t.jsx)(Wt.Z,{}),type:"primary",size:"small",htmlType:"submit",children:"\u6267\u884C\u67E5\u8BE2"})})]})),(0,t.jsx)(zn.Z,{icon:(0,t.jsx)(_t.Z,{}),style:{fontSize:14},children:"\u5B9E\u65F6\u9884\u89C8SQL"}),(0,t.jsx)(Jn,{rows:6,value:f})]})},Gn=b.memo(Qn),Ot=ke.Z.Option,Xn=ke.Z.OptGroup,qn=function(v){var j=(0,ne.ZP)(function(ue){return{tables:ue.tables}},ce.Z),c=j.tables,e=(0,b.useState)(!1),n=$()(e,2),a=n[0],l=n[1],r=(0,b.useState)(!1),p=$()(r,2),d=p[0],u=p[1],f=(0,b.useState)(!1),S=$()(f,2),Z=S[0],L=S[1],T=(0,Kt.useSearchParams)(),Q=$()(T,1),m=Q[0],i=m.get("erd:projectId")||"";(!i||i==="")&&(i=Tt.rV(It.s.PROJECT_ID)||"");var y=(0,b.useState)({columns:[],dataSource:[],total:0,queryKey:0,tableName:"",page:1,pageSize:20,showPagination:!1,primaryKeys:[],tableColumns:{}}),x=$()(y,2),D=x[0],E=x[1],C=(0,b.useState)({columns:[],dataSource:[],total:0}),h=$()(C,2),I=h[0],g=h[1],P=(0,b.useState)("result"),A=$()(P,2),X=A[0],J=A[1],V=(0,b.useState)(""),R=$()(V,2),B=R[0],q=R[1],he=(0,b.useState)("mysql"),ee=$()(he,2),be=ee[0],le=ee[1],G=(0,b.useState)("xcode"),w=$()(G,2),ye=w[0],te=w[1],ze=(0,b.useState)([]),dt=$()(ze,2),Zt=dt[0],at=dt[1],wt=(0,wn.Z)(function(ue){return{queryDispatch:ue.dispatch}},ce.Z),Ye=wt.queryDispatch,ct=(0,b.useState)({sqlInfo:""}),vt=$()(ct,2),ft=vt[0],xe=vt[1],F=(0,b.useRef)(null),Se=(0,b.useRef)(null);(0,b.useEffect)(function(){var ue=sessionStorage.getItem("queryDbNamesSqlKey:"+v.id);if(ue){var H=JSON.parse(ue);at(H);var se=sessionStorage.getItem("querySqlKey:"+v.id),ie=JSON.parse(se);xe(ie),q(ie.selectDB),ie.selectDB?q(ie.selectDB):q(H[0]);return}u(!0),Pt.ZP.post("/ncnb/getDbs",{data:{projectId:i}}).then(function(ve){ve.data&&(sessionStorage.setItem("queryDbNamesSqlKey:"+v.id,JSON.stringify(ve.data)),at(ve.data),Ye.fetchQueryInfo(v.id).then(function(ae){u(!1),xe(ae.data),ae.data.selectDB?q(ae.data.selectDB):q(ve.data[0]),sessionStorage.setItem("querySqlKey:"+v.id,JSON.stringify(ae.data))}))})},[]);var Ve=function(){Object.keys(sessionStorage).forEach(function(H){H.includes("SqlKey")&&sessionStorage.removeItem(H)})};(0,b.useEffect)(function(){return window.addEventListener("keydown",mt),window.addEventListener("unload",Ve),function(){window.removeEventListener("keydown",mt),window.removeEventListener("unload",Ve)}},[]);var mt=function(H){if(H.ctrlKey&&H.code==="KeyC"&&H.target&&H.target.classList&&H.target.classList.contains("ace_text-input")){var se,ie;if(F!=null&&(se=F.current)!==null&&se!==void 0&&se.getSelectValue())return;F==null||(ie=F.current)===null||ie===void 0||ie.selectLine()}if(H.ctrlKey&&H.code==="Enter"){var ve,ae;if(!(F!=null&&(ve=F.current)!==null&&ve!==void 0&&ve.getSelectValue())){var Le;F==null||(Le=F.current)===null||Le===void 0||Le.selectLine()}var pt=new MouseEvent("click",{bubbles:!0,cancelable:!0});Se==null||(ae=Se.current)===null||ae===void 0||ae.dispatchEvent(pt)}},Qe=function(H){var se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:20,ve={queryId:v.id,projectId:i,sql:H,dbName:B,page:se,pageSize:ie};l(!0),Ye.exec(ve).then(function(ae){l(!1),(ae==null?void 0:ae.code)===200&&(sessionStorage.setItem("executeSqlKey:"+v.id,H),sessionStorage.setItem("executePageSqlKey:"+v.id,ae.data.page),sessionStorage.setItem("executePageSizeSqlKey:"+v.id,ae.data.pageSize),E({columns:ae==null?void 0:ae.data.columns,dataSource:ae.data.tableData.records,total:ae.data.tableData.total,queryKey:ae.data.queryKey,tableName:ae.data.tableName,page:ae.data.page,pageSize:ae.data.pageSize,showPagination:ae.data.showPagination,primaryKeys:ae.data.primaryKeys,tableColumns:ae.data.tableColumns}),J("result"))})},ht=function(H,se){var ie=sessionStorage.getItem("executeSqlKey:"+v.id)||"";Qe(ie,H,se)},ra=function(H){var se=sessionStorage.getItem("executeSqlKey:"+v.id)||"",ie=sessionStorage.getItem("executePageSqlKey:"+v.id)||1,ve=sessionStorage.getItem("executePageSizeSqlKey:"+v.id)||20,ae={queryId:v.id,projectId:i,sql:se,dbName:B,page:ie,pageSize:ve,type:H};l(!0),Ye.exportSql(ae,l)},Ut=function(){var H,se=F==null||(H=F.current)===null||H===void 0?void 0:H.getSelectValue();if(!se){var ie,ve;F==null||(ie=F.current)===null||ie===void 0||ie.selectLine(),se=F==null||(ve=F.current)===null||ve===void 0?void 0:ve.getSelectValue()}if(!B){we.ZP.warning("\u672A\u9009\u4E2D\u6570\u636E\u6E90");return}Qe(se)},oa=function(H){var se,ie;L(!1);var ve=F==null||(se=F.current)===null||se===void 0?void 0:se.getEditor();ve.navigateTo(ve.getCursorPosition().row,99999),F==null||(ie=F.current)===null||ie===void 0||ie.setSelectValue(`\r
`+H),Ut()},ia=function(H){var se=D.page;l(!0);var ie=sessionStorage.getItem("executeSqlKey:"+v.id)||"";Pt.ZP.post("/ncnb/execUpdate",{data:{queryId:v.id,sql:ie,dbName:B,projectId:i,rows:H}}).then(function(ve){l(!1),ve.code===200&&(we.ZP.success(ve.msg),Qe(ie,se))})},la=["xcode","terminal"],ua=(0,t.jsx)(Je.Z,{direction:"vertical",children:(0,t.jsxs)(Je.Z,{wrap:!0,children:[(0,t.jsx)(We.ZP,{loading:d,size:"small",icon:(0,t.jsx)(_t.Z,{}),type:"primary",onClick:function(){L(!0)},children:"\u52A8\u6001\u6784\u5EFA\u67E5\u8BE2SQL"}),(0,t.jsx)("span",{style:{marginRight:8},children:"\u6570\u636E\u6E90"}),(0,t.jsx)(ke.Z,{size:"small",style:{width:150,marginRight:12},value:B||"\u8BF7\u9009\u62E9\u6570\u636E\u6E90",onSelect:function(H){return q(H)},showSearch:!0,children:(0,t.jsx)(Xn,{children:Zt.map(function(ue){return(0,t.jsx)(Ot,{value:ue,children:ue},"".concat(ue))})})},"db"),(0,t.jsx)("span",{style:{marginRight:8},children:"\u6A21\u5F0F"}),(0,t.jsxs)(ke.Z,{size:"small",style:{width:90,marginRight:12},value:be,onSelect:function(H){return le(H)},children:[(0,t.jsx)(Ot,{value:"mysql",children:"MySQL"},"mysql"),(0,t.jsx)(Ot,{value:"sql",children:"SQL"},"sql")]},"model"),(0,t.jsx)("span",{style:{marginRight:8},children:"\u4E3B\u9898"}),(0,t.jsx)(ke.Z,{size:"small",style:{marginRight:16,width:100},value:ye,onSelect:function(H){te(H)},children:la.map(function(ue){return(0,t.jsx)(Ot,{value:ue,children:ue},ue)})},"topic")]})});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($t.Z,{layout:"center",bordered:!0,extra:ua,size:"small",children:(0,t.jsx)($e.Z,{tables:c,selectDB:B,onRef:F,mode:be,theme:ye,value:ft.sqlInfo,onChange:function(H){var se=s()(s()({},ft),{},{sqlInfo:H});xe(se),sessionStorage.setItem("querySqlKey:"+v.id,JSON.stringify(se))}})}),(0,t.jsx)(At.Z,{spinning:d,children:(0,t.jsxs)(Je.Z,{wrap:!0,children:[(0,t.jsx)(We.ZP,{type:"primary",size:"small",ref:Se,icon:(0,t.jsx)(Wt.Z,{}),onClick:Ut,children:"\u8FD0\u884C(Ctrl+Enter)"}),(0,t.jsx)(We.ZP,{icon:(0,t.jsx)(Fn.Z,{}),size:"small",onClick:function(){var H,se,ie=F==null||(H=F.current)===null||H===void 0?void 0:H.getSelectValue();if(!ie){var ve,ae;F==null||(ve=F.current)===null||ve===void 0||ve.selectLine(),ie=F==null||(ae=F.current)===null||ae===void 0?void 0:ae.getSelectValue()}var Le=(0,Nn.WU)(ie||"",{language:be});F==null||(se=F.current)===null||se===void 0||se.setSelectValue(Le)},children:"\u683C\u5F0F\u5316"}),(0,t.jsx)(We.ZP,{icon:(0,t.jsx)(On.Z,{}),size:"small",onClick:function(){var H,se=F==null||(H=F.current)===null||H===void 0?void 0:H.getSelectValue();if(!se){var ie,ve;F==null||(ie=F.current)===null||ie===void 0||ie.selectLine(),se=F==null||(ve=F.current)===null||ve===void 0?void 0:ve.getSelectValue()}if(!B){we.ZP.warning("\u672A\u9009\u4E2D\u6570\u636E\u6E90");return}var ae={queryId:v.id,projectId:i,sql:se,dbName:B};Ye.explain(ae).then(function(Le){var pt,Mt;g({columns:Le==null?void 0:Le.data.columns,dataSource:Le==null?void 0:Le.data.tableData,total:Le==null||(pt=Le.data)===null||pt===void 0||(Mt=pt.tableData)===null||Mt===void 0?void 0:Mt.length}),J("plan")})},children:"\u67E5\u770B\u6267\u884C\u8BA1\u5212"}),(0,t.jsx)(We.ZP,{icon:(0,t.jsx)(Zn.Z,{}),size:"small",onClick:function(){Ye.updateSqlInfo({id:v.id,sqlInfo:ft.sqlInfo,projectId:i,selectDB:B})},children:"\u4FDD\u5B58SQL"})]})}),(0,t.jsx)(At.Z,{spinning:a,children:(0,t.jsx)($t.Z,{size:"small",layout:"center",bordered:!0,style:{height:"calc(100vh - 326px)"},wrap:!0,tabs:{activeKey:X,items:[{label:(0,t.jsx)("span",{children:"\u6267\u884C\u7ED3\u679C"}),key:"result",children:(0,t.jsx)(Pn,{tableResult:D,onRef:F,submitQueryTableChange:ia,executeSqlWhenPaginationChange:ht,exportSql:ra})},{label:(0,t.jsx)("span",{children:"\u6267\u884C\u8BA1\u5212"}),key:"plan",children:(0,t.jsx)(Bn,{tableResult:I})},{label:(0,t.jsx)("span",{children:"\u5386\u53F2\u8BB0\u5F55"}),key:"history",children:(0,t.jsx)(Rn,{queryId:v.id},X)}],onChange:function(H){J(H)}},children:"Auto"})}),(0,t.jsx)(yn.Z,{title:"\u52A8\u6001\u6784\u5EFA\u67E5\u8BE2SQL",width:800,placement:"right",onClose:function(){L(!1)},open:Z,children:(0,t.jsx)(Gn,{selectDB:B,closeDrawer:oa})})]})},ea=b.memo(qn),ta=o(22685),na=function(v){var j=(0,Ue.ZP)(function(m){return m.tableTabs}),c=(0,Ue.ZP)(function(m){return m.selectTabId}),e=(0,Ue.ZP)(function(m){return m.dispatch}),n=(0,ne.ZP)(),a=n.showErrorTipFloatButton,l=function(i){if(i.group===Ue.v0.MODEL){var y;return(y=i.entity)!==null&&y!==void 0&&y.startsWith("\u5173\u7CFB\u56FE")?(0,t.jsx)(hn,{moduleEntity:i}):(0,t.jsx)(ut,{moduleEntity:i})}return i.group===Ue.v0.QUERY?(0,t.jsx)(ea,{id:i.module+""}):(0,t.jsx)(Lt.Z,{image:"/invocationlab-erd-online-view/empty.svg",imageStyle:{height:200},style:{marginTop:"100px"},description:(0,t.jsx)("span",{children:"\u8FD9\u91CC\u7A7A\u7A7A\u5982\u4E5F!"})})},r=function(i){e.removeTab(i)},p=function(i){e.removeLeftTab(i)},d=function(i){e.removeRightTab(i)},u=function(i){e.removeAllTab(i)},f=Ae.Z.TabPane,S=function(i){return{group:Ue.v0.MODEL,module:i.split("###")[0],entity:i.split("###")[1]}},Z=function(i){e.activeTab(S(i))},L=function(i,y){y==="remove"&&r(S(i))},T=function(i){return(0,t.jsxs)(tt.Z,{children:[(0,t.jsx)(tt.Z.Item,{onClick:function(){return r(i)},children:"\u5173\u95ED\u5F53\u524D"},"closeCurrent"),(0,t.jsx)(tt.Z.Item,{onClick:function(){return p(i)},children:"\u5173\u95ED\u5DE6\u8FB9"},"closeLeft"),(0,t.jsx)(tt.Z.Item,{onClick:function(){return d(i)},children:"\u5173\u95ED\u53F3\u8FB9"},"closeRight"),(0,t.jsx)(tt.Z.Item,{onClick:function(){return u(i)},children:"\u5173\u95ED\u5168\u90E8"},"closeAll")]})},Q=function(i,y){return(0,t.jsx)(y,s()(s()({},i),{},{children:function(D){var E,C;return(0,t.jsx)(pn.Z,{overlay:T({module:D==null||(E=D.key)===null||E===void 0?void 0:E.split("###")[0],entity:D==null||(C=D.key)===null||C===void 0?void 0:C.split("###")[1]}),trigger:["contextMenu"],children:D})}}))};return(0,t.jsxs)(t.Fragment,{children:[c?(0,t.jsx)(Ae.Z,{type:"editable-card",hideAdd:!0,onEdit:function(i,y){return L(i,y)},activeKey:c,onChange:Z,renderTabBar:Q,children:j==null?void 0:j.map(function(m,i){return(0,t.jsx)(f,{tab:(0,t.jsx)(ta.I,{title:m.entity,children:m.entity}),closable:!0,children:l(m)},"".concat(m.module,"###").concat(m.entity))})},c):(0,t.jsx)(Lt.Z,{image:"/invocationlab-erd-online-view/empty.svg",imageStyle:{height:200},style:{marginTop:"100px"},description:(0,t.jsx)("span",{children:"\u8FD9\u91CC\u7A7A\u7A7A\u5982\u4E5F!"})}),a&&(0,t.jsx)(Ce.Z,{description:"\u670D\u52A1\u5668\u6570\u636E\u5DF2\u88AB\u4EBA\u4FEE\u6539\uFF0C\u6240\u6709\u4FDD\u5B58\u90FD\u5C06\u5931\u8D25\u3002\u4E3A\u907F\u514D\u6570\u636E\u4E92\u76F8\u8986\u76D6\u5BFC\u81F4\u4E22\u5931\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u540E\u518D\u91CD\u8BD5\uFF01",shape:"square",style:{right:50,bottom:20,width:340,backgroundColor:"#00000000"}})]})},aa=b.memo(na)},81663:function(Ge,Fe,o){o.d(Fe,{D7:function(){return ce},HT:function(){return $e},UC:function(){return Be},a4:function(){return U},dm:function(){return k},fU:function(){return _}});var Ne=o(97833),s=o.n(Ne),b=o(91484),Ce=o.n(b),pe=o(42196),re=o.n(pe),De=o(88263);function ge(de,fe,je){return ne.apply(this,arguments)}function ne(){return ne=_asyncToGenerator(_regeneratorRuntime().mark(function de(fe,je,Oe){var Y,_e;return _regeneratorRuntime().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return Oe||(Oe={}),Y=JSON.stringify(Oe)==="{}",_e=[],Y||Object.keys(Oe).map(function(Xe,rt){var ot=Oe[Xe];ot==="ascend"&&_e.push({column:Xe,asc:!0}),ot==="descend"&&_e.push({column:Xe,asc:!1})}),O.abrupt("return",request(fe,{method:"GET",params:_objectSpread({size:je.pageSize,orders:_e},je)}));case 5:case"end":return O.stop()}},de)})),ne.apply(this,arguments)}function ce(de,fe){return M.apply(this,arguments)}function M(){return M=re()(s()().mark(function de(fe,je){return s()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",(0,De.ZP)(fe,{method:"POST",data:Ce()({},je)}));case 1:case"end":return Y.stop()}},de)})),M.apply(this,arguments)}function _(de,fe){return t.apply(this,arguments)}function t(){return t=re()(s()().mark(function de(fe,je){return s()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",(0,De.ZP)(fe,{method:"DELETE",data:Ce()({},je)}));case 1:case"end":return Y.stop()}},de)})),t.apply(this,arguments)}function k(de,fe){return W.apply(this,arguments)}function W(){return W=re()(s()().mark(function de(fe,je){return s()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",(0,De.ZP)(fe,{method:"PUT",data:Ce()({},je)}));case 1:case"end":return Y.stop()}},de)})),W.apply(this,arguments)}function U(de,fe){return $.apply(this,arguments)}function $(){return $=re()(s()().mark(function de(fe,je){return s()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",(0,De.ZP)(fe,{method:"POST",data:Ce()({},je)}));case 1:case"end":return Y.stop()}},de)})),$.apply(this,arguments)}function $e(de,fe){return Ke.apply(this,arguments)}function Ke(){return Ke=re()(s()().mark(function de(fe,je){return s()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",(0,De.ZP)(fe,{method:"GET",params:Ce()({},je)}));case 1:case"end":return Y.stop()}},de)})),Ke.apply(this,arguments)}function Be(de,fe){return Me.apply(this,arguments)}function Me(){return Me=re()(s()().mark(function de(fe,je){return s()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",(0,De.ZP)(fe,{method:"GET",params:Ce()({},je)}));case 1:case"end":return Y.stop()}},de)})),Me.apply(this,arguments)}},57956:function(Ge,Fe,o){var Ne=o(31777),s=o(81663),b=o(7599),Ce=o(71793),pe=o(51927),re=o(44766),De=o.n(re),ge=o(14515),ne=o(5049),ce=o(88263),M=(0,Ne.Z)(function(_,t){return{querySearchKey:"",treeData:[],dispatch:{queryHistory:function(W){return(0,s.HT)("/ncnb/queryHistory",W)},explain:function(W){return(0,s.a4)("/ncnb/queryInfo/explain",W)},exec:function(W){return(0,s.a4)("/ncnb/queryInfo/exec",W)},exportSql:function(W,U){(0,ce.Ht)(W,U,"/ncnb/queryInfo/exportSql")},updateSqlInfo:function(W){(0,s.dm)("/ncnb/queryInfo/"+W.id,W).then(function(U){if((U==null?void 0:U.code)===200){ne.ZP.success(U==null?void 0:U.msg);return}})},renameQuery:function(W){(0,s.dm)("/ncnb/queryInfo/"+W.id,W).then(function(U){(U==null?void 0:U.code)===200&&(ne.ZP.success("\u4FEE\u6539\u6210\u529F"),t().dispatch.fetchTreeData({projectId:W.projectId}))})},removeQuery:function(W){var U=Ce.rV(pe.s.PROJECT_ID)||"";(0,s.fU)("/ncnb/queryInfo/"+U+"/"+W.id,{}).then(function($){($==null?void 0:$.code)===200&&(ne.ZP.success("\u5220\u9664\u6210\u529F"),t().dispatch.fetchTreeData({projectId:U}))})},addQuery:function(W){(0,s.D7)("/ncnb/queryInfo",W).then(function(U){(U==null?void 0:U.code)===200&&(ne.ZP.success("\u65B0\u589E\u6210\u529F"),t().dispatch.fetchTreeData({projectId:W.projectId}))})},fetchQueryInfo:function(W){return(0,s.HT)("/ncnb/queryInfo/"+W,{})},fetchTreeData:function(W){var U=t().querySearchKey;U&&De().set(W,"title",U),(0,s.UC)("/ncnb/queryInfo/tree",W).then(function($){($==null?void 0:$.code)===200&&_({treeData:($==null?void 0:$.data)||[]})})},setQuerySearchKey:function(W){return _((0,b.ZP)(function(U){U.querySearchKey=W}))},onSelectNode:function(W,U){return _((0,b.ZP)(function($){var $e=ge.ZP.getState().dispatch;U.node.isLeaf&&$e.addTab({group:ge.v0.QUERY,module:U.node.key+"",entity:U.node.title+""})}))}}}});Fe.Z=M},14515:function(Ge,Fe,o){o.d(Fe,{v0:function(){return Ce}});var Ne=o(31777),s=o(7599),b=o(75687),Ce;(function(ge){ge[ge.MODEL=0]="MODEL",ge[ge.QUERY=1]="QUERY"})(Ce||(Ce={}));var pe="",re="ERD-ONLINE-SQL-QUERY",De=(0,Ne.Z)(function(ge,ne){return{selectTabId:pe,tableTabs:[],dispatch:{addTab:function(M){return ge((0,s.ZP)(function(_){_.tableTabs.find(function(t){return(t==null?void 0:t.entity)===M.entity&&(t==null?void 0:t.module)===M.module})||_.tableTabs.push(M),_.selectTabId="".concat(M.module,"###").concat(M.entity)}))},activeTab:function(M){return ge((0,s.ZP)(function(_){if(_.selectTabId="".concat(M.module,"###").concat(M.entity),M.group===Ce.MODEL){var t=b.ZP.getState().dispatch;t.setCurrentModule(M.module),t.setCurrentEntity(M.entity)}}))},removeTab:function(M){return ge((0,s.ZP)(function(_){var t=_.tableTabs.findIndex(function(U){return(U==null?void 0:U.entity)===M.entity&&(U==null?void 0:U.module)===(M==null?void 0:M.module)});if(t>-1&&(_.tableTabs=_.tableTabs.filter(function(U,$){return $!==t}),ne().selectTabId==="".concat(M==null?void 0:M.module,"###").concat(M==null?void 0:M.entity))){if(t===0)_.selectTabId=pe;else if(t>0){var k=_.tableTabs[t-1];if(_.selectTabId="".concat(k==null?void 0:k.module,"###").concat(k==null?void 0:k.entity),M.group===Ce.MODEL){var W=b.ZP.getState().dispatch;W.setCurrentModule(k.module),W.setCurrentEntity(k.entity)}}}}))},removeLeftTab:function(M){return ge((0,s.ZP)(function(_){var t=_.tableTabs.findIndex(function(k){return(k==null?void 0:k.entity)===M.entity&&(k==null?void 0:k.module)===(M==null?void 0:M.module)});t>-1&&(_.tableTabs=_.tableTabs.filter(function(k,W){return W>=t})),_.selectTabId="".concat(M.module,"###").concat(M.entity)}))},removeRightTab:function(M){return ge((0,s.ZP)(function(_){var t=_.tableTabs.findIndex(function(k){return(k==null?void 0:k.entity)===M.entity&&(k==null?void 0:k.module)===(M==null?void 0:M.module)});t>-1&&(_.tableTabs=_.tableTabs.filter(function(k,W){return W<=t})),_.selectTabId="".concat(M.module,"###").concat(M.entity)}))},removeAllTab:function(M){return ge((0,s.ZP)(function(_){_.tableTabs=[],_.selectTabId=pe}))},containTab:function(M){return!!ne().tableTabs.find(function(_){return _.entity===M})}}}});Fe.ZP=De}}]);
