"use strict";(self.webpackChunkInvocationlab_ERD_Online=self.webpackChunkInvocationlab_ERD_Online||[]).push([[4035],{97111:function(pe,L,e){var b=e(27789),s=e(98404),re=e(25781),d=e(20576),X=function(G,ie){return s.createElement(d.Z,(0,b.Z)((0,b.Z)({},G),{},{ref:ie,icon:re.Z}))};X.displayName="PlusOutlined",L.Z=s.forwardRef(X)},60491:function(pe,L,e){e.d(L,{S:function(){return Y}});var b=e(27789),s=e(32720),re=e(50559),d=e(9169),X=e(7172),B=e(47729),G=e(26869),ie=e.n(G),R=e(91163),N=e(98404),p=e(99880),ve=e(29376),F=e(42017),fe=function(c){return(0,s.Z)({},c.componentCls,{position:"fixed",insetInlineEnd:0,bottom:0,zIndex:99,display:"flex",alignItems:"center",width:"100%",paddingInline:24,paddingBlock:0,boxSizing:"border-box",lineHeight:"64px",backgroundColor:(0,F.uK)(c.colorBgElevated,.6),borderBlockStart:"1px solid ".concat(c.colorSplit),"-webkit-backdrop-filter":"blur(8px)",backdropFilter:"blur(8px)",color:c.colorText,transition:"all 0.2s ease 0s","&-left":{flex:1,color:c.colorText},"&-right":{color:c.colorText,"> *":{marginInlineEnd:8,"&:last-child":{marginBlock:0,marginInline:0}}}})};function le(Q){return(0,F.Xj)("ProLayoutFooterToolbar",function(c){var l=(0,b.Z)((0,b.Z)({},c),{},{componentCls:".".concat(Q)});return[fe(l)]})}function U(Q,c){var l=c.stylish;return(0,F.Xj)("ProLayoutFooterToolbarStylish",function(f){var j=(0,b.Z)((0,b.Z)({},f),{},{componentCls:".".concat(Q)});return l?[(0,s.Z)({},"".concat(j.componentCls),l==null?void 0:l(j))]:[]})}var T=e(36422),ue=["children","className","extra","portalDom","style","renderContent"],Y=function(c){var l=c.children,f=c.className,j=c.extra,n=c.portalDom,o=n===void 0?!0:n,te=c.style,he=c.renderContent,K=(0,d.Z)(c,ue),ae=(0,N.useContext)(B.ZP.ConfigContext),ge=ae.getPrefixCls,oe=ae.getTargetContainer,me=c.prefixCls||ge("pro"),O="".concat(me,"-footer-bar"),je=le(O),Ee=je.wrapSSR,de=je.hashId,C=(0,N.useContext)(ve.X),Pe=(0,N.useMemo)(function(){var se=C.hasSiderMenu,Te=C.isMobile,ye=C.siderWidth;if(se)return ye?Te?"100%":"calc(100% - ".concat(ye,"px)"):"100%"},[C.collapsed,C.hasSiderMenu,C.isMobile,C.siderWidth]),$=(0,N.useMemo)(function(){return(typeof window=="undefined"?"undefined":(0,re.Z)(window))===void 0||(typeof document=="undefined"?"undefined":(0,re.Z)(document))===void 0?null:(oe==null?void 0:oe())||document.body},[]),xe=U("".concat(O,".").concat(O,"-stylish"),{stylish:c.stylish}),ce=(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("div",{className:"".concat(O,"-left ").concat(de).trim(),children:j}),(0,T.jsx)("div",{className:"".concat(O,"-right ").concat(de).trim(),children:l})]});(0,N.useEffect)(function(){return!C||!(C!=null&&C.setHasFooterToolbar)?function(){}:(C==null||C.setHasFooterToolbar(!0),function(){var se;C==null||(se=C.setHasFooterToolbar)===null||se===void 0||se.call(C,!1)})},[]);var Se=(0,T.jsx)("div",(0,b.Z)((0,b.Z)({className:ie()(f,de,O,(0,s.Z)({},"".concat(O,"-stylish"),!!c.stylish)),style:(0,b.Z)({width:Pe},te)},(0,R.Z)(K,["prefixCls"])),{},{children:he?he((0,b.Z)((0,b.Z)((0,b.Z)({},c),C),{},{leftWidth:Pe}),ce):ce})),be=!(0,X.j)()||!o||!$?Se:(0,p.createPortal)(Se,$,O);return xe.wrapSSR(Ee((0,T.jsx)(N.Fragment,{children:be},O)))}},29376:function(pe,L,e){e.d(L,{X:function(){return s}});var b=e(98404),s=(0,b.createContext)({})},28551:function(pe,L,e){e.r(L),e.d(L,{default:function(){return Me}});var b=e(9083),s=e.n(b),re=e(27618),d=e(98404),X=e(12784),B=e(2491),G=e(64210),ie=e(43953),R=e.n(ie),N=e(39346),p=e.n(N),ve=e(91184),F=e.n(ve),fe=e(15241),le=e(31117),U=e(23759),T=e(34973),ue=e(4302),Y=e(55074),Q=e(97111),c=e(63356),l=e(2360),f=e(64454),j=e(62656),n=e(36422),o=f.Z.Search,te=function(E){var V=(0,d.useState)(""),q=s()(V,2),ee=q[0],M=q[1],ne=(0,d.useState)(""),W=s()(ne,2),H=W[0],P=W[1],A=(0,d.useState)(!0),z=s()(A,2),Z=z[0],h=z[1],w=function(){var D=F()(R()().mark(function I(S){var x;return R()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(S){m.next=2;break}return m.abrupt("return");case 2:return m.next=4,(0,T.HT)("/auth/oauth/getUserInfo",{account:S});case 4:x=m.sent,x.code===200?(M(S),P(x.data),h(!1)):(M(""),h(!0),U.ZP.error(x.msg));case 6:case"end":return m.stop()}},I)}));return function(S){return D.apply(this,arguments)}}();return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(c.Y,{title:"\u6DFB\u52A0\u6210\u5458",trigger:(0,n.jsxs)(j.ZP,{type:"primary",children:[(0,n.jsx)(Q.Z,{}),"\u6DFB\u52A0\u6210\u5458"]},"add-user"),autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:function(){M(""),h(!0),P("")}},submitter:{resetButtonProps:{type:"dashed"},render:function(I,S){return[(0,n.jsx)(j.ZP,{disabled:Z,onClick:function(){var _,m;return(_=I.form)===null||_===void 0||(m=_.submit)===null||m===void 0?void 0:m.call(_)},children:"\u63D0\u4EA4"},"submit")]}},submitTimeout:2e3,onFinish:function(){var D=F()(R()().mark(function I(S){return R()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,(0,T.a4)("/ncnb/project/group/role/users",{projectId:E.projectId,roleId:E.roleId,userIds:[ee]}).then(function(m){var y;(m==null?void 0:m.code)===200&&U.ZP.success("\u4FDD\u5B58\u6210\u529F"),(y=E.actionRef.current)===null||y===void 0||y.reload(),M(""),h(!0),P("")});case 2:return _.abrupt("return",!0);case 3:case"end":return _.stop()}},I)}));return function(I){return D.apply(this,arguments)}}(),children:(0,n.jsxs)(l.A.Group,{children:[(0,n.jsx)(o,{placeholder:"\u8BF7\u8F93\u5165",onInput:function(I){return M(I.target.value)},onSearch:w,style:{width:200},onBlur:function(){return w(ee)}}),(0,n.jsx)(f.Z,{placeholder:"\u7528\u6237\u540D",disabled:!0,value:H})]})})})},he=d.memo(te),K=e(53631),ae=function(E){var V=(0,K.md)(),q=(0,ue.useSearchParams)(),ee=s()(q,1),M=ee[0],ne=(0,d.useRef)(),W=M.get(Y.s.PROJECT_ID)||"";return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(fe.Rs,{actionRef:ne,toolBarRender:function(){return V.canErdProjectUsersAdd&&E.isAdmin?[]:[(0,n.jsx)(he,{projectId:W,roleId:E.roleId,actionRef:ne})]},search:{filterType:"light"},rowKey:"id",request:F()(R()().mark(function H(){var P,A,z,Z,h=arguments;return R()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return z=h.length>0&&h[0]!==void 0?h[0]:{},D.next=3,(0,T.HT)("/ncnb/project/group/role/users",p()(p()({},z),{},{projectId:W,roleId:E.roleId}));case 3:return Z=D.sent,D.abrupt("return",{data:Z==null||(P=Z.data)===null||P===void 0||(P=P.records)===null||P===void 0?void 0:P.map(function(I){return p()(p()({},I),{},{avatar:I.avatar?I.avatar:"/invocationlab-erd-online-view/logo.svg"})}),total:Z==null||(A=Z.data)===null||A===void 0?void 0:A.total,success:Z.code===200});case 5:case"end":return D.stop()}},H)})),pagination:{pageSize:6},metas:{title:{dataIndex:"username",title:"\u7528\u6237\u540D",search:V.canErdProjectRolesSearch&&!E.isAdmin},avatar:{dataIndex:"avatar",search:!1},description:{dataIndex:"title",search:!1},content:{dataIndex:"email",title:"\u90AE\u7BB1",search:V.canErdProjectRolesSearch&&!E.isAdmin},actions:{render:function(P,A){return E.isAdmin?[]:[(0,n.jsx)(K.Nv,{accessible:V.canErdProjectRoleUsersDel,fallback:(0,n.jsx)(n.Fragment,{}),children:(0,n.jsx)(le.Z,{placement:"right",title:"\u662F\u5426\u5C06\u300E"+A.username+"\u300F\u79FB\u9664",onConfirm:function(){return(0,T.fU)("/ncnb/project/group/role/users",{projectId:W,roleId:E.roleId,userIds:[A.id]}).then(function(Z){if(Z.code===200){var h;U.ZP.success("\u79FB\u9664\u6210\u529F"),(h=ne.current)===null||h===void 0||h.reload()}})},okText:"\u662F",cancelText:"\u5426",children:(0,n.jsx)("a",{children:"\u79FB\u9664"},"link")})})]},search:!1}}})})},ge=d.memo(ae),oe=e(60491),me=e(39304),O=e(97170),je=e(6088),Ee=e(58750),de=e(92025),C=e(95597),Pe=e(44766),$=e.n(Pe),xe=e(29612),ce=void 0,Se=function(E){var V=(0,K.md)(),q=(0,d.useState)(3),ee=s()(q,2),M=ee[0],ne=ee[1],W=(0,d.useState)([]),H=s()(W,2),P=H[0],A=H[1],z=(0,d.useState)([]),Z=s()(z,2),h=Z[0],w=Z[1],D=(0,d.useState)({indeterminate:!1,checked:!1}),I=s()(D,2),S=I[0],x=I[1],_=(0,d.useState)([]),m=s()(_,2),y=m[0],Ce=m[1],Ae=(0,ue.useSearchParams)(),Ge=s()(Ae,1),Be=Ge[0],Ue=function(){var g=F()(R()().mark(function r(){var a;return R()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,T.HT)("/ncnb/project/group/role/permission",{roleId:(a=E.values)===null||a===void 0?void 0:a.id,projectId:Be.get("projectId")});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},r)}));return function(){return g.apply(this,arguments)}}();function Ke(g,r,a){var v=$().find(g,function(u){var i;return(u==null||(i=u.defaultValue)===null||i===void 0?void 0:i.length)>0}),t=$().filter(g,function(u){var i,J;return(u==null||(i=u.defaultValue)===null||i===void 0?void 0:i.length)===(u==null||(J=u.operations)===null||J===void 0?void 0:J.length)});t.length===g.length?r={indeterminate:!1,checked:!0,disabled:a===0?!1:a>E.defaultRole||!1}:v?r={indeterminate:!0,checked:!0,disabled:a===0?!1:a>E.defaultRole||!0}:r={indeterminate:!1,checked:!1,disabled:a===0?!1:a>E.defaultRole||!1},x(r)}function Ve(g,r){var a=$().find(g,function(t){var u;return(t==null||(u=t.defaultValue)===null||u===void 0?void 0:u.length)>0}),v=$().filter(g,function(t){var u,i;return(t==null||(u=t.defaultValue)===null||u===void 0?void 0:u.length)===(t==null||(i=t.operations)===null||i===void 0?void 0:i.length)});v.length===g.length?r=p()(p()({},S),{},{indeterminate:!1,checked:!0}):a?r=p()(p()({},S),{},{indeterminate:!0,checked:!0}):r=p()(p()({},S),{},{indeterminate:!1,checked:!1}),x(r)}(0,d.useEffect)(function(){Ue().then(function(g){var r,a;if(!g||g.code!==200){U.ZP.error("\u83B7\u53D6\u6743\u9650\u5217\u8868\u5931\u8D25");return}var v=g==null||(r=g.data)===null||r===void 0?void 0:r.checkboxes,t=g==null||(a=g.data)===null||a===void 0?void 0:a.loginRole;ne(t);var u=[],i=[],J={indeterminate:!1,checked:!1};v==null||v.forEach(function(k,Ne,He){var Ie,_e,Ze,Re;u.push({key:Ne,checkedKeys:k.defaultValue});var Fe=(k==null||(Ie=k.defaultValue)===null||Ie===void 0?void 0:Ie.length)>0,$e=Fe&&(k==null||(_e=k.defaultValue)===null||_e===void 0?void 0:_e.length)!=((Ze=k.operations)===null||Ze===void 0?void 0:Ze.length);i.push({indeterminate:$e,checked:Fe,disabled:t===0?!1:t>E.defaultRole?!0:$e||(k==null||(Re=k.defaultValue)===null||Re===void 0?void 0:Re.length)===0})}),w($().omit(i)),Ce(u),A(v),Ke(v,J,t)})},[]);var We=function(r){P.forEach(function(a,v){Oe(v,r)}),r.target.checked?x(p()(p()({},S),{},{indeterminate:!1,checked:!0})):x(p()(p()({},S),{},{indeterminate:!1,checked:!1}))},Oe=function(r,a){if(a.target.checked){h[r]=p()(p()({},h[r]),{},{indeterminate:!1,checked:!0}),w($().omit(h));var v=$().map(P[r].operations||[],"value");y[r]={key:r,checkedKeys:v},Ce(y)}else y[r]={key:r,checkedKeys:[]},Ce(y),h[r]=p()(p()({},h[r]),{},{indeterminate:!1,checked:!1}),w($().omit(h))},ke=function(r,a){var v,t,u,i;y[r]={key:r,checkedKeys:a},Ce(y),h[r]=p()(p()({},h[r]),{},{indeterminate:((v=y[r].checkedKeys)===null||v===void 0?void 0:v.length)>0&&((t=y[r])===null||t===void 0||(t=t.checkedKeys)===null||t===void 0?void 0:t.length)!=((u=P[r])===null||u===void 0||(u=u.operations)===null||u===void 0?void 0:u.length),checked:((i=y[r].checkedKeys)===null||i===void 0?void 0:i.length)>0}),w($().omit(h)),Ve(P,$().omit(S))},Le=function(r,a){var v=[];return v=r.map(function(t,u){var i;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(me.Z,{children:(0,n.jsx)(O.Z,{value:t.value,disabled:M===0?!1:!(M<=E.defaultRole&&((i=P[a])===null||i===void 0?void 0:i.defaultValue.indexOf(t.value))>-1),children:t.name},t.value)},t.value)})}),v};return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.A,{submitter:{render:function(r,a){return V.canErdProjectRolePermissionEdit?(0,n.jsx)(oe.S,{children:a}):(0,n.jsx)(n.Fragment,{})}},onFinish:function(){var g=F()(R()().mark(function r(a){var v,t;return R()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(v=xe.rV(Y.s.PROJECT_ID),t=[],y.forEach(function(J){t=t.concat(J.checkedKeys)}),!V.canErdProjectRolePermissionEdit){i.next=8;break}return i.next=6,(0,T.a4)("/ncnb/project/group/saveCheckedOperations",{projectId:v,checkedKeys:t,roleId:E.values.id}).then(function(J){J.code===200?U.ZP.success("\u4FDD\u5B58\u6210\u529F"):U.ZP.error(J.msg)});case 6:i.next=9;break;case 8:U.ZP.warning("\u65E0\u6743\u64CD\u4F5C\u6743\u9650\u529F\u80FD");case 9:case"end":return i.stop()}},r)}));return function(r){return g.apply(this,arguments)}}(),children:P&&P.length>0?(0,n.jsx)(je.Z,{header:(0,n.jsx)("div",{children:(0,n.jsx)(O.Z,{indeterminate:S.indeterminate,checked:S.checked,disabled:S.disabled,onChange:We.bind(ce),children:"\u5168\u9009"})}),dataSource:P,renderItem:function(r,a){var v,t;return(0,n.jsxs)(n.Fragment,{children:[a>0?(0,n.jsx)(Ee.Z,{}):(0,n.jsx)(n.Fragment,{}),(0,n.jsxs)(de.Z,{align:"middle",children:[(0,n.jsx)(me.Z,{span:6,children:(0,n.jsx)(O.Z,{indeterminate:h[a].indeterminate,checked:h[a].checked,disabled:h[a].disabled,onChange:Oe.bind(ce,a),children:r.menuName},a)}),(0,n.jsx)(me.Z,{span:18,children:(0,n.jsx)(O.Z.Group,{style:{width:"100%",margin:"0 8px"},defaultValue:r==null?void 0:r.defaultValue,value:(v=y[a])===null||v===void 0?void 0:v.checkedKeys,onChange:ke.bind(ce,a),children:(0,n.jsx)(de.Z,{children:(r==null||(t=r.operations)===null||t===void 0?void 0:t.length)>0&&Le(r==null?void 0:r.operations,a)})},a)})]})]})}}):(0,n.jsx)(C.Z,{image:"/invocationlab-erd-online-view/empty.svg",imageStyle:{height:200}})})})},be=d.memo(Se),se=X.Z.Text,Te=X.Z.Title,ye=function(E){var V=(0,d.useState)("admin"),q=s()(V,2),ee=q[0],M=q[1],ne=(0,d.useState)([]),W=s()(ne,2),H=W[0],P=W[1],A=(0,K.md)(),z=(0,ue.useSearchParams)(),Z=s()(z,1),h=Z[0],w=A.canErdProjectRolesPage,D=A.canErdProjectRolePermission,I=function(x,_,m){var y=[];return w&&y.push({label:(0,n.jsx)(se,{strong:!0,children:"\u7528\u6237\u7EC4\u6210\u5458"}),key:"1",children:(0,n.jsx)(ge,{roleId:x,isAdmin:_})}),D&&y.push({label:(0,n.jsx)(se,{strong:!0,children:"\u6743\u9650\u914D\u7F6E"}),key:"3",children:(0,n.jsx)(be,{isAdmin:_,defaultRole:Number(m),values:{id:x}})}),(0,n.jsx)(B.Z,{defaultActiveKey:"1",items:y})};return(0,d.useEffect)(function(){(0,T.HT)("/ncnb/project/group/roles",{projectId:h.get(Y.s.PROJECT_ID)}).then(function(S){var x,_=S==null||(x=S.data)===null||x===void 0?void 0:x.map(function(m){var y=m.roleCode.includes("_0");return y&&M(m.roleCode),{label:m.roleName,key:m.roleCode,children:I(m.roleId,y,m.roleCode.split("_")[1])}});P(_)})},[]),(0,n.jsxs)("div",{children:[(0,n.jsx)(G.Z,{size:"large",children:(0,n.jsx)(Te,{level:4,children:"\u7528\u6237\u7EC4 "})}),(0,n.jsx)("br",{}),(0,n.jsx)(re.Z,{tabs:{tabPosition:"left",activeKey:ee,items:H,onChange:function(x){M(x)}}})]})},Me=d.memo(ye)},34973:function(pe,L,e){e.d(L,{D7:function(){return N},HT:function(){return ue},UC:function(){return Q},a4:function(){return U},dm:function(){return fe},fU:function(){return ve}});var b=e(43953),s=e.n(b),re=e(39346),d=e.n(re),X=e(91184),B=e.n(X),G=e(68413);function ie(l,f,j){return R.apply(this,arguments)}function R(){return R=_asyncToGenerator(_regeneratorRuntime().mark(function l(f,j,n){var o,te;return _regeneratorRuntime().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return n||(n={}),o=JSON.stringify(n)==="{}",te=[],o||Object.keys(n).map(function(ae,ge){var oe=n[ae];oe==="ascend"&&te.push({column:ae,asc:!0}),oe==="descend"&&te.push({column:ae,asc:!1})}),K.abrupt("return",request(f,{method:"GET",params:_objectSpread({size:j.pageSize,orders:te},j)}));case 5:case"end":return K.stop()}},l)})),R.apply(this,arguments)}function N(l,f){return p.apply(this,arguments)}function p(){return p=B()(s()().mark(function l(f,j){return s()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,G.ZP)(f,{method:"POST",data:d()({},j)}));case 1:case"end":return o.stop()}},l)})),p.apply(this,arguments)}function ve(l,f){return F.apply(this,arguments)}function F(){return F=B()(s()().mark(function l(f,j){return s()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,G.ZP)(f,{method:"DELETE",data:d()({},j)}));case 1:case"end":return o.stop()}},l)})),F.apply(this,arguments)}function fe(l,f){return le.apply(this,arguments)}function le(){return le=B()(s()().mark(function l(f,j){return s()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,G.ZP)(f,{method:"PUT",data:d()({},j)}));case 1:case"end":return o.stop()}},l)})),le.apply(this,arguments)}function U(l,f){return T.apply(this,arguments)}function T(){return T=B()(s()().mark(function l(f,j){return s()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,G.ZP)(f,{method:"POST",data:d()({},j)}));case 1:case"end":return o.stop()}},l)})),T.apply(this,arguments)}function ue(l,f){return Y.apply(this,arguments)}function Y(){return Y=B()(s()().mark(function l(f,j){return s()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,G.ZP)(f,{method:"GET",params:d()({},j)}));case 1:case"end":return o.stop()}},l)})),Y.apply(this,arguments)}function Q(l,f){return c.apply(this,arguments)}function c(){return c=B()(s()().mark(function l(f,j){return s()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,G.ZP)(f,{method:"GET",params:d()({},j)}));case 1:case"end":return o.stop()}},l)})),c.apply(this,arguments)}}}]);
