(self.webpackChunkInvocationlab_ERD_Online=self.webpackChunkInvocationlab_ERD_Online||[]).push([[7133],{27856:function(ye,M,t){"use strict";var V=t(27789),P=t(9169),x=t(66626),D=t(98404),F=t(25632),T=t(36933),b=t(36422),g=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],S=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],L=function(y,c){var i=y.fieldProps,E=y.children,$=y.params,re=y.proFieldProps,_=y.mode,se=y.valueEnum,ee=y.request,ie=y.showSearch,ce=y.options,r=(0,P.Z)(y,g),le=(0,D.useContext)(F.Z);return(0,b.jsx)(T.Z,(0,V.Z)((0,V.Z)({valueEnum:(0,x.h)(se),request:ee,params:$,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,V.Z)({options:ce,mode:_,showSearch:ie,getPopupContainer:le.getPopupContainer},i),ref:c,proFieldProps:re},r),{},{children:E}))},I=D.forwardRef(function(h,y){var c=h.fieldProps,i=h.children,E=h.params,$=h.proFieldProps,re=h.mode,_=h.valueEnum,se=h.request,ee=h.options,ie=(0,P.Z)(h,S),ce=(0,V.Z)({options:ee,mode:re||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},c),r=(0,D.useContext)(F.Z);return(0,b.jsx)(T.Z,(0,V.Z)((0,V.Z)({valueEnum:(0,x.h)(_),request:se,params:E,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,V.Z)({getPopupContainer:r.getPopupContainer},ce),ref:y,proFieldProps:$},ie),{},{children:i}))}),a=D.forwardRef(L),m=I,u=a;u.SearchSelect=m,u.displayName="ProFormComponent",M.Z=u},12125:function(ye,M,t){"use strict";var V=t(27789),P=t(9169),x=t(98404),D=t(36933),F=t(36422),T=["fieldProps","proFieldProps"],b=function(S,L){var I=S.fieldProps,a=S.proFieldProps,m=(0,P.Z)(S,T);return(0,F.jsx)(D.Z,(0,V.Z)({ref:L,valueType:"textarea",fieldProps:I,proFieldProps:a},m))};M.Z=x.forwardRef(b)},89591:function(ye,M,t){"use strict";t.d(M,{Z:function(){return F}});var V=t(98404),P=t(28068),x=t(74169),D=t(42279);function F(){const T=(0,P.Z)(x.Z);return T[D.Z]||T}},52107:function(ye,M){var t={UNKNOWN:0,KEYWORD:1,NUMBER:2,STRING:3,FUNCTION:4,VARIABLE:5,PARAMS:6,OPERATOR:7,COMMAS:8,MEMORY:9,COMMENT:99},V=function(D){for(var F=[],T=t.UNKNOWN,b="",g="",S="",L="",I=0;I<D.length;I++){if(g=D.charAt(I),g=="/"&&D.charAt(I+1)=="*"){for(b="",I++;++I<D.length;){if(S=D.charAt(I),L=D.charAt(I+1),S=="*"&&L=="/"){b=b.substr(0,b.length-1),I++;break}b===""?b+=S+L:b+=L}F[F.length]={text:b.replace(/^[\*\s]+/,"").replace(/[\s\*]+$/,""),type:t.COMMENT}}else if(g=="'"||g=='"'||g=="`"){for(b="";I<D.length&&g!=(S=D.charAt(++I));)b+=S=="\\"?D.charAt(++I):S;F[F.length]={text:b,type:g=="`"?t.VARIABLE:t.STRING}}else if(g==":"){for(b=g;I<D.length&&(S=D.charAt(++I),!!/^\w+$/i.test(S));)b+=S;I--,F[F.length]={text:b,type:t.PARAMS}}else if(/^[a-z_]+$/i.test(g)){for(b=g;I<D.length&&(S=D.charAt(++I),!!/^[\w\.:]+$/i.test(S));)b+=S;I--,F[F.length]={text:b,type:S=="("?t.FUNCTION:t.KEYWORD}}else if(g=="-"&&t.VARIABLE!=T||/\d+/.test(g)){for(b=g;I<D.length&&(S=D.charAt(++I),!!/^[\d\.]+$/.test(S));)b+=S;I--,b=="-"?F[F.length]={text:"-",type:t.OPERATOR}:F[F.length]={text:b-0,type:t.NUMBER}}else if(/^[\,;\(\)]+$/.test(g))F[F.length]={text:g,type:t.COMMAS};else if(/^(\+|\-|\*|\/|>|<|=|!)$/.test(g)){for(b=g;I<D.length&&(S=D.charAt(++I),!!/^(\+|\*|\/|>|<|=|!)+$/.test(S));)b+=S;I--,F[F.length]={text:b,type:t.OPERATOR}}T=F.length===0?T:F[F.length-1].type}return F},P=function(D){this.tokens=D instanceof Array?D:V(D.toString()),this.blocks=[];for(var F=0,T={"(":1,")":-1},b=0;b<this.tokens.length;++b){var g=this.tokens[b];g.type==t.COMMAS&&T[g.text]!==void 0?F+=T[g.text]:F||(this.blocks[this.blocks.length]=b)}};P.prototype.getAll=function(){return this.tokens},P.prototype.indexOf=function(x,g){var F=0,T=null;try{var b=new RegExp(x.text,"i")}catch(L){var b=x.text.toLowerCase()}for(var g=g==null?0:g+1,S=0;S<this.blocks.length;++S)if(F=this.blocks[S],!(F<g)&&(T=this.tokens[F],x.type==T.type&&(b instanceof RegExp&&b.test(T.text)||b==T.text.toLowerCase())))return this.blocks[S];return-1},M.vars=function(x,D,F){var T;if(F){var b=new P(D);D=b.getAll()}if(!D[x])return null;switch(D[x].type){case t.OPERATOR:T=[D[x-1],D[x+1]];break;case t.FUNCTION:T=[];for(var g=[],S=0,L=x+1,I=D.length;L<I;L++){var a=D[L];if(a.type!=t.COMMAS){g.push(a);continue}switch(a.text){case"(":S>0&&g.push(a),S++;break;case")":if(--S==0){T.push(g),g=[],L=I;break}else g.push(a);break;case",":S==1?(T.push(g),g=[]):g.push(a);break;default:break}}break;default:T=null;break}return T},M.text=function(x,D){var F=[];for(var T in x){var b=x[T];if(!b||!b.type||b.text==null)F.push(null);else switch(b.type){case t.STRING:F.push("'"+b.text+"'");break;case t.VARIABLE:F.push(b.text);break;default:F.push(b.text);break}D&&F.push(D)}return D&&F.pop(),F},M.types=t,M.create=function(x){return new P(x)}},95430:function(ye,M,t){var V=t(52107),P=t(91459),x=t(93363);function D(m){for(var u=[],h=0,y=0,c=0;c<m.length;c++){var i=m[c].text;if(i==="("){h++;continue}if(i===")"){h--;continue}h===0&&/^UNION$/i.test(i)&&m[c].type===V.types.KEYWORD&&(u.push(P.removeParenthese(m.slice(y,c))),y=c+1)}return u.push(P.removeParenthese(m.slice(y))),u}function F(m){for(var u=[],h={},y=0,c=0,i=0;i<m.length;i++){var E=m[i].text,$=m[i].type;if(E==="("){c++;continue}if(E===")"){c--;continue}if(!(c!==0||$!==V.types.KEYWORD)){if(/^SELECT$/i.test(E)){if(h.column!==void 0)continue;u.push({keyword:"column",pos:i}),h.column=!0}else if(/^FROM$/i.test(E)){if(h.source!==void 0)continue;u.push({keyword:"source",pos:i}),h.source=!0}else if(/^(JOIN|INNER|OUTER|LEFT|RIGHT)$/i.test(E)){if(h.joinmap!==void 0)continue;u.push({keyword:"joinmap",pos:i}),h.joinmap=!0}else if(/^WHERE$/i.test(E)){if(h.where!==void 0)continue;u.push({keyword:"where",pos:i}),h.where=!0}else if(/^GROUP$/i.test(E)){if(h.groupby!==void 0)continue;u.push({keyword:"groupby",pos:i}),h.groupby=!0}else if(/^ORDER$/i.test(E)){if(h.orderby!==void 0)continue;u.push({keyword:"orderby",pos:i}),h.orderby=!0}else if(/^LIMIT$/i.test(E)){if(h.limit!==void 0)continue;u.push({keyword:"limit",pos:i}),h.limit=!0}}}for(var re={},i=1;i<u.length;i++)re[u[i-1].keyword]=m.slice(u[i-1].pos,u[i].pos);return re[u[u.length-1].keyword]=m.slice(u[u.length-1].pos),re}function T(m){var u={},h=P.pickUp(m,",");h[0].shift();for(var y=0;y<h.length;y++){var c=h[y],i=null;/^(distinct|all|distinctrow)$/i.test(c[0].text)&&(c[0].text=c[0].text.toUpperCase(),i=c[0],c.shift());var E,$;c[c.length-1].type===V.types.KEYWORD||c[c.length-1].type===V.types.VARIABLE?($=c[c.length-1].text.indexOf("."))===-1?(E=c[c.length-1].text,c.length===1?u[E]={dist:i,expr:c}:/^as$/i.test(c[c.length-2].text)?u[E]={dist:i,expr:c.slice(0,c.length-2)}:u[E]={dist:i,expr:c.slice(0,c.length-1)}):(E=c[c.length-1].text.substr($+1),u[E]={dist:i,expr:c}):(E=P.merge(c,""),u[E]={dist:i,expr:c})}return u}M.parseColumn=T;function b(m){var u={},h=P.pickUp(m,",");h[0].shift();for(var y=0;y<h.length;y++){var c=P.parseOneSource(h[y]);u[c.name]={type:c.type,source:c.source}}return u}M.parseSource=b;function g(m){for(var u={},h=P.pickUp(m,"JOIN"),y=void 0,c=0;c<h.length;c++){var i=h[c];if(i.length===1){y=i[0].text.toUpperCase();continue}var E=y===void 0?"INNER JOIN":y+" JOIN",$,re,_;y=/^(LEFT|RIGHT|OUTER|INNER)$/i.test(i[i.length-1].text)?i.pop().text:void 0;for(var se=void 0,ee=0;ee<i.length;ee++)if(/^on$/i.test(i[ee].text)){se=ee;var ie=i.slice(0,ee),ce=P.parseOneSource(ie);_=ce.name,$=ce.type,re=ce.source;break}if(se===void 0)throw new Error("no keyword 'on' in join part");var r=[],le=se+1;i.push({text:"and",type:1});for(var ee=le;ee<i.length;ee++)if(/^and$/i.test(i[ee].text)){var te=i.slice(le,ee);r.push(P.parseOneWhere(te)),le=ee+1}u[_]={type:$,source:re,method:P.JOIN[E.toUpperCase()],where:r}}return u}M.parseJoinmap=g;function S(m){var u=[],h=P.pickUp(m,"and");return h[0].shift(),h.forEach(function(y){u.push(P.parseOneWhere(y))}),u}M.parseWhere=S;function L(m){var u=[],h=P.pickUp(m,",");return h[0].shift(),h[0].shift(),h.forEach(function(y){u.push(y)}),u}M.parseGroupby=L;function I(m){var u=[],h=P.pickUp(m,",");h[0].shift(),h[0].shift();for(var y=0;y<h.length;y++){var c=h[y],i,E=c[c.length-1].text.toUpperCase();/^(ASC|DESC)$/i.test(E)?(i=P.ORDER[E],c.pop()):i=P.ORDER.ASC,c.length!==0&&u.push({type:i,expr:c})}return u}M.parseOrderby=I;function a(m){var u=[],h=P.pickUp(m,",");h[0].shift();for(var y=0;y<h.length;y++){var c=h[y];if(c.length>=2)throw new Error("something wrong in 'limit' part");u.push(c[0])}return u.length===1&&u.unshift({text:0,type:2}),u}M.parseLimit=a,M.createObj=function(m){for(var u=[],h=V.create(m).getAll(),y=D(h),c=0;c<y.length;c++){var i={},E=F(y[c]),$=P.getHint(E.column,1);$&&(i.hint=$),E.column&&(i.column=T(E.column)),E.source&&(i.source=b(E.source)),E.joinmap&&(i.joinmap=g(E.joinmap)),E.where&&(i.where=S(E.where)),E.groupby&&(i.groupby=L(E.groupby)),E.orderby&&(i.orderby=I(E.orderby)),E.limit&&(i.limit=a(E.limit)),u.push(i)}return u}},91459:function(ye,M,t){var V=t(52107),P={"=":1,">":2,">=":3,"<":4,"<=":5,"<>":6,"!=":6,in:7,"not in":8,like:9,"not like":10,between:11,"is null":20,"not null":21};M.RELATE=P;var x={ASC:1,DESC:2};M.ORDER=x;var D={"INNER JOIN":1,"OUTER JOIN":2,"LEFT JOIN":3,"RIGHT JOIN":4};M.JOIN=D;function F(a){if(a[0]===void 0||a[0].text!=="(")return a;for(var m=0,u=0;u<a.length;u++)a[u].text==="("&&m++,a[u].text===")"&&m--;if(m===0&&a[a.length-1].text===")")return a.pop(),a.shift(),F(a);throw new Error("lack parenthese")}M.removeParenthese=F;function T(a,m){m=m===void 0?" ":m;for(var u="",h=0;h<a.length;h++)u+=a[h].text+m;return u.substr(0,u.length-m.length)}M.merge=T;function b(a,m){a.push({text:m});for(var u=[],h=0,y=0,c=0;c<a.length;c++)if(a[c].text==="("&&y++,a[c].text===")"&&y--,new RegExp("^"+m+"$","i").test(a[c].text)&&y===0){var i=a.slice(h,c);if(i.length===0){h=c+1;continue}u.push(i),h=c+1}return u}M.pickUp=b;function g(a,m){var u=void 0;if(a&&a[m]&&a[m].type===V.types.COMMENT){u=a[m];for(var h=a.slice(0,m),y=0;y<=m;y++)a.shift();for(;h.length>0;)a.unshift(h.pop())}return u}M.getHint=g;function S(a){var m,u,h,y,c=a[0].text.indexOf(".");if(u=a[0].text.substr(0,c),c===-1)if(a[0].text==="("){for(var i=1,E=1;E<a.length;E++)if(a[E].text==="("&&i++,a[E].text===")"&&i--,i===0){h=T(a.slice(1,E)," "),a=a.slice(E+1,a.length);break}}else h=a[0].text,a.shift();else if(c===a[0].text.length-1){if(a[1].text!=="(")throw new Error("something wrong in 'source' part");var i=0,E;for(E=1;E<a.length;E++)if(a[E].text==="("&&i++,a[E].text===")"&&i--,i===0){h=T(a.slice(2,E)," "),a=a.slice(E+1,a.length);break}if(E===a.length)throw new Error("lack parentheses in 'source' part")}else h=a[0].text.substr(c+1),a.shift();if(a.length===0)y={name:h,type:u,source:h};else{if(a.length>=3||a.length===2&&!/^as$/i.test(a[0].text)||a[a.length-1].type!==V.types.KEYWORD&&a[a.length-1].type!==V.types.VARIABLE)throw new Error("something wrong in 'source' part");y={name:a[a.length-1].text,type:u,source:h}}return y}M.parseOneSource=S;function L(a){var m={},u=a[1];if(m.column=a[0],!u)return m;if(u.type===V.types.OPERATOR){if(P[u.text]===void 0)throw new Error("unrecognized operator");m.relate=P[u.text],m.values=I(a.slice(2),",")}else if(u.text.toLowerCase()==="between")m.relate=P[u.text.toLowerCase()],m.values=I(a.slice(3,a.length-1),"and");else if(u.text.toLowerCase()==="in")m.relate=P[u.text.toLowerCase()],m.values=I(a.slice(3,a.length-1),",");else if(u.text.toLowerCase()==="like")m.relate=P[u.text.toLowerCase()],m.values=[[a[2]]];else if(u.text.toLowerCase()==="is")if(a[2].text.toLowerCase()==="not")m.relate=P["not null"],m.values=null;else if(a[2].text.toLowerCase()==="null")m.relate=P["is null"],m.values=null;else throw new Error('wrong key word after "is"');else if(u.text.toLowerCase()==="not")if(a[2].text.toLowerCase()==="in")m.relate=P["not in"],m.values=I(a.slice(4,a.length-1),",");else if(a[2].text.toLowerCase()==="like")m.relate=P["not like"],m.values=[[a[3]]];else throw new Error('wrong key word after "not"');else throw new Error("unrecognized relate");return m}M.parseOneWhere=L;function I(a,m){m=new RegExp(m,"i");var u=[],h=0,y=[];for(var c in a)m.test(a[c].text)?(u.push(y),y=[]):y.push(a[c]);return y.length!==0&&u.push(y),u}},33293:function(ye,M,t){var V=t(91459),P=t(52107),x={select:t(95430)};M.parse=function(D){D=D.trim();var F=D.substr(0,D.indexOf(" ")).toLowerCase();if(x[F]===void 0)throw new Error("Unsupport sentence");return x[F].createObj(D)},M.RELATE=V.RELATE,M.JOIN=V.JOIN,M.ORDER=V.ORDER,M.types=P.types},70163:function(ye,M,t){"use strict";t.d(M,{t:function(){return V}});var V=function(){var x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",F=function S(L,I,a,m){var u=-1,h=L[a]||0,y=I[a]||0;return h===y&&a+1<m?u=S(L,I,a+1,m):u=h-y,u},T=x.replace(/[a-zA-Z]/g,"").split(".").map(function(S){return parseInt(S,10)}),b=D.replace(/[a-zA-Z]/g,"").split(".").map(function(S){return parseInt(S,10)}),g=T.length>b.length?T:b;return F(T,b,0,g.length)}},46298:function(ye,M,t){"use strict";t.d(M,{Z:function(){return c}});var V=t(9083),P=t.n(V),x=t(2927),D=t.n(x),F=t(98404),T=t(44761),b=t(86957),g=t(44925),S=t(50205),L=t(8236),I=t(58168),a=t(33293),m=t(36422),u=new Map,h=new Map,y=function(E){var $=E.selectDB,re=E.mode,_=E.height,se=E.width,ee=E.name,ie=E.placeholder,ce=E.value,r=E.theme,le=E.onChange,te=E.tables,ge=(0,F.useRef)(null),d=function(){var j=te||[];h.set($,{});var N=j.map(function(U){var K={name:U.title,value:U.title,meta:U.chnname};return h.get($)[U.title]=U.fields.map(function(Y){return{name:Y.name,value:Y.name,meta:"".concat(Y.chnname,"(").concat(U.title,")"),remarks:Y.chnname,dataType:Y.dataType,notNull:Y.notNull,autoIncrement:Y.autoIncrement,defaultValue:Y.defaultValue,pk:Y.pk}}),K});u.set($,N)},J=function(j){var N=[];try{var U=a.parse(j),K=Object.entries(U[0].source);U[0].joinmap&&K.push.apply(K,D()(Object.entries(U[0].joinmap))),K.forEach(function(Y){var W=P()(Y,2),de=W[0],ae=W[1],De=ae.source,Ce=h.get($)[De];Ce&&N.push.apply(N,D()(Ce)),de!==De&&N.push({name:de,value:de,meta:De})})}catch(Y){}return N};return(0,F.useImperativeHandle)(E.onRef,function(){return{selectLine:function(){return ge.current.editor.selection.selectLine()},getEditor:function(){return ge.current.editor},getSelectValue:function(){return ge.current.editor.getSelectedText()},setSelectValue:function(j){return ge.current.editor.insert(j)},getDbTableFieldsMap:function(j){var N={},U=h.get($)[j];if(!U)return N;for(var K=0;K<U.length;K++){var Y=U[K];N[Y.name]=Y}return N}}}),u.get($)||d(),(0,F.useEffect)(function(){(0,S.addCompleter)({getCompletions:function(j,N,U,K,Y){var W=N.getTextRange({start:{row:U.row,column:0},end:{row:U.row,column:2e3}}).toLowerCase(),de=[];if(W.includes("select")&&W.includes("from")){de=J(W),Y(null,u.get($).concat(de));return}W=N.getTextRange({start:{row:0,column:0},end:{row:100,column:2e3}}),W=W.replace(/[\r\n]/g," ").replace(/\s{2,}/g," "),de=J(W),Y(null,u.get($).concat(de))}})},[]),(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(T.ZP,{ref:ge,width:se||"100%",height:_||"250px",mode:re||"sql",theme:r||"xcode",placeholder:ie||"",onChange:le,name:ee||"ace-editor",value:ce,editorProps:{$blockScrolling:!0},fontSize:"14px",showGutter:!0,highlightActiveLine:!0,showPrintMargin:!1,setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,wrap:!1}})})},c=F.memo(y)},15250:function(ye,M,t){"use strict";t.r(M),t.d(M,{default:function(){return bn}});var V=t(9083),P=t.n(V),x=t(98404),D=t(77662),F=t(60183),T=t.n(F),b=t(39346),g=t.n(b),S=t(2927),L=t.n(S),I=t(43953),a=t.n(I),m=t(91184),u=t.n(m),h=t(31777),y=t(44766),c=t.n(y),i=t(23759),E=t(29167),$=t(70163),re=t(1993),_=t(49967),se=t(20497),ee=t(61671),ie=t.n(ee),ce=t(7599),r=t(36422),le={DEFAULT:"lastVersion",CURRENT:"currentVersion",MULTI:"multiVersionCompare"},te=re.ZP.getState(),ge=(0,h.Z)(function(w,s){return{init:!0,currentVersion:{},currentVersionIndex:void 0,hasDB:!0,versions:[],messages:[],data:void 0,dbVersion:"0.0.0",changes:[],dbs:[],incrementVersionData:{},synchronous:{},fetch:function(){var v=u()(a()().mark(function o(e){var f,l;return a()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(te=re.ZP.getState(),!c().isEmpty((f=te)===null||f===void 0?void 0:f.project)){O.next=6;break}return O.next=4,te.fetch().then(function(C){var R=C==null?void 0:C.data;if(!e&&R){var H;s().dispatch.initDbs((H=R.project.projectJSON)===null||H===void 0||(H=H.profile)===null||H===void 0?void 0:H.dbs)}_.hisProjectLoad(e||s().dispatch.getCurrentDBData()).then(function(Z){if(Z){var B=Z.data;B?(s().dispatch.getDBVersion(),s().dispatch.checkBaseVersion(B),s().dispatch.getVersionMessage(B),w({changes:s().dispatch.calcChanges(B)})):i.ZP.error("\u83B7\u53D6\u7248\u672C\u4FE1\u606F\u5931\u8D25")}})});case 4:O.next=8;break;case 6:e||s().dispatch.initDbs((l=te.project.projectJSON)===null||l===void 0||(l=l.profile)===null||l===void 0?void 0:l.dbs),_.hisProjectLoad(e||s().dispatch.getCurrentDBData()).then(function(C){if(C){var R=C.data;R?(s().dispatch.getDBVersion(),s().dispatch.checkBaseVersion(R),s().dispatch.getVersionMessage(R),w({changes:s().dispatch.calcChanges(R)})):i.ZP.error("\u83B7\u53D6\u7248\u672C\u4FE1\u606F\u5931\u8D25")}});case 8:case"end":return O.stop()}},o)}));function n(o){return v.apply(this,arguments)}return n}(),dispatch:{compareStringArray:function(n,o,e,f){var l=[];return n.forEach(function(p){o.includes(p)||l.push({type:"index",name:"".concat(e,".").concat(f,".fields.").concat(p),opt:"update",changeData:"addField=>".concat(p)})}),o.forEach(function(p){n.includes(p)||l.push({type:"index",name:"".concat(e,".").concat(f,".fields.").concat(p),opt:"update",changeData:"deleteField=>".concat(p)})}),l},compareIndex:function(n,o,e){var f=[];return Object.keys(n).forEach(function(l){o[l]!==n[l]&&f.push({type:"index",name:"".concat(e.title,".").concat(n.name,".").concat(l),opt:"update",changeData:"".concat(o[l],"=>").concat(n[l])})}),f},compareIndexs:function(n,o){var e=[],f=n.indexs||[],l=o.indexs||[],p=l.map(function(C){return C.name}),O=f.map(function(C){return C.name});return f.forEach(function(C){if(!p.includes(C.name))e.push({type:"index",name:"".concat(n.title,".").concat(C.name),opt:"add"});else{var R=l.filter(function(B){return B.name===C.name})[0]||{};e.push.apply(e,L()(s().dispatch.compareIndex(c().omit(C,["fields"]),c().omit(R,["fields"]),n)));var H=R.fields||[],Z=C.fields||[];e.push.apply(e,L()(s().dispatch.compareStringArray(Z,H,n.title,C.name)))}}),l.forEach(function(C){O.includes(C.name)||e.push({type:"index",name:"".concat(n.title,".").concat(C.name),opt:"delete"})}),e},compareEntity:function(n,o){var e=[];return Object.keys(n).forEach(function(f){o[f]!==n[f]&&e.push({type:"entity",name:"".concat(n.title,".").concat(f),opt:"update",changeData:"".concat(o[f],"=>").concat(n[f])})}),e},compareField:function(n,o,e){var f=[];return Object.keys(n).forEach(function(l){l!=="typeName"&&l!=="dataType"&&o[l]!==n[l]&&f.push({type:"field",name:"".concat(e.title,".").concat(n.name,".").concat(l),opt:"update",changeData:"".concat(o[l],"=>").concat(n[l])})}),f},getAllTable:function(n){return(n.modules||[]).reduce(function(o,e){return o.concat(e.entities||[])},[])},calcChanges:function(n){var o=te.project.projectJSON,e=[],f=L()(n),l=f.sort(function(B,Q){return(0,$.t)(Q.version,B.version)})[0];if(l){var p=g()({},o),O={modules:c().get(l,"projectJSON.modules",[])},C=s().dispatch.getAllTable(p),R=s().dispatch.getAllTable(O),H=R.map(function(B){return B.title}),Z=C.map(function(B){return B.title});return C.forEach(function(B){if(H.includes(B.title)){var Q=R.filter(function(q){return q.title===B.title})[0]||{},ue=(Q.fields||[]).filter(function(q){return q.name}),fe=(B.fields||[]).filter(function(q){return q.name}),A=ue.map(function(q){return q.name}),G=fe.map(function(q){return q.name});fe.forEach(function(q){if(!A.includes(q.name))e.push({type:"field",name:"".concat(B.title,".").concat(q.name),opt:"add"});else{var Fe=ue.filter(function(Se){return Se.name===q.name})[0]||{},k=s().dispatch.compareField(q,Fe,B);e.push.apply(e,L()(k))}}),ue.forEach(function(q){G.includes(q.name)||e.push({type:"field",name:"".concat(B.title,".").concat(q.name),opt:"delete"})});var oe=s().dispatch.compareEntity(c().omit(B,["fields","indexs","headers"]),c().omit(Q,["fields","indexs"]));e.push.apply(e,L()(oe));var xe=s().dispatch.compareIndexs(B,Q);e.push.apply(e,L()(xe))}else e.push({type:"entity",name:B.title,opt:"add"})}),R.forEach(function(B){Z.includes(B.title)||e.push({type:"entity",name:B.title,opt:"delete"})}),e}return[]},getDBVersion:function(){return w((0,ce.ZP)(function(n){n.hasDB=!0;var o=s().dispatch.getCurrentDBData();o?_.dbversion(g()(g()({},o.properties),{},{dbKey:o.key})).then(function(e){e&&e.code===200?i.ZP.success("\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u83B7\u53D6\u6210\u529F"):i.ZP.error("\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u83B7\u53D6\u5931\u8D25"),w({dbVersion:e.code!==200?"":e.data})}).catch(function(){i.ZP.error("\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u83B7\u53D6\u5931\u8D25")}):(w({dbVersion:""}),i.ZP.warning((0,r.jsxs)(r.Fragment,{children:["\u83B7\u53D6\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u5931\u8D25,\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F,\u8BF7",(0,r.jsx)("a",{href:"/design/table/setting/db",children:"\u914D\u7F6E"}),"\u6216\u5207\u6362\u6570\u636E\u6E90\uFF01"]}),2),n.hasDB=!1)}))},checkBaseVersion:function(n){return w((0,ce.ZP)(function(o){n.some(function(e){return e.baseVersion})?o.init=!1:(i.ZP.warning("\u5F53\u524D\u6570\u636E\u6E90\u4E0D\u5B58\u5728\u57FA\u7EBF\u7248\u672C\uFF0C\u8BF7\u5148\u521D\u59CB\u5316\u57FA\u7EBF",2),o.init=!0)}))},getVersionMessage:function(n,o){var e=s(),f=e.versions,l=f===void 0?[]:f,p=[];Array.isArray(n)?p=n:n&&(p=o?[].concat(n):l.concat(n)),w({versions:p.map(function(O){return c().pick(O,["id","version","versionDesc","changes","versionDate","projectJSON","baseVersion"])}).sort(function(O,C){return(0,$.t)(C.version,O.version)})})},setState:function(n){c().assign(s(),n)},getCurrentDB:function(){var n=s().dispatch.getCurrentDBData();return n?n.name:""},getCurrentDBData:function(){var n;return(n=s().dbs)===null||n===void 0?void 0:n.filter(function(o){return o.defaultDB})[0]},dropVersionTable:function(){var n=s().dispatch.getCurrentDBData();n?_.rebaseline(g()(g()({},n),{},{dbKey:n.key,version:"0.0.0",versionDesc:"\u57FA\u7EBF\u7248\u672C\uFF0C\u65B0\u5EFA\u7248\u672C\u65F6\u8BF7\u52FF\u4F4E\u4E8E\u8BE5\u7248\u672C"})).then(function(o){o&&o.code===200?(i.ZP.success("\u521D\u59CB\u5316\u6570\u636E\u8868\u6210\u529F"),s().dispatch.getDBVersion()):i.ZP.error("\u521D\u59CB\u5316\u6570\u636E\u8868\u5931\u8D25")}).catch(function(o){i.ZP.error("\u521D\u59CB\u5316\u6570\u636E\u8868\u5931\u8D25\uFF1A".concat(o.message))}):(w({dbVersion:""}),i.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F\uFF0C\u8BF7\u5207\u6362\u5C1D\u8BD5\u6570\u636E\u6E90"))},setCurrentVersion:function(n,o){w({currentVersion:n,currentVersionIndex:o})},getOptName:function(n){var o="";switch(n){case"update":o="\u66F4\u65B0";break;case"add":o="\u65B0\u589E";break;case"delete":o="\u5220\u9664";break;default:o="\u672A\u77E5\u64CD\u4F5C";break}return o},getTypeName:function(n){var o="";switch(n){case"entity":o="\u8868";break;case"index":o="\u7D22\u5F15";break;case"field":o="\u5C5E\u6027";break;default:o="\u672A\u77E5\u7C7B\u578B";break}return o},constructorMessage:function(n){return n&&c().remove(n,function(o){var e=o.type==="field"&&o.opt==="update"&&o.changeData&&o.changeData.search("undefined=>")>-1;return e}),n.map(function(o){var e="".concat(s().dispatch.getOptName(o.opt),`
      `).concat(s().dispatch.getTypeName(o.type),"\u300C").concat(o.name,"\u300D");return o.changeData&&(e="".concat(e,"\u300C").concat(o.changeData,"\u300D")),g()(g()({},o),{},{message:e})})},showChanges:function(n,o,e,f){var l=c().get(te.project,"projectJSON"),p=s(),O=p.changes,C=p.init,R=p.currentVersionIndex,H=p.versions;(!e||!f)&&(e=s().currentVersion,f=R&&H[R+1]||e);var Z;if(n===le.CURRENT){var B;Z=L()(((B=e)===null||B===void 0?void 0:B.changes)||[])}else n===le.MULTI?Z=L()(o):Z=L()(O);Z&&c().remove(Z,function(k){var Se,X=(k==null?void 0:k.type)==="field"&&(k==null?void 0:k.opt)==="update"&&(k==null?void 0:k.changeData)&&(k==null||(Se=k.changeData)===null||Se===void 0?void 0:Se.search("undefined=>"))>-1;return X});var Q=c().get(te.project,"configJSON"),ue=g()({},(Q==null?void 0:Q.synchronous)||{upgradeType:"increment"});if(ue.upgradeType==="rebuild"){var fe=[],A=[];Z.forEach(function(k){k.type==="entity"?A.push(k):fe.push(k.name.split(".")[0])}),Z=L()(new Set(fe)).map(function(k){return{type:"entity",name:k,opt:"update"}}).concat(A)}else Z=Z.filter(function(k){return!(k.type==="entity"&&k.opt==="update")});var G;if(n===le.CURRENT){var oe;G=s().dispatch.constructorMessage(((oe=e)===null||oe===void 0?void 0:oe.changes)||[])}else n===le.MULTI?G=s().dispatch.constructorMessage(o||[]):G=s().dispatch.constructorMessage(O||[]);w({messages:G});var xe=s().dispatch.getCurrentDBData(),q=c().get(xe,"select","MYSQL"),Fe="";C?Fe=(0,se.U)(g()(g()({},l),{},{modules:(l==null?void 0:l.modules)||[]}),q):Fe=e.baseVersion?(0,se.U)(g()(g()({},l),{},{modules:e.projectJSON?e.projectJSON.modules:e.modules}),q):(0,se.I2)(g()(g()({},l),{},{modules:e.projectJSON?e.projectJSON.modules:e.modules}),Z,q,{modules:f.projectJSON?f.projectJSON.modules:f.modules}),w({data:Fe})},setChanges:function(n){w({changes:n})},checkVersionCount:function(n){var o=s(),e=o.dbVersion,f=o.versions,l=[];return e?l=f.filter(function(p){return(0,$.t)(p.version,e)>0}):l=f,l.filter(function(p){return p.version!==n.version}).some(function(p){return(0,$.t)(p.version,n.version)<=0})},execSQL:function(n,o,e,f,l){var p=s().dispatch.getCurrentDBData();p?E.Z.confirm({title:"\u540C\u6B65\u786E\u8BA4",content:"\u5143\u6570\u636E\u5373\u5C06\u540C\u6B65\u5230\u6570\u636E\u6E90\uFF0C\u540C\u6B65\u540E\u4E0D\u53EF\u64A4\u9500\uFF0C\u786E\u5B9A\u540C\u6B65\u5417\uFF1F",onOk:function(C){var R=function(){s().fetch(null),C&&C()};s().dispatch.generateSQL(p,o,n,e,R,l),f&&f()}}):(w({dbVersion:""}),i.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F\uFF0C\u8BF7\u5207\u6362\u5C1D\u8BD5\u6570\u636E\u6E90"),f&&f())},generateSQL:function(n,o,e,f,l,p){var O=s().dispatch.getCMD(f,p),C=c().get(te.project,"projectJSON");if(n){var R={version:void 0,versionDesc:void 0,sql:void 0,separator:void 0};if(f&&(R.versionDesc=o.versionDesc,R.version=o.version),!p){var H=c().get(C,"profile.sqlConfig","/*SQL@Run*/");R.sql=e,R.separator=H}s().dispatch.connectJDBC(g()(g()(g()({},n.properties),R),{},{dbKey:n.key,showModal:!0}),O,function(Z){l&&l(),w({synchronous:T()({},o.version,!1)})},O)}},getCMD:function(n,o){var e="dbsync";return o?e="updateVersion":n?e="dbsync":e="sqlexec",e},connectJDBC:function(n,o,e){_[o](n).then(function(f){f.code===200?(e&&e(),E.Z.success({title:"\u540C\u6B65\u6210\u529F",content:f.data})):E.Z.warn({title:"\u540C\u6B65\u5931\u8D25",content:f.msg})}).catch(function(f){i.ZP.error("\u540C\u6B65\u5931\u8D25:".concat(f.message))})},updateVersionData:function(n,o,e){if(e==="update"){var f=s().dispatch.getCurrentDBData();_.hisProjectSave(g()(g()({},n),{},{dbKey:f.key})).then(function(l){l.code===200?i.ZP.success("\u7248\u672C\u4FE1\u606F\u66F4\u65B0\u6210\u529F"):i.ZP.error("\u7248\u672C\u4FE1\u606F\u66F4\u65B0\u5931\u8D25")}).catch(function(l){i.ZP.error("\u7248\u672C\u4FE1\u606F\u66F4\u65B0\u5931\u8D25".concat(l.message))}).finally(function(){w({versions:s().versions.map(function(l,p){return p===s().currentVersionIndex?n:l})})})}else _.hisProjectDelete(n.id).then(function(l){if(l.code===200){i.ZP.success("\u7248\u672C\u4FE1\u606F\u5220\u9664\u6210\u529F");var p=s().versions.filter(function(O){return O.id!==n.id});w({changes:s().dispatch.calcChanges(p),versions:p}),s().dispatch.checkBaseVersion(p)}}).catch(function(l){i.ZP.error("\u7248\u672C\u4FE1\u606F\u5220\u9664\u5931\u8D25".concat(l.message))});s().fetch(null)},readDb:function(n,o,e){var f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],l=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0;if(!n){var O=s().dispatch.getCurrentDBData();if(!O)i.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F\uFF0C\u8BF7\u5C1D\u8BD5\u5207\u6362\u6570\u636E\u6E90\uFF0C\u5E76\u68C0\u67E5\u662F\u5426\u5DF2\u7ECF\u914D\u7F6E\u6570\u636E\u6E90\u4FE1\u606F\uFF01");else{var C=!1;l||(C=s().dispatch.checkVersionCount(o)),C?i.ZP.error("\u5F53\u524D\u64CD\u4F5C\u7684\u7248\u672C\u4E4B\u524D\u8FD8\u6709\u7248\u672C\u5C1A\u672A\u540C\u6B65\uFF0C\u8BF7\u4E0D\u8981\u8DE8\u7248\u672C\u64CD\u4F5C!"):E.Z.confirm({title:"\u540C\u6B65\u786E\u8BA4",content:"\u5143\u6570\u636E\u5373\u5C06\u540C\u6B65\u5230\u6570\u636E\u6E90\uFF0C\u540C\u6B65\u540E\u4E0D\u53EF\u64A4\u9500\uFF0C\u786E\u5B9A\u540C\u6B65\u5417\uFF1F",onOk:function(H){c().set(s().synchronous,"".concat(o.version),!0),H&&H();var Z=c().get(te.project,"configJSON"),B=g()({},(Z==null?void 0:Z.synchronous)||{upgradeType:"increment"}),Q="";if(l)Q=(0,se.U)(g()(g()({},c().get(te.project,"projectJSON")),{},{modules:o.projectJSON.modules}),c().get(O,"select","MYSQL"));else{var ue=L()(f);if(B.upgradeType==="rebuild"){var fe=[],A=[];ue.forEach(function(G){G.type==="entity"?A.push(G):fe.push(G.name.split(".")[0])}),ue=L()(new Set(fe)).map(function(G){return{type:"entity",name:G,opt:"update"}}).concat(A)}else ue=ue.filter(function(G){return!(G.type==="entity"&&G.opt==="update")});Q=(0,se.I2)(g()(g()({},c().get(te.project,"projectJSON")),{},{modules:o.projectJSON.modules}),ue,c().get(O,"select","MYSQL"),e.projectJSON)}s().dispatch.generateSQL(O,o,Q,p,function(){return s().fetch(null)})}})}}},saveNewVersion:function(n){var o=s().dispatch.calcChanges(s().versions);if(!n.version||!n.versionDesc)i.ZP.error("\u7248\u672C\u53F7\u548C\u7248\u672C\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");else if(s().versions.map(function(p){return p.version}).includes(n.version))i.ZP.error("\u8BE5\u7248\u672C\u53F7\u5DF2\u7ECF\u5B58\u5728\u4E86");else if(s().versions[0]&&(0,$.t)(n.version,s().versions[0].version)<=0)i.ZP.error("\u65B0\u7248\u672C\u4E0D\u80FD\u5C0F\u4E8E\u6216\u7B49\u4E8E\u5DF2\u7ECF\u5B58\u5728\u7684\u7248\u672C");else{var e,f=s().dispatch.getCurrentDBData(),l={projectJSON:{modules:((e=te.project)===null||e===void 0||(e=e.projectJSON)===null||e===void 0?void 0:e.modules)||[]},dbKey:f.key,baseVersion:!1,version:n.version,versionDesc:n.versionDesc,changes:o,versionDate:ie()().format("YYYY/M/D H:m:s")};_.hisProjectSave(l).then(function(p){p&&p.code===200?(s().dispatch.getVersionMessage(p.data),w({changes:[]}),i.ZP.success("\u5F53\u524D\u7248\u672C\u4FDD\u5B58\u6210\u529F")):i.ZP.error("\u5F53\u524D\u7248\u672C\u4FDD\u5B58\u5931\u8D25")}).catch(function(p){i.ZP.error("\u5F53\u524D\u7248\u672C\u4FDD\u5B58\u5931\u8D25:".concat(p.message))})}},rebuild:function(n){E.Z.confirm({title:"\u91CD\u5EFA\u57FA\u7EBF",content:"\u91CD\u5EFA\u57FA\u7EBF\u5C06\u4F1A\u6E05\u9664\u5F53\u524D\u9879\u76EE\u7684\u6240\u6709\u7248\u672C\u4FE1\u606F\uFF0C\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",onOk:function(){s().dispatch.initBase(n,"\u91CD\u5EFA\u57FA\u7EBF\u6210\u529F")}})},initBase:function(n,o){if(!n.version||!n.versionDesc)i.ZP.error("\u7248\u672C\u53F7\u548C\u7248\u672C\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");else{var e,f=s().dispatch.getCurrentDBData(),l=(e=te)===null||e===void 0||(e=e.project)===null||e===void 0||(e=e.projectJSON)===null||e===void 0?void 0:e.modules,p={projectJSON:{modules:l||[]},dbKey:f.key,baseVersion:!0,version:n.version,versionDesc:n.versionDesc,changes:s().dispatch.calcChanges(s().versions),versionDate:ie()().format("YYYY/M/D H:m:s")};o?_.hisProjectDeleteAll(f.key).then(function(O){O.code===200?s().dispatch.initSave(p,o):i.ZP.error("\u91CD\u5EFA\u57FA\u7EBF\u5931\u8D25")}).catch(function(O){i.ZP.error("\u91CD\u5EFA\u57FA\u7EBF\u5931\u8D25:".concat(O.message))}):s().dispatch.initSave(p,o)}},initSave:function(n,o){_.hisProjectSave(n).then(function(e){e?(i.ZP.success(o||"\u521D\u59CB\u5316\u57FA\u7EBF\u6210\u529F"),s().dispatch.getVersionMessage(e.data,!0),w({changes:s().dispatch.calcChanges(s().versions),init:!1,versions:e.data}),s().dispatch.dropVersionTable()):i.ZP.error("\u64CD\u4F5C\u5931\u8D25\uFF01")}).catch(function(e){i.ZP.error("\u64CD\u4F5C\u5931\u8D25\uFF01 ".concat(e.message))})},initDbs:function(n){return w((0,ce.ZP)(function(o){o.dbs=n||[]}))},dbChange:function(n){w({dbs:s().dbs.map(function(o){return o.name===n.name?g()(g()({},o),{},{defaultDB:!0}):g()(g()({},o),{},{defaultDB:!1})})}),s().fetch(n)},resolveDb:function(){return w((0,ce.ZP)(function(n){n.hasDB=n.dbs&&n.dbs.length>0}))},compare:function(n){if(s().versions.length>1&&(!n.initVersion||!n.incrementVersion)&&i.ZP.warning("\u8BF7\u9009\u62E9\u4F60\u8981\u6BD4\u8F83\u7684\u4E24\u4E2A\u7248\u672C"),(0,$.t)(n.incrementVersion,n.initVersion)<=0)i.ZP.warning("\u589E\u91CF\u811A\u672C\u7684\u7248\u672C\u53F7\u4E0D\u80FD\u5C0F\u4E8E\u6216\u7B49\u4E8E\u521D\u59CB\u7248\u672C\u7684\u7248\u672C\u53F7");else{var o={},e={};s().versions.forEach(function(l){l.version===n.initVersion&&(e={modules:l.projectJSON.modules}),l.version===n.incrementVersion&&(o={modules:l.projectJSON.modules})});var f=s().dispatch.checkVersionData(o,e);s().dispatch.showChanges(le.MULTI,f,o,e),w({incrementVersionData:o})}},checkVersionData:function(n,o){var e=[],f=s().dispatch.getAllTable(n),l=s().dispatch.getAllTable(o),p=l.map(function(C){return C.title}),O=f.map(function(C){return C.title});return f.forEach(function(C){if(p.includes(C.title)){var R=l.filter(function(A){return A.title===C.title})[0]||{},H=(R.fields||[]).filter(function(A){return A.name}),Z=(C.fields||[]).filter(function(A){return A.name}),B=H.map(function(A){return A.name}),Q=Z.map(function(A){return A.name});Z.forEach(function(A){if(!B.includes(A.name))e.push({type:"field",name:"".concat(C.title,".").concat(A.name),opt:"add"});else{var G=H.filter(function(xe){return xe.name===A.name})[0]||{},oe=s().dispatch.compareField(A,G,C);e.push.apply(e,L()(oe))}}),H.forEach(function(A){Q.includes(A.name)||e.push({type:"field",name:"".concat(C.title,".").concat(A.name),opt:"delete"})});var ue=s().dispatch.compareEntity(c().omit(C,["fields","indexs","headers"]),c().omit(R,["fields","indexs"]));e.push.apply(e,L()(ue));var fe=s().dispatch.compareIndexs(C,R);e.push.apply(e,L()(fe))}else e.push({type:"entity",name:C.title,opt:"add"})}),l.forEach(function(C){O.includes(C.title)||e.push({type:"entity",name:C.title,opt:"delete"})}),e}}}});re.ZP.subscribe(function(w){var s;return(s=w.project)===null||s===void 0||(s=s.projectJSON)===null||s===void 0||(s=s.profile)===null||s===void 0?void 0:s.dbs},function(w,s){ge.getState().dispatch.initDbs(w),ge.getState().dispatch.resolveDb()});var d=ge,J=t(15122),z=t(64210),j=t(24765),N=t(15241),U=t(63356),K=t(4341),Y=t(12125),W=t(27789),de=t(34843),ae=t(20576),De=function(s,v){return x.createElement(ae.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:de.Z}))};De.displayName="InfoCircleOutlined";var Ce=x.forwardRef(De),ne=t(62656),Pe=function(s){var v=d(function(e){return{init:e.init,versionDispatch:e.dispatch}},D.Z),n=v.init,o=v.versionDispatch;return(0,x.useEffect)(function(){return function(){}}),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(U.Y,{title:"\u65B0\u589E\u7248\u672C",onFinish:function(){var e=u()(a()().mark(function f(l){var p;return a()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return p={version:l.version,versionDesc:l.versionDesc},o.saveNewVersion(p),C.abrupt("return",!0);case 3:case"end":return C.stop()}},f)}));return function(f){return e.apply(this,arguments)}}(),trigger:s.trigger==="bp"?(0,r.jsx)(ne.ZP,{type:"primary",disabled:n,children:"\u65B0\u589E\u7248\u672C"},"artifact"):(0,r.jsx)(ne.ZP,{type:"primary",disabled:n,title:n?"\u672A\u914D\u7F6E\u6570\u636E\u6E90\u4E0D\u80FD\u65B0\u589E\u7248\u672C":"",icon:n?(0,r.jsx)(Ce,{}):"",children:"\u65B0\u589E\u7248\u672C"}),children:[(0,r.jsx)(K.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u53F7",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}}),(0,r.jsx)(Y.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u63CF\u8FF0",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},je=x.memo(Pe),Ee=t(2360),Ve=t(65581),Ae=function(s){var v=(0,re.ZP)(function(e){var f;return{upgradeType:(f=e.project)===null||f===void 0||(f=f.configJSON)===null||f===void 0||(f=f.synchronous)===null||f===void 0?void 0:f.upgradeType,projectDispatch:e.dispatch}},D.Z),n=v.upgradeType,o=v.projectDispatch;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(U.Y,{title:(0,r.jsxs)("span",{children:["\u540C\u6B65\u914D\u7F6E",(0,r.jsx)("span",{style:{color:"red"},children:"\uFF08\u914D\u7F6E\u6210\u529F\u540E\uFF0C\u540E\u7EED\u7684\u540C\u6B65\u7684\u64CD\u4F5C\u90FD\u4F7F\u7528\u8BE5\u914D\u7F6E\uFF0C\u4EC5\u5EFA\u8BAE\u9879\u76EE\u521D\u59CB\u5316\u4E4B\u540E\u8BBE\u7F6E\u4E00\u6B21\uFF0C\u4EE5\u540E\u4E0D\u8981\u53D8\u52A8\uFF0C\u514D\u5F97\u51FA\u73B0\u7248\u672C\u6DF7\u4E71\uFF09"})]}),trigger:(0,r.jsx)(ne.ZP,{type:"primary",children:"\u540C\u6B65\u914D\u7F6E"},"refresh"),onFinish:function(){var e=u()(a()().mark(function f(l){return a()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,o.setUpgradeType(l);case 2:return O.abrupt("return",!0);case 3:case"end":return O.stop()}},f)}));return function(f){return e.apply(this,arguments)}}(),children:(0,r.jsx)(Ee.A.Group,{children:(0,r.jsx)(Ve.Z.Group,{name:"upgradeType",label:"\u6570\u636E\u8868\u5347\u7EA7\u65B9\u5F0F",initialValue:n,options:[{label:"\u5B57\u6BB5\u589E\u91CF",value:"increment"},{label:"\u91CD\u5EFA\u6570\u636E\u8868",value:"rebuild"}]})})})})},Te=x.memo(Ae),Re=function(s){var v=d(function(p){return{hasDB:p.hasDB,init:p.init,versionDispatch:p.dispatch}},D.Z),n=v.hasDB,o=v.init,e=v.versionDispatch,f=(0,re.ZP)(function(p){var O;return{projectJSON:(O=p.project)===null||O===void 0?void 0:O.projectJSON}},D.Z),l=f.projectJSON;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(U.Y,{title:"\u521D\u59CB\u5316\u57FA\u7EBF",trigger:(0,r.jsx)(ne.ZP,{type:"primary",disabled:!n||!o,children:"\u521D\u59CB\u5316\u57FA\u7EBF"},"selection"),onFinish:function(){var p=u()(a()().mark(function O(C){var R,H;return a()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(R=e.getCurrentDBData(),R){B.next=4;break}return i.ZP.warning("\u672A\u914D\u7F6E\u6570\u636E\u5E93\u6E90\uFF0C\u8BF7\u5148\u914D\u7F6E\u6570\u636E\u6E90\uFF01"),B.abrupt("return",!1);case 4:return H={projectJSON:{modules:l.modules||[]},dbKey:R.key||"",baseVersion:!0,version:C.version,versionDesc:C.versionDesc,changes:[],versionDate:ie()().format("YYYY/M/D H:m:s")},_.hisProjectSave(H).then(function(Q){Q.code===200?(i.ZP.success("\u521D\u59CB\u5316\u57FA\u7EBF\u6210\u529F"),e.getVersionMessage(Q.data,!0),e.setState({changes:[],init:!1,versions:Q.data}),e.dropVersionTable()):i.ZP.error("\u64CD\u4F5C\u5931\u8D25\uFF01")}).catch(function(Q){i.ZP.error("\u64CD\u4F5C\u5931\u8D25:".concat(Q.message))}),B.abrupt("return",!0);case 7:case"end":return B.stop()}},O)}));return function(O){return p.apply(this,arguments)}}(),children:[(0,r.jsx)(K.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u4F8B\u5982\uFF1A1.0.0\u300C\u8BF7\u52FF\u4F4E\u4E8E\u7CFB\u7EDF\u9ED8\u8BA4\u7684\u6570\u636E\u6E90\u7248\u672C0.0.0\u300D",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 200 \u4E2A\u5B57\u7B26"}]}}),(0,r.jsx)(Y.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"'\u4F8B\u5982\uFF1A\u521D\u59CB\u5316\u5F53\u524D\u9879\u76EE\u7248\u672C",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},Ze=x.memo(Re),$e=function(s){var v=d(function(e){return{init:e.init,versionDispatch:e.dispatch}},D.Z),n=v.init,o=v.versionDispatch;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(U.Y,{title:(0,r.jsxs)("span",{children:["\u91CD\u5EFA\u57FA\u7EBF",(0,r.jsx)("span",{style:{color:"red"},children:"\uFF08\u91CD\u5EFA\u57FA\u7EBF\u5C06\u4F1A\u6E05\u9664\u5F53\u524D\u9879\u76EE\u7684\u6240\u6709\u7248\u672C\u4FE1\u606F\uFF0C\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF09"})]}),onFinish:function(){var e=u()(a()().mark(function f(l){var p;return a()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return p={version:l.version,versionDesc:l.versionDesc},o.rebuild(p),C.abrupt("return",!0);case 3:case"end":return C.stop()}},f)}));return function(f){return e.apply(this,arguments)}}(),trigger:(0,r.jsx)(ne.ZP,{type:"primary",disabled:n,children:"\u91CD\u5EFA\u57FA\u7EBF"},"undo"),children:[(0,r.jsx)(K.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u4F8B\u5982\uFF1A1.0.0\u300C\u8BF7\u52FF\u4F4E\u4E8E\u7CFB\u7EDF\u9ED8\u8BA4\u7684\u6570\u636E\u6E90\u7248\u672C0.0.0\u300D",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 200 \u4E2A\u5B57\u7B26"}]}}),(0,r.jsx)(Y.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"'\u4F8B\u5982\uFF1A\u521D\u59CB\u5316\u5F53\u524D\u9879\u76EE\u7248\u672C",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},he=x.memo($e),Ie=t(27856),Ue=t(31398),Oe=t(66205),Je=t(46298),Ne=t(11958),We={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M448 224a64 64 0 10128 0 64 64 0 10-128 0zm96 168h-64c-4.4 0-8 3.6-8 8v464c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V400c0-4.4-3.6-8-8-8z"}}]},name:"info",theme:"outlined"},ze=We,Be=function(s,v){return x.createElement(ae.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:ze}))};Be.displayName="InfoOutlined";var He=x.forwardRef(Be),Me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M476 399.1c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1V484h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H420v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V540h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H476v-84.9zM560.5 704h-225c-4.1 0-7.5 3.2-7.5 7v42c0 3.8 3.4 7 7.5 7h225c4.1 0 7.5-3.2 7.5-7v-42c0-3.8-3.4-7-7.5-7zm-7.1-502.6c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v704c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32V397.3c0-8.5-3.4-16.6-9.4-22.6L553.4 201.4zM664 888H232V264h282.2L664 413.8V888zm190.2-581.4L611.3 72.9c-6-5.7-13.9-8.9-22.2-8.9H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h277l219 210.6V824c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V329.6c0-8.7-3.5-17-9.8-23z"}}]},name:"diff",theme:"outlined"},be=Me,Ke=function(s,v){return x.createElement(ae.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:be}))};Ke.displayName="DiffOutlined";var _e=x.forwardRef(Ke),pe=t(53631),we={DETAIL:"detail",COMPARE:"compare"},en=function(s){var v=d(function(X){return{messages:X.messages,data:X.data,versions:X.versions,currentVersion:X.currentVersion,dbVersion:X.dbVersion,versionDispatch:X.dispatch}},D.Z),n=v.currentVersion,o=v.dbVersion,e=v.messages,f=v.data,l=v.versions,p=v.versionDispatch,O=document.body.clientHeight,C=O-25,R=(0,x.useState)({initVersion:l[1]&&l[1].version||"",incrementVersion:l[0]&&l[0].version||"",incrementVersionData:{},again:!1,synchronous:!1,preSynchronous:!1,flagSynchronous:!1}),H=P()(R,2),Z=H[0],B=H[1],Q=(0,pe.md)(),ue=(0,x.useState)(1),fe=P()(ue,2),A=fe[0],G=fe[1];(0,x.useEffect)(function(){p.compare(Z)},[Z.initVersion,Z.incrementVersion,A]);var oe=l.map(function(X){return{label:X.version,value:X.version}}),xe=function(me,ve){B(g()(g()({},Z),{},T()({},ve,me)))},q=function(){Ne.a1(f,"".concat(ie()().format("YYYY-MM-D-h-mm-ss"),".sql"))},Fe=function(me,ve){var Le=p.checkVersionCount(n);if(Le)i.ZP.error("\u5F53\u524D\u64CD\u4F5C\u7684\u7248\u672C\u4E4B\u524D\u8FD8\u6709\u7248\u672C\u5C1A\u672A\u540C\u6B65\uFF0C\u8BF7\u4E0D\u8981\u8DE8\u7248\u672C\u64CD\u4F5C!");else{var qe=ve;B(g()(g()({},Z),{},T()({},qe,!0)));try{p.execSQL(f,n,me,null,ve==="flagSynchronous"),G(A+1)}finally{B(g()(g()({},Z),{},T()({},qe,!1)))}}},k=s.type===we.DETAIL,Se=s.type===we.COMPARE;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(U.Y,{title:k?"\u7248\u672C\u53D8\u66F4\u8BE6\u60C5":"\u4EFB\u610F\u7248\u672C\u6BD4\u8F83",layout:"horizontal",trigger:(0,r.jsx)(ne.ZP,{size:"small",type:"link",icon:k?(0,r.jsx)(He,{}):(0,r.jsx)(_e,{}),onClick:function(){return k?p.showChanges(le.CURRENT,null,null,null):p.compare(Z)},children:k?"\u7248\u672C\u53D8\u66F4\u8BE6\u60C5":"\u4EFB\u610F\u7248\u672C\u6BD4\u8F83"},"compare"),submitter:{render:function(me,ve){return[(0,r.jsx)(ne.ZP,{onClick:q,children:"\u5BFC\u51FA\u5230\u6587\u4EF6"},"save"),(0,r.jsx)(pe.Nv,{accessible:Q.canErdConnectorDbsync,fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(ne.ZP,{loading:Z.synchronous,title:"\u4F1A\u66F4\u65B0\u6570\u636E\u6E90\u4E2D\u7684\u7248\u672C\u53F7",style:{display:k&&n.version&&(0,$.t)(n.version,o)>0?"":"none"},onClick:function(){return Fe(!0,"synchronous")},children:Z.synchronous?"\u6B63\u5728\u540C\u6B65":"\u540C\u6B65\u5230\u6570\u636E\u6E90"})}),(0,r.jsx)(pe.Nv,{accessible:Q.canErdConnectorDbsync,fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(ne.ZP,{loading:Z.flagSynchronous,title:"\u66F4\u65B0\u6570\u636E\u6E90\u7684\u7248\u672C\u53F7\uFF0C\u4E0D\u4F1A\u6267\u884C\u5DEE\u5F02\u5316\u7684SQL",style:{display:k&&n.version&&(0,$.t)(n.version,o)>0?"":"none"},onClick:function(){return Fe(!0,"flagSynchronous")},children:Z.flagSynchronous?"\u6B63\u5728\u6807\u8BB0\u4E3A\u540C\u6B65":"\u6807\u8BB0\u4E3A\u540C\u6B65"})}),(0,r.jsx)(pe.Nv,{accessible:Q.canErdConnectorDbsync,fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(ne.ZP,{loading:Z.again,title:"\u4E0D\u4F1A\u66F4\u65B0\u6570\u636E\u6E90\u4E2D\u7684\u7248\u672C\u53F7",style:{display:k&&n.version&&(0,$.t)(n.version,o)<=0?"":"none",marginLeft:10},onClick:function(){return Fe(!1,"again")},children:Z.again?"\u6B63\u5728\u6267\u884C":"\u518D\u6B21\u6267\u884C"})})]}},children:[(0,r.jsxs)(Ee.A.Group,{style:{display:Se?"":"none"},children:[(0,r.jsx)(Ie.Z,{fieldProps:{onChange:function(me){xe(me,"initVersion")}},request:u()(a()().mark(function X(){return a()().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return ve.abrupt("return",oe||[]);case 1:case"end":return ve.stop()}},X)})),name:"initVersion",initialValue:Z.initVersion,label:"\u521D\u59CB\u7248\u672C"}),(0,r.jsx)(Ie.Z,{fieldProps:{onChange:function(me){xe(me,"incrementVersion")}},request:u()(a()().mark(function X(){return a()().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return ve.abrupt("return",oe||[]);case 1:case"end":return ve.stop()}},X)})),name:"incrementVersion",initialValue:Z.incrementVersion,label:"\u589E\u91CF\u7248\u672C"})]}),(0,r.jsx)(Ue.Z,{}),(0,r.jsxs)(Oe.ZP,{container:!0,spacing:2,children:[(0,r.jsx)(Oe.ZP,{item:!0,xs:4,children:"\u53D8\u5316\u4FE1\u606F"}),(0,r.jsx)(Oe.ZP,{item:!0,xs:8,children:n?"\u53D8\u5316\u811A\u672C(".concat((0,$.t)(n.version,o)<=0?"\u5DF2\u540C\u6B65":"\u672A\u540C\u6B65",")"):"\u53D8\u5316\u811A\u672C"}),(0,r.jsx)(Oe.ZP,{item:!0,xs:4,style:{height:"450px",overflowY:"auto"},children:e.length>0?c().sortBy(e,["opt","type"]).map(function(X,me){return(0,r.jsx)("div",{children:"".concat(me+1,": ").concat(X.message)},X.message)}):"".concat(f?"\u5F53\u524D\u811A\u672C\u4E3A\u5168\u91CF\u811A\u672C":"\u5F53\u524D\u7248\u672C\u65E0\u53D8\u5316")}),(0,r.jsx)(Oe.ZP,{item:!0,xs:8,children:(0,r.jsx)(Je.Z,{mode:"mysql",height:"".concat(C*.5,"px"),value:f})})]})]})})},Ye=x.memo(en),nn=t(88254),rn=function(s){var v=d(function(l){return{currentVersionIndex:l.currentVersionIndex,currentVersion:l.currentVersion,versions:l.versions,versionDispatch:l.dispatch}},D.Z),n=v.currentVersionIndex,o=v.currentVersion,e=v.versions,f=v.versionDispatch;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(U.Y,{title:"\u7F16\u8F91\u7248\u672C",onFinish:function(){var l=u()(a()().mark(function p(O){var C,R;return a()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return C=g()(g()({},o),{},{version:O.version,versionDesc:O.versionDesc}),R=e.slice(1),n!==0?f.updateVersionData(C,o,"update"):R.map(function(B){return B.version}).includes(C.version)?i.ZP.error("\u8BE5\u7248\u672C\u53F7\u5DF2\u7ECF\u5B58\u5728\u4E86"):R[0]&&(0,$.t)(C.version,R[0].version)<=0?i.ZP.error("\u65B0\u7248\u672C\u4E0D\u80FD\u5C0F\u4E8E\u6216\u7B49\u4E8E\u5DF2\u7ECF\u5B58\u5728\u7684\u7248\u672C"):f.updateVersionData(C,o,"update"),Z.abrupt("return",!0);case 4:case"end":return Z.stop()}},p)}));return function(p){return l.apply(this,arguments)}}(),trigger:(0,r.jsx)(ne.ZP,{size:"small",type:"link",icon:(0,r.jsx)(nn.Z,{}),children:"\u7F16\u8F91\u7248\u672C"},"editor"),request:function(){var l=u()(a()().mark(function p(O){return a()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.abrupt("return",o);case 1:case"end":return R.stop()}},p)}));return function(p){return l.apply(this,arguments)}}(),children:[(0,r.jsx)(K.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u53F7",readonly:n!==0,formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}}),(0,r.jsx)(Y.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u63CF\u8FF0",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},tn=x.memo(rn),on=t(31117),an=t(70198),sn=function(s){var v=d(function(e){return{currentVersionIndex:e.currentVersionIndex,currentVersion:e.currentVersion,versions:e.versions,versionDispatch:e.dispatch}},D.Z),n=v.currentVersion,o=v.versionDispatch;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(on.Z,{placement:"right",title:"\u5220\u9664\u7248\u672C[".concat(n.version,"]"),onConfirm:function(){return o.updateVersionData(n,n,"delete")},okText:"\u662F",cancelText:"\u5426",children:(0,r.jsx)(ne.ZP,{size:"small",type:"link",icon:(0,r.jsx)(an.Z,{}),children:"\u5220\u9664\u7248\u672C"},"delete")})})},un=x.memo(sn),cn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M704 446H320c-4.4 0-8 3.6-8 8v402c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8V454c0-4.4-3.6-8-8-8zm-328 64h272v117H376V510zm272 290H376V683h272v117z"}},{tag:"path",attrs:{d:"M424 748a32 32 0 1064 0 32 32 0 10-64 0zm0-178a32 32 0 1064 0 32 32 0 10-64 0z"}},{tag:"path",attrs:{d:"M811.4 368.9C765.6 248 648.9 162 512.2 162S258.8 247.9 213 368.8C126.9 391.5 63.5 470.2 64 563.6 64.6 668 145.6 752.9 247.6 762c4.7.4 8.7-3.3 8.7-8v-60.4c0-4-3-7.4-7-7.9-27-3.4-52.5-15.2-72.1-34.5-24-23.5-37.2-55.1-37.2-88.6 0-28 9.1-54.4 26.2-76.4 16.7-21.4 40.2-36.9 66.1-43.7l37.9-10 13.9-36.7c8.6-22.8 20.6-44.2 35.7-63.5 14.9-19.2 32.6-36 52.4-50 41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.3c19.9 14 37.5 30.8 52.4 50 15.1 19.3 27.1 40.7 35.7 63.5l13.8 36.6 37.8 10c54.2 14.4 92.1 63.7 92.1 120 0 33.6-13.2 65.1-37.2 88.6-19.5 19.2-44.9 31.1-71.9 34.5-4 .5-6.9 3.9-6.9 7.9V754c0 4.7 4.1 8.4 8.8 8 101.7-9.2 182.5-94 183.2-198.2.6-93.4-62.7-172.1-148.6-194.9z"}}]},name:"cloud-server",theme:"outlined"},ln=cn,ke=function(s,v){return x.createElement(ae.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:ln}))};ke.displayName="CloudServerOutlined";var dn=x.forwardRef(ke),fn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},vn=fn,Ge=function(s,v){return x.createElement(ae.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:vn}))};Ge.displayName="CloudUploadOutlined";var hn=x.forwardRef(Ge),pn=function(s){var v=d(function(p){return{currentVersionIndex:p.currentVersionIndex,currentVersion:p.currentVersion,synchronous:p.synchronous,versions:p.versions,dbVersion:p.dbVersion,versionDispatch:p.dispatch}},D.Z),n=v.currentVersionIndex,o=v.currentVersion,e=v.versions,f=v.dbVersion,l=v.versionDispatch;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(ne.ZP,{icon:s.synced?(0,r.jsx)(dn,{}):(0,r.jsx)(hn,{}),type:"link",size:"small",disabled:s.synced,onClick:function(){l.readDb(s.synced,o,n&&e[n+1]||o,o.changes,n===e.length-1,!0)},children:"\u540C\u6B65\u5230\u6570\u636E\u6E90"},"sync")})},mn=x.memo(pn),gn=t(59833),Qe=function(s,v){return x.createElement(ae.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:gn.Z}))};Qe.displayName="WarningFilled";var Cn=x.forwardRef(Qe),En=t(16762),Xe=function(s,v){return x.createElement(ae.Z,(0,W.Z)((0,W.Z)({},s),{},{ref:v,icon:En.Z}))};Xe.displayName="CheckCircleFilled";var yn=x.forwardRef(Xe),Dn=J.Z.Option,xn=J.Z.OptGroup,Fn=function(s){var v=d(function(A){return{dbs:A.dbs,synchronous:A.synchronous,dbVersion:A.dbVersion||"0.0.0",changes:A.changes,versions:A.versions,fetch:A.fetch,versionDispatch:A.dispatch}},D.Z),n=v.dbs,o=v.synchronous,e=v.dbVersion,f=v.changes,l=v.versions,p=v.fetch,O=v.versionDispatch,C=(0,pe.md)();(0,x.useEffect)(function(){p(null)},[e]);var R=x.useCallback(function(A){},[]),H=O.getCurrentDB(),Z=(0,x.useState)("tab1"),B=P()(Z,2),Q=B[0],ue=B[1],fe=c().groupBy(n,function(A){return A.select});return(0,r.jsx)("div",{children:(0,r.jsx)(N.Rs,{rowKey:"id",dataSource:l,metas:{title:{dataIndex:"version"},description:{dataIndex:"versionDesc",render:function(G,oe){return(0,r.jsxs)(z.Z,{children:[(0,r.jsx)("span",{children:oe.versionDate}),(0,r.jsx)("span",{children:oe.versionDesc})]})}},subTitle:{dataIndex:"labels",render:function(G,oe){return(0,r.jsx)(z.Z,{children:(0,$.t)(oe.version,e)<=0?(0,r.jsx)(j.Z,{title:"\u5DF2\u540C\u6B65\u5230\u6570\u636E\u6E90",color:"blue",children:"\u5DF2\u540C\u6B65"}):o[oe.version]?(0,r.jsx)(j.Z,{title:"\u6B63\u5728\u540C\u6B65\u5230\u6570\u636E\u6E90",color:"lime",children:"\u6B63\u5728\u540C\u6B65"}):(0,r.jsx)(j.Z,{title:"\u672A\u540C\u6B65\u5230\u6570\u636E\u6E90",color:"red",children:"\u672A\u540C\u6B65"})})},search:!1},actions:{render:function(G,oe){return[(0,r.jsx)(Ye,{type:we.DETAIL}),(0,r.jsx)(Ye,{type:we.COMPARE}),(0,r.jsx)(pe.Nv,{accessible:C.canErdHisprojectEdit,fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(tn,{})}),(0,r.jsx)(pe.Nv,{accessible:C.canErdHisprojectDel,fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(un,{})}),(0,r.jsx)(pe.Nv,{accessible:C.canErdConnectorDbsync,fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(mn,{synced:(0,$.t)(oe.version,e)<=0})})]}}},onRow:function(G,oe){return{onMouseEnter:function(q){O.setCurrentVersion(G,oe)}}},toolbar:{menu:{activeKey:Q,items:[{key:"tab1",label:f.length>0?(0,r.jsx)("span",{title:"\u5F53\u524D\u5185\u5BB9\u4E0E\u4E0A\u4E00\u7248\u672C\u7684\u5185\u5BB9\u6709\u53D8\u5316\uFF0C\u4F46\u672A\u4FDD\u5B58\u540C\u6B65\u7248\u672C\uFF01",children:(0,r.jsx)(j.Z,{color:"red",children:(0,r.jsx)(Cn,{size:30})})}):(0,r.jsx)("span",{title:"\u5F53\u524D\u5185\u5BB9\u4E0E\u4E0A\u4E00\u7248\u672C\u5185\u5BB9\u65E0\u53D8\u5316",children:(0,r.jsx)(j.Z,{color:"blue",children:(0,r.jsx)(yn,{size:30})})})},{key:"tab2",label:(0,r.jsxs)(z.Z,{children:["\u6570\u636E\u6E90",(0,r.jsx)(J.Z,{labelInValue:!0,value:H||"\u8BF7\u9009\u62E9\u6570\u636E\u6E90",style:{width:200},onChange:R,children:Object.keys(fe).map(function(A){return(0,r.jsx)(xn,{label:A,children:fe[A].map(function(G){return(0,r.jsx)(Dn,{value:G.name,children:G.name},A.name)})},A)})})]})}],onChange:function(G){ue(G)}},actions:[(0,r.jsx)(pe.Nv,{accessible:C.canErdHisprojectAdd,fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(je,{trigger:"bp"})}),(0,r.jsx)(pe.Nv,{accessible:C.canErdHisprojectConfig,fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(Te,{})}),(0,r.jsx)(pe.Nv,{accessible:C.canErdHisprojectInit,fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(Ze,{})}),(0,r.jsx)(pe.Nv,{accessible:C.canErdHisprojectRebuild,fallback:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(he,{})})]}})})},bn=x.memo(Fn)},24765:function(ye,M,t){"use strict";t.d(M,{Z:function(){return ge}});var V=t(98404),P=t(18784),x=t(26869),D=t.n(x),F=t(57399),T=t(82557),b=t(99004),g=t(95704),S=t(43920),L=t(51084),I=t(19397),a=t(20120),m=t(67146);const u=d=>{const{paddingXXS:J,lineWidth:z,tagPaddingHorizontal:j,componentCls:N,calc:U}=d,K=U(j).sub(z).equal(),Y=U(J).sub(z).equal();return{[N]:Object.assign(Object.assign({},(0,I.Wf)(d)),{display:"inline-block",height:"auto",marginInlineEnd:d.marginXS,paddingInline:K,fontSize:d.tagFontSize,lineHeight:d.tagLineHeight,whiteSpace:"nowrap",background:d.defaultBg,border:`${(0,S.bf)(d.lineWidth)} ${d.lineType} ${d.colorBorder}`,borderRadius:d.borderRadiusSM,opacity:1,transition:`all ${d.motionDurationMid}`,textAlign:"start",position:"relative",[`&${N}-rtl`]:{direction:"rtl"},"&, a, a:hover":{color:d.defaultColor},[`${N}-close-icon`]:{marginInlineStart:Y,fontSize:d.tagIconSize,color:d.colorTextDescription,cursor:"pointer",transition:`all ${d.motionDurationMid}`,"&:hover":{color:d.colorTextHeading}},[`&${N}-has-color`]:{borderColor:"transparent",[`&, a, a:hover, ${d.iconCls}-close, ${d.iconCls}-close:hover`]:{color:d.colorTextLightSolid}},["&-checkable"]:{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",[`&:not(${N}-checkable-checked):hover`]:{color:d.colorPrimary,backgroundColor:d.colorFillSecondary},"&:active, &-checked":{color:d.colorTextLightSolid},"&-checked":{backgroundColor:d.colorPrimary,"&:hover":{backgroundColor:d.colorPrimaryHover}},"&:active":{backgroundColor:d.colorPrimaryActive}},["&-hidden"]:{display:"none"},[`> ${d.iconCls} + span, > span + ${d.iconCls}`]:{marginInlineStart:K}}),[`${N}-borderless`]:{borderColor:"transparent",background:d.tagBorderlessBg}}},h=d=>{const{lineWidth:J,fontSizeIcon:z,calc:j}=d,N=d.fontSizeSM;return(0,a.TS)(d,{tagFontSize:N,tagLineHeight:(0,S.bf)(j(d.lineHeightSM).mul(N).equal()),tagIconSize:j(z).sub(j(J).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:d.colorFillTertiary})},y=d=>({defaultBg:new L.C(d.colorFillQuaternary).onBackground(d.colorBgContainer).toHexString(),defaultColor:d.colorText});var c=(0,m.I$)("Tag",d=>{const J=h(d);return u(J)},y),i=function(d,J){var z={};for(var j in d)Object.prototype.hasOwnProperty.call(d,j)&&J.indexOf(j)<0&&(z[j]=d[j]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var N=0,j=Object.getOwnPropertySymbols(d);N<j.length;N++)J.indexOf(j[N])<0&&Object.prototype.propertyIsEnumerable.call(d,j[N])&&(z[j[N]]=d[j[N]]);return z},$=V.forwardRef((d,J)=>{const{prefixCls:z,style:j,className:N,checked:U,onChange:K,onClick:Y}=d,W=i(d,["prefixCls","style","className","checked","onChange","onClick"]),{getPrefixCls:de,tag:ae}=V.useContext(g.E_),De=Ve=>{K==null||K(!U),Y==null||Y(Ve)},Ce=de("tag",z),[ne,Pe,je]=c(Ce),Ee=D()(Ce,`${Ce}-checkable`,{[`${Ce}-checkable-checked`]:U},ae==null?void 0:ae.className,N,Pe,je);return ne(V.createElement("span",Object.assign({},W,{ref:J,style:Object.assign(Object.assign({},j),ae==null?void 0:ae.style),className:Ee,onClick:De})))}),re=t(10143);const _=d=>(0,re.Z)(d,(J,z)=>{let{textColor:j,lightBorderColor:N,lightColor:U,darkColor:K}=z;return{[`${d.componentCls}${d.componentCls}-${J}`]:{color:j,background:U,borderColor:N,"&-inverse":{color:d.colorTextLightSolid,background:K,borderColor:K},[`&${d.componentCls}-borderless`]:{borderColor:"transparent"}}}});var se=(0,m.bk)(["Tag","preset"],d=>{const J=h(d);return _(J)},y);function ee(d){return typeof d!="string"?d:d.charAt(0).toUpperCase()+d.slice(1)}const ie=(d,J,z)=>{const j=ee(z);return{[`${d.componentCls}${d.componentCls}-${J}`]:{color:d[`color${z}`],background:d[`color${j}Bg`],borderColor:d[`color${j}Border`],[`&${d.componentCls}-borderless`]:{borderColor:"transparent"}}}};var ce=(0,m.bk)(["Tag","status"],d=>{const J=h(d);return[ie(J,"success","Success"),ie(J,"processing","Info"),ie(J,"error","Error"),ie(J,"warning","Warning")]},y),r=function(d,J){var z={};for(var j in d)Object.prototype.hasOwnProperty.call(d,j)&&J.indexOf(j)<0&&(z[j]=d[j]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var N=0,j=Object.getOwnPropertySymbols(d);N<j.length;N++)J.indexOf(j[N])<0&&Object.prototype.propertyIsEnumerable.call(d,j[N])&&(z[j[N]]=d[j[N]]);return z};const le=(d,J)=>{const{prefixCls:z,className:j,rootClassName:N,style:U,children:K,icon:Y,color:W,onClose:de,closeIcon:ae,closable:De,bordered:Ce=!0}=d,ne=r(d,["prefixCls","className","rootClassName","style","children","icon","color","onClose","closeIcon","closable","bordered"]),{getPrefixCls:Pe,direction:je,tag:Ee}=V.useContext(g.E_),[Ve,Ae]=V.useState(!0);V.useEffect(()=>{"visible"in ne&&Ae(ne.visible)},[ne.visible]);const Te=(0,F.o2)(W),Re=(0,F.yT)(W),Ze=Te||Re,$e=Object.assign(Object.assign({backgroundColor:W&&!Ze?W:void 0},Ee==null?void 0:Ee.style),U),he=Pe("tag",z),[Ie,Ue,Oe]=c(he),Je=D()(he,Ee==null?void 0:Ee.className,{[`${he}-${W}`]:Ze,[`${he}-has-color`]:W&&!Ze,[`${he}-hidden`]:!Ve,[`${he}-rtl`]:je==="rtl",[`${he}-borderless`]:!Ce},j,N,Ue,Oe),Ne=be=>{be.stopPropagation(),de==null||de(be),!be.defaultPrevented&&Ae(!1)},[,We]=(0,T.Z)(De,ae,be=>be===null?V.createElement(P.Z,{className:`${he}-close-icon`,onClick:Ne}):V.createElement("span",{className:`${he}-close-icon`,onClick:Ne},be),null,!1),ze=typeof ne.onClick=="function"||K&&K.type==="a",Be=Y||null,He=Be?V.createElement(V.Fragment,null,Be,K&&V.createElement("span",null,K)):K,Me=V.createElement("span",Object.assign({},ne,{ref:J,className:Je,style:$e}),He,We,Te&&V.createElement(se,{key:"preset",prefixCls:he}),Re&&V.createElement(ce,{key:"status",prefixCls:he}));return Ie(ze?V.createElement(b.Z,{component:"Tag"},Me):Me)},te=V.forwardRef(le);te.CheckableTag=$;var ge=te}}]);
