"use strict";(self.webpackChunkInvocationlab_ERD_Online=self.webpackChunkInvocationlab_ERD_Online||[]).push([[4035],{81667:function(ye,ee,r){r.r(ee),r.d(ee,{default:function(){return $e}});var oe=r(9116),v=r.n(oe),se=r(1768),m=r(98404),ne=r(81824),V=r(24882),M=r(38297),ge=r(97833),y=r.n(ge),ue=r(91484),c=r.n(ue),le=r(42196),K=r.n(le),ie=r(56037),N=r(23749),B=r(5049),O=r(81663),Y=r(19688),w=r(51927),de=r(51270),Q=r(34137),h=r(67026),f=r(80455),C=r(26774),e=r(36422),o=function(p){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Q.Y,{title:"\u6DFB\u52A0\u6210\u5458",trigger:(0,e.jsxs)(C.ZP,{type:"primary",children:[(0,e.jsx)(de.Z,{}),"\u6DFB\u52A0\u6210\u5458"]},"add-user"),autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:function(){}},submitter:{resetButtonProps:{type:"dashed"}},submitTimeout:2e3,onFinish:function(){var b=K()(y()().mark(function x(k){return y()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,O.a4)("/ncnb/project/group/role/users",{projectId:p.projectId,roleId:p.roleId,userIds:k.user}).then(function(D){if((D==null?void 0:D.code)===200){var j;B.ZP.success("\u4FDD\u5B58\u6210\u529F"),(j=p.actionRef.current)===null||j===void 0||j.reload()}});case 2:return P.abrupt("return",!0);case 3:case"end":return P.stop()}},x)}));return function(x){return b.apply(this,arguments)}}(),children:(0,e.jsx)(h.A.Group,{children:(0,e.jsx)(f.Z,{width:"md",name:"user",label:"\u9009\u62E9\u7528\u6237",mode:"multiple",showSearch:!0,request:function(){var b=K()(y()().mark(function x(k){var R,P;return y()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,O.HT)("/ncnb/project/group/users",{pageSize:6,current:1,username:k.keyWords,roleId:p.roleId});case 2:return P=j.sent,j.abrupt("return",P==null||(R=P.data)===null||R===void 0?void 0:R.records.map(function(g){return{value:g.id,label:"".concat(g.id," - ").concat(g.username," - ").concat(g.email)}}));case 4:case"end":return j.stop()}},x)}));return function(x){return b.apply(this,arguments)}}(),placeholder:"\u8F93\u5165\u59D3\u540D\u6A21\u7CCA\u641C\u7D22",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u7528\u6237"}]})})})})},L=m.memo(o),X=r(56713),z=function(p){var b=(0,X.md)(),x=(0,Y.useSearchParams)(),k=v()(x,1),R=k[0],P=(0,m.useRef)(),D=R.get(w.s.PROJECT_ID)||"";return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(ie.Rs,{actionRef:P,toolBarRender:function(){return b.canErdProjectUsersAdd&&p.isAdmin?[]:[(0,e.jsx)(L,{projectId:D,roleId:p.roleId,actionRef:P})]},search:{filterType:"light"},rowKey:"id",request:K()(y()().mark(function j(){var g,Z,W,U,l,F=arguments;return y()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return U=F.length>0&&F[0]!==void 0?F[0]:{},G.next=3,(0,O.HT)("/ncnb/project/group/role/users",c()(c()({},U),{},{projectId:D,roleId:p.roleId}));case 3:return l=G.sent,G.abrupt("return",{data:l==null||(g=l.data)===null||g===void 0||(Z=g.records)===null||Z===void 0?void 0:Z.map(function(_){return c()(c()({},_),{},{avatar:_.avatar?_.avatar:"/invocationlab-erd-online-view/logo.svg"})}),total:l==null||(W=l.data)===null||W===void 0?void 0:W.total,success:l.code===200});case 5:case"end":return G.stop()}},j)})),pagination:{pageSize:6},metas:{title:{dataIndex:"username",title:"\u7528\u6237\u540D",search:b.canErdProjectRolesSearch&&!p.isAdmin},avatar:{dataIndex:"avatar",search:!1},description:{dataIndex:"title",search:!1},content:{dataIndex:"email",title:"\u90AE\u7BB1",search:b.canErdProjectRolesSearch&&!p.isAdmin},actions:{render:function(g,Z){return p.isAdmin?[]:[(0,e.jsx)(X.Nv,{accessible:b.canErdProjectRoleUsersDel,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(N.Z,{placement:"right",title:"\u662F\u5426\u5C06\u300E"+Z.username+"\u300F\u79FB\u9664",onConfirm:function(){return(0,O.fU)("/ncnb/project/group/role/users",{projectId:D,roleId:p.roleId,userIds:[Z.id]}).then(function(U){if(U.code===200){var l;B.ZP.success("\u79FB\u9664\u6210\u529F"),(l=P.current)===null||l===void 0||l.reload()}})},okText:"\u662F",cancelText:"\u5426",children:(0,e.jsx)("a",{children:"\u79FB\u9664"},"link")})})]},search:!1}}})})},q=m.memo(z),je=r(7301),H=r(41041),re=r(22024),be=r(43878),Te=r(87098),_e=r(5922),De=r(6176),Ie=r(44766),A=r.n(Ie),xe=r(71793),ce=void 0,Re=function(p){var b=(0,X.md)(),x=(0,m.useState)(3),k=v()(x,2),R=k[0],P=k[1],D=(0,m.useState)([]),j=v()(D,2),g=j[0],Z=j[1],W=(0,m.useState)([]),U=v()(W,2),l=U[0],F=U[1],ae=(0,m.useState)({indeterminate:!1,checked:!1}),G=v()(ae,2),_=G[0],I=G[1],J=(0,m.useState)([]),$=v()(J,2),E=$[0],te=$[1],Ae=(0,Y.useSearchParams)(),ke=v()(Ae,1),Fe=ke[0],Ke=function(){var d=K()(y()().mark(function n(){var t;return y()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,O.HT)("/ncnb/project/group/role/permission",{roleId:(t=p.values)===null||t===void 0?void 0:t.id,projectId:Fe.get(w.s.PROJECT_ID)});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},n)}));return function(){return d.apply(this,arguments)}}();function Ue(d,n,t){var u=A().find(d,function(i){var s;return(i==null||(s=i.defaultValue)===null||s===void 0?void 0:s.length)>0}),a=A().filter(d,function(i){var s,T;return(i==null||(s=i.defaultValue)===null||s===void 0?void 0:s.length)===(i==null||(T=i.operations)===null||T===void 0?void 0:T.length)});a.length===d.length?n={indeterminate:!1,checked:!0,disabled:t===0?!1:t>p.defaultRole||!1}:u?n={indeterminate:!0,checked:!0,disabled:t===0?!1:t>p.defaultRole||!0}:n={indeterminate:!1,checked:!1,disabled:t===0?!1:t>p.defaultRole||!1},I(n)}function Ve(d,n){var t=A().find(d,function(a){var i;return(a==null||(i=a.defaultValue)===null||i===void 0?void 0:i.length)>0}),u=A().filter(d,function(a){var i,s;return(a==null||(i=a.defaultValue)===null||i===void 0?void 0:i.length)===(a==null||(s=a.operations)===null||s===void 0?void 0:s.length)});u.length===d.length?n=c()(c()({},_),{},{indeterminate:!1,checked:!0}):t?n=c()(c()({},_),{},{indeterminate:!0,checked:!0}):n=c()(c()({},_),{},{indeterminate:!1,checked:!1}),I(n)}(0,m.useEffect)(function(){Ke().then(function(d){var n,t;if(!d||d.code!==200){B.ZP.error("\u83B7\u53D6\u6743\u9650\u5217\u8868\u5931\u8D25");return}var u=d==null||(n=d.data)===null||n===void 0?void 0:n.checkboxes,a=d==null||(t=d.data)===null||t===void 0?void 0:t.loginRole;P(a);var i=[],s=[],T={indeterminate:!1,checked:!1};u==null||u.forEach(function(S,We,Le){var he,fe,me,pe;i.push({key:We,checkedKeys:S.defaultValue});var Ce=(S==null||(he=S.defaultValue)===null||he===void 0?void 0:he.length)>0,Se=Ce&&(S==null||(fe=S.defaultValue)===null||fe===void 0?void 0:fe.length)!=((me=S.operations)===null||me===void 0?void 0:me.length);s.push({indeterminate:Se,checked:Ce,disabled:a===0?!1:a>p.defaultRole?!0:Se||(S==null||(pe=S.defaultValue)===null||pe===void 0?void 0:pe.length)===0})}),F(A().omit(s)),te(i),Z(u),Ue(u,T,a)})},[]);var Me=function(n){g.forEach(function(t,u){Ee(u,n)}),n.target.checked?I(c()(c()({},_),{},{indeterminate:!1,checked:!0})):I(c()(c()({},_),{},{indeterminate:!1,checked:!1}))},Ee=function(n,t){if(t.target.checked){l[n]=c()(c()({},l[n]),{},{indeterminate:!1,checked:!0}),F(A().omit(l));var u=A().map(g[n].operations||[],"value");E[n]={key:n,checkedKeys:u},te(E)}else E[n]={key:n,checkedKeys:[]},te(E),l[n]=c()(c()({},l[n]),{},{indeterminate:!1,checked:!1}),F(A().omit(l))},Be=function(n,t){var u,a,i,s,T,S;E[n]={key:n,checkedKeys:t},te(E),l[n]=c()(c()({},l[n]),{},{indeterminate:((u=E[n].checkedKeys)===null||u===void 0?void 0:u.length)>0&&((a=E[n])===null||a===void 0||(i=a.checkedKeys)===null||i===void 0?void 0:i.length)!=((s=g[n])===null||s===void 0||(T=s.operations)===null||T===void 0?void 0:T.length),checked:((S=E[n].checkedKeys)===null||S===void 0?void 0:S.length)>0}),F(A().omit(l)),Ve(g,A().omit(_))},we=function(n,t){var u=[];return u=n.map(function(a,i){var s;return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(H.Z,{children:(0,e.jsx)(re.Z,{value:a.value,disabled:R===0?!1:!(R<=p.defaultRole&&((s=g[t])===null||s===void 0?void 0:s.defaultValue.indexOf(a.value))>-1),children:a.name},a.value)},a.value)})}),u};return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(h.A,{submitter:{render:function(n,t){return b.canErdProjectRolePermissionEdit?(0,e.jsx)(je.S,{children:t}):(0,e.jsx)(e.Fragment,{})}},onFinish:function(){var d=K()(y()().mark(function n(t){var u,a;return y()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(u=xe.rV(w.s.PROJECT_ID),a=[],E.forEach(function(T){a=a.concat(T.checkedKeys)}),!b.canErdProjectRolePermissionEdit){s.next=8;break}return s.next=6,(0,O.a4)("/ncnb/project/group/saveCheckedOperations",{projectId:u,checkedKeys:a,roleId:p.values.id}).then(function(T){T.code===200?B.ZP.success("\u4FDD\u5B58\u6210\u529F"):B.ZP.error(T.msg)});case 6:s.next=9;break;case 8:B.ZP.warning("\u65E0\u6743\u64CD\u4F5C\u6743\u9650\u529F\u80FD");case 9:case"end":return s.stop()}},n)}));return function(n){return d.apply(this,arguments)}}(),children:g&&g.length>0?(0,e.jsx)(be.ZP,{header:(0,e.jsx)("div",{children:(0,e.jsx)(re.Z,{indeterminate:_.indeterminate,checked:_.checked,disabled:_.disabled,onChange:Me.bind(ce),children:"\u5168\u9009"})}),dataSource:g,renderItem:function(n,t){var u,a;return(0,e.jsxs)(e.Fragment,{children:[t>0?(0,e.jsx)(Te.Z,{}):(0,e.jsx)(e.Fragment,{}),(0,e.jsxs)(_e.Z,{align:"middle",children:[(0,e.jsx)(H.Z,{span:6,children:(0,e.jsx)(re.Z,{indeterminate:l[t].indeterminate,checked:l[t].checked,disabled:l[t].disabled,onChange:Ee.bind(ce,t),children:n.menuName},t)}),(0,e.jsx)(H.Z,{span:18,children:(0,e.jsx)(re.Z.Group,{style:{width:"100%",margin:"0 8px"},defaultValue:n==null?void 0:n.defaultValue,value:(u=E[t])===null||u===void 0?void 0:u.checkedKeys,onChange:Be.bind(ce,t),children:(0,e.jsx)(_e.Z,{children:(n==null||(a=n.operations)===null||a===void 0?void 0:a.length)>0&&we(n==null?void 0:n.operations,t)})},t)})]})]})}}):(0,e.jsx)(De.Z,{image:"/invocationlab-erd-online-view/empty.svg",imageStyle:{height:200}})})})},Oe=m.memo(Re),Pe=ne.Z.Text,Ze=ne.Z.Title,Ge=function(p){var b=(0,m.useState)("admin"),x=v()(b,2),k=x[0],R=x[1],P=(0,m.useState)([]),D=v()(P,2),j=D[0],g=D[1],Z=(0,X.md)(),W=(0,Y.useSearchParams)(),U=v()(W,1),l=U[0],F=Z.canErdProjectRolesPage,ae=Z.canErdProjectRolePermission,G=function(I,J,$){var E=[];return F&&E.push({label:(0,e.jsx)(Pe,{strong:!0,children:"\u7528\u6237\u7EC4\u6210\u5458"}),key:"1",children:(0,e.jsx)(q,{roleId:I,isAdmin:J})}),ae&&E.push({label:(0,e.jsx)(Pe,{strong:!0,children:"\u6743\u9650\u914D\u7F6E"}),key:"3",children:(0,e.jsx)(Oe,{isAdmin:J,defaultRole:Number($),values:{id:I}})}),(0,e.jsx)(V.Z,{defaultActiveKey:"1",items:E})};return(0,m.useEffect)(function(){(0,O.HT)("/ncnb/project/group/roles",{projectId:l.get(w.s.PROJECT_ID)}).then(function(_){var I,J=_==null||(I=_.data)===null||I===void 0?void 0:I.map(function($){var E=$.roleCode.includes("_0");return E&&R($.roleCode),{label:$.roleName,key:$.roleCode,children:G($.roleId,E,$.roleCode.split("_")[1])}});g(J)})},[]),(0,e.jsxs)("div",{children:[(0,e.jsx)(M.Z,{size:"large",children:(0,e.jsx)(Ze,{level:4,children:"\u7528\u6237\u7EC4 "})}),(0,e.jsx)("br",{}),(0,e.jsx)(se.Z,{tabs:{tabPosition:"left",activeKey:k,items:j,onChange:function(I){R(I)}}})]})},$e=m.memo(Ge)},81663:function(ye,ee,r){r.d(ee,{D7:function(){return ue},HT:function(){return Y},UC:function(){return de},a4:function(){return B},dm:function(){return ie},fU:function(){return le}});var oe=r(97833),v=r.n(oe),se=r(91484),m=r.n(se),ne=r(42196),V=r.n(ne),M=r(88263);function ge(h,f,C){return y.apply(this,arguments)}function y(){return y=_asyncToGenerator(_regeneratorRuntime().mark(function h(f,C,e){var o,L;return _regeneratorRuntime().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return e||(e={}),o=JSON.stringify(e)==="{}",L=[],o||Object.keys(e).map(function(q,je){var H=e[q];H==="ascend"&&L.push({column:q,asc:!0}),H==="descend"&&L.push({column:q,asc:!1})}),z.abrupt("return",request(f,{method:"GET",params:_objectSpread({size:C.pageSize,orders:L},C)}));case 5:case"end":return z.stop()}},h)})),y.apply(this,arguments)}function ue(h,f){return c.apply(this,arguments)}function c(){return c=V()(v()().mark(function h(f,C){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,M.ZP)(f,{method:"POST",data:m()({},C)}));case 1:case"end":return o.stop()}},h)})),c.apply(this,arguments)}function le(h,f){return K.apply(this,arguments)}function K(){return K=V()(v()().mark(function h(f,C){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,M.ZP)(f,{method:"DELETE",data:m()({},C)}));case 1:case"end":return o.stop()}},h)})),K.apply(this,arguments)}function ie(h,f){return N.apply(this,arguments)}function N(){return N=V()(v()().mark(function h(f,C){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,M.ZP)(f,{method:"PUT",data:m()({},C)}));case 1:case"end":return o.stop()}},h)})),N.apply(this,arguments)}function B(h,f){return O.apply(this,arguments)}function O(){return O=V()(v()().mark(function h(f,C){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,M.ZP)(f,{method:"POST",data:m()({},C)}));case 1:case"end":return o.stop()}},h)})),O.apply(this,arguments)}function Y(h,f){return w.apply(this,arguments)}function w(){return w=V()(v()().mark(function h(f,C){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,M.ZP)(f,{method:"GET",params:m()({},C)}));case 1:case"end":return o.stop()}},h)})),w.apply(this,arguments)}function de(h,f){return Q.apply(this,arguments)}function Q(){return Q=V()(v()().mark(function h(f,C){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,M.ZP)(f,{method:"GET",params:m()({},C)}));case 1:case"end":return o.stop()}},h)})),Q.apply(this,arguments)}}}]);
