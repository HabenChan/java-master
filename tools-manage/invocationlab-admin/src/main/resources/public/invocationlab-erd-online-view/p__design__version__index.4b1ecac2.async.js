"use strict";(self.webpackChunkInvocationlab_ERD_Online=self.webpackChunkInvocationlab_ERD_Online||[]).push([[7133],{80455:function(xe,le,l){var w=l(76813),oe=l(9009),y=l(47107),F=l(98404),ie=l(50322),K=l(85016),_=l(36422),C=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],Q=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],A=F.forwardRef(function(O,ae){var j=O.fieldProps,g=O.children,se=O.params,z=O.proFieldProps,ue=O.mode,J=O.valueEnum,ce=O.request,d=O.showSearch,B=O.options,S=(0,oe.Z)(O,C),e=(0,F.useContext)(ie.Z);return(0,_.jsx)(K.Z,(0,w.Z)((0,w.Z)({valueEnum:(0,y.h)(J),request:ce,params:se,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,w.Z)({options:B,mode:ue,showSearch:d,getPopupContainer:e.getPopupContainer},j),ref:ae,proFieldProps:z},S),{},{children:g}))}),de=F.forwardRef(function(O,ae){var j=O.fieldProps,g=O.children,se=O.params,z=O.proFieldProps,ue=O.mode,J=O.valueEnum,ce=O.request,d=O.options,B=(0,oe.Z)(O,Q),S=(0,w.Z)({options:d,mode:ue||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},j),e=(0,F.useContext)(ie.Z);return(0,_.jsx)(K.Z,(0,w.Z)((0,w.Z)({valueEnum:(0,y.h)(J),request:ce,params:se,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,w.Z)({getPopupContainer:e.getPopupContainer},S),ref:ae,proFieldProps:z},B),{},{children:g}))}),V=A,ee=de,L=V;L.SearchSelect=ee,L.displayName="ProFormComponent",le.Z=L},76436:function(xe,le,l){var w=l(76813),oe=l(9009),y=l(98404),F=l(85016),ie=l(36422),K=["fieldProps","proFieldProps"],_=function(Q,A){var de=Q.fieldProps,V=Q.proFieldProps,ee=(0,oe.Z)(Q,K);return(0,ie.jsx)(F.Z,(0,w.Z)({ref:A,valueType:"textarea",fieldProps:de,proFieldProps:V},ee))};le.Z=y.forwardRef(_)},6487:function(xe,le,l){l.d(le,{t:function(){return w}});var w=function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",ie=function Q(A,de,V,ee){var L=-1,O=A[V]||0,ae=de[V]||0;return O===ae&&V+1<ee?L=Q(A,de,V+1,ee):L=O-ae,L},K=y.replace(/[a-zA-Z]/g,"").split(".").map(function(Q){return parseInt(Q,10)}),_=F.replace(/[a-zA-Z]/g,"").split(".").map(function(Q){return parseInt(Q,10)}),C=K.length>_.length?K:_;return ie(K,_,0,C.length)}},60481:function(xe,le,l){l.r(le),l.d(le,{default:function(){return jn}});var w=l(9116),oe=l.n(w),y=l(98404),F=l(77662),ie=l(99439),K=l.n(ie),_=l(91484),C=l.n(_),Q=l(5678),A=l.n(Q),de=l(97833),V=l.n(de),ee=l(42196),L=l.n(ee),O=l(31777),ae=l(44766),j=l.n(ae),g=l(5049),se=l(28307),z=l(6487),ue=l(75687),J=l(82411),ce=l(40570),d=l(3571),B=l.n(d),S=l(7599),e=l(36422),E={DEFAULT:"lastVersion",CURRENT:"currentVersion",MULTI:"multiVersionCompare"},I=ue.ZP.getState(),U=(0,O.Z)(function(D,o){return{init:!0,currentVersion:{},currentVersionIndex:void 0,hasDB:!0,versions:[],messages:[],data:void 0,dbVersion:"0.0.0",changes:[],dbs:[],incrementVersionData:{},synchronous:{},fetch:function(){var a=L()(V()().mark(function t(r){var s,i,u;return V()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(I=ue.ZP.getState(),!j().isEmpty((s=I)===null||s===void 0?void 0:s.project)){c.next=6;break}return c.next=4,I.fetch().then(function(f){var x=f==null?void 0:f.data;if(!r&&x){var p,m;o().dispatch.initDbs((p=x.project.projectJSON)===null||p===void 0||(m=p.profile)===null||m===void 0?void 0:m.dbs)}J.hisProjectLoad(r||o().dispatch.getCurrentDBData()).then(function(Z){if(Z){var R=Z.data;R?(o().dispatch.getDBVersion(),o().dispatch.checkBaseVersion(R),o().dispatch.getVersionMessage(R),D({changes:o().dispatch.calcChanges(R)})):g.ZP.error("\u83B7\u53D6\u7248\u672C\u4FE1\u606F\u5931\u8D25")}})});case 4:c.next=8;break;case 6:r||o().dispatch.initDbs((i=I.project.projectJSON)===null||i===void 0||(u=i.profile)===null||u===void 0?void 0:u.dbs),J.hisProjectLoad(r||o().dispatch.getCurrentDBData()).then(function(f){if(f){var x=f.data;x?(o().dispatch.getDBVersion(),o().dispatch.checkBaseVersion(x),o().dispatch.getVersionMessage(x),D({changes:o().dispatch.calcChanges(x)})):g.ZP.error("\u83B7\u53D6\u7248\u672C\u4FE1\u606F\u5931\u8D25")}});case 8:case"end":return c.stop()}},t)}));function n(t){return a.apply(this,arguments)}return n}(),dispatch:{compareStringArray:function(n,t,r,s){var i=[];return n.forEach(function(u){t.includes(u)||i.push({type:"index",name:"".concat(r,".").concat(s,".fields.").concat(u),opt:"update",changeData:"addField=>".concat(u)})}),t.forEach(function(u){n.includes(u)||i.push({type:"index",name:"".concat(r,".").concat(s,".fields.").concat(u),opt:"update",changeData:"deleteField=>".concat(u)})}),i},compareIndex:function(n,t,r){var s=[];return Object.keys(n).forEach(function(i){t[i]!==n[i]&&s.push({type:"index",name:"".concat(r.title,".").concat(n.name,".").concat(i),opt:"update",changeData:"".concat(t[i],"=>").concat(n[i])})}),s},compareIndexs:function(n,t){var r=[],s=n.indexs||[],i=t.indexs||[],u=i.map(function(c){return c.name}),v=s.map(function(c){return c.name});return s.forEach(function(c){if(!u.includes(c.name))r.push({type:"index",name:"".concat(n.title,".").concat(c.name),opt:"add"});else{var f=i.filter(function(m){return m.name===c.name})[0]||{};r.push.apply(r,A()(o().dispatch.compareIndex(j().omit(c,["fields"]),j().omit(f,["fields"]),n)));var x=f.fields||[],p=c.fields||[];r.push.apply(r,A()(o().dispatch.compareStringArray(p,x,n.title,c.name)))}}),i.forEach(function(c){v.includes(c.name)||r.push({type:"index",name:"".concat(n.title,".").concat(c.name),opt:"delete"})}),r},compareEntity:function(n,t){var r=[];return Object.keys(n).forEach(function(s){t[s]!==n[s]&&r.push({type:"entity",name:"".concat(n.title,".").concat(s),opt:"update",changeData:"".concat(t[s],"=>").concat(n[s])})}),r},compareField:function(n,t,r){var s=[];return Object.keys(n).forEach(function(i){i!=="typeName"&&i!=="dataType"&&t[i]!==n[i]&&s.push({type:"field",name:"".concat(r.title,".").concat(n.name,".").concat(i),opt:"update",changeData:"".concat(t[i],"=>").concat(n[i])})}),s},getAllTable:function(n){return(n.modules||[]).reduce(function(t,r){return t.concat(r.entities||[])},[])},calcChanges:function(n){var t=I.project.projectJSON,r=[],s=A()(n),i=s.sort(function(m,Z){return(0,z.t)(Z.version,m.version)})[0];if(i){var u=C()({},t),v={modules:j().get(i,"projectJSON.modules",[])},c=o().dispatch.getAllTable(u),f=o().dispatch.getAllTable(v),x=f.map(function(m){return m.title}),p=c.map(function(m){return m.title});return c.forEach(function(m){if(x.includes(m.title)){var Z=f.filter(function(T){return T.title===m.title})[0]||{},R=(Z.fields||[]).filter(function(T){return T.name}),Y=(m.fields||[]).filter(function(T){return T.name}),h=R.map(function(T){return T.name}),b=Y.map(function(T){return T.name});Y.forEach(function(T){if(!h.includes(T.name))r.push({type:"field",name:"".concat(m.title,".").concat(T.name),opt:"add"});else{var he=R.filter(function(me){return me.name===T.name})[0]||{},P=o().dispatch.compareField(T,he,m);r.push.apply(r,A()(P))}}),R.forEach(function(T){b.includes(T.name)||r.push({type:"field",name:"".concat(m.title,".").concat(T.name),opt:"delete"})});var $=o().dispatch.compareEntity(j().omit(m,["fields","indexs","headers"]),j().omit(Z,["fields","indexs"]));r.push.apply(r,A()($));var pe=o().dispatch.compareIndexs(m,Z);r.push.apply(r,A()(pe))}else r.push({type:"entity",name:m.title,opt:"add"})}),f.forEach(function(m){p.includes(m.title)||r.push({type:"entity",name:m.title,opt:"delete"})}),r}return[]},getDBVersion:function(){return D((0,S.ZP)(function(n){n.hasDB=!0;var t=o().dispatch.getCurrentDBData();t?J.dbversion(C()(C()({},t.properties),{},{dbKey:t.key})).then(function(r){r&&r.code===200?g.ZP.success("\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u83B7\u53D6\u6210\u529F"):g.ZP.error("\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u83B7\u53D6\u5931\u8D25"),D({dbVersion:r.code!==200?"":r.data})}).catch(function(){g.ZP.error("\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u83B7\u53D6\u5931\u8D25")}):(D({dbVersion:""}),g.ZP.warning((0,e.jsxs)(e.Fragment,{children:["\u83B7\u53D6\u6570\u636E\u6E90\u7248\u672C\u4FE1\u606F\u5931\u8D25,\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F,\u8BF7",(0,e.jsx)("a",{href:"/design/table/setting/db",children:"\u914D\u7F6E"}),"\u6216\u5207\u6362\u6570\u636E\u6E90\uFF01"]}),2),n.hasDB=!1)}))},checkBaseVersion:function(n){return D((0,S.ZP)(function(t){n.some(function(r){return r.baseVersion})?t.init=!1:(g.ZP.warning("\u5F53\u524D\u6570\u636E\u6E90\u4E0D\u5B58\u5728\u57FA\u7EBF\u7248\u672C\uFF0C\u8BF7\u5148\u521D\u59CB\u5316\u57FA\u7EBF",2),t.init=!0)}))},getVersionMessage:function(n,t){var r=o(),s=r.versions,i=s===void 0?[]:s,u=[];Array.isArray(n)?u=n:n&&(u=t?[].concat(n):i.concat(n)),D({versions:u.map(function(v){return j().pick(v,["id","version","versionDesc","changes","versionDate","projectJSON","baseVersion"])}).sort(function(v,c){return(0,z.t)(c.version,v.version)})})},setState:function(n){j().assign(o(),n)},getCurrentDB:function(){var n=o().dispatch.getCurrentDBData();return n?n.name:""},getCurrentDBData:function(){var n;return(n=o().dbs)===null||n===void 0?void 0:n.filter(function(t){return t.defaultDB})[0]},dropVersionTable:function(){var n=o().dispatch.getCurrentDBData();n?J.rebaseline(C()(C()({},n),{},{dbKey:n.key,version:"0.0.0",versionDesc:"\u57FA\u7EBF\u7248\u672C\uFF0C\u65B0\u5EFA\u7248\u672C\u65F6\u8BF7\u52FF\u4F4E\u4E8E\u8BE5\u7248\u672C"})).then(function(t){t&&t.code===200?(g.ZP.success("\u521D\u59CB\u5316\u6570\u636E\u8868\u6210\u529F"),o().dispatch.getDBVersion()):g.ZP.error("\u521D\u59CB\u5316\u6570\u636E\u8868\u5931\u8D25")}).catch(function(t){g.ZP.error("\u521D\u59CB\u5316\u6570\u636E\u8868\u5931\u8D25\uFF1A".concat(t.message))}):(D({dbVersion:""}),g.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F\uFF0C\u8BF7\u5207\u6362\u5C1D\u8BD5\u6570\u636E\u6E90"))},setCurrentVersion:function(n,t){D({currentVersion:n,currentVersionIndex:t})},getOptName:function(n){var t="";switch(n){case"update":t="\u66F4\u65B0";break;case"add":t="\u65B0\u589E";break;case"delete":t="\u5220\u9664";break;default:t="\u672A\u77E5\u64CD\u4F5C";break}return t},getTypeName:function(n){var t="";switch(n){case"entity":t="\u8868";break;case"index":t="\u7D22\u5F15";break;case"field":t="\u5C5E\u6027";break;default:t="\u672A\u77E5\u7C7B\u578B";break}return t},constructorMessage:function(n){return n&&j().remove(n,function(t){var r=t.type==="field"&&t.opt==="update"&&t.changeData&&t.changeData.search("undefined=>")>-1;return r}),n.map(function(t){var r="".concat(o().dispatch.getOptName(t.opt),`
      `).concat(o().dispatch.getTypeName(t.type),"\u300C").concat(t.name,"\u300D");return t.changeData&&(r="".concat(r,"\u300C").concat(t.changeData,"\u300D")),C()(C()({},t),{},{message:r})})},showChanges:function(n,t,r,s){var i=j().get(I.project,"projectJSON"),u=o(),v=u.changes,c=u.init,f=u.currentVersionIndex,x=u.versions;(!r||!s)&&(r=o().currentVersion,s=f&&x[f+1]||r);var p;if(n===E.CURRENT){var m;p=A()(((m=r)===null||m===void 0?void 0:m.changes)||[])}else n===E.MULTI?p=A()(t):p=A()(v);p&&j().remove(p,function(P){var me,N=(P==null?void 0:P.type)==="field"&&(P==null?void 0:P.opt)==="update"&&(P==null?void 0:P.changeData)&&(P==null||(me=P.changeData)===null||me===void 0?void 0:me.search("undefined=>"))>-1;return N});var Z=j().get(I.project,"configJSON"),R=C()({},(Z==null?void 0:Z.synchronous)||{upgradeType:"increment"});if(R.upgradeType==="rebuild"){var Y=[],h=[];p.forEach(function(P){P.type==="entity"?h.push(P):Y.push(P.name.split(".")[0])}),p=A()(new Set(Y)).map(function(P){return{type:"entity",name:P,opt:"update"}}).concat(h)}else p=p.filter(function(P){return!(P.type==="entity"&&P.opt==="update")});var b;if(n===E.CURRENT){var $;b=o().dispatch.constructorMessage((($=r)===null||$===void 0?void 0:$.changes)||[])}else n===E.MULTI?b=o().dispatch.constructorMessage(t||[]):b=o().dispatch.constructorMessage(v||[]);D({messages:b});var pe=o().dispatch.getCurrentDBData(),T=j().get(pe,"select","MYSQL"),he="";c?he=(0,ce.U)(C()(C()({},i),{},{modules:(i==null?void 0:i.modules)||[]}),T):he=r.baseVersion?(0,ce.U)(C()(C()({},i),{},{modules:r.projectJSON?r.projectJSON.modules:r.modules}),T):(0,ce.I2)(C()(C()({},i),{},{modules:r.projectJSON?r.projectJSON.modules:r.modules}),p,T,{modules:s.projectJSON?s.projectJSON.modules:s.modules}),D({data:he})},setChanges:function(n){D({changes:n})},checkVersionCount:function(n){var t=o(),r=t.dbVersion,s=t.versions,i=[];return r?i=s.filter(function(u){return(0,z.t)(u.version,r)>0}):i=s,i.filter(function(u){return u.version!==n.version}).some(function(u){return(0,z.t)(u.version,n.version)<=0})},execSQL:function(n,t,r,s,i){var u=o().dispatch.getCurrentDBData();u?se.Z.confirm({title:"\u540C\u6B65\u786E\u8BA4",content:"\u5143\u6570\u636E\u5373\u5C06\u540C\u6B65\u5230\u6570\u636E\u6E90\uFF0C\u540C\u6B65\u540E\u4E0D\u53EF\u64A4\u9500\uFF0C\u786E\u5B9A\u540C\u6B65\u5417\uFF1F",onOk:function(c){var f=function(){o().fetch(null),c&&c()};o().dispatch.generateSQL(u,t,n,r,f,i),s&&s()}}):(D({dbVersion:""}),g.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F\uFF0C\u8BF7\u5207\u6362\u5C1D\u8BD5\u6570\u636E\u6E90"),s&&s())},generateSQL:function(n,t,r,s,i,u){var v=o().dispatch.getCMD(s,u),c=j().get(I.project,"projectJSON");if(n){var f={version:void 0,versionDesc:void 0,sql:void 0,separator:void 0};if(s&&(f.versionDesc=t.versionDesc,f.version=t.version),!u){var x=j().get(c,"profile.sqlConfig","/*SQL@Run*/");f.sql=r,f.separator=x}o().dispatch.connectJDBC(C()(C()(C()({},n.properties),f),{},{dbKey:n.key,showModal:!0}),v,function(p){i&&i(),D({synchronous:K()({},t.version,!1)})},v)}},getCMD:function(n,t){var r="dbsync";return t?r="updateVersion":n?r="dbsync":r="sqlexec",r},connectJDBC:function(n,t,r){J[t](n).then(function(s){s.code===200?(r&&r(),se.Z.success({title:"\u540C\u6B65\u6210\u529F",content:s.data})):se.Z.warn({title:"\u540C\u6B65\u5931\u8D25",content:s.msg})}).catch(function(s){g.ZP.error("\u540C\u6B65\u5931\u8D25:".concat(s.message))})},updateVersionData:function(n,t,r){if(r==="update"){var s=o().dispatch.getCurrentDBData();J.hisProjectSave(C()(C()({},n),{},{dbKey:s.key})).then(function(i){i.code===200?g.ZP.success("\u7248\u672C\u4FE1\u606F\u66F4\u65B0\u6210\u529F"):g.ZP.error("\u7248\u672C\u4FE1\u606F\u66F4\u65B0\u5931\u8D25")}).catch(function(i){g.ZP.error("\u7248\u672C\u4FE1\u606F\u66F4\u65B0\u5931\u8D25".concat(i.message))}).finally(function(){D({versions:o().versions.map(function(i,u){return u===o().currentVersionIndex?n:i})})})}else J.hisProjectDelete(n.id).then(function(i){if(i.code===200){g.ZP.success("\u7248\u672C\u4FE1\u606F\u5220\u9664\u6210\u529F");var u=o().versions.filter(function(v){return v.id!==n.id});D({changes:o().dispatch.calcChanges(u),versions:u}),o().dispatch.checkBaseVersion(u)}}).catch(function(i){g.ZP.error("\u7248\u672C\u4FE1\u606F\u5220\u9664\u5931\u8D25".concat(i.message))});o().fetch(null)},readDb:function(n,t,r){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],i=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0;if(!n){var v=o().dispatch.getCurrentDBData();if(!v)g.ZP.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u6570\u636E\u6E90\u4FE1\u606F\uFF0C\u8BF7\u5C1D\u8BD5\u5207\u6362\u6570\u636E\u6E90\uFF0C\u5E76\u68C0\u67E5\u662F\u5426\u5DF2\u7ECF\u914D\u7F6E\u6570\u636E\u6E90\u4FE1\u606F\uFF01");else{var c=!1;i||(c=o().dispatch.checkVersionCount(t)),c?g.ZP.error("\u5F53\u524D\u64CD\u4F5C\u7684\u7248\u672C\u4E4B\u524D\u8FD8\u6709\u7248\u672C\u5C1A\u672A\u540C\u6B65\uFF0C\u8BF7\u4E0D\u8981\u8DE8\u7248\u672C\u64CD\u4F5C!"):se.Z.confirm({title:"\u540C\u6B65\u786E\u8BA4",content:"\u5143\u6570\u636E\u5373\u5C06\u540C\u6B65\u5230\u6570\u636E\u6E90\uFF0C\u540C\u6B65\u540E\u4E0D\u53EF\u64A4\u9500\uFF0C\u786E\u5B9A\u540C\u6B65\u5417\uFF1F",onOk:function(x){j().set(o().synchronous,"".concat(t.version),!0),x&&x();var p=j().get(I.project,"configJSON"),m=C()({},(p==null?void 0:p.synchronous)||{upgradeType:"increment"}),Z="";if(i)Z=(0,ce.U)(C()(C()({},j().get(I.project,"projectJSON")),{},{modules:t.projectJSON.modules}),j().get(v,"select","MYSQL"));else{var R=A()(s);if(m.upgradeType==="rebuild"){var Y=[],h=[];R.forEach(function(b){b.type==="entity"?h.push(b):Y.push(b.name.split(".")[0])}),R=A()(new Set(Y)).map(function(b){return{type:"entity",name:b,opt:"update"}}).concat(h)}else R=R.filter(function(b){return!(b.type==="entity"&&b.opt==="update")});Z=(0,ce.I2)(C()(C()({},j().get(I.project,"projectJSON")),{},{modules:t.projectJSON.modules}),R,j().get(v,"select","MYSQL"),r.projectJSON)}o().dispatch.generateSQL(v,t,Z,u,function(){return o().fetch(null)})}})}}},saveNewVersion:function(n){var t=o().dispatch.calcChanges(o().versions);if(!n.version||!n.versionDesc)g.ZP.error("\u7248\u672C\u53F7\u548C\u7248\u672C\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");else if(o().versions.map(function(v){return v.version}).includes(n.version))g.ZP.error("\u8BE5\u7248\u672C\u53F7\u5DF2\u7ECF\u5B58\u5728\u4E86");else if(o().versions[0]&&(0,z.t)(n.version,o().versions[0].version)<=0)g.ZP.error("\u65B0\u7248\u672C\u4E0D\u80FD\u5C0F\u4E8E\u6216\u7B49\u4E8E\u5DF2\u7ECF\u5B58\u5728\u7684\u7248\u672C");else{var r,s,i=o().dispatch.getCurrentDBData(),u={projectJSON:{modules:((r=I.project)===null||r===void 0||(s=r.projectJSON)===null||s===void 0?void 0:s.modules)||[]},dbKey:i.key,baseVersion:!1,version:n.version,versionDesc:n.versionDesc,changes:t,versionDate:B()().format("YYYY/M/D H:m:s")};J.hisProjectSave(u).then(function(v){v&&v.code===200?(o().dispatch.getVersionMessage(v.data),D({changes:[]}),g.ZP.success("\u5F53\u524D\u7248\u672C\u4FDD\u5B58\u6210\u529F")):g.ZP.error("\u5F53\u524D\u7248\u672C\u4FDD\u5B58\u5931\u8D25")}).catch(function(v){g.ZP.error("\u5F53\u524D\u7248\u672C\u4FDD\u5B58\u5931\u8D25:".concat(v.message))})}},rebuild:function(n){se.Z.confirm({title:"\u91CD\u5EFA\u57FA\u7EBF",content:"\u91CD\u5EFA\u57FA\u7EBF\u5C06\u4F1A\u6E05\u9664\u5F53\u524D\u9879\u76EE\u7684\u6240\u6709\u7248\u672C\u4FE1\u606F\uFF0C\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",onOk:function(){o().dispatch.initBase(n,"\u91CD\u5EFA\u57FA\u7EBF\u6210\u529F")}})},initBase:function(n,t){if(!n.version||!n.versionDesc)g.ZP.error("\u7248\u672C\u53F7\u548C\u7248\u672C\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");else{var r,s,i,u=o().dispatch.getCurrentDBData(),v=(r=I)===null||r===void 0||(s=r.project)===null||s===void 0||(i=s.projectJSON)===null||i===void 0?void 0:i.modules,c={projectJSON:{modules:v||[]},dbKey:u.key,baseVersion:!0,version:n.version,versionDesc:n.versionDesc,changes:o().dispatch.calcChanges(o().versions),versionDate:B()().format("YYYY/M/D H:m:s")};t?J.hisProjectDeleteAll(u.key).then(function(f){f.code===200?o().dispatch.initSave(c,t):g.ZP.error("\u91CD\u5EFA\u57FA\u7EBF\u5931\u8D25")}).catch(function(f){g.ZP.error("\u91CD\u5EFA\u57FA\u7EBF\u5931\u8D25:".concat(f.message))}):o().dispatch.initSave(c,t)}},initSave:function(n,t){J.hisProjectSave(n).then(function(r){r?(g.ZP.success(t||"\u521D\u59CB\u5316\u57FA\u7EBF\u6210\u529F"),o().dispatch.getVersionMessage(r.data,!0),D({changes:o().dispatch.calcChanges(o().versions),init:!1,versions:r.data}),o().dispatch.dropVersionTable()):g.ZP.error("\u64CD\u4F5C\u5931\u8D25\uFF01")}).catch(function(r){g.ZP.error("\u64CD\u4F5C\u5931\u8D25\uFF01 ".concat(r.message))})},initDbs:function(n){return D((0,S.ZP)(function(t){t.dbs=n||[]}))},dbChange:function(n){D({dbs:o().dbs.map(function(t){return t.name===n.name?C()(C()({},t),{},{defaultDB:!0}):C()(C()({},t),{},{defaultDB:!1})})}),o().fetch(n)},resolveDb:function(){return D((0,S.ZP)(function(n){n.hasDB=n.dbs&&n.dbs.length>0}))},compare:function(n){if(o().versions.length>1&&(!n.initVersion||!n.incrementVersion)&&g.ZP.warning("\u8BF7\u9009\u62E9\u4F60\u8981\u6BD4\u8F83\u7684\u4E24\u4E2A\u7248\u672C"),(0,z.t)(n.incrementVersion,n.initVersion)<=0)g.ZP.warning("\u589E\u91CF\u811A\u672C\u7684\u7248\u672C\u53F7\u4E0D\u80FD\u5C0F\u4E8E\u6216\u7B49\u4E8E\u521D\u59CB\u7248\u672C\u7684\u7248\u672C\u53F7");else{var t={},r={};o().versions.forEach(function(i){i.version===n.initVersion&&(r={modules:i.projectJSON.modules}),i.version===n.incrementVersion&&(t={modules:i.projectJSON.modules})});var s=o().dispatch.checkVersionData(t,r);o().dispatch.showChanges(E.MULTI,s,t,r),D({incrementVersionData:t})}},checkVersionData:function(n,t){var r=[],s=o().dispatch.getAllTable(n),i=o().dispatch.getAllTable(t),u=i.map(function(c){return c.title}),v=s.map(function(c){return c.title});return s.forEach(function(c){if(u.includes(c.title)){var f=i.filter(function(h){return h.title===c.title})[0]||{},x=(f.fields||[]).filter(function(h){return h.name}),p=(c.fields||[]).filter(function(h){return h.name}),m=x.map(function(h){return h.name}),Z=p.map(function(h){return h.name});p.forEach(function(h){if(!m.includes(h.name))r.push({type:"field",name:"".concat(c.title,".").concat(h.name),opt:"add"});else{var b=x.filter(function(pe){return pe.name===h.name})[0]||{},$=o().dispatch.compareField(h,b,c);r.push.apply(r,A()($))}}),x.forEach(function(h){Z.includes(h.name)||r.push({type:"field",name:"".concat(c.title,".").concat(h.name),opt:"delete"})});var R=o().dispatch.compareEntity(j().omit(c,["fields","indexs","headers"]),j().omit(f,["fields","indexs"]));r.push.apply(r,A()(R));var Y=o().dispatch.compareIndexs(c,f);r.push.apply(r,A()(Y))}else r.push({type:"entity",name:c.title,opt:"add"})}),i.forEach(function(c){v.includes(c.title)||r.push({type:"entity",name:c.title,opt:"delete"})}),r}}}});ue.ZP.subscribe(function(D){var o,a,n;return(o=D.project)===null||o===void 0||(a=o.projectJSON)===null||a===void 0||(n=a.profile)===null||n===void 0?void 0:n.dbs},function(D,o){U.getState().dispatch.initDbs(D),U.getState().dispatch.resolveDb()});var G=U,X=l(25087),q=l(38297),H=l(81152),ge=l(56037),ve=l(34137),ne=l(47174),Ce=l(76436),W=l(76813),be=l(98855),fe=l(70004),De=function(o,a){return y.createElement(fe.Z,(0,W.Z)((0,W.Z)({},o),{},{ref:a,icon:be.Z}))};De.displayName="InfoCircleOutlined";var Oe=y.forwardRef(De),M=l(26774),Be=function(o){var a=G(function(r){return{init:r.init,versionDispatch:r.dispatch}},F.Z),n=a.init,t=a.versionDispatch;return(0,y.useEffect)(function(){return function(){}}),(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(ve.Y,{title:"\u65B0\u589E\u7248\u672C",onFinish:function(){var r=L()(V()().mark(function s(i){var u;return V()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return u={version:i.version,versionDesc:i.versionDesc},t.saveNewVersion(u),c.abrupt("return",!0);case 3:case"end":return c.stop()}},s)}));return function(s){return r.apply(this,arguments)}}(),trigger:o.trigger==="bp"?(0,e.jsx)(M.ZP,{type:"primary",disabled:n,children:"\u65B0\u589E\u7248\u672C"},"artifact"):(0,e.jsx)(M.ZP,{type:"primary",disabled:n,title:n?"\u672A\u914D\u7F6E\u6570\u636E\u6E90\u4E0D\u80FD\u65B0\u589E\u7248\u672C":"",icon:n?(0,e.jsx)(Oe,{}):"",children:"\u65B0\u589E\u7248\u672C"}),children:[(0,e.jsx)(ne.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u53F7",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}}),(0,e.jsx)(Ce.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u63CF\u8FF0",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},Ie=y.memo(Be),je=l(67026),ye=l(75513),Ne=function(o){var a=(0,ue.ZP)(function(r){var s,i,u;return{upgradeType:(s=r.project)===null||s===void 0||(i=s.configJSON)===null||i===void 0||(u=i.synchronous)===null||u===void 0?void 0:u.upgradeType,projectDispatch:r.dispatch}},F.Z),n=a.upgradeType,t=a.projectDispatch;return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(ve.Y,{title:(0,e.jsxs)("span",{children:["\u540C\u6B65\u914D\u7F6E",(0,e.jsx)("span",{style:{color:"red"},children:"\uFF08\u914D\u7F6E\u6210\u529F\u540E\uFF0C\u540E\u7EED\u7684\u540C\u6B65\u7684\u64CD\u4F5C\u90FD\u4F7F\u7528\u8BE5\u914D\u7F6E\uFF0C\u4EC5\u5EFA\u8BAE\u9879\u76EE\u521D\u59CB\u5316\u4E4B\u540E\u8BBE\u7F6E\u4E00\u6B21\uFF0C\u4EE5\u540E\u4E0D\u8981\u53D8\u52A8\uFF0C\u514D\u5F97\u51FA\u73B0\u7248\u672C\u6DF7\u4E71\uFF09"})]}),trigger:(0,e.jsx)(M.ZP,{type:"primary",children:"\u540C\u6B65\u914D\u7F6E"},"refresh"),onFinish:function(){var r=L()(V()().mark(function s(i){return V()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,t.setUpgradeType(i);case 2:return v.abrupt("return",!0);case 3:case"end":return v.stop()}},s)}));return function(s){return r.apply(this,arguments)}}(),children:(0,e.jsx)(je.A.Group,{children:(0,e.jsx)(ye.Z.Group,{name:"upgradeType",label:"\u6570\u636E\u8868\u5347\u7EA7\u65B9\u5F0F",initialValue:n,options:[{label:"\u5B57\u6BB5\u589E\u91CF",value:"increment"},{label:"\u91CD\u5EFA\u6570\u636E\u8868",value:"rebuild"}]})})})})},Ae=y.memo(Ne),Pe=function(o){var a=G(function(u){return{hasDB:u.hasDB,init:u.init,versionDispatch:u.dispatch}},F.Z),n=a.hasDB,t=a.init,r=a.versionDispatch,s=(0,ue.ZP)(function(u){var v;return{projectJSON:(v=u.project)===null||v===void 0?void 0:v.projectJSON}},F.Z),i=s.projectJSON;return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(ve.Y,{title:"\u521D\u59CB\u5316\u57FA\u7EBF",trigger:(0,e.jsx)(M.ZP,{type:"primary",disabled:!n||!t,children:"\u521D\u59CB\u5316\u57FA\u7EBF"},"selection"),onFinish:function(){var u=L()(V()().mark(function v(c){var f,x;return V()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(f=r.getCurrentDBData(),f){m.next=4;break}return g.ZP.warning("\u672A\u914D\u7F6E\u6570\u636E\u5E93\u6E90\uFF0C\u8BF7\u5148\u914D\u7F6E\u6570\u636E\u6E90\uFF01"),m.abrupt("return",!1);case 4:return x={projectJSON:{modules:i.modules||[]},dbKey:f.key||"",baseVersion:!0,version:c.version,versionDesc:c.versionDesc,changes:[],versionDate:B()().format("YYYY/M/D H:m:s")},J.hisProjectSave(x).then(function(Z){Z.code===200?(g.ZP.success("\u521D\u59CB\u5316\u57FA\u7EBF\u6210\u529F"),r.getVersionMessage(Z.data,!0),r.setState({changes:[],init:!1,versions:Z.data}),r.dropVersionTable()):g.ZP.error("\u64CD\u4F5C\u5931\u8D25\uFF01")}).catch(function(Z){g.ZP.error("\u64CD\u4F5C\u5931\u8D25:".concat(Z.message))}),m.abrupt("return",!0);case 7:case"end":return m.stop()}},v)}));return function(v){return u.apply(this,arguments)}}(),children:[(0,e.jsx)(ne.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u4F8B\u5982\uFF1A1.0.0\u300C\u8BF7\u52FF\u4F4E\u4E8E\u7CFB\u7EDF\u9ED8\u8BA4\u7684\u6570\u636E\u6E90\u7248\u672C0.0.0\u300D",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 200 \u4E2A\u5B57\u7B26"}]}}),(0,e.jsx)(Ce.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"'\u4F8B\u5982\uFF1A\u521D\u59CB\u5316\u5F53\u524D\u9879\u76EE\u7248\u672C",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},Me=y.memo(Pe),Se=function(o){var a=G(function(r){return{init:r.init,versionDispatch:r.dispatch}},F.Z),n=a.init,t=a.versionDispatch;return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(ve.Y,{title:(0,e.jsxs)("span",{children:["\u91CD\u5EFA\u57FA\u7EBF",(0,e.jsx)("span",{style:{color:"red"},children:"\uFF08\u91CD\u5EFA\u57FA\u7EBF\u5C06\u4F1A\u6E05\u9664\u5F53\u524D\u9879\u76EE\u7684\u6240\u6709\u7248\u672C\u4FE1\u606F\uFF0C\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF09"})]}),onFinish:function(){var r=L()(V()().mark(function s(i){var u;return V()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return u={version:i.version,versionDesc:i.versionDesc},t.rebuild(u),c.abrupt("return",!0);case 3:case"end":return c.stop()}},s)}));return function(s){return r.apply(this,arguments)}}(),trigger:(0,e.jsx)(M.ZP,{type:"primary",disabled:n,children:"\u91CD\u5EFA\u57FA\u7EBF"},"undo"),children:[(0,e.jsx)(ne.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u4F8B\u5982\uFF1A1.0.0\u300C\u8BF7\u52FF\u4F4E\u4E8E\u7CFB\u7EDF\u9ED8\u8BA4\u7684\u6570\u636E\u6E90\u7248\u672C0.0.0\u300D",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 200 \u4E2A\u5B57\u7B26"}]}}),(0,e.jsx)(Ce.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"'\u4F8B\u5982\uFF1A\u521D\u59CB\u5316\u5F53\u524D\u9879\u76EE\u7248\u672C",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},Ee=y.memo(Se),Te=l(80455),Ye=l(29898),Fe=l(37417),we=l(4966),Ke=l(76129),Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M448 224a64 64 0 10128 0 64 64 0 10-128 0zm96 168h-64c-4.4 0-8 3.6-8 8v464c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V400c0-4.4-3.6-8-8-8z"}}]},name:"info",theme:"outlined"},ke=Qe,Re=function(o,a){return y.createElement(fe.Z,(0,W.Z)((0,W.Z)({},o),{},{ref:a,icon:ke}))};Re.displayName="InfoOutlined";var Ge=y.forwardRef(Re),Xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M476 399.1c0-3.9-3.1-7.1-7-7.1h-42c-3.8 0-7 3.2-7 7.1V484h-84.5c-4.1 0-7.5 3.1-7.5 7v42c0 3.8 3.4 7 7.5 7H420v84.9c0 3.9 3.2 7.1 7 7.1h42c3.9 0 7-3.2 7-7.1V540h84.5c4.1 0 7.5-3.2 7.5-7v-42c0-3.9-3.4-7-7.5-7H476v-84.9zM560.5 704h-225c-4.1 0-7.5 3.2-7.5 7v42c0 3.8 3.4 7 7.5 7h225c4.1 0 7.5-3.2 7.5-7v-42c0-3.8-3.4-7-7.5-7zm-7.1-502.6c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v704c0 17.7 14.3 32 32 32h512c17.7 0 32-14.3 32-32V397.3c0-8.5-3.4-16.6-9.4-22.6L553.4 201.4zM664 888H232V264h282.2L664 413.8V888zm190.2-581.4L611.3 72.9c-6-5.7-13.9-8.9-22.2-8.9H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h277l219 210.6V824c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V329.6c0-8.7-3.5-17-9.8-23z"}}]},name:"diff",theme:"outlined"},qe=Xe,$e=function(o,a){return y.createElement(fe.Z,(0,W.Z)((0,W.Z)({},o),{},{ref:a,icon:qe}))};$e.displayName="DiffOutlined";var _e=y.forwardRef($e),re=l(56713),Ze={DETAIL:"detail",COMPARE:"compare"},en=function(o){var a=G(function(N){return{messages:N.messages,data:N.data,versions:N.versions,currentVersion:N.currentVersion,dbVersion:N.dbVersion,versionDispatch:N.dispatch}},F.Z),n=a.currentVersion,t=a.dbVersion,r=a.messages,s=a.data,i=a.versions,u=a.versionDispatch,v=document.body.clientHeight,c=v-25,f=(0,y.useState)({initVersion:i[1]&&i[1].version||"",incrementVersion:i[0]&&i[0].version||"",incrementVersionData:{},again:!1,synchronous:!1,preSynchronous:!1,flagSynchronous:!1}),x=oe()(f,2),p=x[0],m=x[1],Z=(0,re.md)(),R=(0,y.useState)(1),Y=oe()(R,2),h=Y[0],b=Y[1];(0,y.useEffect)(function(){u.compare(p)},[p.initVersion,p.incrementVersion,h]);var $=i.map(function(N){return{label:N.version,value:N.version}}),pe=function(te,k){m(C()(C()({},p),{},K()({},k,te)))},T=function(){Ke.a1(s,"".concat(B()().format("YYYY-MM-D-h-mm-ss"),".sql"))},he=function(te,k){var Ve=u.checkVersionCount(n);if(Ve)g.ZP.error("\u5F53\u524D\u64CD\u4F5C\u7684\u7248\u672C\u4E4B\u524D\u8FD8\u6709\u7248\u672C\u5C1A\u672A\u540C\u6B65\uFF0C\u8BF7\u4E0D\u8981\u8DE8\u7248\u672C\u64CD\u4F5C!");else{var We=k;m(C()(C()({},p),{},K()({},We,!0)));try{u.execSQL(s,n,te,null,k==="flagSynchronous"),b(h+1)}finally{m(C()(C()({},p),{},K()({},We,!1)))}}},P=o.type===Ze.DETAIL,me=o.type===Ze.COMPARE;return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(ve.Y,{title:P?"\u7248\u672C\u53D8\u66F4\u8BE6\u60C5":"\u4EFB\u610F\u7248\u672C\u6BD4\u8F83",layout:"horizontal",trigger:(0,e.jsx)(M.ZP,{size:"small",type:"link",icon:P?(0,e.jsx)(Ge,{}):(0,e.jsx)(_e,{}),onClick:function(){return P?u.showChanges(E.CURRENT,null,null,null):u.compare(p)},children:P?"\u7248\u672C\u53D8\u66F4\u8BE6\u60C5":"\u4EFB\u610F\u7248\u672C\u6BD4\u8F83"},"compare"),submitter:{render:function(te,k){return[(0,e.jsx)(M.ZP,{onClick:T,children:"\u5BFC\u51FA\u5230\u6587\u4EF6"},"save"),(0,e.jsx)(re.Nv,{accessible:Z.canErdConnectorDbsync,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(M.ZP,{loading:p.synchronous,title:"\u4F1A\u66F4\u65B0\u6570\u636E\u6E90\u4E2D\u7684\u7248\u672C\u53F7",style:{display:P&&n.version&&(0,z.t)(n.version,t)>0?"":"none"},onClick:function(){return he(!0,"synchronous")},children:p.synchronous?"\u6B63\u5728\u540C\u6B65":"\u540C\u6B65\u5230\u6570\u636E\u6E90"})}),(0,e.jsx)(re.Nv,{accessible:Z.canErdConnectorDbsync,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(M.ZP,{loading:p.flagSynchronous,title:"\u66F4\u65B0\u6570\u636E\u6E90\u7684\u7248\u672C\u53F7\uFF0C\u4E0D\u4F1A\u6267\u884C\u5DEE\u5F02\u5316\u7684SQL",style:{display:P&&n.version&&(0,z.t)(n.version,t)>0?"":"none"},onClick:function(){return he(!0,"flagSynchronous")},children:p.flagSynchronous?"\u6B63\u5728\u6807\u8BB0\u4E3A\u540C\u6B65":"\u6807\u8BB0\u4E3A\u540C\u6B65"})}),(0,e.jsx)(re.Nv,{accessible:Z.canErdConnectorDbsync,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(M.ZP,{loading:p.again,title:"\u4E0D\u4F1A\u66F4\u65B0\u6570\u636E\u6E90\u4E2D\u7684\u7248\u672C\u53F7",style:{display:P&&n.version&&(0,z.t)(n.version,t)<=0?"":"none",marginLeft:10},onClick:function(){return he(!1,"again")},children:p.again?"\u6B63\u5728\u6267\u884C":"\u518D\u6B21\u6267\u884C"})})]}},children:[(0,e.jsxs)(je.A.Group,{style:{display:me?"":"none"},children:[(0,e.jsx)(Te.Z,{fieldProps:{onChange:function(te){pe(te,"initVersion")}},request:L()(V()().mark(function N(){return V()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.abrupt("return",$||[]);case 1:case"end":return k.stop()}},N)})),name:"initVersion",initialValue:p.initVersion,label:"\u521D\u59CB\u7248\u672C"}),(0,e.jsx)(Te.Z,{fieldProps:{onChange:function(te){pe(te,"incrementVersion")}},request:L()(V()().mark(function N(){return V()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.abrupt("return",$||[]);case 1:case"end":return k.stop()}},N)})),name:"incrementVersion",initialValue:p.incrementVersion,label:"\u589E\u91CF\u7248\u672C"})]}),(0,e.jsx)(Ye.Z,{}),(0,e.jsxs)(Fe.ZP,{container:!0,spacing:2,children:[(0,e.jsx)(Fe.ZP,{item:!0,xs:4,children:"\u53D8\u5316\u4FE1\u606F"}),(0,e.jsx)(Fe.ZP,{item:!0,xs:8,children:n?"\u53D8\u5316\u811A\u672C(".concat((0,z.t)(n.version,t)<=0?"\u5DF2\u540C\u6B65":"\u672A\u540C\u6B65",")"):"\u53D8\u5316\u811A\u672C"}),(0,e.jsx)(Fe.ZP,{item:!0,xs:4,style:{height:"450px",overflowY:"auto"},children:r.length>0?j().sortBy(r,["opt","type"]).map(function(N,te){return(0,e.jsx)("div",{children:"".concat(te+1,": ").concat(N.message)},N.message)}):"".concat(s?"\u5F53\u524D\u811A\u672C\u4E3A\u5168\u91CF\u811A\u672C":"\u5F53\u524D\u7248\u672C\u65E0\u53D8\u5316")}),(0,e.jsx)(Fe.ZP,{item:!0,xs:8,children:(0,e.jsx)(we.Z,{mode:"mysql",height:"".concat(c*.5,"px"),value:s})})]})]})})},Le=y.memo(en),nn=l(52753),rn=function(o){var a=G(function(i){return{currentVersionIndex:i.currentVersionIndex,currentVersion:i.currentVersion,versions:i.versions,versionDispatch:i.dispatch}},F.Z),n=a.currentVersionIndex,t=a.currentVersion,r=a.versions,s=a.versionDispatch;return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(ve.Y,{title:"\u7F16\u8F91\u7248\u672C",onFinish:function(){var i=L()(V()().mark(function u(v){var c,f;return V()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return c=C()(C()({},t),{},{version:v.version,versionDesc:v.versionDesc}),f=r.slice(1),n!==0?s.updateVersionData(c,t,"update"):f.map(function(m){return m.version}).includes(c.version)?g.ZP.error("\u8BE5\u7248\u672C\u53F7\u5DF2\u7ECF\u5B58\u5728\u4E86"):f[0]&&(0,z.t)(c.version,f[0].version)<=0?g.ZP.error("\u65B0\u7248\u672C\u4E0D\u80FD\u5C0F\u4E8E\u6216\u7B49\u4E8E\u5DF2\u7ECF\u5B58\u5728\u7684\u7248\u672C"):s.updateVersionData(c,t,"update"),p.abrupt("return",!0);case 4:case"end":return p.stop()}},u)}));return function(u){return i.apply(this,arguments)}}(),trigger:(0,e.jsx)(M.ZP,{size:"small",type:"link",icon:(0,e.jsx)(nn.Z,{}),children:"\u7F16\u8F91\u7248\u672C"},"editor"),request:function(){var i=L()(V()().mark(function u(v){return V()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",t);case 1:case"end":return f.stop()}},u)}));return function(u){return i.apply(this,arguments)}}(),children:[(0,e.jsx)(ne.Z,{width:"md",name:"version",label:"\u7248\u672C\u53F7",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u53F7",readonly:n!==0,formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp(/^([1-9]\d|[1-9])(\.([1-9]\d|\d)){2}$/),message:"\u7248\u672C\u53F7\u683C\u5F0F\u4E0D\u5BF9,\u7248\u672C\u9700\u6EE1\u8DB3\u6B63\u5219\uFF1A/^([1-9]\\d|[1-9])(\\.([1-9]\\d|\\d)){2}$/\uFF0C\u6B63\u786E\u793A\u4F8B\uFF1A1.0.1"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}}),(0,e.jsx)(Ce.Z,{width:"md",name:"versionDesc",label:"\u7248\u672C\u63CF\u8FF0",placeholder:"\u8BF7\u8F93\u5165\u7248\u672C\u63CF\u8FF0",formItemProps:{rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"},{max:100,message:"\u4E0D\u80FD\u5927\u4E8E 100 \u4E2A\u5B57\u7B26"}]}})]})})},tn=y.memo(rn),on=l(23749),an=l(18421),sn=function(o){var a=G(function(r){return{currentVersionIndex:r.currentVersionIndex,currentVersion:r.currentVersion,versions:r.versions,versionDispatch:r.dispatch}},F.Z),n=a.currentVersion,t=a.versionDispatch;return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(on.Z,{placement:"right",title:"\u5220\u9664\u7248\u672C[".concat(n.version,"]"),onConfirm:function(){return t.updateVersionData(n,n,"delete")},okText:"\u662F",cancelText:"\u5426",children:(0,e.jsx)(M.ZP,{size:"small",type:"link",icon:(0,e.jsx)(an.Z,{}),children:"\u5220\u9664\u7248\u672C"},"delete")})})},un=y.memo(sn),cn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M704 446H320c-4.4 0-8 3.6-8 8v402c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8V454c0-4.4-3.6-8-8-8zm-328 64h272v117H376V510zm272 290H376V683h272v117z"}},{tag:"path",attrs:{d:"M424 748a32 32 0 1064 0 32 32 0 10-64 0zm0-178a32 32 0 1064 0 32 32 0 10-64 0z"}},{tag:"path",attrs:{d:"M811.4 368.9C765.6 248 648.9 162 512.2 162S258.8 247.9 213 368.8C126.9 391.5 63.5 470.2 64 563.6 64.6 668 145.6 752.9 247.6 762c4.7.4 8.7-3.3 8.7-8v-60.4c0-4-3-7.4-7-7.9-27-3.4-52.5-15.2-72.1-34.5-24-23.5-37.2-55.1-37.2-88.6 0-28 9.1-54.4 26.2-76.4 16.7-21.4 40.2-36.9 66.1-43.7l37.9-10 13.9-36.7c8.6-22.8 20.6-44.2 35.7-63.5 14.9-19.2 32.6-36 52.4-50 41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.3c19.9 14 37.5 30.8 52.4 50 15.1 19.3 27.1 40.7 35.7 63.5l13.8 36.6 37.8 10c54.2 14.4 92.1 63.7 92.1 120 0 33.6-13.2 65.1-37.2 88.6-19.5 19.2-44.9 31.1-71.9 34.5-4 .5-6.9 3.9-6.9 7.9V754c0 4.7 4.1 8.4 8.8 8 101.7-9.2 182.5-94 183.2-198.2.6-93.4-62.7-172.1-148.6-194.9z"}}]},name:"cloud-server",theme:"outlined"},ln=cn,ze=function(o,a){return y.createElement(fe.Z,(0,W.Z)((0,W.Z)({},o),{},{ref:a,icon:ln}))};ze.displayName="CloudServerOutlined";var dn=y.forwardRef(ze),vn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},fn=vn,Je=function(o,a){return y.createElement(fe.Z,(0,W.Z)((0,W.Z)({},o),{},{ref:a,icon:fn}))};Je.displayName="CloudUploadOutlined";var pn=y.forwardRef(Je),hn=function(o){var a=G(function(u){return{currentVersionIndex:u.currentVersionIndex,currentVersion:u.currentVersion,synchronous:u.synchronous,versions:u.versions,dbVersion:u.dbVersion,versionDispatch:u.dispatch}},F.Z),n=a.currentVersionIndex,t=a.currentVersion,r=a.versions,s=a.dbVersion,i=a.versionDispatch;return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(M.ZP,{icon:o.synced?(0,e.jsx)(dn,{}):(0,e.jsx)(pn,{}),type:"link",size:"small",disabled:o.synced,onClick:function(){i.readDb(o.synced,t,n&&r[n+1]||t,t.changes,n===r.length-1,!0)},children:"\u540C\u6B65\u5230\u6570\u636E\u6E90"},"sync")})},mn=y.memo(hn),gn=l(2827),He=function(o,a){return y.createElement(fe.Z,(0,W.Z)((0,W.Z)({},o),{},{ref:a,icon:gn.Z}))};He.displayName="WarningFilled";var Cn=y.forwardRef(He),Dn=l(91523),Ue=function(o,a){return y.createElement(fe.Z,(0,W.Z)((0,W.Z)({},o),{},{ref:a,icon:Dn.Z}))};Ue.displayName="CheckCircleFilled";var yn=y.forwardRef(Ue),En=X.Z.Option,Fn=X.Z.OptGroup,xn=function(o){var a=G(function(h){return{dbs:h.dbs,synchronous:h.synchronous,dbVersion:h.dbVersion||"0.0.0",changes:h.changes,versions:h.versions,fetch:h.fetch,versionDispatch:h.dispatch}},F.Z),n=a.dbs,t=a.synchronous,r=a.dbVersion,s=a.changes,i=a.versions,u=a.fetch,v=a.versionDispatch,c=(0,re.md)();(0,y.useEffect)(function(){u(null)},[r]);var f=y.useCallback(function(h){},[]),x=v.getCurrentDB(),p=(0,y.useState)("tab1"),m=oe()(p,2),Z=m[0],R=m[1],Y=j().groupBy(n,function(h){return h.select});return(0,e.jsx)("div",{children:(0,e.jsx)(ge.Rs,{rowKey:"id",dataSource:i,metas:{title:{dataIndex:"version"},description:{dataIndex:"versionDesc",render:function(b,$){return(0,e.jsxs)(q.Z,{children:[(0,e.jsx)("span",{children:$.versionDate}),(0,e.jsx)("span",{children:$.versionDesc})]})}},subTitle:{dataIndex:"labels",render:function(b,$){return(0,e.jsx)(q.Z,{children:(0,z.t)($.version,r)<=0?(0,e.jsx)(H.Z,{title:"\u5DF2\u540C\u6B65\u5230\u6570\u636E\u6E90",color:"blue",children:"\u5DF2\u540C\u6B65"}):t[$.version]?(0,e.jsx)(H.Z,{title:"\u6B63\u5728\u540C\u6B65\u5230\u6570\u636E\u6E90",color:"lime",children:"\u6B63\u5728\u540C\u6B65"}):(0,e.jsx)(H.Z,{title:"\u672A\u540C\u6B65\u5230\u6570\u636E\u6E90",color:"red",children:"\u672A\u540C\u6B65"})})},search:!1},actions:{render:function(b,$){return[(0,e.jsx)(Le,{type:Ze.DETAIL}),(0,e.jsx)(Le,{type:Ze.COMPARE}),(0,e.jsx)(re.Nv,{accessible:c.canErdHisprojectEdit,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(tn,{})}),(0,e.jsx)(re.Nv,{accessible:c.canErdHisprojectDel,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(un,{})}),(0,e.jsx)(re.Nv,{accessible:c.canErdConnectorDbsync,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(mn,{synced:(0,z.t)($.version,r)<=0})})]}}},onRow:function(b,$){return{onMouseEnter:function(T){v.setCurrentVersion(b,$)}}},toolbar:{menu:{activeKey:Z,items:[{key:"tab1",label:s.length>0?(0,e.jsx)("span",{title:"\u5F53\u524D\u5185\u5BB9\u4E0E\u4E0A\u4E00\u7248\u672C\u7684\u5185\u5BB9\u6709\u53D8\u5316\uFF0C\u4F46\u672A\u4FDD\u5B58\u540C\u6B65\u7248\u672C\uFF01",children:(0,e.jsx)(H.Z,{color:"red",children:(0,e.jsx)(Cn,{size:30})})}):(0,e.jsx)("span",{title:"\u5F53\u524D\u5185\u5BB9\u4E0E\u4E0A\u4E00\u7248\u672C\u5185\u5BB9\u65E0\u53D8\u5316",children:(0,e.jsx)(H.Z,{color:"blue",children:(0,e.jsx)(yn,{size:30})})})},{key:"tab2",label:(0,e.jsxs)(q.Z,{children:["\u6570\u636E\u6E90",(0,e.jsx)(X.Z,{labelInValue:!0,value:x||"\u8BF7\u9009\u62E9\u6570\u636E\u6E90",style:{width:200},onChange:f,children:Object.keys(Y).map(function(h){return(0,e.jsx)(Fn,{label:h,children:Y[h].map(function(b){return(0,e.jsx)(En,{value:b.name,children:b.name},h.name)})},h)})})]})}],onChange:function(b){R(b)}},actions:[(0,e.jsx)(re.Nv,{accessible:c.canErdHisprojectAdd,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(Ie,{trigger:"bp"})}),(0,e.jsx)(re.Nv,{accessible:c.canErdHisprojectConfig,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(Ae,{})}),(0,e.jsx)(re.Nv,{accessible:c.canErdHisprojectInit,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(Me,{})}),(0,e.jsx)(re.Nv,{accessible:c.canErdHisprojectRebuild,fallback:(0,e.jsx)(e.Fragment,{}),children:(0,e.jsx)(Ee,{})})]}})})},jn=y.memo(xn)},81152:function(xe,le,l){l.d(le,{Z:function(){return ce}});var w=l(64201),oe=l(7421),y=l.n(oe),F=l(98404),ie=l(89782),K=l(10764),_=l(72577);function C(d){return typeof d!="string"?d:d.charAt(0).toUpperCase()+d.slice(1)}var Q=l(48188),A=l(13659),de=l(42771),V=l(41809);const ee=(d,B,S)=>{const e=C(S);return{[`${d.componentCls}-${B}`]:{color:d[`color${S}`],background:d[`color${e}Bg`],borderColor:d[`color${e}Border`],[`&${d.componentCls}-borderless`]:{borderColor:"transparent"}}}},L=d=>(0,A.Z)(d,(B,S)=>{let{textColor:e,lightBorderColor:E,lightColor:I,darkColor:U}=S;return{[`${d.componentCls}-${B}`]:{color:e,background:I,borderColor:E,"&-inverse":{color:d.colorTextLightSolid,background:U,borderColor:U},[`&${d.componentCls}-borderless`]:{borderColor:"transparent"}}}}),O=d=>{const{paddingXXS:B,lineWidth:S,tagPaddingHorizontal:e,componentCls:E}=d,I=e-S,U=B-S;return{[E]:Object.assign(Object.assign({},(0,Q.Wf)(d)),{display:"inline-block",height:"auto",marginInlineEnd:d.marginXS,paddingInline:I,fontSize:d.tagFontSize,lineHeight:`${d.tagLineHeight}px`,whiteSpace:"nowrap",background:d.tagDefaultBg,border:`${d.lineWidth}px ${d.lineType} ${d.colorBorder}`,borderRadius:d.borderRadiusSM,opacity:1,transition:`all ${d.motionDurationMid}`,textAlign:"start",[`&${E}-rtl`]:{direction:"rtl"},"&, a, a:hover":{color:d.tagDefaultColor},[`${E}-close-icon`]:{marginInlineStart:U,color:d.colorTextDescription,fontSize:d.tagIconSize,cursor:"pointer",transition:`all ${d.motionDurationMid}`,"&:hover":{color:d.colorTextHeading}},[`&${E}-has-color`]:{borderColor:"transparent",[`&, a, a:hover, ${d.iconCls}-close, ${d.iconCls}-close:hover`]:{color:d.colorTextLightSolid}},["&-checkable"]:{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",[`&:not(${E}-checkable-checked):hover`]:{color:d.colorPrimary,backgroundColor:d.colorFillSecondary},"&:active, &-checked":{color:d.colorTextLightSolid},"&-checked":{backgroundColor:d.colorPrimary,"&:hover":{backgroundColor:d.colorPrimaryHover}},"&:active":{backgroundColor:d.colorPrimaryActive}},["&-hidden"]:{display:"none"},[`> ${d.iconCls} + span, > span + ${d.iconCls}`]:{marginInlineStart:I}}),[`${E}-borderless`]:{borderColor:"transparent",background:d.tagBorderlessBg}}};var ae=(0,de.Z)("Tag",d=>{const{fontSize:B,lineHeight:S,lineWidth:e,fontSizeIcon:E}=d,I=Math.round(B*S),U=d.fontSizeSM,G=I-e*2,X=d.colorFillQuaternary,q=d.colorText,H=(0,V.TS)(d,{tagFontSize:U,tagLineHeight:G,tagDefaultBg:X,tagDefaultColor:q,tagIconSize:E-2*e,tagPaddingHorizontal:8,tagBorderlessBg:d.colorFillTertiary});return[O(H),L(H),ee(H,"success","Success"),ee(H,"processing","Info"),ee(H,"error","Error"),ee(H,"warning","Warning")]}),j=function(d,B){var S={};for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&B.indexOf(e)<0&&(S[e]=d[e]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var E=0,e=Object.getOwnPropertySymbols(d);E<e.length;E++)B.indexOf(e[E])<0&&Object.prototype.propertyIsEnumerable.call(d,e[E])&&(S[e[E]]=d[e[E]]);return S},se=d=>{const{prefixCls:B,className:S,checked:e,onChange:E,onClick:I}=d,U=j(d,["prefixCls","className","checked","onChange","onClick"]),{getPrefixCls:G}=F.useContext(_.E_),X=ne=>{E==null||E(!e),I==null||I(ne)},q=G("tag",B),[H,ge]=ae(q),ve=y()(q,{[`${q}-checkable`]:!0,[`${q}-checkable-checked`]:e},S,ge);return H(F.createElement("span",Object.assign({},U,{className:ve,onClick:X})))},z=function(d,B){var S={};for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&B.indexOf(e)<0&&(S[e]=d[e]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var E=0,e=Object.getOwnPropertySymbols(d);E<e.length;E++)B.indexOf(e[E])<0&&Object.prototype.propertyIsEnumerable.call(d,e[E])&&(S[e[E]]=d[e[E]]);return S};const ue=(d,B)=>{const{prefixCls:S,className:e,rootClassName:E,style:I,children:U,icon:G,color:X,onClose:q,closeIcon:H,closable:ge=!1,bordered:ve=!0}=d,ne=z(d,["prefixCls","className","rootClassName","style","children","icon","color","onClose","closeIcon","closable","bordered"]),{getPrefixCls:Ce,direction:W}=F.useContext(_.E_),[be,fe]=F.useState(!0);F.useEffect(()=>{"visible"in ne&&fe(ne.visible)},[ne.visible]);const De=(0,ie.o2)(X)||(0,ie.yT)(X),Oe=Object.assign({backgroundColor:X&&!De?X:void 0},I),M=Ce("tag",S),[Be,Ie]=ae(M),je=y()(M,{[`${M}-${X}`]:De,[`${M}-has-color`]:X&&!De,[`${M}-hidden`]:!be,[`${M}-rtl`]:W==="rtl",[`${M}-borderless`]:!ve},e,E,Ie),ye=Ee=>{Ee.stopPropagation(),q==null||q(Ee),!Ee.defaultPrevented&&fe(!1)},Ne=F.useMemo(()=>ge?H?F.createElement("span",{className:`${M}-close-icon`,onClick:ye},H):F.createElement(w.Z,{className:`${M}-close-icon`,onClick:ye}):null,[ge,H,M,ye]),Ae=typeof ne.onClick=="function"||U&&U.type==="a",Pe=G||null,Me=Pe?F.createElement(F.Fragment,null,Pe,F.createElement("span",null,U)):U,Se=F.createElement("span",Object.assign({},ne,{ref:B,className:je,style:Oe}),Me,Ne);return Be(Ae?F.createElement(K.Z,null,Se):Se)},J=F.forwardRef(ue);J.CheckableTag=se;var ce=J}}]);
