import{_ as N,r,b as q,w as S,o as u,d as h,e as t,f as e,c as F,g as w,F as I,h as s,a as _,t as y,i as E,j as f,k as U}from"./index-eef1c218.js";const L={name:"redisManage",data(){return{loading:!1,connectInfo:{connectId:"",nodes:"",name:"单机or集群",host:"",port:"6379",password:""},dialogVisible:!1,dialogKeyVisible:!1,dialogFieldVisible:!1,url:"---",pattern:"*",connectVos:[],redisDbs:[],defaultProps:{children:"keys",label:"label",isLeaf:"isLeaf"},node_had:null,resolve_had:null,commonVo:{connectId:"",oldRedisKey:"",redisKey:"",redisKeyBase64:"",oldRedisValue:"",redisValue:"",fieldKey:"",score:null,redisDbIndex:null,redisKeyTtl:null,redisKeyType:""},addFieldObj:{fieldKey:"",redisValue:"",score:null},fieldVos:[],redisValueSize:"",fieldCount:"",valueFormat:1,valueFormats:[{name:"Plain Text",value:1},{name:"JSON",value:2}],redisKeyTypes:["string","list","set","hash","zset"],currentRedisDbIndex:null}},methods:{resetData(){this.fieldVos=[],this.redisValueSize="",this.fieldCount="",this.commonVo.redisKey="",this.commonVo.redisKeyBase64="",this.commonVo.redisValue="",this.commonVo.redisDbIndex=null,this.commonVo.redisKeyTtl=null,this.commonVo.redisKeyType="",this.valueFormat=1},valueFormatChange(d){d===2&&(this.commonVo.redisValue=JSON.stringify(JSON.parse(this.commonVo.redisValue),null,"  "))},saveConnect(){this.$request({url:"/redis/saveConnect",method:"post",data:this.connectInfo}).then(d=>{d.data.code===0&&(this.$message.success(d.data.data),this.dialogVisible=!1,this.listConnects())})},pingConnect(){this.$request({url:"/redis/pingConnect",method:"post",data:this.connectInfo}).then(d=>{d.data.code===0&&this.$message.success(d.data.data)})},listConnects(){this.$request({url:"/redis/listConnects",method:"post",data:this.connectInfo}).then(d=>{d.data.code===0&&(this.connectVos=d.data.data,this.connectVos.length>0&&(this.commonVo.connectId=this.connectVos[0].connectId))})},listDb(){if(this.commonVo.connectId===""){this.$message.warning("请选择连接");return}this.loading=!0,this.$request({url:"/redis/listDb/"+this.commonVo.connectId,method:"get"}).then(d=>{this.loading=!1,d.data.code===0&&(this.resetData(),this.redisDbs=d.data.data,this.initUrl())})},loadKeys(d,l){if(!this.commonVo.connectId)return l([]);d.level===1&&(this.node_had=d,this.resolve_had=l)},listKeys(d,l){this.loading=!0,this.currentRedisDbIndex=d.data.redisDbIndex,this.$request({url:"/redis/listKeys/"+this.commonVo.connectId+"/"+d.data.redisDbIndex+"?pattern="+this.pattern,method:"get"}).then(g=>{this.loading=!1,g.data.code===0&&l(g.data.data)})},nodeExpand(d,l){this.listKeys(this.node_had,this.resolve_had)},nodeClick(d,l){l.level==2&&(this.commonVo.redisKey=d.label,this.commonVo.redisKeyBase64=d.labelBase64,this.commonVo.oldRedisKey=d.label,this.commonVo.redisDbIndex=l.parent.data.redisDbIndex,this.reloadValue())},patternEnter(){this.node_had&&this.listKeys(this.node_had,this.resolve_had)},initUrl(){let d=this.connectVos.filter(l=>l.connectId===this.commonVo.connectId);d[0].nodes!==""?this.url=d[0].nodes:this.url=d[0].host+":"+d[0].port},renameKey(){this.commonVo.redisKey&&this.$confirm(`确定将key ${this.commonVo.oldRedisKey} 重命名为 ${this.commonVo.redisKey}?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.loading=!0,this.$request({url:"/redis/renameKey",method:"post",data:this.commonVo}).then(d=>{this.loading=!1,d.data.code===0&&(this.$message.success("操作成功"),this.commonVo.oldRedisKey=d.data.data.redisKey,this.listKeys(this.node_had,this.resolve_had))})}).catch(()=>{})},reloadValue(){this.commonVo.redisKey&&(this.valueFormat=1,this.loading=!0,this.$request({url:"/redis/getValue",method:"post",data:this.commonVo}).then(d=>{if(this.loading=!1,d.data.code===0){let l=d.data.data;this.commonVo.redisValue=l.redisValue,this.commonVo.redisKeyTtl=l.redisKeyTtl,this.commonVo.redisKeyType=l.redisKeyType||"",this.redisValueSize=l.redisValueSize||"",this.fieldCount=l.fieldCount||"",this.fieldVos=l.fieldVos||[]}}))},openAdd(){!this.currentRedisDbIndex&&this.currentRedisDbIndex!==0||(this.dialogKeyVisible=!0)},addKey(){this.loading=!0,Object.assign(this.commonVo,this.addFieldObj),this.commonVo.redisDbIndex=this.currentRedisDbIndex,this.$request({url:"/redis/addKey",method:"post",data:this.commonVo}).then(d=>{this.loading=!1,d.data.code===0&&(this.$message.success("新增成功"),this.listKeys(this.node_had,this.resolve_had),this.dialogKeyVisible=!1)})},delKey(){this.commonVo.redisKey&&this.$confirm(`确定删除key ${this.commonVo.redisKey}?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.loading=!0,this.$request({url:"/redis/delKey",method:"post",data:this.commonVo}).then(d=>{this.loading=!1,d.data.code===0&&(this.$message.success("删除成功"),this.commonVo.redisKey="",this.commonVo.redisValue="",this.listKeys(this.node_had,this.resolve_had))})}).catch(()=>{})},fieldRowClick(d){this.commonVo.fieldKey=d.fieldKey,this.commonVo.redisValue=d.fieldValue,this.commonVo.oldRedisValue=d.fieldValue,this.redisValueSize=d.fieldValueSize},deleteField(d){this.commonVo.redisValue=d.fieldValue,this.commonVo.fieldKey=d.fieldKey,this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.loading=!0,this.$request({url:"/redis/delField",method:"post",data:this.commonVo}).then(l=>{this.loading=!1,l.data.code===0&&(this.$message.success(l.data.data),this.reloadValue())})}).catch(()=>{})},addField(){Object.assign(this.commonVo,this.addFieldObj),this.loading=!0,this.$request({url:"/redis/addField",method:"post",data:this.commonVo}).then(d=>{this.loading=!1,d.data.code===0&&(this.$message.success(d.data.data),this.dialogFieldVisible=!1,this.reloadValue())})},setNewTtl(){this.commonVo.redisKeyTtl&&this.$confirm(`确定将TTL设置为 ${this.commonVo.redisKeyTtl}?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.loading=!0,this.$request({url:"/redis/setNewTtl",method:"post",data:this.commonVo}).then(d=>{this.loading=!1,d.data.code===0&&(this.$message.success(d.data.data),this.reloadValue())})}).catch(()=>{})},saveValue(){this.commonVo.redisValue&&this.$confirm("确定要保存value?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$request({url:"/redis/saveValue",method:"post",data:this.commonVo}).then(d=>{this.loading=!1,d.data.code===0&&this.$message.success("保存成功"),this.reloadValue()})}).catch(()=>{})}},mounted(){this.listConnects()}},M={style:{height:"calc(78vh)",width:"300px"}},J={style:{margin:"6px"}},P=_("template",{slot:"prepend"},[s("TTL")],-1);function A(d,l,g,G,o,n){const b=r("el-option"),K=r("el-select"),m=r("el-col"),a=r("el-button"),v=r("el-row"),D=r("el-header"),O=r("el-tooltip"),c=r("el-input"),j=r("el-tree"),k=r("el-tag"),p=r("el-table-column"),B=r("el-table"),C=r("el-container"),V=r("el-form-item"),x=r("el-form"),T=r("el-dialog"),R=q("loading");return S((u(),h(C,{style:{margin:"6px"}},{default:t(()=>[e(D,null,{default:t(()=>[e(v,{gutter:20},{default:t(()=>[e(m,{span:3},{default:t(()=>[e(K,{modelValue:o.commonVo.connectId,"onUpdate:modelValue":l[0]||(l[0]=i=>o.commonVo.connectId=i),placeholder:"请选择"},{default:t(()=>[(u(!0),F(I,null,w(o.connectVos,i=>(u(),h(b,{key:i.connectId,label:i.name,value:i.connectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(m,{span:2},{default:t(()=>[e(a,{onClick:n.listDb,type:"primary"},{default:t(()=>[s("连接")]),_:1},8,["onClick"])]),_:1}),e(m,{span:2},{default:t(()=>[e(a,{onClick:l[1]||(l[1]=i=>o.dialogVisible=!0),type:"primary"},{default:t(()=>[s("新增连接")]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{style:{height:"calc(78vh)"}},{default:t(()=>[_("div",M,[e(D,{style:{overflow:"hidden",height:"120px"},width:"300px"},{default:t(()=>[e(O,{class:"item",effect:"dark",content:o.url,placement:"bottom"},{default:t(()=>[_("span",null,y(o.url),1)]),_:1},8,["content"]),e(c,{modelValue:o.pattern,"onUpdate:modelValue":l[2]||(l[2]=i=>o.pattern=i),onKeyup:E(n.patternEnter,["enter","native"])},{prepend:t(()=>[s("pattern")]),_:1},8,["modelValue","onKeyup"])]),_:1}),e(j,{style:{height:"420px","overflow-y":"auto"},lazy:"",data:o.redisDbs,props:o.defaultProps,load:n.loadKeys,onNodeExpand:n.nodeExpand,onNodeClick:n.nodeClick},null,8,["data","props","load","onNodeExpand","onNodeClick"])]),e(C,{style:{margin:"10px"}},{default:t(()=>[_("div",J,[e(v,{gutter:40},{default:t(()=>[e(m,{span:12},{default:t(()=>[e(c,{modelValue:o.commonVo.redisKey,"onUpdate:modelValue":l[3]||(l[3]=i=>o.commonVo.redisKey=i)},null,8,["modelValue"])]),_:1}),e(m,{span:2},{default:t(()=>[e(a,{onClick:n.renameKey,type:"primary"},{default:t(()=>[s("重命名key")]),_:1},8,["onClick"])]),_:1}),e(m,{span:2},{default:t(()=>[e(a,{onClick:n.openAdd,type:"primary"},{default:t(()=>[s("新增key")]),_:1},8,["onClick"])]),_:1}),e(m,{span:2},{default:t(()=>[e(a,{onClick:n.delKey,type:"danger"},{default:t(()=>[s("删除key")]),_:1},8,["onClick"])]),_:1})]),_:1}),e(v,{gutter:40,style:{margin:"6px"}},{default:t(()=>[e(m,{span:2},{default:t(()=>[e(k,null,{default:t(()=>[s(y("key类型:"+o.commonVo.redisKeyType),1)]),_:1})]),_:1}),e(m,{span:3},{default:t(()=>[e(k,null,{default:t(()=>[s(y("value大小(bytes):"+o.redisValueSize),1)]),_:1})]),_:1}),e(m,{span:2},{default:t(()=>[e(k,null,{default:t(()=>[s(y("field数量:"+o.fieldCount),1)]),_:1})]),_:1}),e(m,{span:5},{default:t(()=>[e(c,{modelValue:o.commonVo.redisKeyTtl,"onUpdate:modelValue":l[4]||(l[4]=i=>o.commonVo.redisKeyTtl=i)},{default:t(()=>[P]),_:1},8,["modelValue"])]),_:1}),e(m,{span:2},{default:t(()=>[e(a,{onClick:n.setNewTtl,type:"primary"},{default:t(()=>[s("设置TTL")]),_:1},8,["onClick"])]),_:1}),e(m,{span:3},{default:t(()=>[e(K,{modelValue:o.valueFormat,"onUpdate:modelValue":l[5]||(l[5]=i=>o.valueFormat=i),onChange:n.valueFormatChange},{default:t(()=>[(u(!0),F(I,null,w(o.valueFormats,i=>(u(),h(b,{key:i.value,label:i.name,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),e(m,{span:3},{default:t(()=>[e(a,{onClick:n.reloadValue,type:"primary"},{default:t(()=>[s("刷新value")]),_:1},8,["onClick"])]),_:1}),e(m,{span:3},{default:t(()=>[e(a,{onClick:n.saveValue,type:"primary"},{default:t(()=>[s("保存value")]),_:1},8,["onClick"])]),_:1})]),_:1}),o.fieldVos.length>0?(u(),h(B,{key:Math.random(),data:o.fieldVos,onRowClick:n.fieldRowClick,border:"",style:{width:"98%"},height:"170"},{default:t(()=>[o.commonVo.redisKeyType==="hash"?(u(),h(p,{key:0,prop:"fieldKey",label:"field"})):f("",!0),e(p,{prop:"fieldValue",label:"value","show-overflow-tooltip":""}),o.commonVo.redisKeyType==="zset"?(u(),h(p,{key:1,prop:"fieldScore",label:"score"})):f("",!0),e(p,{fixed:"right",label:"操作",width:"150"},{default:t(i=>[e(a,{onClick:l[6]||(l[6]=U(z=>o.dialogFieldVisible=!0,["prevent"])),type:"text",size:"small"},{default:t(()=>[s(" 新增 ")]),_:1}),e(a,{onClick:U(z=>n.deleteField(i.row),["prevent"]),type:"text",size:"small"},{default:t(()=>[s(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onRowClick"])):f("",!0),e(c,{rows:16,type:"textarea",style:{width:"calc(66vw)"},placeholder:"请输入内容",modelValue:o.commonVo.redisValue,"onUpdate:modelValue":l[7]||(l[7]=i=>o.commonVo.redisValue=i)},null,8,["modelValue"])])]),_:1})]),_:1}),o.dialogVisible?(u(),h(T,{key:0,title:"新增连接",modelValue:o.dialogVisible,"onUpdate:modelValue":l[13]||(l[13]=i=>o.dialogVisible=i)},{default:t(()=>[e(x,{ref:"form",model:o.connectInfo,"label-width":"80px"},{default:t(()=>[e(V,{label:"连接名称"},{default:t(()=>[e(c,{modelValue:o.connectInfo.name,"onUpdate:modelValue":l[8]||(l[8]=i=>o.connectInfo.name=i)},null,8,["modelValue"])]),_:1}),e(V,{label:"host"},{default:t(()=>[e(c,{modelValue:o.connectInfo.host,"onUpdate:modelValue":l[9]||(l[9]=i=>o.connectInfo.host=i)},null,8,["modelValue"])]),_:1}),e(V,{label:"端口"},{default:t(()=>[e(c,{modelValue:o.connectInfo.port,"onUpdate:modelValue":l[10]||(l[10]=i=>o.connectInfo.port=i)},null,8,["modelValue"])]),_:1}),e(V,{label:"密码"},{default:t(()=>[e(c,{modelValue:o.connectInfo.password,"onUpdate:modelValue":l[11]||(l[11]=i=>o.connectInfo.password=i),"show-password":""},null,8,["modelValue"])]),_:1}),e(V,null,{default:t(()=>[e(a,{type:"primary",onClick:n.pingConnect},{default:t(()=>[s("测试连接")]),_:1},8,["onClick"]),e(a,{type:"primary",onClick:n.saveConnect},{default:t(()=>[s("保存")]),_:1},8,["onClick"]),e(a,{onClick:l[12]||(l[12]=i=>o.dialogVisible=!1)},{default:t(()=>[s("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])):f("",!0),o.dialogKeyVisible?(u(),h(T,{key:1,title:"新增key",modelValue:o.dialogKeyVisible,"onUpdate:modelValue":l[20]||(l[20]=i=>o.dialogKeyVisible=i)},{default:t(()=>[e(x,{ref:"form1",model:o.addFieldObj,"label-width":"80px"},{default:t(()=>[e(V,{label:"key"},{default:t(()=>[e(c,{modelValue:o.commonVo.redisKey,"onUpdate:modelValue":l[14]||(l[14]=i=>o.commonVo.redisKey=i)},null,8,["modelValue"])]),_:1}),e(V,{label:"type"},{default:t(()=>[e(K,{modelValue:o.commonVo.redisKeyType,"onUpdate:modelValue":l[15]||(l[15]=i=>o.commonVo.redisKeyType=i)},{default:t(()=>[(u(!0),F(I,null,w(o.redisKeyTypes,i=>(u(),h(b,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o.commonVo.redisKeyType==="hash"?(u(),h(V,{key:0,label:"field"},{default:t(()=>[e(c,{modelValue:o.addFieldObj.fieldKey,"onUpdate:modelValue":l[16]||(l[16]=i=>o.addFieldObj.fieldKey=i)},null,8,["modelValue"])]),_:1})):f("",!0),o.commonVo.redisKeyType==="zset"?(u(),h(V,{key:1,label:"score"},{default:t(()=>[e(c,{modelValue:o.addFieldObj.score,"onUpdate:modelValue":l[17]||(l[17]=i=>o.addFieldObj.score=i)},null,8,["modelValue"])]),_:1})):f("",!0),e(V,{label:"value"},{default:t(()=>[e(c,{type:"textarea",rows:"8",modelValue:o.addFieldObj.redisValue,"onUpdate:modelValue":l[18]||(l[18]=i=>o.addFieldObj.redisValue=i)},null,8,["modelValue"])]),_:1}),e(V,null,{default:t(()=>[e(a,{type:"primary",onClick:n.addKey},{default:t(()=>[s("确定")]),_:1},8,["onClick"]),e(a,{onClick:l[19]||(l[19]=i=>o.dialogKeyVisible=!1)},{default:t(()=>[s("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])):f("",!0),o.dialogFieldVisible?(u(),h(T,{key:2,title:"新增",modelValue:o.dialogFieldVisible,"onUpdate:modelValue":l[25]||(l[25]=i=>o.dialogFieldVisible=i)},{default:t(()=>[e(x,{ref:"form2",model:o.addFieldObj,"label-width":"80px"},{default:t(()=>[o.commonVo.redisKeyType==="zset"?(u(),h(V,{key:0,label:"score"},{default:t(()=>[e(c,{modelValue:o.addFieldObj.score,"onUpdate:modelValue":l[21]||(l[21]=i=>o.addFieldObj.score=i)},null,8,["modelValue"])]),_:1})):o.commonVo.redisKeyType==="hash"?(u(),h(V,{key:1,label:"field"},{default:t(()=>[e(c,{modelValue:o.addFieldObj.fieldKey,"onUpdate:modelValue":l[22]||(l[22]=i=>o.addFieldObj.fieldKey=i)},null,8,["modelValue"])]),_:1})):f("",!0),e(V,{label:"value"},{default:t(()=>[e(c,{type:"textarea",rows:"8",modelValue:o.addFieldObj.redisValue,"onUpdate:modelValue":l[23]||(l[23]=i=>o.addFieldObj.redisValue=i)},null,8,["modelValue"])]),_:1}),e(V,null,{default:t(()=>[e(a,{type:"primary",onClick:n.addField},{default:t(()=>[s("确定")]),_:1},8,["onClick"]),e(a,{onClick:l[24]||(l[24]=i=>o.dialogFieldVisible=!1)},{default:t(()=>[s("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])):f("",!0)]),_:1})),[[R,o.loading]])}const Q=N(L,[["render",A]]);export{Q as default};
